(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var _app=require("./src/js/app");var _app2=_interopRequireDefault(_app);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./src/js/app":577}],2:[function(require,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error("after called too many times")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],3:[function(require,module,exports){"use strict";module.exports=angleNormals;function hypot(x,y,z){return Math.sqrt(Math.pow(x,2)+Math.pow(y,2)+Math.pow(z,2))}function weight(s,r,a){return Math.atan2(r,s-a)}function mulAdd(dest,s,x,y,z){dest[0]+=s*x;dest[1]+=s*y;dest[2]+=s*z}function angleNormals(cells,positions){var numVerts=positions.length;var numCells=cells.length;var normals=new Array(numVerts);for(var i=0;i<numVerts;++i){normals[i]=[0,0,0]}for(var i=0;i<numCells;++i){var cell=cells[i];var a=positions[cell[0]];var b=positions[cell[1]];var c=positions[cell[2]];var abx=a[0]-b[0];var aby=a[1]-b[1];var abz=a[2]-b[2];var ab=hypot(abx,aby,abz);var bcx=b[0]-c[0];var bcy=b[1]-c[1];var bcz=b[2]-c[2];var bc=hypot(bcx,bcy,bcz);var cax=c[0]-a[0];var cay=c[1]-a[1];var caz=c[2]-a[2];var ca=hypot(cax,cay,caz);if(Math.min(ab,bc,ca)<1e-6){continue}var s=.5*(ab+bc+ca);var r=Math.sqrt((s-ab)*(s-bc)*(s-ca)/s);var nx=aby*bcz-abz*bcy;var ny=abz*bcx-abx*bcz;var nz=abx*bcy-aby*bcx;var nl=hypot(nx,ny,nz);nx/=nl;ny/=nl;nz/=nl;mulAdd(normals[cell[0]],weight(s,r,bc),nx,ny,nz);mulAdd(normals[cell[1]],weight(s,r,ca),nx,ny,nz);mulAdd(normals[cell[2]],weight(s,r,ab),nx,ny,nz)}for(var i=0;i<numVerts;++i){var n=normals[i];var l=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2));if(l<1e-8){n[0]=1;n[1]=0;n[2]=0;continue}n[0]/=l;n[1]/=l;n[2]/=l}return normals}},{}],4:[function(require,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],5:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":550}],6:[function(require,module,exports){module.exports=function(stream,el,options){var item;var element=el;var opts={autoplay:true,mirror:false,muted:false,audio:false,disableContextMenu:false};if(options){for(item in options){opts[item]=options[item]}}if(!element){element=document.createElement(opts.audio?"audio":"video")}else if(element.tagName.toLowerCase()==="audio"){opts.audio=true}if(opts.disableContextMenu){element.oncontextmenu=function(e){e.preventDefault()}}if(opts.autoplay)element.autoplay="autoplay";if(opts.muted)element.muted=true;if(!opts.audio&&opts.mirror){["","moz","webkit","o","ms"].forEach(function(prefix){var styleName=prefix?prefix+"Transform":"transform";element.style[styleName]="scaleX(-1)"})}element.srcObject=stream;return element}},{}],7:[function(require,module,exports){module.exports={default:require("core-js/library/fn/object/create"),__esModule:true}},{"core-js/library/fn/object/create":43}],8:[function(require,module,exports){module.exports={default:require("core-js/library/fn/object/define-property"),__esModule:true}},{"core-js/library/fn/object/define-property":44}],9:[function(require,module,exports){module.exports={default:require("core-js/library/fn/object/set-prototype-of"),__esModule:true}},{"core-js/library/fn/object/set-prototype-of":45}],10:[function(require,module,exports){module.exports={default:require("core-js/library/fn/symbol"),__esModule:true}},{"core-js/library/fn/symbol":46}],11:[function(require,module,exports){module.exports={default:require("core-js/library/fn/symbol/iterator"),__esModule:true}},{"core-js/library/fn/symbol/iterator":47}],12:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}},{}],13:[function(require,module,exports){"use strict";exports.__esModule=true;var _defineProperty=require("../core-js/object/define-property");var _defineProperty2=_interopRequireDefault(_defineProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;(0,_defineProperty2.default)(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}()},{"../core-js/object/define-property":8}],14:[function(require,module,exports){"use strict";exports.__esModule=true;var _defineProperty=require("../core-js/object/define-property");var _defineProperty2=_interopRequireDefault(_defineProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function(obj,descs){for(var key in descs){var desc=descs[key];desc.configurable=desc.enumerable=true;if("value"in desc)desc.writable=true;(0,_defineProperty2.default)(obj,key,desc)}return obj}},{"../core-js/object/define-property":8}],15:[function(require,module,exports){"use strict";exports.__esModule=true;var _setPrototypeOf=require("../core-js/object/set-prototype-of");var _setPrototypeOf2=_interopRequireDefault(_setPrototypeOf);var _create=require("../core-js/object/create");var _create2=_interopRequireDefault(_create);var _typeof2=require("../helpers/typeof");var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":(0,_typeof3.default)(superClass)))}subClass.prototype=(0,_create2.default)(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)_setPrototypeOf2.default?(0,_setPrototypeOf2.default)(subClass,superClass):subClass.__proto__=superClass}},{"../core-js/object/create":7,"../core-js/object/set-prototype-of":9,"../helpers/typeof":17}],16:[function(require,module,exports){"use strict";exports.__esModule=true;var _typeof2=require("../helpers/typeof");var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":(0,_typeof3.default)(call))==="object"||typeof call==="function")?call:self}},{"../helpers/typeof":17}],17:[function(require,module,exports){"use strict";exports.__esModule=true;var _iterator=require("../core-js/symbol/iterator");var _iterator2=_interopRequireDefault(_iterator);var _symbol=require("../core-js/symbol");var _symbol2=_interopRequireDefault(_symbol);var _typeof=typeof _symbol2.default==="function"&&typeof _iterator2.default==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof _symbol2.default==="function"&&obj.constructor===_symbol2.default&&obj!==_symbol2.default.prototype?"symbol":typeof obj};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=typeof _symbol2.default==="function"&&_typeof(_iterator2.default)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":_typeof(obj)}:function(obj){return obj&&typeof _symbol2.default==="function"&&obj.constructor===_symbol2.default&&obj!==_symbol2.default.prototype?"symbol":typeof obj==="undefined"?"undefined":_typeof(obj)}},{"../core-js/symbol":10,"../core-js/symbol/iterator":11}],18:[function(require,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],19:[function(require,module,exports){(function(){"use strict";var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var lookup=new Uint8Array(256);for(var i=0;i<chars.length;i++){lookup[chars.charCodeAt(i)]=i}exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=lookup[base64.charCodeAt(i)];encoded2=lookup[base64.charCodeAt(i+1)];encoded3=lookup[base64.charCodeAt(i+2)];encoded4=lookup[base64.charCodeAt(i+3)];bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})()},{}],20:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],21:[function(require,module,exports){var trailingNewlineRegex=/\n[\s]+$/;var leadingNewlineRegex=/^\n[\s]+/;var trailingSpaceRegex=/[\s]+$/;var leadingSpaceRegex=/^[\s]+/;var multiSpaceRegex=/[\n\s]+/g;var TEXT_TAGS=["a","abbr","b","bdi","bdo","br","cite","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","amp","small","span","strong","sub","sup","time","u","var","wbr"];var CODE_TAGS=["code","pre"];module.exports=function appendChild(el,childs){if(!Array.isArray(childs))return;var nodeName=el.nodeName.toLowerCase();var hadText=false;var value,leader;for(var i=0,len=childs.length;i<len;i++){var node=childs[i];if(Array.isArray(node)){appendChild(el,node);continue}if(typeof node==="number"||typeof node==="boolean"||typeof node==="function"||node instanceof Date||node instanceof RegExp){node=node.toString()}var lastChild=el.childNodes[el.childNodes.length-1];if(typeof node==="string"){hadText=true;if(lastChild&&lastChild.nodeName==="#text"){lastChild.nodeValue+=node}else{node=document.createTextNode(node);el.appendChild(node);lastChild=node}if(i===len-1){hadText=false;if(TEXT_TAGS.indexOf(nodeName)===-1&&CODE_TAGS.indexOf(nodeName)===-1){value=lastChild.nodeValue.replace(leadingNewlineRegex,"").replace(trailingSpaceRegex,"").replace(trailingNewlineRegex,"").replace(multiSpaceRegex," ");if(value===""){el.removeChild(lastChild)}else{lastChild.nodeValue=value}}else if(CODE_TAGS.indexOf(nodeName)===-1){leader=i===0?"":" ";value=lastChild.nodeValue.replace(leadingNewlineRegex,leader).replace(leadingSpaceRegex," ").replace(trailingSpaceRegex,"").replace(trailingNewlineRegex,"").replace(multiSpaceRegex," ");lastChild.nodeValue=value}}}else if(node&&node.nodeType){if(hadText){hadText=false;if(TEXT_TAGS.indexOf(nodeName)===-1&&CODE_TAGS.indexOf(nodeName)===-1){value=lastChild.nodeValue.replace(leadingNewlineRegex,"").replace(trailingNewlineRegex,"").replace(multiSpaceRegex," ");if(value===""){el.removeChild(lastChild)}else{lastChild.nodeValue=value}}else if(CODE_TAGS.indexOf(nodeName)===-1){value=lastChild.nodeValue.replace(leadingSpaceRegex," ").replace(leadingNewlineRegex,"").replace(trailingNewlineRegex,"").replace(multiSpaceRegex," ");lastChild.nodeValue=value}}var _nodeName=node.nodeName;if(_nodeName)nodeName=_nodeName.toLowerCase();el.appendChild(node)}}}},{}],22:[function(require,module,exports){var hyperx=require("hyperx");var appendChild=require("./appendChild");var SVGNS="http://www.w3.org/2000/svg";var XLINKNS="http://www.w3.org/1999/xlink";var BOOL_PROPS=["autofocus","checked","defaultchecked","disabled","formnovalidate","indeterminate","readonly","required","selected","willvalidate"];var COMMENT_TAG="!--";var SVG_TAGS=["svg","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"];function belCreateElement(tag,props,children){var el;if(SVG_TAGS.indexOf(tag)!==-1){props.namespace=SVGNS}var ns=false;if(props.namespace){ns=props.namespace;delete props.namespace}if(ns){el=document.createElementNS(ns,tag)}else if(tag===COMMENT_TAG){return document.createComment(props.comment)}else{el=document.createElement(tag)}for(var p in props){if(props.hasOwnProperty(p)){var key=p.toLowerCase();var val=props[p];if(key==="classname"){key="class";p="class"}if(p==="htmlFor"){p="for"}if(BOOL_PROPS.indexOf(key)!==-1){if(val==="true")val=key;else if(val==="false")continue}if(key.slice(0,2)==="on"){el[p]=val}else{if(ns){if(p==="xlink:href"){el.setAttributeNS(XLINKNS,p,val)}else if(/^xmlns($|:)/i.test(p)){}else{el.setAttributeNS(null,p,val)}}else{el.setAttribute(p,val)}}}}appendChild(el,children);return el}module.exports=hyperx(belCreateElement,{comments:true});module.exports.default=module.exports;module.exports.createElement=belCreateElement},{"./appendChild":21,hyperx:214}],23:[function(require,module,exports){"use strict";"use restrict";var INT_BITS=32;exports.INT_BITS=INT_BITS;exports.INT_MAX=2147483647;exports.INT_MIN=-1<<INT_BITS-1;exports.sign=function(v){return(v>0)-(v<0)};exports.abs=function(v){var mask=v>>INT_BITS-1;return(v^mask)-mask};exports.min=function(x,y){return y^(x^y)&-(x<y)};exports.max=function(x,y){return x^(x^y)&-(x<y)};exports.isPow2=function(v){return!(v&v-1)&&!!v};exports.log2=function(v){var r,shift;r=(v>65535)<<4;v>>>=r;shift=(v>255)<<3;v>>>=shift;r|=shift;shift=(v>15)<<2;v>>>=shift;r|=shift;shift=(v>3)<<1;v>>>=shift;r|=shift;return r|v>>1};exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0};exports.popCount=function(v){v=v-(v>>>1&1431655765);v=(v&858993459)+(v>>>2&858993459);return(v+(v>>>4)&252645135)*16843009>>>24};function countTrailingZeros(v){var c=32;v&=-v;if(v)c--;if(v&65535)c-=16;if(v&16711935)c-=8;if(v&252645135)c-=4;if(v&858993459)c-=2;if(v&1431655765)c-=1;return c}exports.countTrailingZeros=countTrailingZeros;exports.nextPow2=function(v){v+=v===0;--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v+1};exports.prevPow2=function(v){v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v-(v>>>1)};exports.parity=function(v){v^=v>>>16;v^=v>>>8;v^=v>>>4;v&=15;return 27030>>>v&1};var REVERSE_TABLE=new Array(256);(function(tab){for(var i=0;i<256;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1){r<<=1;r|=v&1;--s}tab[i]=r<<s&255}})(REVERSE_TABLE);exports.reverse=function(v){return REVERSE_TABLE[v&255]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]};exports.interleave2=function(x,y){x&=65535;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y&=65535;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1};exports.deinterleave2=function(v,n){v=v>>>n&1431655765;v=(v|v>>>1)&858993459;v=(v|v>>>2)&252645135;v=(v|v>>>4)&16711935;v=(v|v>>>16)&65535;return v<<16>>16};exports.interleave3=function(x,y,z){x&=1023;x=(x|x<<16)&4278190335;x=(x|x<<8)&251719695;x=(x|x<<4)&3272356035;x=(x|x<<2)&1227133513;y&=1023;y=(y|y<<16)&4278190335;y=(y|y<<8)&251719695;y=(y|y<<4)&3272356035;y=(y|y<<2)&1227133513;x|=y<<1;z&=1023;z=(z|z<<16)&4278190335;z=(z|z<<8)&251719695;z=(z|z<<4)&3272356035;z=(z|z<<2)&1227133513;return x|z<<2};exports.deinterleave3=function(v,n){v=v>>>n&1227133513;v=(v|v>>>2)&3272356035;v=(v|v>>>4)&251719695;v=(v|v>>>8)&4278190335;v=(v|v>>>16)&1023;return v<<22>>22};exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],24:[function(require,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob(["hi"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],25:[function(require,module,exports){},{}],26:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(isArrayBuffer(value)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(isArrayBufferView(obj)||"length"in obj){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(isArrayBufferView(string)||isArrayBuffer(string)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding);var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||obj!=null&&obj.constructor!=null&&obj.constructor.name==="ArrayBuffer"&&typeof obj.byteLength==="number"}function isArrayBufferView(obj){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}},{"base64-js":20,ieee754:216}],27:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var storage=require("./lib/storage");var logger=require("./lib/logger");var debug=require("./lib/debug");var copy=require("./lib/copy");var help=require("./lib/help");var log=require("./lib/log");var getAllRoutes=require("wayfarer/get-all-routes");module.exports=expose;function expose(){store.storeName="choo-devtools";return store;function store(state,emitter,app){var localEmitter=new EventEmitter;if(typeof window!=="undefined"){logger(state,emitter,app)}emitter.on("DOMContentLoaded",function(){if(typeof window==="undefined")return;window.choo={};window.choo.state=state;window.choo.emit=function(eventName,data){emitter.emit(eventName,data)};window.choo.on=function(eventName,listener){emitter.on(eventName,listener)};Object.defineProperty(window.choo,"debug",debug(state,emitter,app,localEmitter));window.choo.log=log(state,emitter,app,localEmitter);window.choo.copy=copy;window.choo.routes=Object.keys(getAllRoutes(app.router.router));storage();help()})}}},{"./lib/copy":28,"./lib/debug":29,"./lib/help":30,"./lib/log":31,"./lib/logger":32,"./lib/storage":33,events:173,"wayfarer/get-all-routes":557}],28:[function(require,module,exports){var stateCopy=require("state-copy");var pluck=require("plucker");module.exports=copy;function copy(state){var isStateString=state&&typeof state==="string";var isChooPath=isStateString&&arguments.length===1&&state.indexOf("state.")===0;if(!state||typeof state==="function")state=window.choo.state;if(isChooPath)[].push.call(arguments,{state:window.choo.state});stateCopy(isStateString?pluck.apply(this,arguments):state)}},{plucker:421,"state-copy":540}],29:[function(require,module,exports){var onChange=require("object-change-callsite");var nanologger=require("nanologger");var assert=require("assert");var enabledMessage="Debugging enabled. To disable run: `choo.debug = false`";var disabledMessage="Debugging disabled. We hope it was helpful! 🙌";module.exports=debug;function debug(state,emitter,app,localEmitter){var log=nanologger("choo-devtools");var enabled=window.localStorage.logLevel==="debug";if(enabled)log.info(enabledMessage);state=onChange(state,function(attr,value,callsite){if(!enabled)return;callsite=callsite.split("\n")[1].replace(/^ +/,"");log.info(`state.${attr}`,value,"\n"+callsite)});app.state=state;return{get:function(){window.localStorage.logLevel="debug";localEmitter.emit("debug",true);enabled=true;return enabledMessage},set:function(bool){assert.equal(typeof bool,"boolean","choo-devtools.debug: bool should be type boolean");window.localStorage.logLevel=bool?"debug":"info";enabled=bool;localEmitter.emit("debug",enabled);if(enabled)log.info(enabledMessage);else log.info(disabledMessage)}}}},{assert:5,nanologger:234,"object-change-callsite":245}],30:[function(require,module,exports){module.exports=help;function help(){Object.defineProperty(window.choo,"help",{get:get});function get(){setTimeout(function(){print("copy","Serialize the current state to the clipboard.");print("debug","Enable Choo debug mode.");print("emit","Emit an event in the Choo emitter.");print("help","Print usage information.");print("log","Print the last 150 events emitted.");print("on","Listen for an event in the Choo emitter.");print("once","Listen for an event once in the Choo emitter.");print("state","Print the Choo state object.");print("storage","Print browser storage information.")},0);return"Choo command overview"}}function print(cmd,desc){var color="#cc99cc";console.log("  %cchoo."+cmd,"color: "+color,"— "+desc)}},{}],31:[function(require,module,exports){var removeItems=require("remove-array-items");var onIdle=require("on-idle");var clone=require("clone");var MAX_HISTORY_LENGTH=150;module.exports=log;function log(state,emitter,app,localEmitter){var shouldDebug=window.localStorage.logLevel==="debug";var history=[];var i=0;localEmitter.on("debug",function(bool){shouldDebug=bool});window.choo._history=history;window.choo.history=showHistory;Object.defineProperty(window.choo,"log",{get:showHistory});Object.defineProperty(window.choo,"history",{get:showHistory});emitter.on("*",function(name,data){i+=1;var entry=new Event(name,data,state);history.push(entry);onIdle(function(){var length=history.length;if(length>MAX_HISTORY_LENGTH){removeItems(history,0,length-MAX_HISTORY_LENGTH)}})});function showHistory(){setTimeout(function(){console.table(history)},0);var events=i===1?"event":"events";var msg=`${i} ${events} recorded, showing the last ${MAX_HISTORY_LENGTH}.`;if(shouldDebug===false){msg+=" Enable state capture by calling `choo.debug`."}else{msg+=" Disable state capture by calling `choo.debug = false`."}return msg}function Event(name,data,state){this.name=name;this.data=data===undefined?"<no data>":data;this.state=shouldDebug?clone(state):"<disabled>"}}},{clone:34,"on-idle":247,"remove-array-items":434}],32:[function(require,module,exports){var nanologger=require("nanologger");var nanotiming=require("nanotiming");var Hooks=require("choo-hooks");var onIdle=require("on-idle");module.exports=logger;function logger(state,emitter){var initialRender=true;var hooks=Hooks(emitter);var log=nanologger("choo");hooks.on("log:debug",logger("debug"));hooks.on("log:info",logger("info"));hooks.on("log:warn",logger("warn"));hooks.on("log:error",logger("error"));hooks.on("log:fatal",logger("fatal"));hooks.on("event",function(eventName,data,timing){if(timing){var duration=timing.duration.toFixed();var level=duration<50?"info":"warn";if(data!==undefined)logger(level)(eventName,data,duration+"ms");else logger(level)(eventName,duration+"ms")}else{if(data!==undefined)logger("info")(eventName,data);else logger("info")(eventName)}});hooks.on("use",function(count,duration){logger("debug")("use",{count:count},duration+"ms")});hooks.on("unhandled",function(eventName,data){logger("error")("No listeners for "+eventName)});hooks.on("DOMContentLoaded",function(timing){if(!timing)return logger("info")("DOMContentLoaded");var level=timing.interactive<1e3?"info":"warn";logger(level)("DOMContentLoaded",timing.interactive+"ms to interactive")});hooks.on("render",function(timings){if(!timings)return logger("info")("render");var duration=timings.render.duration.toFixed();var msg="render";if(initialRender){initialRender=false;msg="initial "+msg}var fps=Math.min((600/duration).toFixed(),60);if(fps===60){logger("info")(msg,fps+"fps",duration+"ms")}else{logger("warn")(msg,fps+"fps",duration+"ms",{render:timings.render.duration.toFixed()+"ms",morph:timings.morph.duration.toFixed()+"ms"})}});hooks.on("resource-timing-buffer-full",function(){logger("error")("The browser's Resource Resource timing buffer is full. Cannot store any more timing information")});hooks.start();function logger(level){return function(){var args=[];for(var i=0,len=arguments.length;i<len;i++){args.push(arguments[i])}onIdle(function(){var timing=nanotiming("choo-log."+level);log[level].apply(log,args);timing()})}}}},{"choo-hooks":35,nanologger:234,nanotiming:241,"on-idle":247}],33:[function(require,module,exports){var pretty=require("prettier-bytes");module.exports=storage;function storage(){Object.defineProperty(window.choo,"storage",{get:get});function get(){if(navigator.storage){navigator.storage.estimate().then(function(estimate){var value=(estimate.usage/estimate.quota).toFixed();clr("Max storage:",fmt(estimate.quota));clr("Storage used:",fmt(estimate.usage)+" ("+value+"%)");navigator.storage.persisted().then(function(bool){var val=bool?"enabled":"disabled";clr("Persistent storage:",val)})});return"Calculating storage quota…"}else{var protocol=window.location.protocol;return/https/.test(protocol)?"The Storage API is unavailable in this browser. We're sorry!":"The Storage API is unavailable. Serving this site over HTTPS might help enable it!"}}}function clr(msg,arg){var color="#cc99cc";console.log("%c"+msg,"color: "+color,arg)}function fmt(num){return pretty(num).replace(" ","")}},{"prettier-bytes":422}],34:[function(require,module,exports){(function(Buffer){var clone=function(){"use strict";function _instanceof(obj,type){return type!=null&&obj instanceof type}var nativeMap;try{nativeMap=Map}catch(_){nativeMap=function(){}}var nativeSet;try{nativeSet=Set}catch(_){nativeSet=function(){}}var nativePromise;try{nativePromise=Promise}catch(_){nativePromise=function(){}}function clone(parent,circular,depth,prototype,includeNonEnumerable){if(typeof circular==="object"){depth=circular.depth;prototype=circular.prototype;includeNonEnumerable=circular.includeNonEnumerable;circular=circular.circular}var allParents=[];var allChildren=[];var useBuffer=typeof Buffer!="undefined";if(typeof circular=="undefined")circular=true;if(typeof depth=="undefined")depth=Infinity;function _clone(parent,depth){if(parent===null)return null;if(depth===0)return parent;var child;var proto;if(typeof parent!="object"){return parent}if(_instanceof(parent,nativeMap)){child=new nativeMap}else if(_instanceof(parent,nativeSet)){child=new nativeSet}else if(_instanceof(parent,nativePromise)){child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})})}else if(clone.__isArray(parent)){child=[]}else if(clone.__isRegExp(parent)){child=new RegExp(parent.source,__getRegExpFlags(parent));if(parent.lastIndex)child.lastIndex=parent.lastIndex}else if(clone.__isDate(parent)){child=new Date(parent.getTime())}else if(useBuffer&&Buffer.isBuffer(parent)){child=new Buffer(parent.length);parent.copy(child);return child}else if(_instanceof(parent,Error)){child=Object.create(parent)}else{if(typeof prototype=="undefined"){proto=Object.getPrototypeOf(parent);child=Object.create(proto)}else{child=Object.create(prototype);proto=prototype}}if(circular){var index=allParents.indexOf(parent);if(index!=-1){return allChildren[index]}allParents.push(parent);allChildren.push(child)}if(_instanceof(parent,nativeMap)){parent.forEach(function(value,key){var keyChild=_clone(key,depth-1);var valueChild=_clone(value,depth-1);child.set(keyChild,valueChild)})}if(_instanceof(parent,nativeSet)){parent.forEach(function(value){var entryChild=_clone(value,depth-1);child.add(entryChild)})}for(var i in parent){var attrs;if(proto){attrs=Object.getOwnPropertyDescriptor(proto,i)}if(attrs&&attrs.set==null){continue}child[i]=_clone(parent[i],depth-1)}if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(parent);for(var i=0;i<symbols.length;i++){var symbol=symbols[i];var descriptor=Object.getOwnPropertyDescriptor(parent,symbol);if(descriptor&&!descriptor.enumerable&&!includeNonEnumerable){continue}child[symbol]=_clone(parent[symbol],depth-1);if(!descriptor.enumerable){Object.defineProperty(child,symbol,{enumerable:false})}}}if(includeNonEnumerable){var allPropertyNames=Object.getOwnPropertyNames(parent);for(var i=0;i<allPropertyNames.length;i++){var propertyName=allPropertyNames[i];var descriptor=Object.getOwnPropertyDescriptor(parent,propertyName);if(descriptor&&descriptor.enumerable){continue}child[propertyName]=_clone(parent[propertyName],depth-1);Object.defineProperty(child,propertyName,{enumerable:false})}}return child}return _clone(parent,depth)}clone.clonePrototype=function clonePrototype(parent){if(parent===null)return null;var c=function(){};c.prototype=parent;return new c};function __objToStr(o){return Object.prototype.toString.call(o)}clone.__objToStr=__objToStr;function __isDate(o){return typeof o==="object"&&__objToStr(o)==="[object Date]"}clone.__isDate=__isDate;function __isArray(o){return typeof o==="object"&&__objToStr(o)==="[object Array]"}clone.__isArray=__isArray;function __isRegExp(o){return typeof o==="object"&&__objToStr(o)==="[object RegExp]"}clone.__isRegExp=__isRegExp;function __getRegExpFlags(re){var flags="";if(re.global)flags+="g";if(re.ignoreCase)flags+="i";if(re.multiline)flags+="m";return flags}clone.__getRegExpFlags=__getRegExpFlags;return clone}();if(typeof module==="object"&&module.exports){module.exports=clone}}).call(this,require("buffer").Buffer)},{buffer:26}],35:[function(require,module,exports){var onPerformance=require("on-performance");var onIdle=require("on-idle");var assert=require("assert");module.exports=ChooHooks;function ChooHooks(emitter){if(!(this instanceof ChooHooks))return new ChooHooks(emitter);assert.equal(typeof emitter,"object");this.hasWindow=typeof window!=="undefined";this.hasIdleCallback=this.hasWindow&&window.requestIdleCallback;this.hasPerformance=this.hasWindow&&window.performance&&window.performance.getEntriesByName;this.emitter=emitter;this.listeners={};this.buffer={use:[],render:[],events:{}}}ChooHooks.prototype.on=function(name,handler){this.listeners[name]=handler};ChooHooks.prototype.start=function(){var self=this;if(this.hasPerformance){window.performance.onresourcetimingbufferfull=function(){var listener=self.listeners["resource-timing-buffer-full"];if(listener)listener()}}onPerformance(function(timing){if(!timing)return;if(timing.entryType!=="measure")return;var eventName=timing.name;if(/choo\.morph/.test(eventName)){self.buffer.render.push(timing)}else if(/choo\.router/.test(eventName)){self.buffer.render.push(timing)}else if(/choo\.render/.test(eventName)){self.buffer.render.push(timing)}else if(/choo\.use/.test(eventName)){self.buffer.use.push(timing)}else if(/choo\.emit/.test(eventName)&&!/log:/.test(eventName)){var eventListener=self.listeners["event"];if(eventListener){var timingName=eventName.match(/choo\.emit\('(.*)'\)/)[1];if(timingName==="render"||timingName==="DOMContentLoaded")return;var traceId=eventName.match(/\[(\d+)\]/)[1];var data=self.buffer.events[traceId];self.buffer.events[traceId]=null;eventListener(timingName,data,timing)}}if(self.buffer.render.length===3){var renderListener=self.listeners["render"];if(!renderListener)return;var timings={};while(self.buffer.render.length){var _timing=self.buffer.render.pop();var name=_timing.name;if(/choo\.render/.test(name))timings.render=_timing;else if(/choo\.morph/.test(name))timings.morph=_timing;else timings.route=_timing}renderListener(timings)}});this.emitter.on("*",function(eventName,data,uuid){var logLevel=/^log:(\w{4,5})/.exec(eventName);if(!self.hasPerformance&&eventName==="render"){var renderListener=self.listeners["render"];if(renderListener)renderListener()}else if(eventName==="DOMContentLoaded"){self._emitLoaded()}else if(logLevel){logLevel=logLevel[1];var logListener=self.listeners["log:"+logLevel];if(logListener)logListener(eventName,data)}else if(!self.emitter.listeners(eventName).length){var unhandledListener=self.listeners["unhandled"];if(unhandledListener)unhandledListener(eventName,data)}else if(eventName!=="render"){if(self.hasPerformance)self.buffer.events[uuid]=data}})};ChooHooks.prototype._emitLoaded=function(){var self=this;onIdle(function clear(){var listener=self.listeners["DOMContentLoaded"];var usesListener=self.listeners["use"];var timing=self.hasWindow&&window.performance&&window.performance.timing;if(listener&&timing){listener({interactive:timing.domInteractive-timing.navigationStart,loaded:timing.domContentLoadedEventEnd-timing.navigationStart})}if(self.hasPerformance){var duration=sumDurations(self.buffer.use);if(usesListener)usesListener(self.buffer.use.length,duration)}else{usesListener()}})};function sumDurations(timings){return timings.reduce(function(sum,timing){return sum+timing.duration},0).toFixed()}},{assert:5,"on-idle":247,"on-performance":249}],36:[function(require,module,exports){module.exports=require("bel")},{bel:22}],37:[function(require,module,exports){var scrollToAnchor=require("scroll-to-anchor");var documentReady=require("document-ready");var nanolocation=require("nanolocation");var nanotiming=require("nanotiming");var nanorouter=require("nanorouter");var nanomorph=require("nanomorph");var nanoquery=require("nanoquery");var nanohref=require("nanohref");var nanoraf=require("nanoraf");var nanobus=require("nanobus");var assert=require("assert");var xtend=require("xtend");module.exports=Choo;var HISTORY_OBJECT={};function Choo(opts){if(!(this instanceof Choo))return new Choo(opts);opts=opts||{};assert.equal(typeof opts,"object","choo: opts should be type object");var self=this;this._events={DOMCONTENTLOADED:"DOMContentLoaded",DOMTITLECHANGE:"DOMTitleChange",REPLACESTATE:"replaceState",PUSHSTATE:"pushState",NAVIGATE:"navigate",POPSTATE:"popState",RENDER:"render"};this._historyEnabled=opts.history===undefined?true:opts.history;this._hrefEnabled=opts.href===undefined?true:opts.href;this._hasWindow=typeof window!=="undefined";this._createLocation=nanolocation;this._loaded=false;this._tree=null;this.router=nanorouter({curry:true});this.emitter=nanobus("choo.emit");var events={events:this._events};if(this._hasWindow){this.state=window.initialState?xtend(window.initialState,events):events;delete window.initialState}else{this.state=events}if(this._hasWindow)this.state.title=document.title;this.emitter.prependListener(this._events.DOMTITLECHANGE,function(title){assert.equal(typeof title,"string","events.DOMTitleChange: title should be type string");self.state.title=title;if(self._hasWindow)document.title=title})}Choo.prototype.route=function(route,handler){assert.equal(typeof route,"string","choo.route: route should be type string");assert.equal(typeof handler,"function","choo.handler: route should be type function");var self=this;this.router.on(route,function(params){return function(){self.state.params=params;self.state.route=route;var routeTiming=nanotiming("choo.route('"+route+"')");var res=handler(self.state,function(eventName,data){self.emitter.emit(eventName,data)});routeTiming();return res}})};Choo.prototype.use=function(cb){assert.equal(typeof cb,"function","choo.use: cb should be type function");var msg="choo.use";msg=cb.storeName?msg+"("+cb.storeName+")":msg;var endTiming=nanotiming(msg);cb(this.state,this.emitter,this);endTiming()};Choo.prototype.start=function(){assert.equal(typeof window,"object","choo.start: window was not found. .start() must be called in a browser, use .toString() if running in Node");var self=this;if(this._historyEnabled){this.emitter.prependListener(this._events.NAVIGATE,function(){self.state.query=nanoquery(window.location.search);if(self._loaded){self.emitter.emit(self._events.RENDER);setTimeout(scrollToAnchor.bind(null,window.location.hash),0)}});this.emitter.prependListener(this._events.POPSTATE,function(){self.emitter.emit(self._events.NAVIGATE)});this.emitter.prependListener(this._events.PUSHSTATE,function(href){assert.equal(typeof href,"string","events.pushState: href should be type string");window.history.pushState(HISTORY_OBJECT,null,href);self.emitter.emit(self._events.NAVIGATE)});this.emitter.prependListener(this._events.REPLACESTATE,function(href){assert.equal(typeof href,"string","events.replaceState: href should be type string");window.history.replaceState(HISTORY_OBJECT,null,href);self.emitter.emit(self._events.NAVIGATE)});window.onpopstate=function(){self.emitter.emit(self._events.POPSTATE)};if(self._hrefEnabled){nanohref(function(location){var href=location.href;var currHref=window.location.href;if(href===currHref)return;self.emitter.emit(self._events.PUSHSTATE,href)})}}this.state.href=this._createLocation();this.state.query=nanoquery(window.location.search);this._tree=this.router(this.state.href);assert.ok(this._tree,"choo.start: no valid DOM node returned for location "+this.state.href);this.emitter.prependListener(self._events.RENDER,nanoraf(function(){var renderTiming=nanotiming("choo.render");self.state.href=self._createLocation();var newTree=self.router(self.state.href);assert.ok(newTree,"choo.render: no valid DOM node returned for location "+self.state.href);assert.equal(self._tree.nodeName,newTree.nodeName,"choo.render: The target node <"+self._tree.nodeName.toLowerCase()+"> is not the same type as the new node <"+newTree.nodeName.toLowerCase()+">.");var morphTiming=nanotiming("choo.morph");nanomorph(self._tree,newTree);morphTiming();renderTiming()}));documentReady(function(){self.emitter.emit(self._events.DOMCONTENTLOADED);self._loaded=true});return this._tree};Choo.prototype.mount=function mount(selector){assert.equal(typeof window,"object","choo.mount: window was not found. .mount() must be called in a browser, use .toString() if running in Node");assert.equal(typeof selector,"string","choo.mount: selector should be type string");var self=this;documentReady(function(){var renderTiming=nanotiming("choo.render");var newTree=self.start();self._tree=document.querySelector(selector);assert.ok(self._tree,"choo.mount: could not query selector: "+selector);assert.equal(self._tree.nodeName,newTree.nodeName,"choo.mount: The target node <"+self._tree.nodeName.toLowerCase()+"> is not the same type as the new node <"+newTree.nodeName.toLowerCase()+">.");var morphTiming=nanotiming("choo.morph");nanomorph(self._tree,newTree);morphTiming();renderTiming()})};Choo.prototype.toString=function(location,state){this.state=xtend(this.state,state||{});assert.notEqual(typeof window,"object","choo.mount: window was found. .toString() must be called in Node, use .start() or .mount() if running in the browser");assert.equal(typeof location,"string","choo.toString: location should be type string");assert.equal(typeof this.state,"object","choo.toString: state should be type object");this.state.href=location.replace(/\?.+$/,"");this.state.query=nanoquery(location);var html=this.router(location);assert.ok(html,"choo.toString: no valid value returned for the route "+location);return html.toString()}},{assert:5,"document-ready":155,nanobus:230,nanohref:232,nanolocation:233,nanomorph:235,nanoquery:238,nanoraf:239,nanorouter:240,nanotiming:241,"scroll-to-anchor":445,xtend:574}],38:[function(require,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],39:[function(require,module,exports){if(typeof module!=="undefined"){module.exports=Emitter}function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks["$"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks["$"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],40:[function(require,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],41:[function(require,module,exports){"use strict";module.exports=(input=>{const el=document.createElement("textarea");el.value=input;el.setAttribute("readonly","");el.style.contain="strict";el.style.position="absolute";el.style.left="-9999px";el.style.fontSize="12pt";const selection=getSelection();let originalRange=false;if(selection.rangeCount>0){originalRange=selection.getRangeAt(0)}document.body.appendChild(el);el.select();el.selectionStart=0;el.selectionEnd=input.length;let success=false;try{success=document.execCommand("copy")}catch(err){}document.body.removeChild(el);if(originalRange){selection.removeAllRanges();selection.addRange(originalRange)}return success})},{}],42:[function(require,module,exports){require("../../modules/es6.object.assign");module.exports=require("../../modules/_core").Object.assign},{"../../modules/_core":119,"../../modules/es6.object.assign":150}],43:[function(require,module,exports){require("../../modules/es6.object.create");var $Object=require("../../modules/_core").Object;module.exports=function create(P,D){return $Object.create(P,D)}},{"../../modules/_core":53,"../../modules/es6.object.create":106}],44:[function(require,module,exports){require("../../modules/es6.object.define-property");var $Object=require("../../modules/_core").Object;module.exports=function defineProperty(it,key,desc){return $Object.defineProperty(it,key,desc)}},{"../../modules/_core":53,"../../modules/es6.object.define-property":107}],45:[function(require,module,exports){require("../../modules/es6.object.set-prototype-of");module.exports=require("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":53,"../../modules/es6.object.set-prototype-of":108}],46:[function(require,module,exports){require("../../modules/es6.symbol");require("../../modules/es6.object.to-string");require("../../modules/es7.symbol.async-iterator");require("../../modules/es7.symbol.observable");module.exports=require("../../modules/_core").Symbol},{"../../modules/_core":53,"../../modules/es6.object.to-string":109,"../../modules/es6.symbol":111,"../../modules/es7.symbol.async-iterator":112,"../../modules/es7.symbol.observable":113}],47:[function(require,module,exports){require("../../modules/es6.string.iterator");require("../../modules/web.dom.iterable");module.exports=require("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":103,"../../modules/es6.string.iterator":110,"../../modules/web.dom.iterable":114}],48:[function(require,module,exports){module.exports=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it}},{}],49:[function(require,module,exports){module.exports=function(){}},{}],50:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}},{"./_is-object":69}],51:[function(require,module,exports){var toIObject=require("./_to-iobject"),toLength=require("./_to-length"),toIndex=require("./_to-index");module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIObject($this),length=toLength(O.length),index=toIndex(fromIndex,length),value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index||0}return!IS_INCLUDES&&-1}}},{"./_to-index":95,"./_to-iobject":97,"./_to-length":98}],52:[function(require,module,exports){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1)}},{}],53:[function(require,module,exports){var core=module.exports={version:"2.4.0"};if(typeof __e=="number")__e=core},{}],54:[function(require,module,exports){var aFunction=require("./_a-function");module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},{"./_a-function":48}],55:[function(require,module,exports){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it}},{}],56:[function(require,module,exports){module.exports=!require("./_fails")(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},{"./_fails":61}],57:[function(require,module,exports){var isObject=require("./_is-object"),document=require("./_global").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},{"./_global":62,"./_is-object":69}],58:[function(require,module,exports){module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],59:[function(require,module,exports){var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie");module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols){var symbols=getSymbols(it),isEnum=pIE.f,i=0,key;while(symbols.length>i)if(isEnum.call(it,key=symbols[i++]))result.push(key)}return result}},{"./_object-gops":83,"./_object-keys":86,"./_object-pie":87}],60:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),ctx=require("./_ctx"),hide=require("./_hide"),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,IS_WRAP=type&$export.W,exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE],target=IS_GLOBAL?global:IS_STATIC?global[name]:(global[name]||{})[PROTOTYPE],key,own,out;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;if(own&&key in exports)continue;out=own?target[key]:source[key];exports[key]=IS_GLOBAL&&typeof target[key]!="function"?source[key]:IS_BIND&&own?ctx(out,global):IS_WRAP&&target[key]==out?function(C){var F=function(a,b,c){if(this instanceof C){switch(arguments.length){case 0:return new C;case 1:return new C(a);case 2:return new C(a,b)}return new C(a,b,c)}return C.apply(this,arguments)};F[PROTOTYPE]=C[PROTOTYPE];return F}(out):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(IS_PROTO){(exports.virtual||(exports.virtual={}))[key]=out;if(type&$export.R&&expProto&&!expProto[key])hide(expProto,key,out)}}};$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;module.exports=$export},{"./_core":53,"./_ctx":54,"./_global":62,"./_hide":64}],61:[function(require,module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return true}}},{}],62:[function(require,module,exports){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global},{}],63:[function(require,module,exports){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}},{}],64:[function(require,module,exports){var dP=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=require("./_descriptors")?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){object[key]=value;return object}},{"./_descriptors":56,"./_object-dp":78,"./_property-desc":88}],65:[function(require,module,exports){module.exports=require("./_global").document&&document.documentElement},{"./_global":62}],66:[function(require,module,exports){module.exports=!require("./_descriptors")&&!require("./_fails")(function(){return Object.defineProperty(require("./_dom-create")("div"),"a",{get:function(){return 7}}).a!=7})},{"./_descriptors":56,"./_dom-create":57,"./_fails":61}],67:[function(require,module,exports){var cof=require("./_cof");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return cof(it)=="String"?it.split(""):Object(it)}},{"./_cof":52}],68:[function(require,module,exports){var cof=require("./_cof");module.exports=Array.isArray||function isArray(arg){return cof(arg)=="Array"}},{"./_cof":52}],69:[function(require,module,exports){module.exports=function(it){return typeof it==="object"?it!==null:typeof it==="function"}},{}],70:[function(require,module,exports){"use strict";var create=require("./_object-create"),descriptor=require("./_property-desc"),setToStringTag=require("./_set-to-string-tag"),IteratorPrototype={};require("./_hide")(IteratorPrototype,require("./_wks")("iterator"),function(){return this});module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+" Iterator")}},{"./_hide":64,"./_object-create":77,"./_property-desc":88,"./_set-to-string-tag":91,"./_wks":104}],71:[function(require,module,exports){"use strict";var LIBRARY=require("./_library"),$export=require("./_export"),redefine=require("./_redefine"),hide=require("./_hide"),has=require("./_has"),Iterators=require("./_iterators"),$iterCreate=require("./_iter-create"),setToStringTag=require("./_set-to-string-tag"),getPrototypeOf=require("./_object-gpo"),ITERATOR=require("./_wks")("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values";var returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function keys(){return new Constructor(this,kind)};case VALUES:return function values(){return new Constructor(this,kind)}}return function entries(){return new Constructor(this,kind)}};var TAG=NAME+" Iterator",DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=false,proto=Base.prototype,$native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?!DEF_VALUES?$default:getMethod("entries"):undefined,$anyNative=NAME=="Array"?proto.entries||$native:$native,methods,key,IteratorPrototype;if($anyNative){IteratorPrototype=getPrototypeOf($anyNative.call(new Base));if(IteratorPrototype!==Object.prototype){setToStringTag(IteratorPrototype,TAG,true);if(!LIBRARY&&!has(IteratorPrototype,ITERATOR))hide(IteratorPrototype,ITERATOR,returnThis)}}if(DEF_VALUES&&$native&&$native.name!==VALUES){VALUES_BUG=true;$default=function values(){return $native.call(this)}}if((!LIBRARY||FORCED)&&(BUGGY||VALUES_BUG||!proto[ITERATOR])){hide(proto,ITERATOR,$default)}Iterators[NAME]=$default;Iterators[TAG]=returnThis;if(DEFAULT){methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries};if(FORCED)for(key in methods){if(!(key in proto))redefine(proto,key,methods[key])}else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods)}return methods}},{"./_export":60,"./_has":63,"./_hide":64,"./_iter-create":70,"./_iterators":73,"./_library":75,"./_object-gpo":84,"./_redefine":89,"./_set-to-string-tag":91,"./_wks":104}],72:[function(require,module,exports){module.exports=function(done,value){return{value:value,done:!!done}}},{}],73:[function(require,module,exports){module.exports={}},{}],74:[function(require,module,exports){var getKeys=require("./_object-keys"),toIObject=require("./_to-iobject");module.exports=function(object,el){var O=toIObject(object),keys=getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key}},{"./_object-keys":86,"./_to-iobject":97}],75:[function(require,module,exports){module.exports=true},{}],76:[function(require,module,exports){var META=require("./_uid")("meta"),isObject=require("./_is-object"),has=require("./_has"),setDesc=require("./_object-dp").f,id=0;var isExtensible=Object.isExtensible||function(){return true};var FREEZE=!require("./_fails")(function(){return isExtensible(Object.preventExtensions({}))});var setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})};var fastKey=function(it,create){if(!isObject(it))return typeof it=="symbol"?it:(typeof it=="string"?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i};var getWeak=function(it,create){if(!has(it,META)){if(!isExtensible(it))return true;if(!create)return false;setMeta(it)}return it[META].w};var onFreeze=function(it){if(FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META))setMeta(it);return it};var meta=module.exports={KEY:META,NEED:false,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze}},{"./_fails":61,"./_has":63,"./_is-object":69,"./_object-dp":78,"./_uid":101}],77:[function(require,module,exports){var anObject=require("./_an-object"),dPs=require("./_object-dps"),enumBugKeys=require("./_enum-bug-keys"),IE_PROTO=require("./_shared-key")("IE_PROTO"),Empty=function(){},PROTOTYPE="prototype";var createDict=function(){var iframe=require("./_dom-create")("iframe"),i=enumBugKeys.length,lt="<",gt=">",iframeDocument;iframe.style.display="none";require("./_html").appendChild(iframe);iframe.src="javascript:";iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(lt+"script"+gt+"document.F=Object"+lt+"/script"+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];return createDict()};module.exports=Object.create||function create(O,Properties){var result;if(O!==null){Empty[PROTOTYPE]=anObject(O);result=new Empty;Empty[PROTOTYPE]=null;result[IE_PROTO]=O}else result=createDict();return Properties===undefined?result:dPs(result,Properties)}},{"./_an-object":50,"./_dom-create":57,"./_enum-bug-keys":58,"./_html":65,"./_object-dps":79,"./_shared-key":92}],78:[function(require,module,exports){var anObject=require("./_an-object"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),toPrimitive=require("./_to-primitive"),dP=Object.defineProperty;exports.f=require("./_descriptors")?Object.defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");if("value"in Attributes)O[P]=Attributes.value;return O}},{"./_an-object":50,"./_descriptors":56,"./_ie8-dom-define":66,"./_to-primitive":100}],79:[function(require,module,exports){var dP=require("./_object-dp"),anObject=require("./_an-object"),getKeys=require("./_object-keys");module.exports=require("./_descriptors")?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=getKeys(Properties),length=keys.length,i=0,P;while(length>i)dP.f(O,P=keys[i++],Properties[P]);return O}},{"./_an-object":50,"./_descriptors":56,"./_object-dp":78,"./_object-keys":86}],80:[function(require,module,exports){var pIE=require("./_object-pie"),createDesc=require("./_property-desc"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),has=require("./_has"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),gOPD=Object.getOwnPropertyDescriptor;exports.f=require("./_descriptors")?gOPD:function getOwnPropertyDescriptor(O,P){O=toIObject(O);P=toPrimitive(P,true);if(IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P])}},{"./_descriptors":56,"./_has":63,"./_ie8-dom-define":66,"./_object-pie":87,"./_property-desc":88,"./_to-iobject":97,"./_to-primitive":100}],81:[function(require,module,exports){var toIObject=require("./_to-iobject"),gOPN=require("./_object-gopn").f,toString={}.toString;var windowNames=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}};module.exports.f=function getOwnPropertyNames(it){return windowNames&&toString.call(it)=="[object Window]"?getWindowNames(it):gOPN(toIObject(it))}},{"./_object-gopn":82,"./_to-iobject":97}],82:[function(require,module,exports){var $keys=require("./_object-keys-internal"),hiddenKeys=require("./_enum-bug-keys").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return $keys(O,hiddenKeys)}},{"./_enum-bug-keys":58,"./_object-keys-internal":85}],83:[function(require,module,exports){exports.f=Object.getOwnPropertySymbols},{}],84:[function(require,module,exports){var has=require("./_has"),toObject=require("./_to-object"),IE_PROTO=require("./_shared-key")("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){O=toObject(O);if(has(O,IE_PROTO))return O[IE_PROTO];if(typeof O.constructor=="function"&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectProto:null}},{"./_has":63,"./_shared-key":92,"./_to-object":99}],85:[function(require,module,exports){var has=require("./_has"),toIObject=require("./_to-iobject"),arrayIndexOf=require("./_array-includes")(false),IE_PROTO=require("./_shared-key")("IE_PROTO");module.exports=function(object,names){var O=toIObject(object),i=0,result=[],key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(names.length>i)if(has(O,key=names[i++])){~arrayIndexOf(result,key)||result.push(key)}return result}},{"./_array-includes":51,"./_has":63,"./_shared-key":92,"./_to-iobject":97}],86:[function(require,module,exports){var $keys=require("./_object-keys-internal"),enumBugKeys=require("./_enum-bug-keys");module.exports=Object.keys||function keys(O){return $keys(O,enumBugKeys)}},{"./_enum-bug-keys":58,"./_object-keys-internal":85}],87:[function(require,module,exports){exports.f={}.propertyIsEnumerable},{}],88:[function(require,module,exports){module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}},{}],89:[function(require,module,exports){module.exports=require("./_hide")},{"./_hide":64}],90:[function(require,module,exports){var isObject=require("./_is-object"),anObject=require("./_an-object");var check=function(O,proto){anObject(O);if(!isObject(proto)&&proto!==null)throw TypeError(proto+": can't set as prototype!")};module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(test,buggy,set){try{set=require("./_ctx")(Function.call,require("./_object-gopd").f(Object.prototype,"__proto__").set,2);set(test,[]);buggy=!(test instanceof Array)}catch(e){buggy=true}return function setPrototypeOf(O,proto){check(O,proto);if(buggy)O.__proto__=proto;else set(O,proto);return O}}({},false):undefined),check:check}},{"./_an-object":50,"./_ctx":54,"./_is-object":69,"./_object-gopd":80}],91:[function(require,module,exports){var def=require("./_object-dp").f,has=require("./_has"),TAG=require("./_wks")("toStringTag");module.exports=function(it,tag,stat){if(it&&!has(it=stat?it:it.prototype,TAG))def(it,TAG,{configurable:true,value:tag})}},{"./_has":63,"./_object-dp":78,"./_wks":104}],92:[function(require,module,exports){var shared=require("./_shared")("keys"),uid=require("./_uid");module.exports=function(key){return shared[key]||(shared[key]=uid(key))}},{"./_shared":93,"./_uid":101}],93:[function(require,module,exports){var global=require("./_global"),SHARED="__core-js_shared__",store=global[SHARED]||(global[SHARED]={});module.exports=function(key){return store[key]||(store[key]={})}},{"./_global":62}],94:[function(require,module,exports){var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function(TO_STRING){return function(that,pos){var s=String(defined(that)),i=toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return TO_STRING?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}}},{"./_defined":55,"./_to-integer":96}],95:[function(require,module,exports){var toInteger=require("./_to-integer"),max=Math.max,min=Math.min;module.exports=function(index,length){index=toInteger(index);return index<0?max(index+length,0):min(index,length)}},{"./_to-integer":96}],96:[function(require,module,exports){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}},{}],97:[function(require,module,exports){var IObject=require("./_iobject"),defined=require("./_defined");module.exports=function(it){return IObject(defined(it))}},{"./_defined":55,"./_iobject":67}],98:[function(require,module,exports){var toInteger=require("./_to-integer"),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),9007199254740991):0}},{"./_to-integer":96}],99:[function(require,module,exports){var defined=require("./_defined");module.exports=function(it){return Object(defined(it))}},{"./_defined":55}],100:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;if(typeof(fn=it.valueOf)=="function"&&!isObject(val=fn.call(it)))return val;if(!S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":69}],101:[function(require,module,exports){var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(key===undefined?"":key,")_",(++id+px).toString(36))}},{}],102:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),LIBRARY=require("./_library"),wksExt=require("./_wks-ext"),defineProperty=require("./_object-dp").f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});if(name.charAt(0)!="_"&&!(name in $Symbol))defineProperty($Symbol,name,{value:wksExt.f(name)})}},{"./_core":53,"./_global":62,"./_library":75,"./_object-dp":78,"./_wks-ext":103}],103:[function(require,module,exports){exports.f=require("./_wks")},{"./_wks":104}],104:[function(require,module,exports){var store=require("./_shared")("wks"),uid=require("./_uid"),Symbol=require("./_global").Symbol,USE_SYMBOL=typeof Symbol=="function";var $exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))};$exports.store=store},{"./_global":62,"./_shared":93,"./_uid":101}],105:[function(require,module,exports){"use strict";var addToUnscopables=require("./_add-to-unscopables"),step=require("./_iter-step"),Iterators=require("./_iterators"),toIObject=require("./_to-iobject");module.exports=require("./_iter-define")(Array,"Array",function(iterated,kind){this._t=toIObject(iterated);this._i=0;this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;if(!O||index>=O.length){this._t=undefined;return step(1)}if(kind=="keys")return step(0,index);if(kind=="values")return step(0,O[index]);return step(0,[index,O[index]])},"values");Iterators.Arguments=Iterators.Array;addToUnscopables("keys");addToUnscopables("values");addToUnscopables("entries")},{"./_add-to-unscopables":49,"./_iter-define":71,"./_iter-step":72,"./_iterators":73,"./_to-iobject":97}],106:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{create:require("./_object-create")})},{"./_export":60,"./_object-create":77}],107:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperty:require("./_object-dp").f})},{"./_descriptors":56,"./_export":60,"./_object-dp":78}],108:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{setPrototypeOf:require("./_set-proto").set})},{"./_export":60,"./_set-proto":90}],109:[function(require,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25}],110:[function(require,module,exports){"use strict";var $at=require("./_string-at")(true);require("./_iter-define")(String,"String",function(iterated){this._t=String(iterated);this._i=0},function(){var O=this._t,index=this._i,point;if(index>=O.length)return{value:undefined,done:true};point=$at(O,index);this._i+=point.length;return{value:point,done:false}})},{"./_iter-define":71,"./_string-at":94}],111:[function(require,module,exports){"use strict";var global=require("./_global"),has=require("./_has"),DESCRIPTORS=require("./_descriptors"),$export=require("./_export"),redefine=require("./_redefine"),META=require("./_meta").KEY,$fails=require("./_fails"),shared=require("./_shared"),setToStringTag=require("./_set-to-string-tag"),uid=require("./_uid"),wks=require("./_wks"),wksExt=require("./_wks-ext"),wksDefine=require("./_wks-define"),keyOf=require("./_keyof"),enumKeys=require("./_enum-keys"),isArray=require("./_is-array"),anObject=require("./_an-object"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),createDesc=require("./_property-desc"),_create=require("./_object-create"),gOPNExt=require("./_object-gopn-ext"),$GOPD=require("./_object-gopd"),$DP=require("./_object-dp"),$keys=require("./_object-keys"),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE="prototype",HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object[PROTOTYPE],USE_NATIVE=typeof $Symbol=="function",QObject=global.QObject;var setter=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild;var setSymbolDesc=DESCRIPTORS&&$fails(function(){return _create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a!=7})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);if(protoDesc)delete ObjectProto[key];dP(it,key,D);if(protoDesc&&it!==ObjectProto)dP(ObjectProto,key,protoDesc)}:dP;var wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol[PROTOTYPE]);sym._k=tag;return sym};var isSymbol=USE_NATIVE&&typeof $Symbol.iterator=="symbol"?function(it){return typeof it=="symbol"}:function(it){return it instanceof $Symbol};var $defineProperty=function defineProperty(it,key,D){if(it===ObjectProto)$defineProperty(OPSymbols,key,D);anObject(it);key=toPrimitive(key,true);anObject(D);if(has(AllSymbols,key)){if(!D.enumerable){if(!has(it,HIDDEN))dP(it,HIDDEN,createDesc(1,{}));it[HIDDEN][key]=true}else{if(has(it,HIDDEN)&&it[HIDDEN][key])it[HIDDEN][key]=false;D=_create(D,{enumerable:createDesc(0,false)})}return setSymbolDesc(it,key,D)}return dP(it,key,D)};var $defineProperties=function defineProperties(it,P){anObject(it);var keys=enumKeys(P=toIObject(P)),i=0,l=keys.length,key;while(l>i)$defineProperty(it,key=keys[i++],P[key]);return it};var $create=function create(it,P){return P===undefined?_create(it):$defineProperties(_create(it),P)};var $propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=toPrimitive(key,true));if(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return false;return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:true};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){it=toIObject(it);key=toPrimitive(key,true);if(it===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return;var D=gOPD(it,key);if(D&&has(AllSymbols,key)&&!(has(it,HIDDEN)&&it[HIDDEN][key]))D.enumerable=true;return D};var $getOwnPropertyNames=function getOwnPropertyNames(it){var names=gOPN(toIObject(it)),result=[],i=0,key;while(names.length>i){if(!has(AllSymbols,key=names[i++])&&key!=HIDDEN&&key!=META)result.push(key)}return result};var $getOwnPropertySymbols=function getOwnPropertySymbols(it){var IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0,key;while(names.length>i){if(has(AllSymbols,key=names[i++])&&(IS_OP?has(ObjectProto,key):true))result.push(AllSymbols[key])}return result};if(!USE_NATIVE){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(arguments.length>0?arguments[0]:undefined);var $set=function(value){if(this===ObjectProto)$set.call(OPSymbols,value);if(has(this,HIDDEN)&&has(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDesc(this,tag,createDesc(1,value))};if(DESCRIPTORS&&setter)setSymbolDesc(ObjectProto,tag,{configurable:true,set:$set});return wrap(tag)};redefine($Symbol[PROTOTYPE],"toString",function toString(){return this._k});$GOPD.f=$getOwnPropertyDescriptor;$DP.f=$defineProperty;require("./_object-gopn").f=gOPNExt.f=$getOwnPropertyNames;require("./_object-pie").f=$propertyIsEnumerable;require("./_object-gops").f=$getOwnPropertySymbols;if(DESCRIPTORS&&!require("./_library")){redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,true)}wksExt.f=function(name){return wrap(wks(name))}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),i=0;symbols.length>i;)wks(symbols[i++]);for(var symbols=$keys(wks.store),i=0;symbols.length>i;)wksDefine(symbols[i++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function keyFor(key){if(isSymbol(key))return keyOf(SymbolRegistry,key);throw TypeError(key+" is not a symbol!")},useSetter:function(){setter=true},useSimple:function(){setter=false}});$export($export.S+$export.F*!USE_NATIVE,"Object",{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return _stringify([S])!="[null]"||_stringify({a:S})!="{}"||_stringify(Object(S))!="{}"})),"JSON",{stringify:function stringify(it){if(it===undefined||isSymbol(it))return;var args=[it],i=1,replacer,$replacer;while(arguments.length>i)args.push(arguments[i++]);replacer=args[1];if(typeof replacer=="function")$replacer=replacer;if($replacer||!isArray(replacer))replacer=function(key,value){if($replacer)value=$replacer.call(this,key,value);if(!isSymbol(value))return value};args[1]=replacer;return _stringify.apply($JSON,args)}});$Symbol[PROTOTYPE][TO_PRIMITIVE]||require("./_hide")($Symbol[PROTOTYPE],TO_PRIMITIVE,$Symbol[PROTOTYPE].valueOf);setToStringTag($Symbol,"Symbol");setToStringTag(Math,"Math",true);setToStringTag(global.JSON,"JSON",true)},{"./_an-object":50,"./_descriptors":56,"./_enum-keys":59,"./_export":60,"./_fails":61,"./_global":62,"./_has":63,"./_hide":64,"./_is-array":68,"./_keyof":74,"./_library":75,"./_meta":76,"./_object-create":77,"./_object-dp":78,"./_object-gopd":80,"./_object-gopn":82,"./_object-gopn-ext":81,"./_object-gops":83,"./_object-keys":86,"./_object-pie":87,"./_property-desc":88,"./_redefine":89,"./_set-to-string-tag":91,"./_shared":93,"./_to-iobject":97,"./_to-primitive":100,"./_uid":101,"./_wks":104,"./_wks-define":102,"./_wks-ext":103}],112:[function(require,module,exports){require("./_wks-define")("asyncIterator")},{"./_wks-define":102}],113:[function(require,module,exports){require("./_wks-define")("observable")},{"./_wks-define":102}],114:[function(require,module,exports){require("./es6.array.iterator");var global=require("./_global"),hide=require("./_hide"),Iterators=require("./_iterators"),TO_STRING_TAG=require("./_wks")("toStringTag");for(var collections=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var NAME=collections[i],Collection=global[NAME],proto=Collection&&Collection.prototype;if(proto&&!proto[TO_STRING_TAG])hide(proto,TO_STRING_TAG,NAME);Iterators[NAME]=Iterators.Array}},{"./_global":62,"./_hide":64,"./_iterators":73,"./_wks":104,"./es6.array.iterator":105}],115:[function(require,module,exports){arguments[4][48][0].apply(exports,arguments)},{dup:48}],116:[function(require,module,exports){arguments[4][50][0].apply(exports,arguments)},{"./_is-object":132,dup:50}],117:[function(require,module,exports){arguments[4][51][0].apply(exports,arguments)},{"./_to-index":143,"./_to-iobject":145,"./_to-length":146,dup:51}],118:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{dup:52}],119:[function(require,module,exports){arguments[4][53][0].apply(exports,arguments)},{dup:53}],120:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{"./_a-function":115,dup:54}],121:[function(require,module,exports){arguments[4][55][0].apply(exports,arguments)},{dup:55}],122:[function(require,module,exports){arguments[4][56][0].apply(exports,arguments)},{"./_fails":126,dup:56}],123:[function(require,module,exports){arguments[4][57][0].apply(exports,arguments)},{"./_global":127,"./_is-object":132,dup:57}],124:[function(require,module,exports){arguments[4][58][0].apply(exports,arguments)},{dup:58}],125:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),hide=require("./_hide"),redefine=require("./_redefine"),ctx=require("./_ctx"),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={}),key,own,out,exp;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;out=(own?target:source)[key];exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(target)redefine(target,key,out,type&$export.U);if(exports[key]!=out)hide(exports,key,exp);if(IS_PROTO&&expProto[key]!=out)expProto[key]=out}};global.core=core;$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;module.exports=$export},{"./_core":119,"./_ctx":120,"./_global":127,"./_hide":129,"./_redefine":140}],126:[function(require,module,exports){arguments[4][61][0].apply(exports,arguments)},{dup:61}],127:[function(require,module,exports){arguments[4][62][0].apply(exports,arguments)},{dup:62}],128:[function(require,module,exports){arguments[4][63][0].apply(exports,arguments)},{dup:63}],129:[function(require,module,exports){arguments[4][64][0].apply(exports,arguments)},{"./_descriptors":122,"./_object-dp":134,"./_property-desc":139,dup:64}],130:[function(require,module,exports){arguments[4][66][0].apply(exports,arguments)},{"./_descriptors":122,"./_dom-create":123,"./_fails":126,dup:66}],131:[function(require,module,exports){arguments[4][67][0].apply(exports,arguments)},{"./_cof":118,dup:67}],132:[function(require,module,exports){arguments[4][69][0].apply(exports,arguments)},{dup:69}],133:[function(require,module,exports){"use strict";var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie"),toObject=require("./_to-object"),IObject=require("./_iobject"),$assign=Object.assign;module.exports=!$assign||require("./_fails")(function(){var A={},B={},S=Symbol(),K="abcdefghijklmnopqrst";A[S]=7;K.split("").forEach(function(k){B[k]=k});return $assign({},A)[S]!=7||Object.keys($assign({},B)).join("")!=K})?function assign(target,source){var T=toObject(target),aLen=arguments.length,index=1,getSymbols=gOPS.f,isEnum=pIE.f;while(aLen>index){var S=IObject(arguments[index++]),keys=getSymbols?getKeys(S).concat(getSymbols(S)):getKeys(S),length=keys.length,j=0,key;while(length>j)if(isEnum.call(S,key=keys[j++]))T[key]=S[key]}return T}:$assign},{"./_fails":126,"./_iobject":131,"./_object-gops":135,"./_object-keys":137,"./_object-pie":138,"./_to-object":147}],134:[function(require,module,exports){arguments[4][78][0].apply(exports,arguments)},{"./_an-object":116,"./_descriptors":122,"./_ie8-dom-define":130,"./_to-primitive":148,dup:78}],135:[function(require,module,exports){arguments[4][83][0].apply(exports,arguments)},{dup:83}],136:[function(require,module,exports){arguments[4][85][0].apply(exports,arguments)},{"./_array-includes":117,"./_has":128,"./_shared-key":141,"./_to-iobject":145,dup:85}],137:[function(require,module,exports){arguments[4][86][0].apply(exports,arguments)},{"./_enum-bug-keys":124,"./_object-keys-internal":136,dup:86}],138:[function(require,module,exports){arguments[4][87][0].apply(exports,arguments)},{dup:87}],139:[function(require,module,exports){arguments[4][88][0].apply(exports,arguments)},{dup:88}],140:[function(require,module,exports){var global=require("./_global"),hide=require("./_hide"),has=require("./_has"),SRC=require("./_uid")("src"),TO_STRING="toString",$toString=Function[TO_STRING],TPL=(""+$toString).split(TO_STRING);require("./_core").inspectSource=function(it){return $toString.call(it)};(module.exports=function(O,key,val,safe){var isFunction=typeof val=="function";if(isFunction)has(val,"name")||hide(val,"name",key);if(O[key]===val)return;if(isFunction)has(val,SRC)||hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)));if(O===global){O[key]=val}else{if(!safe){delete O[key];hide(O,key,val)}else{if(O[key])O[key]=val;else hide(O,key,val)}}})(Function.prototype,TO_STRING,function toString(){return typeof this=="function"&&this[SRC]||$toString.call(this)})},{"./_core":119,"./_global":127,"./_has":128,"./_hide":129,"./_uid":149}],141:[function(require,module,exports){arguments[4][92][0].apply(exports,arguments)},{"./_shared":142,"./_uid":149,dup:92}],142:[function(require,module,exports){arguments[4][93][0].apply(exports,arguments)},{"./_global":127,dup:93}],143:[function(require,module,exports){arguments[4][95][0].apply(exports,arguments)},{"./_to-integer":144,dup:95}],144:[function(require,module,exports){arguments[4][96][0].apply(exports,arguments)},{dup:96}],145:[function(require,module,exports){arguments[4][97][0].apply(exports,arguments)},{"./_defined":121,"./_iobject":131,dup:97}],146:[function(require,module,exports){arguments[4][98][0].apply(exports,arguments)},{"./_to-integer":144,dup:98}],147:[function(require,module,exports){arguments[4][99][0].apply(exports,arguments)},{"./_defined":121,dup:99}],148:[function(require,module,exports){arguments[4][100][0].apply(exports,arguments)},{"./_is-object":132,dup:100}],149:[function(require,module,exports){arguments[4][101][0].apply(exports,arguments)},{dup:101}],150:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F,"Object",{assign:require("./_object-assign")})},{"./_export":125,"./_object-assign":133}],151:[function(require,module,exports){"use strict";var _typeof2=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};(function webpackUniversalModuleDefinition(root,factory){if((typeof exports==="undefined"?"undefined":_typeof2(exports))==="object"&&(typeof module==="undefined"?"undefined":_typeof2(module))==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if((typeof exports==="undefined"?"undefined":_typeof2(exports))==="object")exports["dat"]=factory();else root["dat"]=factory()})(undefined,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _index=__webpack_require__(1);var _index2=_interopRequireDefault(_index);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_index2.default;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Color=__webpack_require__(2);var _Color2=_interopRequireDefault(_Color);var _math=__webpack_require__(6);var _math2=_interopRequireDefault(_math);var _interpret=__webpack_require__(3);var _interpret2=_interopRequireDefault(_interpret);var _Controller=__webpack_require__(7);var _Controller2=_interopRequireDefault(_Controller);var _BooleanController=__webpack_require__(8);var _BooleanController2=_interopRequireDefault(_BooleanController);var _OptionController=__webpack_require__(10);var _OptionController2=_interopRequireDefault(_OptionController);var _StringController=__webpack_require__(11);var _StringController2=_interopRequireDefault(_StringController);var _NumberController=__webpack_require__(12);var _NumberController2=_interopRequireDefault(_NumberController);var _NumberControllerBox=__webpack_require__(13);var _NumberControllerBox2=_interopRequireDefault(_NumberControllerBox);var _NumberControllerSlider=__webpack_require__(14);var _NumberControllerSlider2=_interopRequireDefault(_NumberControllerSlider);var _FunctionController=__webpack_require__(15);var _FunctionController2=_interopRequireDefault(_FunctionController);var _ColorController=__webpack_require__(16);var _ColorController2=_interopRequireDefault(_ColorController);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);var _GUI=__webpack_require__(17);var _GUI2=_interopRequireDefault(_GUI);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={color:{Color:_Color2.default,math:_math2.default,interpret:_interpret2.default},controllers:{Controller:_Controller2.default,BooleanController:_BooleanController2.default,OptionController:_OptionController2.default,StringController:_StringController2.default,NumberController:_NumberController2.default,NumberControllerBox:_NumberControllerBox2.default,NumberControllerSlider:_NumberControllerSlider2.default,FunctionController:_FunctionController2.default,ColorController:_ColorController2.default},dom:{dom:_dom2.default},gui:{GUI:_GUI2.default},GUI:_GUI2.default};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _interpret=__webpack_require__(3);var _interpret2=_interopRequireDefault(_interpret);var _math=__webpack_require__(6);var _math2=_interopRequireDefault(_math);var _toString=__webpack_require__(4);var _toString2=_interopRequireDefault(_toString);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Color=function(){function Color(){_classCallCheck(this,Color);this.__state=_interpret2.default.apply(this,arguments);if(this.__state===false){throw new Error("Failed to interpret color arguments")}this.__state.a=this.__state.a||1}Color.prototype.toString=function toString(){return(0,_toString2.default)(this)};Color.prototype.toHexString=function toHexString(){return(0,_toString2.default)(this,true)};Color.prototype.toOriginal=function toOriginal(){return this.__state.conversion.write(this)};return Color}();function defineRGBComponent(target,component,componentHexIndex){Object.defineProperty(target,component,{get:function get(){if(this.__state.space==="RGB"){return this.__state[component]}Color.recalculateRGB(this,component,componentHexIndex);return this.__state[component]},set:function set(v){if(this.__state.space!=="RGB"){Color.recalculateRGB(this,component,componentHexIndex);this.__state.space="RGB"}this.__state[component]=v}})}function defineHSVComponent(target,component){Object.defineProperty(target,component,{get:function get(){if(this.__state.space==="HSV"){return this.__state[component]}Color.recalculateHSV(this);return this.__state[component]},set:function set(v){if(this.__state.space!=="HSV"){Color.recalculateHSV(this);this.__state.space="HSV"}this.__state[component]=v}})}Color.recalculateRGB=function(color,component,componentHexIndex){if(color.__state.space==="HEX"){color.__state[component]=_math2.default.component_from_hex(color.__state.hex,componentHexIndex)}else if(color.__state.space==="HSV"){_common2.default.extend(color.__state,_math2.default.hsv_to_rgb(color.__state.h,color.__state.s,color.__state.v))}else{throw new Error("Corrupted color state")}};Color.recalculateHSV=function(color){var result=_math2.default.rgb_to_hsv(color.r,color.g,color.b);_common2.default.extend(color.__state,{s:result.s,v:result.v});if(!_common2.default.isNaN(result.h)){color.__state.h=result.h}else if(_common2.default.isUndefined(color.__state.h)){color.__state.h=0}};Color.COMPONENTS=["r","g","b","h","s","v","hex","a"];defineRGBComponent(Color.prototype,"r",2);defineRGBComponent(Color.prototype,"g",1);defineRGBComponent(Color.prototype,"b",0);defineHSVComponent(Color.prototype,"h");defineHSVComponent(Color.prototype,"s");defineHSVComponent(Color.prototype,"v");Object.defineProperty(Color.prototype,"a",{get:function get(){return this.__state.a},set:function set(v){this.__state.a=v}});Object.defineProperty(Color.prototype,"hex",{get:function get(){if(!this.__state.space!=="HEX"){this.__state.hex=_math2.default.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function set(v){this.__state.space="HEX";this.__state.hex=v}});exports.default=Color;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _toString=__webpack_require__(4);var _toString2=_interopRequireDefault(_toString);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var INTERPRETATIONS=[{litmus:_common2.default.isString,conversions:{THREE_CHAR_HEX:{read:function read(original){var test=original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(test===null){return false}return{space:"HEX",hex:parseInt("0x"+test[1].toString()+test[1].toString()+test[2].toString()+test[2].toString()+test[3].toString()+test[3].toString(),0)}},write:_toString2.default},SIX_CHAR_HEX:{read:function read(original){var test=original.match(/^#([A-F0-9]{6})$/i);if(test===null){return false}return{space:"HEX",hex:parseInt("0x"+test[1].toString(),0)}},write:_toString2.default},CSS_RGB:{read:function read(original){var test=original.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(test===null){return false}return{space:"RGB",r:parseFloat(test[1]),g:parseFloat(test[2]),b:parseFloat(test[3])}},write:_toString2.default},CSS_RGBA:{read:function read(original){var test=original.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(test===null){return false}return{space:"RGB",r:parseFloat(test[1]),g:parseFloat(test[2]),b:parseFloat(test[3]),a:parseFloat(test[4])}},write:_toString2.default}}},{litmus:_common2.default.isNumber,conversions:{HEX:{read:function read(original){return{space:"HEX",hex:original,conversionName:"HEX"}},write:function write(color){return color.hex}}}},{litmus:_common2.default.isArray,conversions:{RGB_ARRAY:{read:function read(original){if(original.length!==3){return false}return{space:"RGB",r:original[0],g:original[1],b:original[2]}},write:function write(color){return[color.r,color.g,color.b]}},RGBA_ARRAY:{read:function read(original){if(original.length!==4)return false;return{space:"RGB",r:original[0],g:original[1],b:original[2],a:original[3]}},write:function write(color){return[color.r,color.g,color.b,color.a]}}}},{litmus:_common2.default.isObject,conversions:{RGBA_OBJ:{read:function read(original){if(_common2.default.isNumber(original.r)&&_common2.default.isNumber(original.g)&&_common2.default.isNumber(original.b)&&_common2.default.isNumber(original.a)){return{space:"RGB",r:original.r,g:original.g,b:original.b,a:original.a}}return false},write:function write(color){return{r:color.r,g:color.g,b:color.b,a:color.a}}},RGB_OBJ:{read:function read(original){if(_common2.default.isNumber(original.r)&&_common2.default.isNumber(original.g)&&_common2.default.isNumber(original.b)){return{space:"RGB",r:original.r,g:original.g,b:original.b}}return false},write:function write(color){return{r:color.r,g:color.g,b:color.b}}},HSVA_OBJ:{read:function read(original){if(_common2.default.isNumber(original.h)&&_common2.default.isNumber(original.s)&&_common2.default.isNumber(original.v)&&_common2.default.isNumber(original.a)){return{space:"HSV",h:original.h,s:original.s,v:original.v,a:original.a}}return false},write:function write(color){return{h:color.h,s:color.s,v:color.v,a:color.a}}},HSV_OBJ:{read:function read(original){if(_common2.default.isNumber(original.h)&&_common2.default.isNumber(original.s)&&_common2.default.isNumber(original.v)){return{space:"HSV",h:original.h,s:original.s,v:original.v}}return false},write:function write(color){return{h:color.h,s:color.s,v:color.v}}}}}];var result=void 0;var toReturn=void 0;var interpret=function interpret(){toReturn=false;var original=arguments.length>1?_common2.default.toArray(arguments):arguments[0];_common2.default.each(INTERPRETATIONS,function(family){if(family.litmus(original)){_common2.default.each(family.conversions,function(conversion,conversionName){result=conversion.read(original);if(toReturn===false&&result!==false){toReturn=result;result.conversionName=conversionName;result.conversion=conversion;return _common2.default.BREAK}});return _common2.default.BREAK}});return toReturn};exports.default=interpret;module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;exports.default=function(color,forceCSSHex){var colorFormat=color.__state.conversionName.toString();var r=Math.round(color.r);var g=Math.round(color.g);var b=Math.round(color.b);var a=color.a;var h=Math.round(color.h);var s=color.s.toFixed(1);var v=color.v.toFixed(1);if(forceCSSHex||colorFormat==="THREE_CHAR_HEX"||colorFormat==="SIX_CHAR_HEX"){var str=color.hex.toString(16);while(str.length<6){str="0"+str}return"#"+str}else if(colorFormat==="CSS_RGB"){return"rgb("+r+","+g+","+b+")"}else if(colorFormat==="CSS_RGBA"){return"rgba("+r+","+g+","+b+","+a+")"}else if(colorFormat==="HEX"){return"0x"+color.hex.toString(16)}else if(colorFormat==="RGB_ARRAY"){return"["+r+","+g+","+b+"]"}else if(colorFormat==="RGBA_ARRAY"){return"["+r+","+g+","+b+","+a+"]"}else if(colorFormat==="RGB_OBJ"){return"{r:"+r+",g:"+g+",b:"+b+"}"}else if(colorFormat==="RGBA_OBJ"){return"{r:"+r+",g:"+g+",b:"+b+",a:"+a+"}"}else if(colorFormat==="HSV_OBJ"){return"{h:"+h+",s:"+s+",v:"+v+"}"}else if(colorFormat==="HSVA_OBJ"){return"{h:"+h+",s:"+s+",v:"+v+",a:"+a+"}"}return"unknown format"};module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;var ARR_EACH=Array.prototype.forEach;var ARR_SLICE=Array.prototype.slice;var Common={BREAK:{},extend:function extend(target){this.each(ARR_SLICE.call(arguments,1),function(obj){var keys=this.isObject(obj)?Object.keys(obj):[];keys.forEach(function(key){if(!this.isUndefined(obj[key])){target[key]=obj[key]}}.bind(this))},this);return target},defaults:function defaults(target){this.each(ARR_SLICE.call(arguments,1),function(obj){var keys=this.isObject(obj)?Object.keys(obj):[];keys.forEach(function(key){if(this.isUndefined(target[key])){target[key]=obj[key]}}.bind(this))},this);return target},compose:function compose(){var toCall=ARR_SLICE.call(arguments);return function(){var args=ARR_SLICE.call(arguments);for(var i=toCall.length-1;i>=0;i--){args=[toCall[i].apply(this,args)]}return args[0]}},each:function each(obj,itr,scope){if(!obj){return}if(ARR_EACH&&obj.forEach&&obj.forEach===ARR_EACH){obj.forEach(itr,scope)}else if(obj.length===obj.length+0){var key=void 0;var l=void 0;for(key=0,l=obj.length;key<l;key++){if(key in obj&&itr.call(scope,obj[key],key)===this.BREAK){return}}}else{for(var _key in obj){if(itr.call(scope,obj[_key],_key)===this.BREAK){return}}}},defer:function defer(fnc){setTimeout(fnc,0)},debounce:function debounce(func,threshold,callImmediately){var timeout=void 0;return function(){var obj=this;var args=arguments;function delayed(){timeout=null;if(!callImmediately)func.apply(obj,args)}var callNow=callImmediately||!timeout;clearTimeout(timeout);timeout=setTimeout(delayed,threshold);if(callNow){func.apply(obj,args)}}},toArray:function toArray(obj){if(obj.toArray)return obj.toArray();return ARR_SLICE.call(obj)},isUndefined:function isUndefined(obj){return obj===undefined},isNull:function isNull(obj){return obj===null},isNaN:function(_isNaN){function isNaN(_x){return _isNaN.apply(this,arguments)}isNaN.toString=function(){return _isNaN.toString()};return isNaN}(function(obj){return isNaN(obj)}),isArray:Array.isArray||function(obj){return obj.constructor===Array},isObject:function isObject(obj){return obj===Object(obj)},isNumber:function isNumber(obj){return obj===obj+0},isString:function isString(obj){return obj===obj+""},isBoolean:function isBoolean(obj){return obj===false||obj===true},isFunction:function isFunction(obj){return Object.prototype.toString.call(obj)==="[object Function]"}};exports.default=Common;module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;var tmpComponent=void 0;var ColorMath={hsv_to_rgb:function hsv_to_rgb(h,s,v){var hi=Math.floor(h/60)%6;var f=h/60-Math.floor(h/60);var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);var c=[[v,t,p],[q,v,p],[p,v,t],[p,q,v],[t,p,v],[v,p,q]][hi];return{r:c[0]*255,g:c[1]*255,b:c[2]*255}},rgb_to_hsv:function rgb_to_hsv(r,g,b){var min=Math.min(r,g,b);var max=Math.max(r,g,b);var delta=max-min;var h=void 0;var s=void 0;if(max!==0){s=delta/max}else{return{h:NaN,s:0,v:0}}if(r===max){h=(g-b)/delta}else if(g===max){h=2+(b-r)/delta}else{h=4+(r-g)/delta}h/=6;if(h<0){h+=1}return{h:h*360,s:s,v:max/255}},rgb_to_hex:function rgb_to_hex(r,g,b){var hex=this.hex_with_component(0,2,r);hex=this.hex_with_component(hex,1,g);hex=this.hex_with_component(hex,0,b);return hex},component_from_hex:function component_from_hex(hex,componentIndex){return hex>>componentIndex*8&255},hex_with_component:function hex_with_component(hex,componentIndex,value){return value<<(tmpComponent=componentIndex*8)|hex&~(255<<tmpComponent)}};exports.default=ColorMath;module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Controller=function(){function Controller(object,property){_classCallCheck(this,Controller);this.initialValue=object[property];this.domElement=document.createElement("div");this.object=object;this.property=property;this.__onChange=undefined;this.__onFinishChange=undefined}Controller.prototype.onChange=function onChange(fnc){this.__onChange=fnc;return this};Controller.prototype.onFinishChange=function onFinishChange(fnc){this.__onFinishChange=fnc;return this};Controller.prototype.setValue=function setValue(newValue){this.object[this.property]=newValue;if(this.__onChange){this.__onChange.call(this,newValue)}this.updateDisplay();return this};Controller.prototype.getValue=function getValue(){return this.object[this.property]};Controller.prototype.updateDisplay=function updateDisplay(){return this};Controller.prototype.isModified=function isModified(){return this.initialValue!==this.getValue()};return Controller}();exports.default=Controller;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Controller2=__webpack_require__(7);var _Controller3=_interopRequireDefault(_Controller2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BooleanController=function(_Controller){_inherits(BooleanController,_Controller);function BooleanController(object,property){_classCallCheck(this,BooleanController);var _this2=_possibleConstructorReturn(this,_Controller.call(this,object,property));var _this=_this2;_this2.__prev=_this2.getValue();_this2.__checkbox=document.createElement("input");_this2.__checkbox.setAttribute("type","checkbox");function onChange(){_this.setValue(!_this.__prev)}_dom2.default.bind(_this2.__checkbox,"change",onChange,false);_this2.domElement.appendChild(_this2.__checkbox);_this2.updateDisplay();return _this2}BooleanController.prototype.setValue=function setValue(v){var toReturn=_Controller.prototype.setValue.call(this,v);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.__prev=this.getValue();return toReturn};BooleanController.prototype.updateDisplay=function updateDisplay(){if(this.getValue()===true){this.__checkbox.setAttribute("checked","checked");this.__checkbox.checked=true;this.__prev=true}else{this.__checkbox.checked=false;this.__prev=false}return _Controller.prototype.updateDisplay.call(this)};return BooleanController}(_Controller3.default);exports.default=BooleanController;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EVENT_MAP={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]};var EVENT_MAP_INV={};_common2.default.each(EVENT_MAP,function(v,k){_common2.default.each(v,function(e){EVENT_MAP_INV[e]=k})});var CSS_VALUE_PIXELS=/(\d+(\.\d+)?)px/;function cssValueToPixels(val){if(val==="0"||_common2.default.isUndefined(val)){return 0}var match=val.match(CSS_VALUE_PIXELS);if(!_common2.default.isNull(match)){return parseFloat(match[1])}return 0}var dom={makeSelectable:function makeSelectable(elem,selectable){if(elem===undefined||elem.style===undefined)return;elem.onselectstart=selectable?function(){return false}:function(){};elem.style.MozUserSelect=selectable?"auto":"none";elem.style.KhtmlUserSelect=selectable?"auto":"none";elem.unselectable=selectable?"on":"off"},makeFullscreen:function makeFullscreen(elem,hor,vert){var vertical=vert;var horizontal=hor;if(_common2.default.isUndefined(horizontal)){horizontal=true}if(_common2.default.isUndefined(vertical)){vertical=true}elem.style.position="absolute";if(horizontal){elem.style.left=0;elem.style.right=0}if(vertical){elem.style.top=0;elem.style.bottom=0}},fakeEvent:function fakeEvent(elem,eventType,pars,aux){var params=pars||{};var className=EVENT_MAP_INV[eventType];if(!className){throw new Error("Event type "+eventType+" not supported.")}var evt=document.createEvent(className);switch(className){case"MouseEvents":{var clientX=params.x||params.clientX||0;var clientY=params.y||params.clientY||0;evt.initMouseEvent(eventType,params.bubbles||false,params.cancelable||true,window,params.clickCount||1,0,0,clientX,clientY,false,false,false,false,0,null);break}case"KeyboardEvents":{var init=evt.initKeyboardEvent||evt.initKeyEvent;_common2.default.defaults(params,{cancelable:true,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:undefined,charCode:undefined});init(eventType,params.bubbles||false,params.cancelable,window,params.ctrlKey,params.altKey,params.shiftKey,params.metaKey,params.keyCode,params.charCode);break}default:{evt.initEvent(eventType,params.bubbles||false,params.cancelable||true);break}}_common2.default.defaults(evt,aux);elem.dispatchEvent(evt)},bind:function bind(elem,event,func,newBool){var bool=newBool||false;if(elem.addEventListener){elem.addEventListener(event,func,bool)}else if(elem.attachEvent){elem.attachEvent("on"+event,func)}return dom},unbind:function unbind(elem,event,func,newBool){var bool=newBool||false;if(elem.removeEventListener){elem.removeEventListener(event,func,bool)}else if(elem.detachEvent){elem.detachEvent("on"+event,func)}return dom},addClass:function addClass(elem,className){if(elem.className===undefined){elem.className=className}else if(elem.className!==className){var classes=elem.className.split(/ +/);if(classes.indexOf(className)===-1){classes.push(className);elem.className=classes.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}}return dom},removeClass:function removeClass(elem,className){if(className){if(elem.className===className){elem.removeAttribute("class")}else{var classes=elem.className.split(/ +/);var index=classes.indexOf(className);if(index!==-1){classes.splice(index,1);elem.className=classes.join(" ")}}}else{elem.className=undefined}return dom},hasClass:function hasClass(elem,className){return new RegExp("(?:^|\\s+)"+className+"(?:\\s+|$)").test(elem.className)||false},getWidth:function getWidth(elem){var style=getComputedStyle(elem);return cssValueToPixels(style["border-left-width"])+cssValueToPixels(style["border-right-width"])+cssValueToPixels(style["padding-left"])+cssValueToPixels(style["padding-right"])+cssValueToPixels(style.width)},getHeight:function getHeight(elem){var style=getComputedStyle(elem);return cssValueToPixels(style["border-top-width"])+cssValueToPixels(style["border-bottom-width"])+cssValueToPixels(style["padding-top"])+cssValueToPixels(style["padding-bottom"])+cssValueToPixels(style.height)},getOffset:function getOffset(el){var elem=el;var offset={left:0,top:0};if(elem.offsetParent){do{offset.left+=elem.offsetLeft;offset.top+=elem.offsetTop;elem=elem.offsetParent}while(elem)}return offset},isActive:function isActive(elem){return elem===document.activeElement&&(elem.type||elem.href)}};exports.default=dom;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Controller2=__webpack_require__(7);var _Controller3=_interopRequireDefault(_Controller2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var OptionController=function(_Controller){_inherits(OptionController,_Controller);function OptionController(object,property,opts){_classCallCheck(this,OptionController);var _this2=_possibleConstructorReturn(this,_Controller.call(this,object,property));var options=opts;var _this=_this2;_this2.__select=document.createElement("select");if(_common2.default.isArray(options)){var map={};_common2.default.each(options,function(element){map[element]=element});options=map}_common2.default.each(options,function(value,key){var opt=document.createElement("option");opt.innerHTML=key;opt.setAttribute("value",value);_this.__select.appendChild(opt)});_this2.updateDisplay();_dom2.default.bind(_this2.__select,"change",function(){var desiredValue=this.options[this.selectedIndex].value;_this.setValue(desiredValue)});_this2.domElement.appendChild(_this2.__select);return _this2}OptionController.prototype.setValue=function setValue(v){var toReturn=_Controller.prototype.setValue.call(this,v);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}return toReturn};OptionController.prototype.updateDisplay=function updateDisplay(){if(_dom2.default.isActive(this.__select))return this;this.__select.value=this.getValue();return _Controller.prototype.updateDisplay.call(this)};return OptionController}(_Controller3.default);exports.default=OptionController;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Controller2=__webpack_require__(7);var _Controller3=_interopRequireDefault(_Controller2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StringController=function(_Controller){_inherits(StringController,_Controller);function StringController(object,property){_classCallCheck(this,StringController);var _this2=_possibleConstructorReturn(this,_Controller.call(this,object,property));var _this=_this2;function onChange(){_this.setValue(_this.__input.value)}function onBlur(){if(_this.__onFinishChange){_this.__onFinishChange.call(_this,_this.getValue())}}_this2.__input=document.createElement("input");_this2.__input.setAttribute("type","text");_dom2.default.bind(_this2.__input,"keyup",onChange);_dom2.default.bind(_this2.__input,"change",onChange);_dom2.default.bind(_this2.__input,"blur",onBlur);_dom2.default.bind(_this2.__input,"keydown",function(e){if(e.keyCode===13){this.blur()}});_this2.updateDisplay();_this2.domElement.appendChild(_this2.__input);return _this2}StringController.prototype.updateDisplay=function updateDisplay(){if(!_dom2.default.isActive(this.__input)){this.__input.value=this.getValue()}return _Controller.prototype.updateDisplay.call(this)};return StringController}(_Controller3.default);exports.default=StringController;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Controller2=__webpack_require__(7);var _Controller3=_interopRequireDefault(_Controller2);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function numDecimals(x){var _x=x.toString();if(_x.indexOf(".")>-1){return _x.length-_x.indexOf(".")-1}return 0}var NumberController=function(_Controller){_inherits(NumberController,_Controller);function NumberController(object,property,params){_classCallCheck(this,NumberController);var _this=_possibleConstructorReturn(this,_Controller.call(this,object,property));var _params=params||{};_this.__min=_params.min;_this.__max=_params.max;_this.__step=_params.step;if(_common2.default.isUndefined(_this.__step)){if(_this.initialValue===0){_this.__impliedStep=1}else{_this.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(_this.initialValue))/Math.LN10))/10}}else{_this.__impliedStep=_this.__step}_this.__precision=numDecimals(_this.__impliedStep);return _this}NumberController.prototype.setValue=function setValue(v){var _v=v;if(this.__min!==undefined&&_v<this.__min){_v=this.__min}else if(this.__max!==undefined&&_v>this.__max){_v=this.__max}if(this.__step!==undefined&&_v%this.__step!==0){_v=Math.round(_v/this.__step)*this.__step}return _Controller.prototype.setValue.call(this,_v)};NumberController.prototype.min=function min(v){this.__min=v;return this};NumberController.prototype.max=function max(v){this.__max=v;return this};NumberController.prototype.step=function step(v){this.__step=v;this.__impliedStep=v;this.__precision=numDecimals(v);return this};return NumberController}(_Controller3.default);exports.default=NumberController;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _NumberController2=__webpack_require__(12);var _NumberController3=_interopRequireDefault(_NumberController2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function roundToDecimal(value,decimals){var tenTo=Math.pow(10,decimals);return Math.round(value*tenTo)/tenTo}var NumberControllerBox=function(_NumberController){_inherits(NumberControllerBox,_NumberController);function NumberControllerBox(object,property,params){_classCallCheck(this,NumberControllerBox);var _this2=_possibleConstructorReturn(this,_NumberController.call(this,object,property,params));_this2.__truncationSuspended=false;var _this=_this2;var prevY=void 0;function onChange(){var attempted=parseFloat(_this.__input.value);if(!_common2.default.isNaN(attempted)){_this.setValue(attempted)}}function onFinish(){if(_this.__onFinishChange){_this.__onFinishChange.call(_this,_this.getValue())}}function onBlur(){onFinish()}function onMouseDrag(e){var diff=prevY-e.clientY;_this.setValue(_this.getValue()+diff*_this.__impliedStep);prevY=e.clientY}function onMouseUp(){_dom2.default.unbind(window,"mousemove",onMouseDrag);_dom2.default.unbind(window,"mouseup",onMouseUp);onFinish()}function onMouseDown(e){_dom2.default.bind(window,"mousemove",onMouseDrag);_dom2.default.bind(window,"mouseup",onMouseUp);prevY=e.clientY}_this2.__input=document.createElement("input");_this2.__input.setAttribute("type","text");_dom2.default.bind(_this2.__input,"change",onChange);_dom2.default.bind(_this2.__input,"blur",onBlur);_dom2.default.bind(_this2.__input,"mousedown",onMouseDown);_dom2.default.bind(_this2.__input,"keydown",function(e){if(e.keyCode===13){_this.__truncationSuspended=true;this.blur();_this.__truncationSuspended=false;onFinish()}});_this2.updateDisplay();_this2.domElement.appendChild(_this2.__input);return _this2}NumberControllerBox.prototype.updateDisplay=function updateDisplay(){this.__input.value=this.__truncationSuspended?this.getValue():roundToDecimal(this.getValue(),this.__precision);return _NumberController.prototype.updateDisplay.call(this)};return NumberControllerBox}(_NumberController3.default);exports.default=NumberControllerBox;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _NumberController2=__webpack_require__(12);var _NumberController3=_interopRequireDefault(_NumberController2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function map(v,i1,i2,o1,o2){return o1+(o2-o1)*((v-i1)/(i2-i1))}var NumberControllerSlider=function(_NumberController){_inherits(NumberControllerSlider,_NumberController);function NumberControllerSlider(object,property,min,max,step){_classCallCheck(this,NumberControllerSlider);var _this2=_possibleConstructorReturn(this,_NumberController.call(this,object,property,{min:min,max:max,step:step}));var _this=_this2;_this2.__background=document.createElement("div");_this2.__foreground=document.createElement("div");_dom2.default.bind(_this2.__background,"mousedown",onMouseDown);_dom2.default.addClass(_this2.__background,"slider");_dom2.default.addClass(_this2.__foreground,"slider-fg");function onMouseDown(e){document.activeElement.blur();_dom2.default.bind(window,"mousemove",onMouseDrag);_dom2.default.bind(window,"mouseup",onMouseUp);onMouseDrag(e)}function onMouseDrag(e){e.preventDefault();var bgRect=_this.__background.getBoundingClientRect();_this.setValue(map(e.clientX,bgRect.left,bgRect.right,_this.__min,_this.__max));return false}function onMouseUp(){_dom2.default.unbind(window,"mousemove",onMouseDrag);_dom2.default.unbind(window,"mouseup",onMouseUp);if(_this.__onFinishChange){_this.__onFinishChange.call(_this,_this.getValue())}}_this2.updateDisplay();_this2.__background.appendChild(_this2.__foreground);_this2.domElement.appendChild(_this2.__background);return _this2}NumberControllerSlider.prototype.updateDisplay=function updateDisplay(){var pct=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=pct*100+"%";return _NumberController.prototype.updateDisplay.call(this)};return NumberControllerSlider}(_NumberController3.default);exports.default=NumberControllerSlider;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Controller2=__webpack_require__(7);var _Controller3=_interopRequireDefault(_Controller2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FunctionController=function(_Controller){_inherits(FunctionController,_Controller);function FunctionController(object,property,text){_classCallCheck(this,FunctionController);var _this2=_possibleConstructorReturn(this,_Controller.call(this,object,property));var _this=_this2;_this2.__button=document.createElement("div");_this2.__button.innerHTML=text===undefined?"Fire":text;_dom2.default.bind(_this2.__button,"click",function(e){e.preventDefault();_this.fire();return false});_dom2.default.addClass(_this2.__button,"button");_this2.domElement.appendChild(_this2.__button);return _this2}FunctionController.prototype.fire=function fire(){if(this.__onChange){this.__onChange.call(this)}this.getValue().call(this.object);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}};return FunctionController}(_Controller3.default);exports.default=FunctionController;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _Controller2=__webpack_require__(7);var _Controller3=_interopRequireDefault(_Controller2);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);var _Color=__webpack_require__(2);var _Color2=_interopRequireDefault(_Color);var _interpret=__webpack_require__(3);var _interpret2=_interopRequireDefault(_interpret);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColorController=function(_Controller){_inherits(ColorController,_Controller);function ColorController(object,property){_classCallCheck(this,ColorController);var _this2=_possibleConstructorReturn(this,_Controller.call(this,object,property));_this2.__color=new _Color2.default(_this2.getValue());_this2.__temp=new _Color2.default(0);var _this=_this2;_this2.domElement=document.createElement("div");_dom2.default.makeSelectable(_this2.domElement,false);_this2.__selector=document.createElement("div");_this2.__selector.className="selector";_this2.__saturation_field=document.createElement("div");_this2.__saturation_field.className="saturation-field";_this2.__field_knob=document.createElement("div");_this2.__field_knob.className="field-knob";_this2.__field_knob_border="2px solid ";_this2.__hue_knob=document.createElement("div");_this2.__hue_knob.className="hue-knob";_this2.__hue_field=document.createElement("div");_this2.__hue_field.className="hue-field";_this2.__input=document.createElement("input");_this2.__input.type="text";_this2.__input_textShadow="0 1px 1px ";_dom2.default.bind(_this2.__input,"keydown",function(e){if(e.keyCode===13){onBlur.call(this)}});_dom2.default.bind(_this2.__input,"blur",onBlur);_dom2.default.bind(_this2.__selector,"mousedown",function(){_dom2.default.addClass(this,"drag").bind(window,"mouseup",function(){_dom2.default.removeClass(_this.__selector,"drag")})});var valueField=document.createElement("div");_common2.default.extend(_this2.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});_common2.default.extend(_this2.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:_this2.__field_knob_border+(_this2.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});_common2.default.extend(_this2.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});_common2.default.extend(_this2.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});_common2.default.extend(valueField.style,{width:"100%",height:"100%",background:"none"});linearGradient(valueField,"top","rgba(0,0,0,0)","#000");_common2.default.extend(_this2.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"});hueGradient(_this2.__hue_field);_common2.default.extend(_this2.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:_this2.__input_textShadow+"rgba(0,0,0,0.7)"});_dom2.default.bind(_this2.__saturation_field,"mousedown",fieldDown);_dom2.default.bind(_this2.__field_knob,"mousedown",fieldDown);_dom2.default.bind(_this2.__hue_field,"mousedown",function(e){setH(e);_dom2.default.bind(window,"mousemove",setH);_dom2.default.bind(window,"mouseup",fieldUpH)});function fieldDown(e){setSV(e);_dom2.default.bind(window,"mousemove",setSV);_dom2.default.bind(window,"mouseup",fieldUpSV)}function fieldUpSV(){_dom2.default.unbind(window,"mousemove",setSV);_dom2.default.unbind(window,"mouseup",fieldUpSV);onFinish()}function onBlur(){var i=(0,_interpret2.default)(this.value);if(i!==false){_this.__color.__state=i;_this.setValue(_this.__color.toOriginal())}else{this.value=_this.__color.toString()}}function fieldUpH(){_dom2.default.unbind(window,"mousemove",setH);_dom2.default.unbind(window,"mouseup",fieldUpH);onFinish()}function onFinish(){if(_this.__onFinishChange){_this.__onFinishChange.call(_this,_this.__color.toOriginal())}}_this2.__saturation_field.appendChild(valueField);_this2.__selector.appendChild(_this2.__field_knob);_this2.__selector.appendChild(_this2.__saturation_field);_this2.__selector.appendChild(_this2.__hue_field);_this2.__hue_field.appendChild(_this2.__hue_knob);_this2.domElement.appendChild(_this2.__input);_this2.domElement.appendChild(_this2.__selector);_this2.updateDisplay();function setSV(e){e.preventDefault();var fieldRect=_this.__saturation_field.getBoundingClientRect();var s=(e.clientX-fieldRect.left)/(fieldRect.right-fieldRect.left);var v=1-(e.clientY-fieldRect.top)/(fieldRect.bottom-fieldRect.top);if(v>1){v=1}else if(v<0){v=0}if(s>1){s=1}else if(s<0){s=0}_this.__color.v=v;_this.__color.s=s;_this.setValue(_this.__color.toOriginal());return false}function setH(e){e.preventDefault();var fieldRect=_this.__hue_field.getBoundingClientRect();var h=1-(e.clientY-fieldRect.top)/(fieldRect.bottom-fieldRect.top);if(h>1){h=1}else if(h<0){h=0}_this.__color.h=h*360;_this.setValue(_this.__color.toOriginal());return false}return _this2}ColorController.prototype.updateDisplay=function updateDisplay(){var i=(0,_interpret2.default)(this.getValue());if(i!==false){var mismatch=false;_common2.default.each(_Color2.default.COMPONENTS,function(component){if(!_common2.default.isUndefined(i[component])&&!_common2.default.isUndefined(this.__color.__state[component])&&i[component]!==this.__color.__state[component]){mismatch=true;return{}}},this);if(mismatch){_common2.default.extend(this.__color.__state,i)}}_common2.default.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var flip=this.__color.v<.5||this.__color.s>.5?255:0;var _flip=255-flip;_common2.default.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+flip+","+flip+","+flip+")"});this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px";this.__temp.s=1;this.__temp.v=1;linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString());this.__input.value=this.__color.toString();_common2.default.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+flip+","+flip+","+flip+")",textShadow:this.__input_textShadow+"rgba("+_flip+","+_flip+","+_flip+",.7)"})};return ColorController}(_Controller3.default);var vendors=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(elem,x,a,b){elem.style.background="";_common2.default.each(vendors,function(vendor){elem.style.cssText+="background: "+vendor+"linear-gradient("+x+", "+a+" 0%, "+b+" 100%); "})}function hueGradient(elem){elem.style.background="";elem.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";elem.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";elem.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";elem.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";elem.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}exports.default=ColorController;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":_typeof2(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj==="undefined"?"undefined":_typeof2(obj)};var _css=__webpack_require__(18);var _css2=_interopRequireDefault(_css);var _saveDialogue=__webpack_require__(19);var _saveDialogue2=_interopRequireDefault(_saveDialogue);var _ControllerFactory=__webpack_require__(20);var _ControllerFactory2=_interopRequireDefault(_ControllerFactory);var _Controller=__webpack_require__(7);var _Controller2=_interopRequireDefault(_Controller);var _BooleanController=__webpack_require__(8);var _BooleanController2=_interopRequireDefault(_BooleanController);var _FunctionController=__webpack_require__(15);var _FunctionController2=_interopRequireDefault(_FunctionController);var _NumberControllerBox=__webpack_require__(13);var _NumberControllerBox2=_interopRequireDefault(_NumberControllerBox);var _NumberControllerSlider=__webpack_require__(14);var _NumberControllerSlider2=_interopRequireDefault(_NumberControllerSlider);var _ColorController=__webpack_require__(16);var _ColorController2=_interopRequireDefault(_ColorController);var _requestAnimationFrame=__webpack_require__(21);var _requestAnimationFrame2=_interopRequireDefault(_requestAnimationFrame);var _CenteredDiv=__webpack_require__(22);var _CenteredDiv2=_interopRequireDefault(_CenteredDiv);var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);var _style=__webpack_require__(23);var _style2=_interopRequireDefault(_style);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_css2.default.inject(_style2.default);var CSS_NAMESPACE="dg";var HIDE_KEY_CODE=72;var CLOSE_BUTTON_HEIGHT=20;var DEFAULT_DEFAULT_PRESET_NAME="Default";var SUPPORTS_LOCAL_STORAGE=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return false}}();var SAVE_DIALOGUE=void 0;var autoPlaceVirgin=true;var autoPlaceContainer=void 0;var hide=false;var hideableGuis=[];var GUI=function GUI(pars){var _this=this;var params=pars||{};this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);_dom2.default.addClass(this.domElement,CSS_NAMESPACE);this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];params=_common2.default.defaults(params,{closeOnTop:false,autoPlace:true,width:GUI.DEFAULT_WIDTH});params=_common2.default.defaults(params,{resizable:params.autoPlace,hideable:params.autoPlace});if(!_common2.default.isUndefined(params.load)){if(params.preset){params.load.preset=params.preset}}else{params.load={preset:DEFAULT_DEFAULT_PRESET_NAME}}if(_common2.default.isUndefined(params.parent)&&params.hideable){hideableGuis.push(this)}params.resizable=_common2.default.isUndefined(params.parent)&&params.resizable;if(params.autoPlace&&_common2.default.isUndefined(params.scrollable)){params.scrollable=true}var useLocalStorage=SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(this,"isLocal"))==="true";var saveToLocalStorage=void 0;Object.defineProperties(this,{parent:{get:function get(){return params.parent}},scrollable:{get:function get(){return params.scrollable}},autoPlace:{get:function get(){return params.autoPlace}},closeOnTop:{get:function get(){return params.closeOnTop}},preset:{get:function get(){if(_this.parent){return _this.getRoot().preset}return params.load.preset},set:function set(v){if(_this.parent){_this.getRoot().preset=v}else{params.load.preset=v}setPresetSelectIndex(this);_this.revert()}},width:{get:function get(){return params.width},set:function set(v){params.width=v;setWidth(_this,v)}},name:{get:function get(){return params.name},set:function set(v){params.name=v;if(titleRowName){titleRowName.innerHTML=params.name}}},closed:{get:function get(){return params.closed},set:function set(v){params.closed=v;if(params.closed){_dom2.default.addClass(_this.__ul,GUI.CLASS_CLOSED)}else{_dom2.default.removeClass(_this.__ul,GUI.CLASS_CLOSED)}this.onResize();if(_this.__closeButton){_this.__closeButton.innerHTML=v?GUI.TEXT_OPEN:GUI.TEXT_CLOSED}}},load:{get:function get(){return params.load}},useLocalStorage:{get:function get(){return useLocalStorage},set:function set(bool){if(SUPPORTS_LOCAL_STORAGE){useLocalStorage=bool;if(bool){_dom2.default.bind(window,"unload",saveToLocalStorage)}else{_dom2.default.unbind(window,"unload",saveToLocalStorage)}localStorage.setItem(getLocalStorageHash(_this,"isLocal"),bool)}}}});if(_common2.default.isUndefined(params.parent)){params.closed=false;_dom2.default.addClass(this.domElement,GUI.CLASS_MAIN);_dom2.default.makeSelectable(this.domElement,false);if(SUPPORTS_LOCAL_STORAGE){if(useLocalStorage){_this.useLocalStorage=true;var savedGui=localStorage.getItem(getLocalStorageHash(this,"gui"));if(savedGui){params.load=JSON.parse(savedGui)}}}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=GUI.TEXT_CLOSED;_dom2.default.addClass(this.__closeButton,GUI.CLASS_CLOSE_BUTTON);if(params.closeOnTop){_dom2.default.addClass(this.__closeButton,GUI.CLASS_CLOSE_TOP);this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])}else{_dom2.default.addClass(this.__closeButton,GUI.CLASS_CLOSE_BOTTOM);this.domElement.appendChild(this.__closeButton)}_dom2.default.bind(this.__closeButton,"click",function(){_this.closed=!_this.closed})}else{if(params.closed===undefined){params.closed=true}var _titleRowName=document.createTextNode(params.name);_dom2.default.addClass(_titleRowName,"controller-name");var titleRow=addRow(_this,_titleRowName);var onClickTitle=function onClickTitle(e){e.preventDefault();_this.closed=!_this.closed;return false};_dom2.default.addClass(this.__ul,GUI.CLASS_CLOSED);_dom2.default.addClass(titleRow,"title");_dom2.default.bind(titleRow,"click",onClickTitle);if(!params.closed){this.closed=false}}if(params.autoPlace){if(_common2.default.isUndefined(params.parent)){if(autoPlaceVirgin){autoPlaceContainer=document.createElement("div");_dom2.default.addClass(autoPlaceContainer,CSS_NAMESPACE);_dom2.default.addClass(autoPlaceContainer,GUI.CLASS_AUTO_PLACE_CONTAINER);document.body.appendChild(autoPlaceContainer);autoPlaceVirgin=false}autoPlaceContainer.appendChild(this.domElement);_dom2.default.addClass(this.domElement,GUI.CLASS_AUTO_PLACE)}if(!this.parent){setWidth(_this,params.width)}}this.__resizeHandler=function(){_this.onResizeDebounced()};_dom2.default.bind(window,"resize",this.__resizeHandler);_dom2.default.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler);_dom2.default.bind(this.__ul,"transitionend",this.__resizeHandler);_dom2.default.bind(this.__ul,"oTransitionEnd",this.__resizeHandler);this.onResize();if(params.resizable){addResizeHandle(this)}saveToLocalStorage=function saveToLocalStorage(){if(SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(_this,"isLocal"))==="true"){localStorage.setItem(getLocalStorageHash(_this,"gui"),JSON.stringify(_this.getSaveObject()))}};this.saveToLocalStorageIfPossible=saveToLocalStorage;function resetWidth(){var root=_this.getRoot();root.width+=1;_common2.default.defer(function(){root.width-=1})}if(!params.parent){resetWidth()}};GUI.toggleHide=function(){hide=!hide;_common2.default.each(hideableGuis,function(gui){gui.domElement.style.display=hide?"none":""})};GUI.CLASS_AUTO_PLACE="a";GUI.CLASS_AUTO_PLACE_CONTAINER="ac";GUI.CLASS_MAIN="main";GUI.CLASS_CONTROLLER_ROW="cr";GUI.CLASS_TOO_TALL="taller-than-window";GUI.CLASS_CLOSED="closed";GUI.CLASS_CLOSE_BUTTON="close-button";GUI.CLASS_CLOSE_TOP="close-top";GUI.CLASS_CLOSE_BOTTOM="close-bottom";GUI.CLASS_DRAG="drag";GUI.DEFAULT_WIDTH=245;GUI.TEXT_CLOSED="Close Controls";GUI.TEXT_OPEN="Open Controls";GUI._keydownHandler=function(e){if(document.activeElement.type!=="text"&&(e.which===HIDE_KEY_CODE||e.keyCode===HIDE_KEY_CODE)){GUI.toggleHide()}};_dom2.default.bind(window,"keydown",GUI._keydownHandler,false);_common2.default.extend(GUI.prototype,{add:function add(object,property){return _add(this,object,property,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function addColor(object,property){return _add(this,object,property,{color:true})},remove:function remove(controller){this.__ul.removeChild(controller.__li);this.__controllers.splice(this.__controllers.indexOf(controller),1);var _this=this;_common2.default.defer(function(){_this.onResize()})},destroy:function destroy(){if(this.autoPlace){autoPlaceContainer.removeChild(this.domElement)}_dom2.default.unbind(window,"keydown",GUI._keydownHandler,false);_dom2.default.unbind(window,"resize",this.__resizeHandler);if(this.saveToLocalStorageIfPossible){_dom2.default.unbind(window,"unload",this.saveToLocalStorageIfPossible)}},addFolder:function addFolder(name){if(this.__folders[name]!==undefined){throw new Error("You already have a folder in this GUI by the"+' name "'+name+'"')}var newGuiParams={name:name,parent:this};newGuiParams.autoPlace=this.autoPlace;if(this.load&&this.load.folders&&this.load.folders[name]){newGuiParams.closed=this.load.folders[name].closed;newGuiParams.load=this.load.folders[name]}var gui=new GUI(newGuiParams);this.__folders[name]=gui;var li=addRow(this,gui.domElement);_dom2.default.addClass(li,"folder");return gui},open:function open(){this.closed=false},close:function close(){this.closed=true},onResize:function onResize(){var root=this.getRoot();if(root.scrollable){var top=_dom2.default.getOffset(root.__ul).top;var h=0;_common2.default.each(root.__ul.childNodes,function(node){if(!(root.autoPlace&&node===root.__save_row)){h+=_dom2.default.getHeight(node)}});if(window.innerHeight-top-CLOSE_BUTTON_HEIGHT<h){_dom2.default.addClass(root.domElement,GUI.CLASS_TOO_TALL);root.__ul.style.height=window.innerHeight-top-CLOSE_BUTTON_HEIGHT+"px"}else{_dom2.default.removeClass(root.domElement,GUI.CLASS_TOO_TALL);root.__ul.style.height="auto"}}if(root.__resize_handle){_common2.default.defer(function(){root.__resize_handle.style.height=root.__ul.offsetHeight+"px"})}if(root.__closeButton){root.__closeButton.style.width=root.width+"px"}},onResizeDebounced:_common2.default.debounce(function(){this.onResize()},50),remember:function remember(){if(_common2.default.isUndefined(SAVE_DIALOGUE)){SAVE_DIALOGUE=new _CenteredDiv2.default;SAVE_DIALOGUE.domElement.innerHTML=_saveDialogue2.default}if(this.parent){throw new Error("You can only call remember on a top level GUI.")}var _this=this;_common2.default.each(Array.prototype.slice.call(arguments),function(object){if(_this.__rememberedObjects.length===0){addSaveMenu(_this)}if(_this.__rememberedObjects.indexOf(object)===-1){_this.__rememberedObjects.push(object)}});if(this.autoPlace){setWidth(this,this.width)}},getRoot:function getRoot(){var gui=this;while(gui.parent){gui=gui.parent}return gui},getSaveObject:function getSaveObject(){var toReturn=this.load;toReturn.closed=this.closed;if(this.__rememberedObjects.length>0){toReturn.preset=this.preset;if(!toReturn.remembered){toReturn.remembered={}}toReturn.remembered[this.preset]=getCurrentPreset(this)}toReturn.folders={};_common2.default.each(this.__folders,function(element,key){toReturn.folders[key]=element.getSaveObject()});return toReturn},save:function save(){if(!this.load.remembered){this.load.remembered={}}this.load.remembered[this.preset]=getCurrentPreset(this);markPresetModified(this,false);this.saveToLocalStorageIfPossible()},saveAs:function saveAs(presetName){if(!this.load.remembered){this.load.remembered={};this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME]=getCurrentPreset(this,true)}this.load.remembered[presetName]=getCurrentPreset(this);this.preset=presetName;addPresetOption(this,presetName,true);this.saveToLocalStorageIfPossible()},revert:function revert(gui){_common2.default.each(this.__controllers,function(controller){if(!this.getRoot().load.remembered){controller.setValue(controller.initialValue)}else{recallSavedValue(gui||this.getRoot(),controller)}if(controller.__onFinishChange){controller.__onFinishChange.call(controller,controller.getValue())}},this);_common2.default.each(this.__folders,function(folder){folder.revert(folder)});if(!gui){markPresetModified(this.getRoot(),false)}},listen:function listen(controller){var init=this.__listening.length===0;this.__listening.push(controller);if(init){updateDisplays(this.__listening)}},updateDisplay:function updateDisplay(){_common2.default.each(this.__controllers,function(controller){controller.updateDisplay()});_common2.default.each(this.__folders,function(folder){folder.updateDisplay()})}});function addRow(gui,newDom,liBefore){var li=document.createElement("li");if(newDom){li.appendChild(newDom)}if(liBefore){gui.__ul.insertBefore(li,liBefore)}else{gui.__ul.appendChild(li)}gui.onResize();return li}function markPresetModified(gui,modified){var opt=gui.__preset_select[gui.__preset_select.selectedIndex];if(modified){opt.innerHTML=opt.value+"*"}else{opt.innerHTML=opt.value}}function augmentController(gui,li,controller){controller.__li=li;controller.__gui=gui;_common2.default.extend(controller,{options:function options(_options){if(arguments.length>1){var nextSibling=controller.__li.nextElementSibling;controller.remove();return _add(gui,controller.object,controller.property,{before:nextSibling,factoryArgs:[_common2.default.toArray(arguments)]})}if(_common2.default.isArray(_options)||_common2.default.isObject(_options)){var _nextSibling=controller.__li.nextElementSibling;controller.remove();return _add(gui,controller.object,controller.property,{before:_nextSibling,factoryArgs:[_options]})}},name:function name(v){controller.__li.firstElementChild.firstElementChild.innerHTML=v;return controller},listen:function listen(){controller.__gui.listen(controller);return controller},remove:function remove(){controller.__gui.remove(controller);return controller}});if(controller instanceof _NumberControllerSlider2.default){var box=new _NumberControllerBox2.default(controller.object,controller.property,{min:controller.__min,max:controller.__max,step:controller.__step});_common2.default.each(["updateDisplay","onChange","onFinishChange","step"],function(method){var pc=controller[method];var pb=box[method];controller[method]=box[method]=function(){var args=Array.prototype.slice.call(arguments);pb.apply(box,args);return pc.apply(controller,args)}});_dom2.default.addClass(li,"has-slider");controller.domElement.insertBefore(box.domElement,controller.domElement.firstElementChild)}else if(controller instanceof _NumberControllerBox2.default){var r=function r(returned){if(_common2.default.isNumber(controller.__min)&&_common2.default.isNumber(controller.__max)){var oldName=controller.__li.firstElementChild.firstElementChild.innerHTML;var wasListening=controller.__gui.__listening.indexOf(controller)>-1;controller.remove();var newController=_add(gui,controller.object,controller.property,{before:controller.__li.nextElementSibling,factoryArgs:[controller.__min,controller.__max,controller.__step]});newController.name(oldName);if(wasListening)newController.listen();return newController}return returned};controller.min=_common2.default.compose(r,controller.min);controller.max=_common2.default.compose(r,controller.max)}else if(controller instanceof _BooleanController2.default){_dom2.default.bind(li,"click",function(){_dom2.default.fakeEvent(controller.__checkbox,"click")});_dom2.default.bind(controller.__checkbox,"click",function(e){e.stopPropagation()})}else if(controller instanceof _FunctionController2.default){_dom2.default.bind(li,"click",function(){_dom2.default.fakeEvent(controller.__button,"click")});_dom2.default.bind(li,"mouseover",function(){_dom2.default.addClass(controller.__button,"hover")});_dom2.default.bind(li,"mouseout",function(){_dom2.default.removeClass(controller.__button,"hover")})}else if(controller instanceof _ColorController2.default){_dom2.default.addClass(li,"color");controller.updateDisplay=_common2.default.compose(function(val){li.style.borderLeftColor=controller.__color.toString();return val},controller.updateDisplay);controller.updateDisplay()}controller.setValue=_common2.default.compose(function(val){if(gui.getRoot().__preset_select&&controller.isModified()){markPresetModified(gui.getRoot(),true)}return val},controller.setValue)}function recallSavedValue(gui,controller){var root=gui.getRoot();var matchedIndex=root.__rememberedObjects.indexOf(controller.object);if(matchedIndex!==-1){var controllerMap=root.__rememberedObjectIndecesToControllers[matchedIndex];if(controllerMap===undefined){controllerMap={};root.__rememberedObjectIndecesToControllers[matchedIndex]=controllerMap}controllerMap[controller.property]=controller;if(root.load&&root.load.remembered){var presetMap=root.load.remembered;var preset=void 0;if(presetMap[gui.preset]){preset=presetMap[gui.preset]}else if(presetMap[DEFAULT_DEFAULT_PRESET_NAME]){preset=presetMap[DEFAULT_DEFAULT_PRESET_NAME]}else{return}if(preset[matchedIndex]&&preset[matchedIndex][controller.property]!==undefined){var value=preset[matchedIndex][controller.property];controller.initialValue=value;controller.setValue(value)}}}}function _add(gui,object,property,params){if(object[property]===undefined){throw new Error('Object "'+object+'" has no property "'+property+'"')}var controller=void 0;if(params.color){controller=new _ColorController2.default(object,property)}else{var factoryArgs=[object,property].concat(params.factoryArgs);controller=_ControllerFactory2.default.apply(gui,factoryArgs)}if(params.before instanceof _Controller2.default){params.before=params.before.__li}recallSavedValue(gui,controller);_dom2.default.addClass(controller.domElement,"c");var name=document.createElement("span");_dom2.default.addClass(name,"property-name");name.innerHTML=controller.property;var container=document.createElement("div");container.appendChild(name);container.appendChild(controller.domElement);var li=addRow(gui,container,params.before);_dom2.default.addClass(li,GUI.CLASS_CONTROLLER_ROW);if(controller instanceof _ColorController2.default){_dom2.default.addClass(li,"color")}else{_dom2.default.addClass(li,_typeof(controller.getValue()))}augmentController(gui,li,controller);gui.__controllers.push(controller);return controller}function getLocalStorageHash(gui,key){return document.location.href+"."+key}function addPresetOption(gui,name,setSelected){var opt=document.createElement("option");opt.innerHTML=name;opt.value=name;gui.__preset_select.appendChild(opt);if(setSelected){gui.__preset_select.selectedIndex=gui.__preset_select.length-1}}function showHideExplain(gui,explain){explain.style.display=gui.useLocalStorage?"block":"none"}function addSaveMenu(gui){var div=gui.__save_row=document.createElement("li");_dom2.default.addClass(gui.domElement,"has-save");gui.__ul.insertBefore(div,gui.__ul.firstChild);_dom2.default.addClass(div,"save-row");var gears=document.createElement("span");gears.innerHTML="&nbsp;";_dom2.default.addClass(gears,"button gears");var button=document.createElement("span");button.innerHTML="Save";_dom2.default.addClass(button,"button");_dom2.default.addClass(button,"save");var button2=document.createElement("span");button2.innerHTML="New";_dom2.default.addClass(button2,"button");_dom2.default.addClass(button2,"save-as");var button3=document.createElement("span");button3.innerHTML="Revert";_dom2.default.addClass(button3,"button");_dom2.default.addClass(button3,"revert");var select=gui.__preset_select=document.createElement("select");if(gui.load&&gui.load.remembered){_common2.default.each(gui.load.remembered,function(value,key){addPresetOption(gui,key,key===gui.preset)})}else{addPresetOption(gui,DEFAULT_DEFAULT_PRESET_NAME,false)}_dom2.default.bind(select,"change",function(){for(var index=0;index<gui.__preset_select.length;index++){gui.__preset_select[index].innerHTML=gui.__preset_select[index].value}gui.preset=this.value});div.appendChild(select);div.appendChild(gears);div.appendChild(button);div.appendChild(button2);div.appendChild(button3);if(SUPPORTS_LOCAL_STORAGE){var explain=document.getElementById("dg-local-explain");var localStorageCheckBox=document.getElementById("dg-local-storage");var saveLocally=document.getElementById("dg-save-locally");saveLocally.style.display="block";if(localStorage.getItem(getLocalStorageHash(gui,"isLocal"))==="true"){localStorageCheckBox.setAttribute("checked","checked")}showHideExplain(gui,explain);_dom2.default.bind(localStorageCheckBox,"change",function(){gui.useLocalStorage=!gui.useLocalStorage;showHideExplain(gui,explain)})}var newConstructorTextArea=document.getElementById("dg-new-constructor");_dom2.default.bind(newConstructorTextArea,"keydown",function(e){if(e.metaKey&&(e.which===67||e.keyCode===67)){SAVE_DIALOGUE.hide()}});_dom2.default.bind(gears,"click",function(){newConstructorTextArea.innerHTML=JSON.stringify(gui.getSaveObject(),undefined,2);SAVE_DIALOGUE.show();newConstructorTextArea.focus();newConstructorTextArea.select()});_dom2.default.bind(button,"click",function(){gui.save()});_dom2.default.bind(button2,"click",function(){var presetName=prompt("Enter a new preset name.");if(presetName){gui.saveAs(presetName)}});_dom2.default.bind(button3,"click",function(){gui.revert()})}function addResizeHandle(gui){var pmouseX=void 0;gui.__resize_handle=document.createElement("div");_common2.default.extend(gui.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function drag(e){e.preventDefault();gui.width+=pmouseX-e.clientX;gui.onResize();pmouseX=e.clientX;return false}function dragStop(){_dom2.default.removeClass(gui.__closeButton,GUI.CLASS_DRAG);_dom2.default.unbind(window,"mousemove",drag);_dom2.default.unbind(window,"mouseup",dragStop)}function dragStart(e){e.preventDefault();pmouseX=e.clientX;_dom2.default.addClass(gui.__closeButton,GUI.CLASS_DRAG);_dom2.default.bind(window,"mousemove",drag);_dom2.default.bind(window,"mouseup",dragStop);return false}_dom2.default.bind(gui.__resize_handle,"mousedown",dragStart);_dom2.default.bind(gui.__closeButton,"mousedown",dragStart);gui.domElement.insertBefore(gui.__resize_handle,gui.domElement.firstElementChild)}function setWidth(gui,w){gui.domElement.style.width=w+"px";if(gui.__save_row&&gui.autoPlace){gui.__save_row.style.width=w+"px"}if(gui.__closeButton){gui.__closeButton.style.width=w+"px"}}function getCurrentPreset(gui,useInitialValues){var toReturn={};_common2.default.each(gui.__rememberedObjects,function(val,index){var savedValues={};var controllerMap=gui.__rememberedObjectIndecesToControllers[index];_common2.default.each(controllerMap,function(controller,property){savedValues[property]=useInitialValues?controller.initialValue:controller.getValue()});toReturn[index]=savedValues});return toReturn}function setPresetSelectIndex(gui){for(var index=0;index<gui.__preset_select.length;index++){if(gui.__preset_select[index].value===gui.preset){gui.__preset_select.selectedIndex=index}}}function updateDisplays(controllerArray){if(controllerArray.length!==0){_requestAnimationFrame2.default.call(window,function(){updateDisplays(controllerArray)})}_common2.default.each(controllerArray,function(c){c.updateDisplay()})}exports.default=GUI;module.exports=exports["default"]},function(module,exports){"use strict";module.exports={load:function load(url,indoc){var doc=indoc||document;var link=doc.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=url;doc.getElementsByTagName("head")[0].appendChild(link)},inject:function inject(css,indoc){var doc=indoc||document;var injected=document.createElement("style");injected.type="text/css";injected.innerHTML=css;var head=doc.getElementsByTagName("head")[0];try{head.appendChild(injected)}catch(e){}}}},function(module,exports){module.exports='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _OptionController=__webpack_require__(10);var _OptionController2=_interopRequireDefault(_OptionController);var _NumberControllerBox=__webpack_require__(13);var _NumberControllerBox2=_interopRequireDefault(_NumberControllerBox);var _NumberControllerSlider=__webpack_require__(14);var _NumberControllerSlider2=_interopRequireDefault(_NumberControllerSlider);var _StringController=__webpack_require__(11);var _StringController2=_interopRequireDefault(_StringController);var _FunctionController=__webpack_require__(15);var _FunctionController2=_interopRequireDefault(_FunctionController);var _BooleanController=__webpack_require__(8);var _BooleanController2=_interopRequireDefault(_BooleanController);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ControllerFactory=function ControllerFactory(object,property){var initialValue=object[property];if(_common2.default.isArray(arguments[2])||_common2.default.isObject(arguments[2])){return new _OptionController2.default(object,property,arguments[2])}if(_common2.default.isNumber(initialValue)){if(_common2.default.isNumber(arguments[2])&&_common2.default.isNumber(arguments[3])){if(_common2.default.isNumber(arguments[4])){return new _NumberControllerSlider2.default(object,property,arguments[2],arguments[3],arguments[4])}return new _NumberControllerSlider2.default(object,property,arguments[2],arguments[3])}if(_common2.default.isNumber(arguments[4])){return new _NumberControllerBox2.default(object,property,{min:arguments[2],max:arguments[3],step:arguments[4]})}return new _NumberControllerBox2.default(object,property,{min:arguments[2],max:arguments[3]})}if(_common2.default.isString(initialValue)){return new _StringController2.default(object,property)}if(_common2.default.isFunction(initialValue)){return new _FunctionController2.default(object,property,"")}if(_common2.default.isBoolean(initialValue)){return new _BooleanController2.default(object,property)}return null};exports.default=ControllerFactory;module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;function requestAnimationFrame(callback){setTimeout(callback,1e3/60)}exports.default=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||requestAnimationFrame;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _dom=__webpack_require__(9);var _dom2=_interopRequireDefault(_dom);var _common=__webpack_require__(5);var _common2=_interopRequireDefault(_common);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CenteredDiv=function(){function CenteredDiv(){_classCallCheck(this,CenteredDiv);this.backgroundElement=document.createElement("div");_common2.default.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"});_dom2.default.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");_common2.default.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var _this=this;_dom2.default.bind(this.backgroundElement,"click",function(){_this.hide()})}CenteredDiv.prototype.show=function show(){var _this=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();_common2.default.defer(function(){_this.backgroundElement.style.opacity=1;_this.domElement.style.opacity=1;_this.domElement.style.webkitTransform="scale(1)"})};CenteredDiv.prototype.hide=function hide(){var _this=this;var hide=function hide(){_this.domElement.style.display="none";_this.backgroundElement.style.display="none";_dom2.default.unbind(_this.domElement,"webkitTransitionEnd",hide);_dom2.default.unbind(_this.domElement,"transitionend",hide);_dom2.default.unbind(_this.domElement,"oTransitionEnd",hide)};_dom2.default.bind(this.domElement,"webkitTransitionEnd",hide);_dom2.default.bind(this.domElement,"transitionend",hide);_dom2.default.bind(this.domElement,"oTransitionEnd",hide);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};CenteredDiv.prototype.layout=function layout(){this.domElement.style.left=window.innerWidth/2-_dom2.default.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-_dom2.default.getHeight(this.domElement)/2+"px"};return CenteredDiv}();exports.default=CenteredDiv;module.exports=exports["default"]},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(24)();exports.push([module.id,".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */\n  /** allow overflow for color selector */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button.close-top {\n        position: relative; }\n      .dg.main .close-button.close-bottom {\n        position: absolute; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-y: visible; }\n    .dg.a.has-save > ul.close-top {\n      margin-top: 0; }\n    .dg.a.has-save > ul.close-bottom {\n      margin-top: 27px; }\n    .dg.a.has-save > ul.closed {\n      margin-top: 0; }\n    .dg.a .save-row {\n      top: 0;\n      z-index: 1002; }\n      .dg.a .save-row.close-top {\n        position: relative; }\n      .dg.a .save-row.close-bottom {\n        position: fixed; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out;\n    -webkit-transition: overflow 0.1s linear;\n    -o-transition: overflow 0.1s linear;\n    -moz-transition: overflow 0.1s linear;\n    transition: overflow 0.1s linear; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid transparent; }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px;\n    overflow: hidden; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%;\n    position: relative; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 7px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .cr.color {\n    overflow: visible; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: #000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.color {\n    border-left: 3px solid; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2FA1D6; }\n    .dg .cr.number input[type=text] {\n      color: #2FA1D6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2FA1D6;\n    max-width: 100%; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",""])},function(module,exports){module.exports=function(){var list=[];list.toString=function toString(){var result=[];for(var i=0;i<this.length;i++){var item=this[i];if(item[2]){result.push("@media "+item[2]+"{"+item[1]+"}")}else{result.push(item[1])}}return result.join("")};list.i=function(modules,mediaQuery){if(typeof modules==="string")modules=[[null,modules,""]];var alreadyImportedModules={};for(var i=0;i<this.length;i++){var id=this[i][0];if(typeof id==="number")alreadyImportedModules[id]=true}for(i=0;i<modules.length;i++){var item=modules[i];if(typeof item[0]!=="number"||!alreadyImportedModules[item[0]]){if(mediaQuery&&!item[2]){item[2]=mediaQuery}else if(mediaQuery){item[2]="("+item[2]+") and ("+mediaQuery+")"}list.push(item)}}};return list}}])})},{}],152:[function(require,module,exports){(function(process){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){if(typeof window!=="undefined"&&window.process&&window.process.type==="renderer"){return true}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}};function formatArgs(args){var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return;var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0;var lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c)}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}if(!r&&typeof process!=="undefined"&&"env"in process){r=process.env.DEBUG}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}}).call(this,require("_process"))},{"./debug":153,_process:423}],153:[function(require,module,exports){exports=module.exports=createDebug.debug=createDebug["default"]=createDebug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevTime;function selectColor(namespace){var hash=0,i;for(i in namespace){hash=(hash<<5)-hash+namespace.charCodeAt(i);hash|=0}return exports.colors[Math.abs(hash)%exports.colors.length]}function createDebug(namespace){function debug(){if(!debug.enabled)return;var self=debug;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args.unshift("%O")}var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});exports.formatArgs.call(self,args);var logFn=debug.log||exports.log||console.log.bind(console);logFn.apply(self,args)}debug.namespace=namespace;debug.enabled=exports.enabled(namespace);debug.useColors=exports.useColors();debug.color=selectColor(namespace);if("function"===typeof exports.init){exports.init(debug)}return debug}function enable(namespaces){exports.save(namespaces);exports.names=[];exports.skips=[];var split=(typeof namespaces==="string"?namespaces:"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:227}],154:[function(require,module,exports){"use strict";var token="%[a-f0-9]{2}";var singleMatcher=new RegExp(token,"gi");var multiMatcher=new RegExp("("+token+")+","gi");function decodeComponents(components,split){try{return decodeURIComponent(components.join(""))}catch(err){}if(components.length===1){return components}split=split||1;var left=components.slice(0,split);var right=components.slice(split);return Array.prototype.concat.call([],decodeComponents(left),decodeComponents(right))}function decode(input){try{return decodeURIComponent(input)}catch(err){var tokens=input.match(singleMatcher);for(var i=1;i<tokens.length;i++){input=decodeComponents(tokens,i).join("");tokens=input.match(singleMatcher)}return input}}function customDecodeURIComponent(input){var replaceMap={"%FE%FF":"��","%FF%FE":"��"};var match=multiMatcher.exec(input);while(match){try{replaceMap[match[0]]=decodeURIComponent(match[0])}catch(err){var result=decode(match[0]);if(result!==match[0]){replaceMap[match[0]]=result}}match=multiMatcher.exec(input)}replaceMap["%C2"]="�";var entries=Object.keys(replaceMap);for(var i=0;i<entries.length;i++){var key=entries[i];input=input.replace(new RegExp(key,"g"),replaceMap[key])}return input}module.exports=function(encodedURI){if(typeof encodedURI!=="string"){throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof encodedURI+"`")}try{encodedURI=encodedURI.replace(/\+/g," ");return decodeURIComponent(encodedURI)}catch(err){return customDecodeURIComponent(encodedURI)}}},{}],155:[function(require,module,exports){"use strict";var assert=require("assert");module.exports=ready;function ready(callback){assert.notEqual(typeof document,"undefined","document-ready only runs in the browser");var state=document.readyState;if(state==="complete"||state==="interactive"){return setTimeout(callback,0)}document.addEventListener("DOMContentLoaded",function onLoad(){callback()})}},{assert:5}],156:[function(require,module,exports){module.exports=dragDrop;var flatten=require("flatten");var parallel=require("run-parallel");function dragDrop(elem,listeners){if(typeof elem==="string"){var selector=elem;elem=window.document.querySelector(elem);if(!elem){throw new Error('"'+selector+'" does not match any HTML elements')}}if(!elem){throw new Error('"'+elem+'" is not a valid HTML element')}if(typeof listeners==="function"){listeners={onDrop:listeners}}var timeout;elem.addEventListener("dragenter",onDragEnter,false);elem.addEventListener("dragover",onDragOver,false);elem.addEventListener("dragleave",onDragLeave,false);elem.addEventListener("drop",onDrop,false);return function remove(){removeDragClass();elem.removeEventListener("dragenter",onDragEnter,false);elem.removeEventListener("dragover",onDragOver,false);elem.removeEventListener("dragleave",onDragLeave,false);elem.removeEventListener("drop",onDrop,false)};function onDragEnter(e){if(listeners.onDragEnter){listeners.onDragEnter(e)}e.stopPropagation();e.preventDefault();return false}function onDragOver(e){e.stopPropagation();e.preventDefault();if(e.dataTransfer.items){var items=toArray(e.dataTransfer.items);var fileItems=items.filter(function(item){return item.kind==="file"});var textItems=items.filter(function(item){return item.kind==="string"});if(fileItems.length===0&&!listeners.onDropText)return;if(textItems.length===0&&!listeners.onDrop)return;if(fileItems.length===0&&textItems.length===0)return}elem.classList.add("drag");clearTimeout(timeout);if(listeners.onDragOver){listeners.onDragOver(e)}e.dataTransfer.dropEffect="copy";return false}function onDragLeave(e){e.stopPropagation();e.preventDefault();if(listeners.onDragLeave){listeners.onDragLeave(e)}clearTimeout(timeout);timeout=setTimeout(removeDragClass,50);return false}function onDrop(e){e.stopPropagation();e.preventDefault();if(listeners.onDragLeave){listeners.onDragLeave(e)}clearTimeout(timeout);removeDragClass();var pos={x:e.clientX,y:e.clientY};var text=e.dataTransfer.getData("text");if(text&&listeners.onDropText){listeners.onDropText(text,pos)}if(e.dataTransfer.items){var items=toArray(e.dataTransfer.items).filter(function(item){return item.kind==="file"});if(items.length===0)return;parallel(items.map(function(item){return function(cb){processEntry(item.webkitGetAsEntry(),cb)}}),function(err,results){if(err)throw err;if(listeners.onDrop){listeners.onDrop(flatten(results),pos)}})}else{var files=toArray(e.dataTransfer.files);if(files.length===0)return;files.forEach(function(file){file.fullPath="/"+file.name});if(listeners.onDrop){listeners.onDrop(files,pos)}}return false}function removeDragClass(){elem.classList.remove("drag")}}function processEntry(entry,cb){var entries=[];if(entry.isFile){entry.file(function(file){file.fullPath=entry.fullPath;cb(null,file)},function(err){cb(err)})}else if(entry.isDirectory){var reader=entry.createReader();readEntries()}function readEntries(){reader.readEntries(function(entries_){if(entries_.length>0){entries=entries.concat(toArray(entries_));readEntries()}else{doneEntries()}})}function doneEntries(){parallel(entries.map(function(entry){return function(cb){processEntry(entry,cb)}}),cb)}}function toArray(list){return Array.prototype.slice.call(list||[],0)}},{flatten:178,"run-parallel":444}],157:[function(require,module,exports){"use strict";module.exports=earcut;module.exports.default=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?1/invSize:0}earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)break;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,invSize);earcutLinked(c,triangles,dim,minX,minY,invSize);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,invSize){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,invSize){x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],158:[function(require,module,exports){module.exports=require("./socket");module.exports.parser=require("engine.io-parser")},{"./socket":159,"engine.io-parser":169}],159:[function(require,module,exports){(function(global){var transports=require("./transports/index");var Emitter=require("component-emitter");var debug=require("debug")("engine.io-client:socket");var index=require("indexof");var parser=require("engine.io-parser");var parseuri=require("parseuri");var parseqs=require("parseqs");module.exports=Socket;function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&"object"===typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==="https"||uri.protocol==="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&"https:"===location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?"443":"80"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:"localhost");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if("string"===typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||"t";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||["polling","websocket"];this.transportOptions=opts.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?true:opts.rejectUnauthorized;this.forceNode=!!opts.forceNode;var freeGlobal=typeof global==="object"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}if(opts.localAddress){this.localAddress=opts.localAddress}}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingIntervalTimer=null;this.pingTimeoutTimer=null;this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=require("./transport");Socket.transports=require("./transports/index");Socket.parser=require("engine.io-parser");Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;var options=this.transportOptions[name]||{};if(this.id)query.sid=this.id;var transport=new transports[name]({query:query,socket:this,agent:options.agent||this.agent,hostname:options.hostname||this.hostname,port:options.port||this.port,secure:options.secure||this.secure,path:options.path||this.path,forceJSONP:options.forceJSONP||this.forceJSONP,jsonp:options.jsonp||this.jsonp,forceBase64:options.forceBase64||this.forceBase64,enablesXDR:options.enablesXDR||this.enablesXDR,timestampRequests:options.timestampRequests||this.timestampRequests,timestampParam:options.timestampParam||this.timestampParam,policyPort:options.policyPort||this.policyPort,pfx:options.pfx||this.pfx,key:options.key||this.key,passphrase:options.passphrase||this.passphrase,cert:options.cert||this.cert,ca:options.ca||this.ca,ciphers:options.ciphers||this.ciphers,rejectUnauthorized:options.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:options.perMessageDeflate||this.perMessageDeflate,extraHeaders:options.extraHeaders||this.extraHeaders,forceNode:options.forceNode||this.forceNode,localAddress:options.localAddress||this.localAddress,requestTimeout:options.requestTimeout||this.requestTimeout,protocols:options.protocols||void 0});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){transport="websocket"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})};Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1});var failed=false;var self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",function(msg){if(failed)return;if("pong"===msg.type&&"probe"===msg.data){debug('probe transport "%s" pong',name);self.upgrading=true;self.emit("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"===transport.name;debug('pausing current transport "%s"',self.transport.name);self.transport.pause(function(){if(failed)return;if("closed"===self.readyState)return;debug("changing transport and sending upgrade packet");cleanup();self.setTransport(transport);transport.send([{type:"upgrade"}]);self.emit("upgrade",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name;self.emit("upgradeError",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!==transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);self.removeListener("close",onclose);self.removeListener("upgrading",onupgrade)}transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"===this.transport.name;this.emit("open");this.flush();if("open"===this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emit("packet",packet);this.emit("heartbeat");switch(packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"pong":this.setPing();this.emit("pong");break;case"error":var err=new Error("server error");err.code=packet.data;this.onError(err);break;case"message":this.emit("data",packet.data);this.emit("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"===this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if("closed"===self.readyState)return;self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket("ping",function(){self.emit("ping")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit("drain")}else{this.flush()}};Socket.prototype.flush=function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket("message",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if("function"===typeof data){fn=data;data=undefined}if("function"===typeof options){fn=options;options=null}if("closing"===this.readyState||"closed"===this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit("packetCreate",packet);this.writeBuffer.push(packet);if(fn)this.once("flush",fn);this.flush()};Socket.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var self=this;if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose("forced close");debug("socket closing - telling transport to close");self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose);self.removeListener("upgradeError",cleanupAndClose);close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose);self.once("upgradeError",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emit("error",err);this.onClose("transport error",err)};Socket.prototype.onClose=function(reason,desc){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":160,"./transports/index":161,"component-emitter":39,debug:167,"engine.io-parser":169,indexof:217,parseqs:252,parseuri:253}],160:[function(require,module,exports){var parser=require("engine.io-parser");var Emitter=require("component-emitter");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState="";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.forceNode=opts.forceNode;this.extraHeaders=opts.extraHeaders;this.localAddress=opts.localAddress}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type="TransportError";err.description=desc;this.emit("error",err);return this};Transport.prototype.open=function(){if("closed"===this.readyState||""===this.readyState){this.readyState="opening";this.doOpen()}return this};Transport.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if("open"===this.readyState){this.write(packets)}else{throw new Error("Transport not open")}};Transport.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit("packet",packet)};Transport.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":39,"engine.io-parser":169}],161:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest-ssl");var XHR=require("./polling-xhr");var JSONP=require("./polling-jsonp");var websocket=require("./websocket");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL="https:"===location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!==location.hostname||port!==opts.port;xs=opts.secure!==isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if("open"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":162,"./polling-xhr":163,"./websocket":165,"xmlhttprequest-ssl":166}],162:[function(require,module,exports){(function(global){var Polling=require("./polling");var inherit=require("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g;var rEscapedNewline=/\\n/g;var callbacks;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener("beforeunload",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko="undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement("form");var area=document.createElement("textarea");var id=this.iframeId="eio_iframe_"+this.index;var iframe;form.className="socketio";form.style.position="absolute";form.style.top="-1000px";form.style.left="-1000px";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId;iframe.src="javascript:0"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,"\\\n");this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==="complete"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":164,"component-inherit":40}],163:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest-ssl");var Polling=require("./polling");var Emitter=require("component-emitter");var inherit=require("component-inherit");var debug=require("debug")("engine.io-client:polling-xhr");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);this.requestTimeout=opts.requestTimeout;this.extraHeaders=opts.extraHeaders;if(global.location){var isSSL="https:"===location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!==global.location.hostname||port!==opts.port;this.xs=opts.secure!==isSSL}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.requestTimeout=this.requestTimeout;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!=="string"&&data!==undefined;var req=this.request({method:"POST",data:data,isBinary:isBinary});var self=this;req.on("success",fn);req.on("error",function(err){self.onError("xhr post error",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request();var self=this;req.on("data",function(data){self.onData(data)});req.on("error",function(err){self.onError("xhr poll error",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||"GET";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!==opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.requestTimeout=opts.requestTimeout;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if("POST"===this.method){try{if(this.isBinary){xhr.setRequestHeader("Content-type","application/octet-stream")}else{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}if("withCredentials"in xhr){xhr.withCredentials=true}if(this.requestTimeout){xhr.timeout=this.requestTimeout}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(xhr.readyState===2){var contentType;try{contentType=xhr.getResponseHeader("Content-Type")}catch(e){}if(contentType==="application/octet-stream"){xhr.responseType="arraybuffer"}}if(4!==xhr.readyState)return;if(200===xhr.status||1223===xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Request.prototype.onData=function(data){this.emit("data",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit("error",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if("undefined"===typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type")}catch(e){}if(contentType==="application/octet-stream"){data=this.xhr.response||this.xhr.responseText}else{data=this.xhr.responseText}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return"undefined"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};Request.requestsCount=0;Request.requests={};if(global.document){if(global.attachEvent){global.attachEvent("onunload",unloadHandler)}else if(global.addEventListener){global.addEventListener("beforeunload",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":164,"component-emitter":39,"component-inherit":40,debug:167,"xmlhttprequest-ssl":166}],164:[function(require,module,exports){var Transport=require("../transport");var parseqs=require("parseqs");var parser=require("engine.io-parser");var inherit=require("component-inherit");var yeast=require("yeast");var debug=require("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=require("xmlhttprequest-ssl");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name="polling";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var self=this;this.readyState="pausing";function pause(){debug("paused");self.readyState="paused";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")};Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){if("opening"===self.readyState){self.onOpen()}if("close"===packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if("closed"!==this.readyState){this.polling=false;this.emit("pollComplete");if("open"===this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet");self.write([{type:"close"}])}if("open"===this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit("drain")};parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"https":"http";var port="";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&("https"===schema&&Number(this.port)!==443||"http"===schema&&Number(this.port)!==80)){port=":"+this.port}if(query.length){query="?"+query}var ipv6=this.hostname.indexOf(":")!==-1;return schema+"://"+(ipv6?"["+this.hostname+"]":this.hostname)+port+this.path+query}},{"../transport":160,"component-inherit":40,debug:167,"engine.io-parser":169,parseqs:252,"xmlhttprequest-ssl":166,yeast:576}],165:[function(require,module,exports){(function(global){var Transport=require("../transport");var parser=require("engine.io-parser");var parseqs=require("parseqs");var inherit=require("component-inherit");var yeast=require("yeast");var debug=require("debug")("engine.io-client:websocket");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var NodeWebSocket;if(typeof window==="undefined"){try{NodeWebSocket=require("ws")}catch(e){}}var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window==="undefined"){WebSocket=NodeWebSocket}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;this.usingBrowserWebSocket=BrowserWebSocket&&!opts.forceNode;this.protocols=opts.protocols;if(!this.usingBrowserWebSocket){WebSocket=NodeWebSocket}Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name="websocket";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var uri=this.uri();var protocols=this.protocols;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}if(this.localAddress){opts.localAddress=this.localAddress}try{this.ws=this.usingBrowserWebSocket?protocols?new WebSocket(uri,protocols):new WebSocket(uri):new WebSocket(uri,protocols,opts)}catch(err){return this.emit("error",err)}if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType="nodebuffer"}else{this.ws.binaryType="arraybuffer"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError("websocket error",e)}};WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!self.usingBrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len="string"===typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(self.usingBrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug("websocket closed before onclose event")}--total||done()})})(packets[i])}function done(){self.emit("flush");setTimeout(function(){self.writable=true;self.emit("drain")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"wss":"ws";var port="";if(this.port&&("wss"===schema&&Number(this.port)!==443||"ws"===schema&&Number(this.port)!==80)){port=":"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query="?"+query}var ipv6=this.hostname.indexOf(":")!==-1;return schema+"://"+(ipv6?"["+this.hostname+"]":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!("__initialize"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../transport":160,"component-inherit":40,debug:167,"engine.io-parser":169,parseqs:252,ws:25,yeast:576}],166:[function(require,module,exports){(function(global){var hasCORS=require("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!==typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new(global[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"has-cors":212}],167:[function(require,module,exports){arguments[4][152][0].apply(exports,arguments)},{"./debug":168,_process:423,dup:152}],168:[function(require,module,exports){arguments[4][153][0].apply(exports,arguments)},{dup:153,ms:227}],169:[function(require,module,exports){(function(global){var keys=require("./keys");var hasBinary=require("has-binary2");var sliceBuffer=require("arraybuffer.slice");var after=require("after");var utf8=require("./utf8");var base64encoder;if(global&&global.ArrayBuffer){base64encoder=require("base64-arraybuffer")}var isAndroid=typeof navigator!=="undefined"&&/Android/i.test(navigator.userAgent);var isPhantomJS=typeof navigator!=="undefined"&&/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:"error",data:"parser error"};var Blob=require("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if(typeof supportsBinary==="function"){callback=supportsBinary;supportsBinary=false}if(typeof utf8encode==="function"){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data),{strict:false}):String(packet.data)}return callback(""+encoded)};function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(data===undefined){return err}if(typeof data==="string"){if(data.charAt(0)==="b"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){data=tryDecode(data);if(data===false){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType==="blob"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};function tryDecode(data){try{data=utf8.decode(data,{strict:false})}catch(e){return false}return data}exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!base64encoder){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType==="blob"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary==="function"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback("0:")}function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,false,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(""))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!=="string"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var packet;if(data===""){return callback(err,0,1)}var length="",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(chr!==":"){length+=chr;continue}if(length===""||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,false);if(err.type===packet.type&&err.data===packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=""}if(length!==""){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p==="string"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p==="string";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded==="string"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength="";for(var i=1;;i++){if(tailArray[i]===255)break;if(msgLength.length>310){return callback(err,0,1)}msgLength+=tailArray[i]}bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":170,"./utf8":171,after:2,"arraybuffer.slice":4,"base64-arraybuffer":19,blob:24,"has-binary2":210}],170:[function(require,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],171:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output="";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint,strict){if(codePoint>=55296&&codePoint<=57343){if(strict){throw Error("Lone surrogate U+"+codePoint.toString(16).toUpperCase()+" is not a scalar value")}return false}return true}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint,strict){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol="";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){if(!checkScalarValue(codePoint,strict)){codePoint=65533}symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string,opts){opts=opts||{};var strict=false!==opts.strict;var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString="";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint,strict)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error("Invalid byte index")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error("Invalid continuation byte")}function decodeSymbol(strict){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error("Invalid byte index")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){return checkScalarValue(codePoint,strict)?codePoint:65533}else{throw Error("Invalid continuation byte")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&7)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error("Invalid UTF-8 detected")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString,opts){opts=opts||{};var strict=false!==opts.strict;byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol(strict))!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:"2.1.2",encode:utf8encode,decode:utf8decode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],172:[function(require,module,exports){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}if(Object.create){Events.prototype=Object.create(null);if(!(new Events).__proto__)prefix=false}function EE(fn,context,once){this.fn=fn;this.context=context;this.once=once||false}function EventEmitter(){this._events=new Events;this._eventsCount=0}EventEmitter.prototype.eventNames=function eventNames(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events){if(has.call(events,name))names.push(prefix?name.slice(1):name)}if(Object.getOwnPropertySymbols){return names.concat(Object.getOwnPropertySymbols(events))}return names};EventEmitter.prototype.listeners=function listeners(event,exists){var evt=prefix?prefix+event:event,available=this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++){ee[i]=available[i].fn}return ee};EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if(listeners.fn){if(listeners.once)this.removeListener(event,listeners.fn,undefined,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true}for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i]}listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event,listeners[i].fn,undefined,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j]}listeners[i].fn.apply(listeners[i].context,args)}}}return true};EventEmitter.prototype.on=function on(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;if(!this._events[evt])this._events[evt]=listener,this._eventsCount++;else if(!this._events[evt].fn)this._events[evt].push(listener);else this._events[evt]=[this._events[evt],listener];return this};EventEmitter.prototype.once=function once(event,fn,context){var listener=new EE(fn,context||this,true),evt=prefix?prefix+event:event;if(!this._events[evt])this._events[evt]=listener,this._eventsCount++;else if(!this._events[evt].fn)this._events[evt].push(listener);else this._events[evt]=[this._events[evt],listener];return this};EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn){if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt];return this}var listeners=this._events[evt];if(listeners.fn){if(listeners.fn===fn&&(!once||listeners.once)&&(!context||listeners.context===context)){if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt]}}else{for(var i=0,events=[],length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context){events.push(listeners[i])}}if(events.length)this._events[evt]=events.length===1?events[0]:events;else if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt]}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;if(event){evt=prefix?prefix+event:event;if(this._events[evt]){if(--this._eventsCount===0)this._events=new Events;else delete this._events[evt]}}else{this._events=new Events;this._eventsCount=0}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.setMaxListeners=function setMaxListeners(){return this};EventEmitter.prefixed=prefix;EventEmitter.EventEmitter=EventEmitter;if("undefined"!==typeof module){module.exports=EventEmitter}},{}],173:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],174:[function(require,module,exports){module.exports=stringify;stringify.default=stringify;function stringify(obj){if(obj!==null&&typeof obj==="object"&&typeof obj.toJSON!=="function"){decirc(obj,"",[],null)}return JSON.stringify(obj)}function Circle(val,k,parent){this.val=val;this.k=k;this.parent=parent;this.count=1}Circle.prototype.toJSON=function toJSON(){if(--this.count===0){this.parent[this.k]=this.val}return"[Circular]"};function decirc(val,k,stack,parent){var keys,len,i,j,exists,stackLen;if(typeof val!=="object"||val===null){return}else if(val instanceof Circle){val.count++;return}else if(typeof val.toJSON==="function"&&!val.toJSON.forceDecirc){return}else if(parent){j=0;exists=false;stackLen=stack.length;for(;j<stackLen;j++){if(stack[j]===val){exists=true;break}}if(exists){parent[k]=new Circle(val,k,parent);return}}stack.push(val);keys=[];for(var key in val){if(Object.prototype.hasOwnProperty.call(val,key))keys.push(key)}len=keys.length;i=0;for(;i<len;i++){k=keys[i];decirc(val[k],k,stack,val)}stack.pop()}},{}],175:[function(require,module,exports){(function(){"use strict";function FastClick(layer,options){var oldOnClick;options=options||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=options.touchBoundary||10;this.layer=layer;this.tapDelay=options.tapDelay||200;this.tapTimeout=options.tapTimeout||700;if(FastClick.notNeeded(layer)){return}function bind(method,context){return function(){return method.apply(context,arguments)}}var methods=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"];var context=this;for(var i=0,l=methods.length;i<l;i++){context[methods[i]]=bind(context[methods[i]],context)}if(deviceIsAndroid){layer.addEventListener("mouseover",this.onMouse,true);layer.addEventListener("mousedown",this.onMouse,true);layer.addEventListener("mouseup",this.onMouse,true)}layer.addEventListener("click",this.onClick,true);layer.addEventListener("touchstart",this.onTouchStart,false);layer.addEventListener("touchmove",this.onTouchMove,false);layer.addEventListener("touchend",this.onTouchEnd,false);layer.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==="click"){rmv.call(layer,type,callback.hijacked||callback,capture)}else{rmv.call(layer,type,callback,capture)}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==="click"){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event)}}),capture)}else{adv.call(layer,type,callback,capture)}}}if(typeof layer.onclick==="function"){oldOnClick=layer.onclick;layer.addEventListener("click",function(event){oldOnClick(event)},false);layer.onclick=null}}var deviceIsWindowsPhone=navigator.userAgent.indexOf("Windows Phone")>=0;var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0&&!deviceIsWindowsPhone;var deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent)&&!deviceIsWindowsPhone;var deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent);var deviceIsIOSWithBadTarget=deviceIsIOS&&/OS [6-7]_\d/.test(navigator.userAgent);var deviceIsBlackBerry10=navigator.userAgent.indexOf("BB10")>0;FastClick.prototype.needsClick=function(target){switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled){return true}break;case"input":if(deviceIsIOS&&target.type==="file"||target.disabled){return true}break;case"label":case"iframe":case"video":return true}return/\bneedsclick\b/.test(target.className)};FastClick.prototype.needsFocus=function(target){switch(target.nodeName.toLowerCase()){case"textarea":return true;case"select":return!deviceIsAndroid;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return!target.disabled&&!target.readOnly;default:return/\bneedsfocus\b/.test(target.className)}};FastClick.prototype.sendClick=function(targetElement,event){var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur()}touch=event.changedTouches[0];clickEvent=document.createEvent("MouseEvents");clickEvent.initMouseEvent(this.determineEventType(targetElement),true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent)};FastClick.prototype.determineEventType=function(targetElement){if(deviceIsAndroid&&targetElement.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};FastClick.prototype.focus=function(targetElement){var length;if(deviceIsIOS&&targetElement.setSelectionRange&&targetElement.type.indexOf("date")!==0&&targetElement.type!=="time"&&targetElement.type!=="month"){length=targetElement.value.length;targetElement.setSelectionRange(length,length)}else{targetElement.focus()}};FastClick.prototype.updateScrollParent=function(targetElement){var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode}return eventTarget};FastClick.prototype.onTouchStart=function(event){var targetElement,touch,selection;if(event.targetTouches.length>1){return true}targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true}if(!deviceIsIOS4){if(touch.identifier&&touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false}this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement)}}this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if(event.timeStamp-this.lastClickTime<this.tapDelay){event.preventDefault()}return true};FastClick.prototype.touchHasMoved=function(event){var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true}return false};FastClick.prototype.onTouchMove=function(event){if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null}return true};FastClick.prototype.findControl=function(labelElement){if(labelElement.control!==undefined){return labelElement.control}if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor)}return labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};FastClick.prototype.onTouchEnd=function(event){var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick){return true}if(event.timeStamp-this.lastClickTime<this.tapDelay){this.cancelNextClick=true;return true}if(event.timeStamp-this.trackingClickStart>this.tapTimeout){return true}this.cancelNextClick=false;this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent}targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==="label"){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(deviceIsAndroid){return false}targetElement=forElement}}else if(this.needsFocus(targetElement)){if(event.timeStamp-trackingClickStart>100||deviceIsIOS&&window.top!==window&&targetTagName==="input"){this.targetElement=null;return false}this.focus(targetElement);this.sendClick(targetElement,event);if(!deviceIsIOS||targetTagName!=="select"){this.targetElement=null;event.preventDefault()}return false}if(deviceIsIOS&&!deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true}}if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event)}return false};FastClick.prototype.onTouchCancel=function(){this.trackingClick=false;this.targetElement=null};FastClick.prototype.onMouse=function(event){if(!this.targetElement){return true}if(event.forwardedTouchEvent){return true}if(!event.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.propagationStopped=true}event.stopPropagation();event.preventDefault();return false}return true};FastClick.prototype.onClick=function(event){var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(event.target.type==="submit"&&event.detail===0){return true}permitted=this.onMouse(event);if(!permitted){this.targetElement=null}return permitted};FastClick.prototype.destroy=function(){var layer=this.layer;if(deviceIsAndroid){layer.removeEventListener("mouseover",this.onMouse,true);layer.removeEventListener("mousedown",this.onMouse,true);layer.removeEventListener("mouseup",this.onMouse,true)}layer.removeEventListener("click",this.onClick,true);layer.removeEventListener("touchstart",this.onTouchStart,false);layer.removeEventListener("touchmove",this.onTouchMove,false);layer.removeEventListener("touchend",this.onTouchEnd,false);layer.removeEventListener("touchcancel",this.onTouchCancel,false)};FastClick.notNeeded=function(layer){var metaViewport;var chromeVersion;var blackberryVersion;var firefoxVersion;if(typeof window.ontouchstart==="undefined"){return true}chromeVersion=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(chromeVersion){if(deviceIsAndroid){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport){if(metaViewport.content.indexOf("user-scalable=no")!==-1){return true}if(chromeVersion>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(deviceIsBlackBerry10){blackberryVersion=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(blackberryVersion[1]>=10&&blackberryVersion[2]>=3){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport){if(metaViewport.content.indexOf("user-scalable=no")!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(layer.style.msTouchAction==="none"||layer.style.touchAction==="manipulation"){return true}firefoxVersion=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(firefoxVersion>=27){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport&&(metaViewport.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth)){return true}}if(layer.style.touchAction==="none"||layer.style.touchAction==="manipulation"){return true}return false};FastClick.attach=function(layer,options){return new FastClick(layer,options)};if(typeof define==="function"&&typeof define.amd==="object"&&define.amd){define(function(){return FastClick})}else if(typeof module!=="undefined"&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick}else{window.FastClick=FastClick}})()},{}],176:[function(require,module,exports){(function(global,factory){if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}else if(typeof exports!=="undefined"&&typeof module!=="undefined"){factory(exports,module)}else{var mod={exports:{}};factory(mod.exports,mod);global.fetchJsonp=mod.exports}})(this,function(exports,module){"use strict";var defaultOptions={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function generateCallbackFunction(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function clearFunction(functionName){try{delete window[functionName]}catch(e){window[functionName]=undefined}}function removeScript(scriptId){var script=document.getElementById(scriptId);if(script){document.getElementsByTagName("head")[0].removeChild(script)}}function fetchJsonp(_url){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var url=_url;var timeout=options.timeout||defaultOptions.timeout;var jsonpCallback=options.jsonpCallback||defaultOptions.jsonpCallback;var timeoutId=undefined;return new Promise(function(resolve,reject){var callbackFunction=options.jsonpCallbackFunction||generateCallbackFunction();var scriptId=jsonpCallback+"_"+callbackFunction;window[callbackFunction]=function(response){resolve({ok:true,json:function json(){return Promise.resolve(response)}});if(timeoutId)clearTimeout(timeoutId);removeScript(scriptId);clearFunction(callbackFunction)};url+=url.indexOf("?")===-1?"?":"&";var jsonpScript=document.createElement("script");jsonpScript.setAttribute("src",""+url+jsonpCallback+"="+callbackFunction);if(options.charset){jsonpScript.setAttribute("charset",options.charset)}jsonpScript.id=scriptId;document.getElementsByTagName("head")[0].appendChild(jsonpScript);timeoutId=setTimeout(function(){reject(new Error("JSONP request to "+_url+" timed out"));clearFunction(callbackFunction);removeScript(scriptId);window[callbackFunction]=function(){clearFunction(callbackFunction)}},timeout);jsonpScript.onerror=function(){reject(new Error("JSONP request to "+_url+" failed"));clearFunction(callbackFunction);removeScript(scriptId);if(timeoutId)clearTimeout(timeoutId)}})}module.exports=fetchJsonp})},{}],177:[function(require,module,exports){var WildEmitter=require("wildemitter");var util=require("util");function Sender(opts){WildEmitter.call(this);var options=opts||{};this.config={chunksize:16384,pacing:0};var item;for(item in options){this.config[item]=options[item]}this.file=null;this.channel=null}util.inherits(Sender,WildEmitter);Sender.prototype.send=function(file,channel){var self=this;this.file=file;this.channel=channel;var usePoll=typeof channel.bufferedAmountLowThreshold!=="number";var offset=0;var sliceFile=function(){var reader=new window.FileReader;reader.onload=function(){return function(e){self.channel.send(e.target.result);self.emit("progress",offset,file.size,e.target.result);if(file.size>offset+e.target.result.byteLength){if(usePoll){window.setTimeout(sliceFile,self.config.pacing)}else if(channel.bufferedAmount<=channel.bufferedAmountLowThreshold){window.setTimeout(sliceFile,0)}else{}}else{self.emit("progress",file.size,file.size,null);self.emit("sentFile")}offset=offset+self.config.chunksize}}(file);var slice=file.slice(offset,offset+self.config.chunksize);reader.readAsArrayBuffer(slice)};if(!usePoll){channel.bufferedAmountLowThreshold=8*this.config.chunksize;channel.addEventListener("bufferedamountlow",sliceFile)}window.setTimeout(sliceFile,0)};function Receiver(){WildEmitter.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}util.inherits(Receiver,WildEmitter);Receiver.prototype.receive=function(metadata,channel){var self=this;if(metadata){this.metadata=metadata}this.channel=channel;channel.binaryType="arraybuffer";this.channel.onmessage=function(event){var len=event.data.byteLength;self.received+=len;self.receiveBuffer.push(event.data);self.emit("progress",self.received,self.metadata.size,event.data);if(self.received===self.metadata.size){self.emit("receivedFile",new window.Blob(self.receiveBuffer),self.metadata);self.receiveBuffer=[]}else if(self.received>self.metadata.size){console.error("received more than expected, discarding...");self.receiveBuffer=[]}}};module.exports={};module.exports.support=typeof window!=="undefined"&&window&&window.File&&window.FileReader&&window.Blob;module.exports.Sender=Sender;module.exports.Receiver=Receiver},{util:550,wildemitter:573}],178:[function(require,module,exports){module.exports=function flatten(list,depth){depth=typeof depth=="number"?depth:Infinity;if(!depth){if(Array.isArray(list)){return list.map(function(i){return i})}return list}return _flatten(list,1);function _flatten(list,d){return list.reduce(function(acc,item){if(Array.isArray(item)&&d<depth){return acc.concat(_flatten(item,d+1))}else{return acc.concat(item)}},[])}}},{}],179:[function(require,module,exports){var cache={};module.exports=function(constraints,cb){var hasConstraints=arguments.length===2;var callback=hasConstraints?cb:constraints;var error;if(typeof window==="undefined"||window.location.protocol==="http:"){error=new Error("NavigatorUserMediaError");error.name="HTTPS_REQUIRED";return callback(error)}if(window.navigator.userAgent.match("Chrome")){var chromever=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10);var maxver=33;var isCef=!window.chrome.webstore;if(window.navigator.userAgent.match("Linux"))maxver=35;if(sessionStorage.getScreenMediaJSExtensionId){chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(data){if(!data||data.sourceId===""){var error=new Error("NavigatorUserMediaError");error.name="NotAllowedError";callback(error)}else{constraints=hasConstraints&&constraints||{audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}};constraints.video.mandatory.chromeMediaSourceId=data.sourceId;window.navigator.mediaDevices.getUserMedia(constraints).then(function(stream){callback(null,stream)}).catch(function(err){callback(err)})}})}else if(window.cefGetScreenMedia){window.cefGetScreenMedia(function(sourceId){if(!sourceId){var error=new Error("cefGetScreenMediaError");error.name="CEF_GETSCREENMEDIA_CANCELED";callback(error)}else{constraints=hasConstraints&&constraints||{audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:true},{googTemporalLayeredScreencast:true}]}};constraints.video.mandatory.chromeMediaSourceId=sourceId;window.navigator.mediaDevices.getUserMedia(constraints).then(function(stream){callback(null,stream)}).catch(function(err){callback(err)})}})}else if(isCef||chromever>=26&&chromever<=maxver){constraints=hasConstraints&&constraints||{video:{mandatory:{googLeakyBucket:true,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}};window.navigator.mediaDevices.getUserMedia(constraints).then(function(stream){callback(null,stream)}).catch(function(err){callback(err)})}else{var pending=window.setTimeout(function(){error=new Error("NavigatorUserMediaError");error.name="EXTENSION_UNAVAILABLE";return callback(error)},1e3);cache[pending]=[callback,hasConstraints?constraints:null];window.postMessage({type:"getScreen",id:pending},"*")}}else if(window.navigator.userAgent.match("Firefox")){var ffver=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(ffver>=33){constraints=hasConstraints&&constraints||{video:{mozMediaSource:"window",mediaSource:"window"}};window.navigator.mediaDevices.getUserMedia(constraints).then(function(stream){callback(null,stream);var lastTime=stream.currentTime;var polly=window.setInterval(function(){if(!stream)window.clearInterval(polly);if(stream.currentTime==lastTime){window.clearInterval(polly);if(stream.onended){stream.onended()}}lastTime=stream.currentTime},500)}).catch(function(err){callback(err)})}else{error=new Error("NavigatorUserMediaError");error.name="EXTENSION_UNAVAILABLE"}}};typeof window!=="undefined"&&window.addEventListener("message",function(event){if(event.origin!=window.location.origin){return}if(event.data.type=="gotScreen"&&cache[event.data.id]){var data=cache[event.data.id];var constraints=data[1];var callback=data[0];delete cache[event.data.id];if(event.data.sourceId===""){var error=new Error("NavigatorUserMediaError");error.name="NotAllowedError";callback(error)}else{constraints=constraints||{audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:true},{googTemporalLayeredScreencast:true}]}};constraints.video.mandatory.chromeMediaSourceId=event.data.sourceId;window.navigator.mediaDevices.getUserMedia(constraints).then(function(stream){callback(null,stream)}).catch(function(err){callback(err)})}}else if(event.data.type=="getScreenPending"){window.clearTimeout(event.data.id)}})},{}],180:[function(require,module,exports){module.exports=adjoint;function adjoint(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out}},{}],181:[function(require,module,exports){module.exports=clone;function clone(a){var out=new Float32Array(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}},{}],182:[function(require,module,exports){module.exports=copy;function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}},{}],183:[function(require,module,exports){module.exports=create;function create(){var out=new Float32Array(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}},{}],184:[function(require,module,exports){module.exports=determinant;function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06}},{}],185:[function(require,module,exports){module.exports=fromQuat;function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}},{}],186:[function(require,module,exports){module.exports=fromRotationTranslation;function fromRotationTranslation(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}},{}],187:[function(require,module,exports){module.exports=frustum;function frustum(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out}},{}],188:[function(require,module,exports){module.exports=identity;function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}},{}],189:[function(require,module,exports){module.exports={create:require("./create"),clone:require("./clone"),copy:require("./copy"),identity:require("./identity"),transpose:require("./transpose"),invert:require("./invert"),adjoint:require("./adjoint"),determinant:require("./determinant"),multiply:require("./multiply"),translate:require("./translate"),scale:require("./scale"),rotate:require("./rotate"),rotateX:require("./rotateX"),rotateY:require("./rotateY"),rotateZ:require("./rotateZ"),fromRotationTranslation:require("./fromRotationTranslation"),fromQuat:require("./fromQuat"),frustum:require("./frustum"),perspective:require("./perspective"),perspectiveFromFieldOfView:require("./perspectiveFromFieldOfView"),ortho:require("./ortho"),lookAt:require("./lookAt"),str:require("./str")}},{"./adjoint":180,"./clone":181,"./copy":182,"./create":183,"./determinant":184,"./fromQuat":185,"./fromRotationTranslation":186,"./frustum":187,"./identity":188,"./invert":190,"./lookAt":191,"./multiply":192,"./ortho":193,"./perspective":194,"./perspectiveFromFieldOfView":195,"./rotate":196,"./rotateX":197,"./rotateY":198,"./rotateZ":199,"./scale":200,"./str":201,"./translate":202,"./transpose":203}],190:[function(require,module,exports){module.exports=invert;function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}},{}],191:[function(require,module,exports){var identity=require("./identity");module.exports=lookAt;function lookAt(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<1e-6&&Math.abs(eyey-centery)<1e-6&&Math.abs(eyez-centerz)<1e-6){return identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out}},{"./identity":188}],192:[function(require,module,exports){module.exports=multiply;function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}},{}],193:[function(require,module,exports){module.exports=ortho;function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out}},{}],194:[function(require,module,exports){module.exports=perspective;function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out}},{}],195:[function(require,module,exports){module.exports=perspectiveFromFieldOfView;function perspectiveFromFieldOfView(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*.5);out[9]=(upTan-downTan)*yScale*.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out}},{}],196:[function(require,module,exports){module.exports=rotate;function rotate(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<1e-6){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out}},{}],197:[function(require,module,exports){module.exports=rotateX;function rotateX(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out}},{}],198:[function(require,module,exports){module.exports=rotateY;function rotateY(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out}},{}],199:[function(require,module,exports){module.exports=rotateZ;function rotateZ(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out}},{}],200:[function(require,module,exports){module.exports=scale;function scale(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}},{}],201:[function(require,module,exports){module.exports=str;function str(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}},{}],202:[function(require,module,exports){module.exports=translate;function translate(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}},{}],203:[function(require,module,exports){module.exports=transpose;function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out}},{}],204:[function(require,module,exports){(function(global){var topLevel=typeof global!=="undefined"?global:typeof window!=="undefined"?window:{};var minDoc=require("min-document");var doccy;if(typeof document!=="undefined"){doccy=document}else{doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"];if(!doccy){doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc}}module.exports=doccy}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":25}],205:[function(require,module,exports){(function(global){var win;if(typeof window!=="undefined"){win=window}else if(typeof global!=="undefined"){win=global}else if(typeof self!=="undefined"){win=self}else{win={}}module.exports=win}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],206:[function(require,module,exports){(function(window,document,exportName,undefined){"use strict";var VENDOR_PREFIXES=["","webkit","Moz","MS","ms","o"];var TEST_ELEMENT=document.createElement("div");var TYPE_FUNCTION="function";var round=Math.round;var abs=Math.abs;var now=Date.now;function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout)}function invokeArrayArg(arg,fn,context){if(Array.isArray(arg)){each(arg,context[fn],context);return true}return false}function each(obj,iterator,context){var i;if(!obj){return}if(obj.forEach){obj.forEach(iterator,context)}else if(obj.length!==undefined){i=0;while(i<obj.length){iterator.call(context,obj[i],i,obj);i++}}else{for(i in obj){obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)}}}function deprecate(method,name,message){var deprecationMessage="DEPRECATED METHOD: "+name+"\n"+message+" AT \n";return function(){var e=new Error("get-stack-trace");var stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace";var log=window.console&&(window.console.warn||window.console.log);if(log){log.call(window.console,deprecationMessage,stack)}return method.apply(this,arguments)}}var assign;if(typeof Object.assign!=="function"){assign=function assign(target){if(target===undefined||target===null){throw new TypeError("Cannot convert undefined or null to object")}var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey]}}}}return output}}else{assign=Object.assign}var extend=deprecate(function extend(dest,src,merge){var keys=Object.keys(src);var i=0;while(i<keys.length){if(!merge||merge&&dest[keys[i]]===undefined){dest[keys[i]]=src[keys[i]]}i++}return dest},"extend","Use `assign`.");var merge=deprecate(function merge(dest,src){return extend(dest,src,true)},"merge","Use `assign`.");function inherit(child,base,properties){var baseP=base.prototype,childP;childP=child.prototype=Object.create(baseP);childP.constructor=child;childP._super=baseP;if(properties){assign(childP,properties)}}function bindFn(fn,context){return function boundFn(){return fn.apply(context,arguments)}}function boolOrFn(val,args){if(typeof val==TYPE_FUNCTION){return val.apply(args?args[0]||undefined:undefined,args)}return val}function ifUndefined(val1,val2){return val1===undefined?val2:val1}function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,false)})}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,false)})}function hasParent(node,parent){while(node){if(node==parent){return true}node=node.parentNode}return false}function inStr(str,find){return str.indexOf(find)>-1}function splitStr(str){return str.trim().split(/\s+/g)}function inArray(src,find,findByKey){if(src.indexOf&&!findByKey){return src.indexOf(find)}else{var i=0;while(i<src.length){if(findByKey&&src[i][findByKey]==find||!findByKey&&src[i]===find){return i}i++}return-1}}function toArray(obj){return Array.prototype.slice.call(obj,0)}function uniqueArray(src,key,sort){var results=[];var values=[];var i=0;while(i<src.length){var val=key?src[i][key]:src[i];if(inArray(values,val)<0){results.push(src[i])}values[i]=val;i++}if(sort){if(!key){results=results.sort()}else{results=results.sort(function sortUniqueArray(a,b){return a[key]>b[key]})}}return results}function prefixed(obj,property){var prefix,prop;var camelProp=property[0].toUpperCase()+property.slice(1);var i=0;while(i<VENDOR_PREFIXES.length){prefix=VENDOR_PREFIXES[i];prop=prefix?prefix+camelProp:property;if(prop in obj){return prop}i++}return undefined}var _uniqueId=1;function uniqueId(){return _uniqueId++}function getWindowForElement(element){var doc=element.ownerDocument||element;return doc.defaultView||doc.parentWindow||window}var MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;var SUPPORT_TOUCH="ontouchstart"in window;var SUPPORT_POINTER_EVENTS=prefixed(window,"PointerEvent")!==undefined;var SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent);var INPUT_TYPE_TOUCH="touch";var INPUT_TYPE_PEN="pen";var INPUT_TYPE_MOUSE="mouse";var INPUT_TYPE_KINECT="kinect";var COMPUTE_INTERVAL=25;var INPUT_START=1;var INPUT_MOVE=2;var INPUT_END=4;var INPUT_CANCEL=8;var DIRECTION_NONE=1;var DIRECTION_LEFT=2;var DIRECTION_RIGHT=4;var DIRECTION_UP=8;var DIRECTION_DOWN=16;var DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT;var DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN;var DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL;var PROPS_XY=["x","y"];var PROPS_CLIENT_XY=["clientX","clientY"];function Input(manager,callback){var self=this;this.manager=manager;this.callback=callback;this.element=manager.element;this.target=manager.options.inputTarget;this.domHandler=function(ev){if(boolOrFn(manager.options.enable,[manager])){self.handler(ev)}};this.init()}Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};function createInputInstance(manager){var Type;var inputClass=manager.options.inputClass;if(inputClass){Type=inputClass}else if(SUPPORT_POINTER_EVENTS){Type=PointerEventInput}else if(SUPPORT_ONLY_TOUCH){Type=TouchInput}else if(!SUPPORT_TOUCH){Type=MouseInput}else{Type=TouchMouseInput}return new Type(manager,inputHandler)}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length;var changedPointersLen=input.changedPointers.length;var isFirst=eventType&INPUT_START&&pointersLen-changedPointersLen===0;var isFinal=eventType&(INPUT_END|INPUT_CANCEL)&&pointersLen-changedPointersLen===0;input.isFirst=!!isFirst;input.isFinal=!!isFinal;if(isFirst){manager.session={}}input.eventType=eventType;computeInputData(manager,input);manager.emit("hammer.input",input);manager.recognize(input);manager.session.prevInput=input}function computeInputData(manager,input){var session=manager.session;var pointers=input.pointers;var pointersLength=pointers.length;if(!session.firstInput){session.firstInput=simpleCloneInputData(input)}if(pointersLength>1&&!session.firstMultiple){session.firstMultiple=simpleCloneInputData(input)}else if(pointersLength===1){session.firstMultiple=false}var firstInput=session.firstInput;var firstMultiple=session.firstMultiple;var offsetCenter=firstMultiple?firstMultiple.center:firstInput.center;var center=input.center=getCenter(pointers);input.timeStamp=now();input.deltaTime=input.timeStamp-firstInput.timeStamp;input.angle=getAngle(offsetCenter,center);input.distance=getDistance(offsetCenter,center);computeDeltaXY(session,input);input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x;input.overallVelocityY=overallVelocity.y;input.overallVelocity=abs(overallVelocity.x)>abs(overallVelocity.y)?overallVelocity.x:overallVelocity.y;input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1;input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):0;input.maxPointers=!session.prevInput?input.pointers.length:input.pointers.length>session.prevInput.maxPointers?input.pointers.length:session.prevInput.maxPointers;computeIntervalInputData(session,input);var target=manager.element;if(hasParent(input.srcEvent.target,target)){target=input.srcEvent.target}input.target=target}function computeDeltaXY(session,input){var center=input.center;var offset=session.offsetDelta||{};var prevDelta=session.prevDelta||{};var prevInput=session.prevInput||{};if(input.eventType===INPUT_START||prevInput.eventType===INPUT_END){prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0};offset=session.offsetDelta={x:center.x,y:center.y}}input.deltaX=prevDelta.x+(center.x-offset.x);input.deltaY=prevDelta.y+(center.y-offset.y)}function computeIntervalInputData(session,input){var last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp,velocity,velocityX,velocityY,direction;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===undefined)){var deltaX=input.deltaX-last.deltaX;var deltaY=input.deltaY-last.deltaY;var v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x;velocityY=v.y;velocity=abs(v.x)>abs(v.y)?v.x:v.y;direction=getDirection(deltaX,deltaY);session.lastInterval=input}else{velocity=last.velocity;velocityX=last.velocityX;velocityY=last.velocityY;direction=last.direction}input.velocity=velocity;input.velocityX=velocityX;input.velocityY=velocityY;input.direction=direction}function simpleCloneInputData(input){var pointers=[];var i=0;while(i<input.pointers.length){pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)};i++}return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY}}function getCenter(pointers){var pointersLength=pointers.length;if(pointersLength===1){return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)}}var x=0,y=0,i=0;while(i<pointersLength){x+=pointers[i].clientX;y+=pointers[i].clientY;i++}return{x:round(x/pointersLength),y:round(y/pointersLength)}}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0}}function getDirection(x,y){if(x===y){return DIRECTION_NONE}if(abs(x)>=abs(y)){return x<0?DIRECTION_LEFT:DIRECTION_RIGHT}return y<0?DIRECTION_UP:DIRECTION_DOWN}function getDistance(p1,p2,props){if(!props){props=PROPS_XY}var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt(x*x+y*y)}function getAngle(p1,p2,props){if(!props){props=PROPS_XY}var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.atan2(y,x)*180/Math.PI}function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY)}function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY)}var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END};var MOUSE_ELEMENT_EVENTS="mousedown";var MOUSE_WINDOW_EVENTS="mousemove mouseup";function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS;this.evWin=MOUSE_WINDOW_EVENTS;this.pressed=false;Input.apply(this,arguments)}inherit(MouseInput,Input,{handler:function MEhandler(ev){var eventType=MOUSE_INPUT_MAP[ev.type];if(eventType&INPUT_START&&ev.button===0){this.pressed=true}if(eventType&INPUT_MOVE&&ev.which!==1){eventType=INPUT_END}if(!this.pressed){return}if(eventType&INPUT_END){this.pressed=false}this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:INPUT_TYPE_MOUSE,srcEvent:ev})}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL};var IE10_POINTER_TYPE_ENUM={2:INPUT_TYPE_TOUCH,3:INPUT_TYPE_PEN,4:INPUT_TYPE_MOUSE,5:INPUT_TYPE_KINECT};var POINTER_ELEMENT_EVENTS="pointerdown";var POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";if(window.MSPointerEvent&&!window.PointerEvent){POINTER_ELEMENT_EVENTS="MSPointerDown";POINTER_WINDOW_EVENTS="MSPointerMove MSPointerUp MSPointerCancel"}function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS;this.evWin=POINTER_WINDOW_EVENTS;Input.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}inherit(PointerEventInput,Input,{handler:function PEhandler(ev){var store=this.store;var removePointer=false;var eventTypeNormalized=ev.type.toLowerCase().replace("ms","");var eventType=POINTER_INPUT_MAP[eventTypeNormalized];var pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType;var isTouch=pointerType==INPUT_TYPE_TOUCH;var storeIndex=inArray(store,ev.pointerId,"pointerId");if(eventType&INPUT_START&&(ev.button===0||isTouch)){if(storeIndex<0){store.push(ev);storeIndex=store.length-1}}else if(eventType&(INPUT_END|INPUT_CANCEL)){removePointer=true}if(storeIndex<0){return}store[storeIndex]=ev;this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev});if(removePointer){store.splice(storeIndex,1)}}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};var SINGLE_TOUCH_TARGET_EVENTS="touchstart";var SINGLE_TOUCH_WINDOW_EVENTS="touchstart touchmove touchend touchcancel";function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS;this.evWin=SINGLE_TOUCH_WINDOW_EVENTS;this.started=false;Input.apply(this,arguments)}inherit(SingleTouchInput,Input,{handler:function TEhandler(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START){this.started=true}if(!this.started){return}var touches=normalizeSingleTouches.call(this,ev,type);if(type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length===0){this.started=false}this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev})}});function normalizeSingleTouches(ev,type){var all=toArray(ev.touches);var changed=toArray(ev.changedTouches);if(type&(INPUT_END|INPUT_CANCEL)){all=uniqueArray(all.concat(changed),"identifier",true)}return[all,changed]}var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};var TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS;this.targetIds={};Input.apply(this,arguments)}inherit(TouchInput,Input,{handler:function MTEhandler(ev){var type=TOUCH_INPUT_MAP[ev.type];var touches=getTouches.call(this,ev,type);if(!touches){return}this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev})}});function getTouches(ev,type){var allTouches=toArray(ev.touches);var targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&allTouches.length===1){targetIds[allTouches[0].identifier]=true;return[allTouches,allTouches]}var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target)});if(type===INPUT_START){i=0;while(i<targetTouches.length){targetIds[targetTouches[i].identifier]=true;i++}}i=0;while(i<changedTouches.length){if(targetIds[changedTouches[i].identifier]){changedTargetTouches.push(changedTouches[i])}if(type&(INPUT_END|INPUT_CANCEL)){delete targetIds[changedTouches[i].identifier]}i++}if(!changedTargetTouches.length){return}return[uniqueArray(targetTouches.concat(changedTargetTouches),"identifier",true),changedTargetTouches]}var DEDUP_TIMEOUT=2500;var DEDUP_DISTANCE=25;function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler);this.mouse=new MouseInput(this.manager,handler);this.primaryTouch=null;this.lastTouches=[]}inherit(TouchMouseInput,Input,{handler:function TMEhandler(manager,inputEvent,inputData){var isTouch=inputData.pointerType==INPUT_TYPE_TOUCH,isMouse=inputData.pointerType==INPUT_TYPE_MOUSE;if(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents){return}if(isTouch){recordTouches.call(this,inputEvent,inputData)}else if(isMouse&&isSyntheticEvent.call(this,inputData)){return}this.callback(manager,inputEvent,inputData)},destroy:function destroy(){this.touch.destroy();this.mouse.destroy()}});function recordTouches(eventType,eventData){if(eventType&INPUT_START){this.primaryTouch=eventData.changedPointers[0].identifier;setLastTouch.call(this,eventData)}else if(eventType&(INPUT_END|INPUT_CANCEL)){setLastTouch.call(this,eventData)}}function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches;var removeLastTouch=function(){var i=lts.indexOf(lastTouch);if(i>-1){lts.splice(i,1)}};setTimeout(removeLastTouch,DEDUP_TIMEOUT)}}function isSyntheticEvent(eventData){var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY;for(var i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i];var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DISTANCE&&dy<=DEDUP_DISTANCE){return true}}return false}var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,"touchAction");var NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined;var TOUCH_ACTION_COMPUTE="compute";var TOUCH_ACTION_AUTO="auto";var TOUCH_ACTION_MANIPULATION="manipulation";var TOUCH_ACTION_NONE="none";var TOUCH_ACTION_PAN_X="pan-x";var TOUCH_ACTION_PAN_Y="pan-y";var TOUCH_ACTION_MAP=getTouchActionProps();function TouchAction(manager,value){this.manager=manager;this.set(value)}TouchAction.prototype={set:function(value){if(value==TOUCH_ACTION_COMPUTE){value=this.compute()}if(NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value]){this.manager.element.style[PREFIXED_TOUCH_ACTION]=value}this.actions=value.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var actions=[];each(this.manager.recognizers,function(recognizer){if(boolOrFn(recognizer.options.enable,[recognizer])){actions=actions.concat(recognizer.getTouchAction())}});return cleanTouchActions(actions.join(" "))},preventDefaults:function(input){var srcEvent=input.srcEvent;var direction=input.offsetDirection;if(this.manager.session.prevented){srcEvent.preventDefault();return}var actions=this.actions;var hasNone=inStr(actions,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(hasNone){var isTapPointer=input.pointers.length===1;var isTapMovement=input.distance<2;var isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime){return}}if(hasPanX&&hasPanY){return}if(hasNone||hasPanY&&direction&DIRECTION_HORIZONTAL||hasPanX&&direction&DIRECTION_VERTICAL){return this.preventSrc(srcEvent)}},preventSrc:function(srcEvent){this.manager.session.prevented=true;srcEvent.preventDefault()}};function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE)){return TOUCH_ACTION_NONE}var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X);var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);if(hasPanX&&hasPanY){return TOUCH_ACTION_NONE}if(hasPanX||hasPanY){return hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y}if(inStr(actions,TOUCH_ACTION_MANIPULATION)){return TOUCH_ACTION_MANIPULATION}return TOUCH_ACTION_AUTO}function getTouchActionProps(){if(!NATIVE_TOUCH_ACTION){return false}var touchMap={};var cssSupports=window.CSS&&window.CSS.supports;["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(val){touchMap[val]=cssSupports?window.CSS.supports("touch-action",val):true});return touchMap}var STATE_POSSIBLE=1;var STATE_BEGAN=2;var STATE_CHANGED=4;var STATE_ENDED=8;var STATE_RECOGNIZED=STATE_ENDED;var STATE_CANCELLED=16;var STATE_FAILED=32;function Recognizer(options){this.options=assign({},this.defaults,options||{});this.id=uniqueId();this.manager=null;this.options.enable=ifUndefined(this.options.enable,true);this.state=STATE_POSSIBLE;this.simultaneous={};this.requireFail=[]}Recognizer.prototype={defaults:{},set:function(options){assign(this.options,options);this.manager&&this.manager.touchAction.update();return this},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"recognizeWith",this)){return this}var simultaneous=this.simultaneous;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(!simultaneous[otherRecognizer.id]){simultaneous[otherRecognizer.id]=otherRecognizer;otherRecognizer.recognizeWith(this)}return this},dropRecognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRecognizeWith",this)){return this}otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);delete this.simultaneous[otherRecognizer.id];return this},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"requireFailure",this)){return this}var requireFail=this.requireFail;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(inArray(requireFail,otherRecognizer)===-1){requireFail.push(otherRecognizer);otherRecognizer.requireFailure(this)}return this},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRequireFailure",this)){return this}otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);if(index>-1){this.requireFail.splice(index,1)}return this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id]},emit:function(input){var self=this;var state=this.state;function emit(event){self.manager.emit(event,input)}if(state<STATE_ENDED){emit(self.options.event+stateStr(state))}emit(self.options.event);if(input.additionalEvent){emit(input.additionalEvent)}if(state>=STATE_ENDED){emit(self.options.event+stateStr(state))}},tryEmit:function(input){if(this.canEmit()){return this.emit(input)}this.state=STATE_FAILED},canEmit:function(){var i=0;while(i<this.requireFail.length){if(!(this.requireFail[i].state&(STATE_FAILED|STATE_POSSIBLE))){return false}i++}return true},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone])){this.reset();this.state=STATE_FAILED;return}if(this.state&(STATE_RECOGNIZED|STATE_CANCELLED|STATE_FAILED)){this.state=STATE_POSSIBLE}this.state=this.process(inputDataClone);if(this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED)){this.tryEmit(inputDataClone)}},process:function(inputData){},getTouchAction:function(){},reset:function(){}};function stateStr(state){if(state&STATE_CANCELLED){return"cancel"}else if(state&STATE_ENDED){return"end"}else if(state&STATE_CHANGED){return"move"}else if(state&STATE_BEGAN){return"start"}return""}function directionStr(direction){if(direction==DIRECTION_DOWN){return"down"}else if(direction==DIRECTION_UP){return"up"}else if(direction==DIRECTION_LEFT){return"left"}else if(direction==DIRECTION_RIGHT){return"right"}return""}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;if(manager){return manager.get(otherRecognizer)}return otherRecognizer}function AttrRecognizer(){Recognizer.apply(this,arguments)}inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return optionPointers===0||input.pointers.length===optionPointers},process:function(input){var state=this.state;var eventType=input.eventType;var isRecognized=state&(STATE_BEGAN|STATE_CHANGED);var isValid=this.attrTest(input);if(isRecognized&&(eventType&INPUT_CANCEL||!isValid)){return state|STATE_CANCELLED}else if(isRecognized||isValid){if(eventType&INPUT_END){return state|STATE_ENDED}else if(!(state&STATE_BEGAN)){return STATE_BEGAN}return state|STATE_CHANGED}return STATE_FAILED}});function PanRecognizer(){AttrRecognizer.apply(this,arguments);this.pX=null;this.pY=null}inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction;var actions=[];if(direction&DIRECTION_HORIZONTAL){actions.push(TOUCH_ACTION_PAN_Y)}if(direction&DIRECTION_VERTICAL){actions.push(TOUCH_ACTION_PAN_X)}return actions},directionTest:function(input){var options=this.options;var hasMoved=true;var distance=input.distance;var direction=input.direction;var x=input.deltaX;var y=input.deltaY;if(!(direction&options.direction)){if(options.direction&DIRECTION_HORIZONTAL){direction=x===0?DIRECTION_NONE:x<0?DIRECTION_LEFT:DIRECTION_RIGHT;hasMoved=x!=this.pX;distance=Math.abs(input.deltaX)}else{direction=y===0?DIRECTION_NONE:y<0?DIRECTION_UP:DIRECTION_DOWN;hasMoved=y!=this.pY;distance=Math.abs(input.deltaY)}}input.direction=direction;return hasMoved&&distance>options.threshold&&direction&options.direction},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(this.state&STATE_BEGAN||!(this.state&STATE_BEGAN)&&this.directionTest(input))},emit:function(input){this.pX=input.deltaX;this.pY=input.deltaY;var direction=directionStr(input.direction);if(direction){input.additionalEvent=this.options.event+direction}this._super.emit.call(this,input)}});function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN)},emit:function(input){if(input.scale!==1){var inOut=input.scale<1?"in":"out";input.additionalEvent=this.options.event+inOut}this._super.emit.call(this,input)}});function PressRecognizer(){Recognizer.apply(this,arguments);this._timer=null;this._input=null}inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[TOUCH_ACTION_AUTO]},process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTime=input.deltaTime>options.time;this._input=input;if(!validMovement||!validPointers||input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime){this.reset()}else if(input.eventType&INPUT_START){this.reset();this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit()},options.time,this)}else if(input.eventType&INPUT_END){return STATE_RECOGNIZED}return STATE_FAILED},reset:function(){clearTimeout(this._timer)},emit:function(input){if(this.state!==STATE_RECOGNIZED){return}if(input&&input.eventType&INPUT_END){this.manager.emit(this.options.event+"up",input)}else{this._input.timeStamp=now();this.manager.emit(this.options.event,this._input)}}});function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN)}});function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function(input){var direction=this.options.direction;var velocity;if(direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)){velocity=input.overallVelocity}else if(direction&DIRECTION_HORIZONTAL){velocity=input.overallVelocityX}else if(direction&DIRECTION_VERTICAL){velocity=input.overallVelocityY}return this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END},emit:function(input){var direction=directionStr(input.offsetDirection);if(direction){this.manager.emit(this.options.event+direction,input)}this.manager.emit(this.options.event,input)}});function TapRecognizer(){Recognizer.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0}inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION]},process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTouchTime=input.deltaTime<options.time;this.reset();if(input.eventType&INPUT_START&&this.count===0){return this.failTimeout()}if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END){return this.failTimeout()}var validInterval=this.pTime?input.timeStamp-this.pTime<options.interval:true;var validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;this.pTime=input.timeStamp;this.pCenter=input.center;if(!validMultiTap||!validInterval){this.count=1}else{this.count+=1}this._input=input;var tapCount=this.count%options.taps;if(tapCount===0){if(!this.hasRequireFailures()){return STATE_RECOGNIZED}else{this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit()},options.interval,this);return STATE_BEGAN}}}return STATE_FAILED},failTimeout:function(){this._timer=setTimeoutContext(function(){this.state=STATE_FAILED},this.options.interval,this);return STATE_FAILED},reset:function(){clearTimeout(this._timer)},emit:function(){if(this.state==STATE_RECOGNIZED){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input)}}});function Hammer(element,options){options=options||{};options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset);return new Manager(element,options)}Hammer.VERSION="2.0.7";Hammer.defaults={domEvents:false,touchAction:TOUCH_ACTION_COMPUTE,enable:true,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:false}],[PinchRecognizer,{enable:false},["rotate"]],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var STOP=1;var FORCED_STOP=2;function Manager(element,options){this.options=assign({},Hammer.defaults,options||{});this.options.inputTarget=this.options.inputTarget||element;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=element;this.input=createInputInstance(this);this.touchAction=new TouchAction(this,this.options.touchAction);toggleCssProps(this,true);each(this.options.recognizers,function(item){var recognizer=this.add(new item[0](item[1]));item[2]&&recognizer.recognizeWith(item[2]);item[3]&&recognizer.requireFailure(item[3])},this)}Manager.prototype={set:function(options){assign(this.options,options);if(options.touchAction){this.touchAction.update()}if(options.inputTarget){this.input.destroy();this.input.target=options.inputTarget;this.input.init()}return this},stop:function(force){this.session.stopped=force?FORCED_STOP:STOP},recognize:function(inputData){var session=this.session;if(session.stopped){return}this.touchAction.preventDefaults(inputData);var recognizer;var recognizers=this.recognizers;var curRecognizer=session.curRecognizer;if(!curRecognizer||curRecognizer&&curRecognizer.state&STATE_RECOGNIZED){curRecognizer=session.curRecognizer=null}var i=0;while(i<recognizers.length){recognizer=recognizers[i];if(session.stopped!==FORCED_STOP&&(!curRecognizer||recognizer==curRecognizer||recognizer.canRecognizeWith(curRecognizer))){recognizer.recognize(inputData)}else{recognizer.reset()}if(!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED)){curRecognizer=session.curRecognizer=recognizer}i++}},get:function(recognizer){if(recognizer instanceof Recognizer){return recognizer}var recognizers=this.recognizers;for(var i=0;i<recognizers.length;i++){if(recognizers[i].options.event==recognizer){return recognizers[i]}}return null},add:function(recognizer){if(invokeArrayArg(recognizer,"add",this)){return this}var existing=this.get(recognizer.options.event);if(existing){this.remove(existing)}this.recognizers.push(recognizer);recognizer.manager=this;this.touchAction.update();return recognizer},remove:function(recognizer){if(invokeArrayArg(recognizer,"remove",this)){return this}recognizer=this.get(recognizer);if(recognizer){var recognizers=this.recognizers;var index=inArray(recognizers,recognizer);if(index!==-1){recognizers.splice(index,1);this.touchAction.update()}}return this},on:function(events,handler){if(events===undefined){return}if(handler===undefined){return}var handlers=this.handlers;each(splitStr(events),function(event){handlers[event]=handlers[event]||[];handlers[event].push(handler)});return this},off:function(events,handler){if(events===undefined){return}var handlers=this.handlers;each(splitStr(events),function(event){if(!handler){delete handlers[event]}else{handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1)}});return this},emit:function(event,data){if(this.options.domEvents){triggerDomEvent(event,data)}var handlers=this.handlers[event]&&this.handlers[event].slice();if(!handlers||!handlers.length){return}data.type=event;data.preventDefault=function(){data.srcEvent.preventDefault()};var i=0;while(i<handlers.length){handlers[i](data);i++}},destroy:function(){this.element&&toggleCssProps(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null}};function toggleCssProps(manager,add){var element=manager.element;if(!element.style){return}var prop;each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name);if(add){manager.oldCssProps[prop]=element.style[prop];element.style[prop]=value}else{element.style[prop]=manager.oldCssProps[prop]||""}});if(!add){manager.oldCssProps={}}}function triggerDomEvent(event,data){var gestureEvent=document.createEvent("Event");gestureEvent.initEvent(event,true,true);gestureEvent.gesture=data;data.target.dispatchEvent(gestureEvent)}assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:STATE_FAILED,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed});var freeGlobal=typeof window!=="undefined"?window:typeof self!=="undefined"?self:{};freeGlobal.Hammer=Hammer;if(typeof define==="function"&&define.amd){define(function(){return Hammer})}else if(typeof module!="undefined"&&module.exports){module.exports=Hammer}else{window[exportName]=Hammer}})(window,document,"Hammer")},{}],207:[function(require,module,exports){var WildEmitter=require("wildemitter");function getMaxVolume(analyser,fftBins){var maxVolume=-Infinity;analyser.getFloatFrequencyData(fftBins);for(var i=4,ii=fftBins.length;i<ii;i++){if(fftBins[i]>maxVolume&&fftBins[i]<0){maxVolume=fftBins[i]}}return maxVolume}var audioContextType;if(typeof window!=="undefined"){audioContextType=window.AudioContext||window.webkitAudioContext}var audioContext=null;module.exports=function(stream,options){var harker=new WildEmitter;if(!audioContextType)return harker;var options=options||{},smoothing=options.smoothing||.1,interval=options.interval||50,threshold=options.threshold,play=options.play,history=options.history||10,running=true;if(!audioContext){audioContext=new audioContextType}var sourceNode,fftBins,analyser;analyser=audioContext.createAnalyser();analyser.fftSize=512;analyser.smoothingTimeConstant=smoothing;fftBins=new Float32Array(analyser.frequencyBinCount);if(stream.jquery)stream=stream[0];if(stream instanceof HTMLAudioElement||stream instanceof HTMLVideoElement){sourceNode=audioContext.createMediaElementSource(stream);if(typeof play==="undefined")play=true;threshold=threshold||-50}else{sourceNode=audioContext.createMediaStreamSource(stream);threshold=threshold||-50}sourceNode.connect(analyser);if(play)analyser.connect(audioContext.destination);harker.speaking=false;harker.setThreshold=function(t){threshold=t};harker.setInterval=function(i){interval=i};harker.stop=function(){running=false;harker.emit("volume_change",-100,threshold);if(harker.speaking){harker.speaking=false;harker.emit("stopped_speaking")}analyser.disconnect();sourceNode.disconnect()};harker.speakingHistory=[];for(var i=0;i<history;i++){harker.speakingHistory.push(0)}var looper=function(){setTimeout(function(){if(!running){return}var currentVolume=getMaxVolume(analyser,fftBins);harker.emit("volume_change",currentVolume,threshold);var history=0;if(currentVolume>threshold&&!harker.speaking){for(var i=harker.speakingHistory.length-3;i<harker.speakingHistory.length;i++){history+=harker.speakingHistory[i]}if(history>=2){harker.speaking=true;harker.emit("speaking")}}else if(currentVolume<threshold&&harker.speaking){for(var i=0;i<harker.speakingHistory.length;i++){history+=harker.speakingHistory[i]}if(history==0){harker.speaking=false;harker.emit("stopped_speaking")}}harker.speakingHistory.shift();harker.speakingHistory.push(0+(currentVolume>threshold));looper()},interval)};looper();return harker}},{wildemitter:573}],208:[function(require,module,exports){(function(global){var isArray=require("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:209}],209:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],210:[function(require,module,exports){(function(global){var isArray=require("isarray");var toString=Object.prototype.toString;var withNativeBlob=typeof global.Blob==="function"||toString.call(global.Blob)==="[object BlobConstructor]";var withNativeFile=typeof global.File==="function"||toString.call(global.File)==="[object FileConstructor]";module.exports=hasBinary;function hasBinary(obj){if(!obj||typeof obj!=="object"){return false}if(isArray(obj)){for(var i=0,l=obj.length;i<l;i++){if(hasBinary(obj[i])){return true}}return false}if(typeof global.Buffer==="function"&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||typeof global.ArrayBuffer==="function"&&obj instanceof ArrayBuffer||withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File){return true}if(obj.toJSON&&typeof obj.toJSON==="function"&&arguments.length===1){return hasBinary(obj.toJSON(),true)}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&hasBinary(obj[key])){return true}}return false}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:211}],211:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],212:[function(require,module,exports){try{module.exports=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(err){module.exports=false}},{}],213:[function(require,module,exports){module.exports=attributeToProperty;var transform={class:"className",for:"htmlFor","http-equiv":"httpEquiv"};function attributeToProperty(h){return function(tagName,attrs,children){for(var attr in attrs){if(attr in transform){attrs[transform[attr]]=attrs[attr];delete attrs[attr]}}return h(tagName,attrs,children)}}},{}],214:[function(require,module,exports){var attrToProp=require("hyperscript-attribute-to-property");var VAR=0,TEXT=1,OPEN=2,CLOSE=3,ATTR=4;var ATTR_KEY=5,ATTR_KEY_W=6;var ATTR_VALUE_W=7,ATTR_VALUE=8;var ATTR_VALUE_SQ=9,ATTR_VALUE_DQ=10;var ATTR_EQ=11,ATTR_BREAK=12;var COMMENT=13;module.exports=function(h,opts){if(!opts)opts={};var concat=opts.concat||function(a,b){return String(a)+String(b)};if(opts.attrToProp!==false){h=attrToProp(h)}return function(strings){var state=TEXT,reg="";var arglen=arguments.length;var parts=[];for(var i=0;i<strings.length;i++){if(i<arglen-1){var arg=arguments[i+1];var p=parse(strings[i]);var xstate=state;if(xstate===ATTR_VALUE_DQ)xstate=ATTR_VALUE;if(xstate===ATTR_VALUE_SQ)xstate=ATTR_VALUE;if(xstate===ATTR_VALUE_W)xstate=ATTR_VALUE;if(xstate===ATTR)xstate=ATTR_KEY;p.push([VAR,xstate,arg]);parts.push.apply(parts,p)}else parts.push.apply(parts,parse(strings[i]))}var tree=[null,{},[]];var stack=[[tree,-1]];for(var i=0;i<parts.length;i++){var cur=stack[stack.length-1][0];var p=parts[i],s=p[0];if(s===OPEN&&/^\//.test(p[1])){var ix=stack[stack.length-1][1];if(stack.length>1){stack.pop();stack[stack.length-1][0][2][ix]=h(cur[0],cur[1],cur[2].length?cur[2]:undefined)}}else if(s===OPEN){var c=[p[1],{},[]];cur[2].push(c);stack.push([c,cur[2].length-1])}else if(s===ATTR_KEY||s===VAR&&p[1]===ATTR_KEY){var key="";var copyKey;for(;i<parts.length;i++){if(parts[i][0]===ATTR_KEY){key=concat(key,parts[i][1])}else if(parts[i][0]===VAR&&parts[i][1]===ATTR_KEY){if(typeof parts[i][2]==="object"&&!key){for(copyKey in parts[i][2]){if(parts[i][2].hasOwnProperty(copyKey)&&!cur[1][copyKey]){cur[1][copyKey]=parts[i][2][copyKey]}}}else{key=concat(key,parts[i][2])}}else break}if(parts[i][0]===ATTR_EQ)i++;var j=i;for(;i<parts.length;i++){if(parts[i][0]===ATTR_VALUE||parts[i][0]===ATTR_KEY){if(!cur[1][key])cur[1][key]=strfn(parts[i][1]);else cur[1][key]=concat(cur[1][key],parts[i][1])}else if(parts[i][0]===VAR&&(parts[i][1]===ATTR_VALUE||parts[i][1]===ATTR_KEY)){if(!cur[1][key])cur[1][key]=strfn(parts[i][2]);else cur[1][key]=concat(cur[1][key],parts[i][2])}else{if(key.length&&!cur[1][key]&&i===j&&(parts[i][0]===CLOSE||parts[i][0]===ATTR_BREAK)){cur[1][key]=key.toLowerCase()}if(parts[i][0]===CLOSE){i--}break}}}else if(s===ATTR_KEY){cur[1][p[1]]=true}else if(s===VAR&&p[1]===ATTR_KEY){cur[1][p[2]]=true}else if(s===CLOSE){if(selfClosing(cur[0])&&stack.length){var ix=stack[stack.length-1][1];stack.pop();stack[stack.length-1][0][2][ix]=h(cur[0],cur[1],cur[2].length?cur[2]:undefined)}}else if(s===VAR&&p[1]===TEXT){if(p[2]===undefined||p[2]===null)p[2]="";else if(!p[2])p[2]=concat("",p[2]);if(Array.isArray(p[2][0])){cur[2].push.apply(cur[2],p[2])}else{cur[2].push(p[2])}}else if(s===TEXT){cur[2].push(p[1])}else if(s===ATTR_EQ||s===ATTR_BREAK){}else{throw new Error("unhandled: "+s)}}if(tree[2].length>1&&/^\s*$/.test(tree[2][0])){tree[2].shift()}if(tree[2].length>2||tree[2].length===2&&/\S/.test(tree[2][1])){throw new Error("multiple root elements must be wrapped in an enclosing tag")}if(Array.isArray(tree[2][0])&&typeof tree[2][0][0]==="string"&&Array.isArray(tree[2][0][2])){tree[2][0]=h(tree[2][0][0],tree[2][0][1],tree[2][0][2])}return tree[2][0];function parse(str){var res=[];if(state===ATTR_VALUE_W)state=ATTR;for(var i=0;i<str.length;i++){var c=str.charAt(i);if(state===TEXT&&c==="<"){if(reg.length)res.push([TEXT,reg]);reg="";state=OPEN}else if(c===">"&&!quot(state)&&state!==COMMENT){if(state===OPEN){res.push([OPEN,reg])}else if(state===ATTR_KEY){res.push([ATTR_KEY,reg])}else if(state===ATTR_VALUE&&reg.length){res.push([ATTR_VALUE,reg])}res.push([CLOSE]);reg="";state=TEXT}else if(state===COMMENT&&/-$/.test(reg)&&c==="-"){if(opts.comments){res.push([ATTR_VALUE,reg.substr(0,reg.length-1)],[CLOSE])}reg="";state=TEXT}else if(state===OPEN&&/^!--$/.test(reg)){if(opts.comments){res.push([OPEN,reg],[ATTR_KEY,"comment"],[ATTR_EQ])}reg=c;state=COMMENT}else if(state===TEXT||state===COMMENT){reg+=c}else if(state===OPEN&&/\s/.test(c)){res.push([OPEN,reg]);reg="";state=ATTR}else if(state===OPEN){reg+=c}else if(state===ATTR&&/[^\s"'=/]/.test(c)){state=ATTR_KEY;reg=c}else if(state===ATTR&&/\s/.test(c)){if(reg.length)res.push([ATTR_KEY,reg]);res.push([ATTR_BREAK])}else if(state===ATTR_KEY&&/\s/.test(c)){res.push([ATTR_KEY,reg]);reg="";state=ATTR_KEY_W}else if(state===ATTR_KEY&&c==="="){res.push([ATTR_KEY,reg],[ATTR_EQ]);reg="";state=ATTR_VALUE_W}else if(state===ATTR_KEY){reg+=c}else if((state===ATTR_KEY_W||state===ATTR)&&c==="="){res.push([ATTR_EQ]);state=ATTR_VALUE_W}else if((state===ATTR_KEY_W||state===ATTR)&&!/\s/.test(c)){res.push([ATTR_BREAK]);if(/[\w-]/.test(c)){reg+=c;state=ATTR_KEY}else state=ATTR}else if(state===ATTR_VALUE_W&&c==='"'){state=ATTR_VALUE_DQ}else if(state===ATTR_VALUE_W&&c==="'"){state=ATTR_VALUE_SQ}else if(state===ATTR_VALUE_DQ&&c==='"'){res.push([ATTR_VALUE,reg],[ATTR_BREAK]);reg="";state=ATTR}else if(state===ATTR_VALUE_SQ&&c==="'"){res.push([ATTR_VALUE,reg],[ATTR_BREAK]);reg="";state=ATTR}else if(state===ATTR_VALUE_W&&!/\s/.test(c)){state=ATTR_VALUE;i--}else if(state===ATTR_VALUE&&/\s/.test(c)){res.push([ATTR_VALUE,reg],[ATTR_BREAK]);reg="";state=ATTR}else if(state===ATTR_VALUE||state===ATTR_VALUE_SQ||state===ATTR_VALUE_DQ){reg+=c}}if(state===TEXT&&reg.length){res.push([TEXT,reg]);reg=""}else if(state===ATTR_VALUE&&reg.length){res.push([ATTR_VALUE,reg]);reg=""}else if(state===ATTR_VALUE_DQ&&reg.length){res.push([ATTR_VALUE,reg]);reg=""}else if(state===ATTR_VALUE_SQ&&reg.length){res.push([ATTR_VALUE,reg]);reg=""}else if(state===ATTR_KEY){res.push([ATTR_KEY,reg]);reg=""}return res}};function strfn(x){if(typeof x==="function")return x;else if(typeof x==="string")return x;else if(x&&typeof x==="object")return x;else return concat("",x)}};function quot(state){return state===ATTR_VALUE_SQ||state===ATTR_VALUE_DQ}var hasOwn=Object.prototype.hasOwnProperty;function has(obj,key){return hasOwn.call(obj,key)}var closeRE=RegExp("^("+["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","!--","animate","animateTransform","circle","cursor","desc","ellipse","feBlend","feColorMatrix","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","font-face-format","font-face-name","font-face-uri","glyph","glyphRef","hkern","image","line","missing-glyph","mpath","path","polygon","polyline","rect","set","stop","tref","use","view","vkern"].join("|")+")(?:[.#][a-zA-Z0-9-￿_:-]+)*$");function selfClosing(tag){return closeRE.test(tag)}},{"hyperscript-attribute-to-property":213}],215:[function(require,module,exports){var normalize=require("vectors/normalize-nd");module.exports=icosphere;function icosphere(subdivisions){subdivisions=+subdivisions|0;var positions=[];var faces=[];var t=.5+Math.sqrt(5)/2;positions.push([-1,+t,0]);positions.push([+1,+t,0]);positions.push([-1,-t,0]);positions.push([+1,-t,0]);positions.push([0,-1,+t]);positions.push([0,+1,+t]);positions.push([0,-1,-t]);positions.push([0,+1,-t]);positions.push([+t,0,-1]);positions.push([+t,0,+1]);positions.push([-t,0,-1]);positions.push([-t,0,+1]);faces.push([0,11,5]);faces.push([0,5,1]);faces.push([0,1,7]);faces.push([0,7,10]);faces.push([0,10,11]);faces.push([1,5,9]);faces.push([5,11,4]);faces.push([11,10,2]);faces.push([10,7,6]);faces.push([7,1,8]);faces.push([3,9,4]);faces.push([3,4,2]);faces.push([3,2,6]);faces.push([3,6,8]);faces.push([3,8,9]);faces.push([4,9,5]);faces.push([2,4,11]);faces.push([6,2,10]);faces.push([8,6,7]);faces.push([9,8,1]);var complex={cells:faces,positions:positions};while(subdivisions-- >0){complex=subdivide(complex)}positions=complex.positions;for(var i=0;i<positions.length;i++){normalize(positions[i])}return complex}function subdivide(complex){var positions=complex.positions;var cells=complex.cells;var newCells=[];var newPositions=[];var midpoints={};var f=[0,1,2];var l=0;for(var i=0;i<cells.length;i++){var cell=cells[i];var c0=cell[0];var c1=cell[1];var c2=cell[2];var v0=positions[c0];var v1=positions[c1];var v2=positions[c2];var a=getMidpoint(v0,v1);var b=getMidpoint(v1,v2);var c=getMidpoint(v2,v0);var ai=newPositions.indexOf(a);if(ai===-1)ai=l++,newPositions.push(a);var bi=newPositions.indexOf(b);if(bi===-1)bi=l++,newPositions.push(b);var ci=newPositions.indexOf(c);if(ci===-1)ci=l++,newPositions.push(c);var v0i=newPositions.indexOf(v0);if(v0i===-1)v0i=l++,newPositions.push(v0);var v1i=newPositions.indexOf(v1);if(v1i===-1)v1i=l++,newPositions.push(v1);var v2i=newPositions.indexOf(v2);if(v2i===-1)v2i=l++,newPositions.push(v2);newCells.push([v0i,ai,ci]);newCells.push([v1i,bi,ai]);newCells.push([v2i,ci,bi]);newCells.push([ai,bi,ci])}return{cells:newCells,positions:newPositions};function getMidpoint(a,b){var point=midpoint(a,b);var pointKey=pointToKey(point);var cachedPoint=midpoints[pointKey];if(cachedPoint){return cachedPoint}else{return midpoints[pointKey]=point}}function pointToKey(point){return point[0].toPrecision(6)+","+point[1].toPrecision(6)+","+point[2].toPrecision(6)}function midpoint(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2,(a[2]+b[2])/2]}}},{"vectors/normalize-nd":556}],216:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],217:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],218:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],219:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function fit(contains){return function(parentWidth,parentHeight,childWidth,childHeight){var doRatio=childWidth/childHeight;var cRatio=parentWidth/parentHeight;var width;var height;if(contains?doRatio>cRatio:doRatio<cRatio){width=parentWidth;height=width/doRatio}else{height=parentHeight;width=height*doRatio}return{width:width,height:height,x:(parentWidth-width)/2,y:(parentHeight-height)/2}}}var contain=fit(true);var cover=fit(false);exports.contain=contain;exports.cover=cover},{}],220:[function(require,module,exports){(function(global){var apple_phone=/iPhone/i,apple_ipod=/iPod/i,apple_tablet=/iPad/i,android_phone=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,android_tablet=/Android/i,amazon_phone=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,amazon_tablet=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,windows_phone=/Windows Phone/i,windows_tablet=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,other_blackberry=/BlackBerry/i,other_blackberry_10=/BB10/i,other_opera=/Opera Mini/i,other_chrome=/(CriOS|Chrome)(?=.*\bMobile\b)/i,other_firefox=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,seven_inch=new RegExp("(?:"+"Nexus 7"+"|"+"BNTV250"+"|"+"Kindle Fire"+"|"+"Silk"+"|"+"GT-P1000"+")","i");var match=function(regex,userAgent){return regex.test(userAgent)};var IsMobileClass=function(userAgent){var ua=userAgent||navigator.userAgent;var tmp=ua.split("[FBAN");if(typeof tmp[1]!=="undefined"){ua=tmp[0]}tmp=ua.split("Twitter");if(typeof tmp[1]!=="undefined"){ua=tmp[0]}this.apple={phone:match(apple_phone,ua),ipod:match(apple_ipod,ua),tablet:!match(apple_phone,ua)&&match(apple_tablet,ua),device:match(apple_phone,ua)||match(apple_ipod,ua)||match(apple_tablet,ua)};this.amazon={phone:match(amazon_phone,ua),tablet:!match(amazon_phone,ua)&&match(amazon_tablet,ua),device:match(amazon_phone,ua)||match(amazon_tablet,ua)};this.android={phone:match(amazon_phone,ua)||match(android_phone,ua),tablet:!match(amazon_phone,ua)&&!match(android_phone,ua)&&(match(amazon_tablet,ua)||match(android_tablet,ua)),device:match(amazon_phone,ua)||match(amazon_tablet,ua)||match(android_phone,ua)||match(android_tablet,ua)};this.windows={phone:match(windows_phone,ua),tablet:match(windows_tablet,ua),device:match(windows_phone,ua)||match(windows_tablet,ua)};this.other={blackberry:match(other_blackberry,ua),blackberry10:match(other_blackberry_10,ua),opera:match(other_opera,ua),firefox:match(other_firefox,ua),chrome:match(other_chrome,ua),device:match(other_blackberry,ua)||match(other_blackberry_10,ua)||match(other_opera,ua)||match(other_firefox,ua)||match(other_chrome,ua)};this.seven_inch=match(seven_inch,ua);this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch;this.phone=this.apple.phone||this.android.phone||this.windows.phone;this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet;if(typeof window==="undefined"){return this}};var instantiate=function(){var IM=new IsMobileClass;IM.Class=IsMobileClass;return IM};if(typeof module!=="undefined"&&module.exports&&typeof window==="undefined"){module.exports=IsMobileClass}else if(typeof module!=="undefined"&&module.exports&&typeof window!=="undefined"){module.exports=instantiate()}else if(typeof define==="function"&&define.amd){define("isMobile",[],global.isMobile=instantiate())}else{global.isMobile=instantiate()}})(this)},{}],221:[function(require,module,exports){(function(window){var getClass={}.toString,isProperty,forEach,undef;var isLoader=typeof define==="function"&&define.amd;var nativeJSON=typeof JSON=="object"&&JSON;var JSON3=typeof exports=="object"&&exports&&!exports.nodeType&&exports;if(JSON3&&nativeJSON){JSON3.stringify=nativeJSON.stringify;JSON3.parse=nativeJSON.parse}else{JSON3=window.JSON=nativeJSON||{}}var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a"}else if(name=="json"){isSupported=has("json-stringify")&&has("json-parse")}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=JSON3.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number)==="0"&&stringify(new String)=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\0\b\n\f\r\t"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name=="json-parse"){var parse=JSON3.parse;if(typeof parse=="function"){try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value["a"].length==5&&value["a"][0]===1;if(parseSupported){try{parseSupported=!parse('"\t"')}catch(exception){}if(parseSupported){try{parseSupported=parse("01")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse("1.")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has("json")){var functionClass="[object Function]";var dateClass="[object Date]";var numberClass="[object Number]";var stringClass="[object String]";var arrayClass="[object Array]";var booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty={}.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}var PrimitiveTypes={boolean:1,number:1,string:1,undefined:1};var isHostType=function(object,property){var type=typeof object[property];return type=="object"?!!object[property]:!PrimitiveTypes[type]};forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&isHostType(object,"hasOwnProperty")?object.hasOwnProperty:isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property)}}if(isConstructor||isProperty.call(object,property="constructor")){callback(property)}}}return forEach(object,callback)};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy,symbols;if(isLarge){symbols=value.split("")}for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index]}}return result+'"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else{value=null}}else if(typeof value.toJSON=="function"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return"null"}className=getClass.call(value);if(className==booleanClass){return""+value}else if(className==numberClass){return value>-1/0&&value<1/0?""+value:"null"}else if(className==stringClass){return quote(""+value)}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element)}result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+":"+(whitespace?" ":"")+element)}});result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}"}stack.pop();return result}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(typeof filter=="function"||typeof filter=="object"&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)=="true"){Index+=4;return true}else if(source.slice(Index,Index+5)=="false"){Index+=5;return false}else if(source.slice(Index,Index+4)=="null"){Index+=4;return null}abort()}}return"$"};var get=function(value){var results,hasMembers;if(value=="$"){abort()}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1)}if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]"){break}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort()}}else{abort()}}if(value==","){abort()}results.push(get(value))}return results}else if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}"){break}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort()}}else{abort()}}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort()}results[value.slice(1)]=get(lex())}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};JSON3.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}if(isLoader){define(function(){return JSON3})}})(this)},{}],222:[function(require,module,exports){var util=require("util");var hark=require("hark");var getScreenMedia=require("getscreenmedia");var WildEmitter=require("wildemitter");var mockconsole=require("mockconsole");function isAllTracksEnded(stream){var isAllTracksEnded=true;stream.getTracks().forEach(function(t){isAllTracksEnded=t.readyState==="ended"&&isAllTracksEnded});return isAllTracksEnded}function shouldWorkAroundFirefoxStopStream(){if(typeof window==="undefined"){return false}if(!window.navigator.mozGetUserMedia){return false}var match=window.navigator.userAgent.match(/Firefox\/(\d+)\./);var version=match&&match.length>=1&&parseInt(match[1],10);return version<50}function LocalMedia(opts){WildEmitter.call(this);var config=this.config={detectSpeakingEvents:false,audioFallback:false,media:{audio:true,video:true},harkOptions:null,logger:mockconsole};var item;for(item in opts){if(opts.hasOwnProperty(item)){this.config[item]=opts[item]}}this.logger=config.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this._logerror("Your browser does not support local media capture.")}this._audioMonitors=[];this.on("localStreamStopped",this._stopAudioMonitor.bind(this));this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}util.inherits(LocalMedia,WildEmitter);LocalMedia.prototype.start=function(mediaConstraints,cb){var self=this;var constraints=mediaConstraints||this.config.media;this.emit("localStreamRequested",constraints);navigator.mediaDevices.getUserMedia(constraints).then(function(stream){if(constraints.audio&&self.config.detectSpeakingEvents){self._setupAudioMonitor(stream,self.config.harkOptions)}self.localStreams.push(stream);stream.getTracks().forEach(function(track){track.addEventListener("ended",function(){if(isAllTracksEnded(stream)){self._removeStream(stream)}})});self.emit("localStream",stream);if(cb){return cb(null,stream)}}).catch(function(err){if(self.config.audioFallback&&err.name==="DevicesNotFoundError"&&constraints.video!==false){constraints.video=false;self.start(constraints,cb);return}self.emit("localStreamRequestFailed",constraints);if(cb){return cb(err,null)}})};LocalMedia.prototype.stop=function(stream){this.stopStream(stream);this.stopScreenShare(stream)};LocalMedia.prototype.stopStream=function(stream){var self=this;if(stream){var idx=this.localStreams.indexOf(stream);if(idx>-1){stream.getTracks().forEach(function(track){track.stop()});if(shouldWorkAroundFirefoxStopStream()){this._removeStream(stream)}}}else{this.localStreams.forEach(function(stream){stream.getTracks().forEach(function(track){track.stop()});if(shouldWorkAroundFirefoxStopStream()){self._removeStream(stream)}})}};LocalMedia.prototype.startScreenShare=function(constraints,cb){var self=this;this.emit("localScreenRequested");if(typeof constraints==="function"&&!cb){cb=constraints;constraints=null}getScreenMedia(constraints,function(err,stream){if(!err){self.localScreens.push(stream);stream.getTracks().forEach(function(track){track.addEventListener("ended",function(){var isAllTracksEnded=true;stream.getTracks().forEach(function(t){isAllTracksEnded=t.readyState==="ended"&&isAllTracksEnded});if(isAllTracksEnded){self._removeStream(stream)}})});self.emit("localScreen",stream)}else{self.emit("localScreenRequestFailed")}if(cb){return cb(err,stream)}})};LocalMedia.prototype.stopScreenShare=function(stream){var self=this;if(stream){var idx=this.localScreens.indexOf(stream);if(idx>-1){stream.getTracks().forEach(function(track){track.stop()});if(shouldWorkAroundFirefoxStopStream()){this._removeStream(stream)}}}else{this.localScreens.forEach(function(stream){stream.getTracks().forEach(function(track){track.stop()});if(shouldWorkAroundFirefoxStopStream()){self._removeStream(stream)}})}};LocalMedia.prototype.mute=function(){this._audioEnabled(false);this.emit("audioOff")};LocalMedia.prototype.unmute=function(){this._audioEnabled(true);this.emit("audioOn")};LocalMedia.prototype.pauseVideo=function(){this._videoEnabled(false);this.emit("videoOff")};LocalMedia.prototype.resumeVideo=function(){this._videoEnabled(true);this.emit("videoOn")};LocalMedia.prototype.pause=function(){this.mute();this.pauseVideo()};LocalMedia.prototype.resume=function(){this.unmute();this.resumeVideo()};LocalMedia.prototype._audioEnabled=function(bool){this.localStreams.forEach(function(stream){stream.getAudioTracks().forEach(function(track){track.enabled=!!bool})})};LocalMedia.prototype._videoEnabled=function(bool){this.localStreams.forEach(function(stream){stream.getVideoTracks().forEach(function(track){track.enabled=!!bool})})};LocalMedia.prototype.isAudioEnabled=function(){var enabled=true;this.localStreams.forEach(function(stream){stream.getAudioTracks().forEach(function(track){enabled=enabled&&track.enabled})});return enabled};LocalMedia.prototype.isVideoEnabled=function(){var enabled=true;this.localStreams.forEach(function(stream){stream.getVideoTracks().forEach(function(track){enabled=enabled&&track.enabled})});return enabled};LocalMedia.prototype._removeStream=function(stream){var idx=this.localStreams.indexOf(stream);if(idx>-1){this.localStreams.splice(idx,1);this.emit("localStreamStopped",stream)}else{idx=this.localScreens.indexOf(stream);if(idx>-1){this.localScreens.splice(idx,1);this.emit("localScreenStopped",stream)}}};LocalMedia.prototype._setupAudioMonitor=function(stream,harkOptions){this._log("Setup audio");var audio=hark(stream,harkOptions);var self=this;var timeout;audio.on("speaking",function(){self.emit("speaking")});audio.on("stopped_speaking",function(){if(timeout){clearTimeout(timeout)}timeout=setTimeout(function(){self.emit("stoppedSpeaking")},1e3)});audio.on("volume_change",function(volume,threshold){self.emit("volumeChange",volume,threshold)});this._audioMonitors.push({audio:audio,stream:stream})};LocalMedia.prototype._stopAudioMonitor=function(stream){var idx=-1;this._audioMonitors.forEach(function(monitors,i){if(monitors.stream===stream){idx=i}});if(idx>-1){this._audioMonitors[idx].audio.stop();this._audioMonitors.splice(idx,1)}};module.exports=LocalMedia},{getscreenmedia:179,hark:207,mockconsole:226,util:550,wildemitter:573}],223:[function(require,module,exports){(function(global){var LARGE_ARRAY_SIZE=200;var HASH_UNDEFINED="__lodash_hash_undefined__";var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",promiseTag="[object Promise]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reFlags=/\w*$/;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsUint=/^(?:0|[1-9]\d*)$/;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function addSetEntry(set,value){set.add(value);return set}function arrayEach(array,iteratee){var index=-1,length=array?array.length:0;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?root.Buffer:undefined,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice;var nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeKeys=overArg(Object.keys,Object);var DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create");var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function Stack(entries){this.__data__=new ListCache(entries)}function stackClear(){this.__data__=new ListCache}function stackDelete(key){return this.__data__["delete"](key)}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);return this}cache=this.__data__=new MapCache(pairs)}cache.set(key,value);return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var result=isArray(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isIndex(key,length)))){result.push(key)}}return result}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){if(isHostObject(value)){return object?value:{}}result=initCloneObject(isFunc?{}:value);if(!isDeep){return copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(!isArr){var props=isFull?getAllKeys(value):keys(value)}arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))});return result}function baseCreate(proto){return isObject(proto)?objectCreate(proto):{}}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return objectToString.call(value)}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var result=new buffer.constructor(buffer.length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),true):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),true):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue)}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):stubArray;var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):undefined;if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object)}}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function cloneDeep(value){return baseClone(value,true,true)}function eq(value,other){return value===other||value!==value&&other!==other}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var isBuffer=nativeIsBuffer||stubFalse;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function stubArray(){return[]}function stubFalse(){return false}module.exports=cloneDeep}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],224:[function(require,module,exports){(function(global){(function(){var undefined;var VERSION="4.17.4";var LARGE_ARRAY_SIZE=200;var CORE_ERROR_TEXT="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var MAX_MEMOIZE_SIZE=500;var PLACEHOLDER="__lodash_placeholder__";var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4;var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;var WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=800,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var wrapFlags=[["ary",WRAP_ARY_FLAG],["bind",WRAP_BIND_FLAG],["bindKey",WRAP_BIND_KEY_FLAG],["curry",WRAP_CURRY_FLAG],["curryRight",WRAP_CURRY_RIGHT_FLAG],["flip",WRAP_FLIP_FLAG],["partial",WRAP_PARTIAL_FLAG],["partialRight",WRAP_PARTIAL_RIGHT_FLAG],["rearg",WRAP_REARG_FLAG]];var argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",domExcTag="[object DOMException]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",promiseTag="[object Promise]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/;var reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /;var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;var rsApos="['’]",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d";var rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",rsOrdUpper="\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reApos=RegExp(rsApos,"g");var reComboMark=RegExp(rsCombo,"g");var reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");var reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");var reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeParseFloat=parseFloat,freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function addSetEntry(set,value){set.add(value);return set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array==null?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array==null?0:array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true}}return false}function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array==null?0:array.length;if(initAccum&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}var asciiSize=baseProperty("length");function asciiToArray(string){return string.split("")}function asciiWords(string){return string.match(reAsciiWord)||[]}function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false}});return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=array==null?0:array.length;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyOf(object){return function(key){return object==null?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current}}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){++result}}return result}var deburrLetter=basePropertyOf(deburredLetters);var escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return object==null?undefined:object[key]}function hasUnicode(string){return reHasUnicode.test(string)}function hasUnicodeWord(string){return reHasUnicodeWord.test(string)}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value)}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index}}return result}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value]});return result}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function strictLastIndexOf(array,value,fromIndex){var index=fromIndex+1;while(index--){if(array[index]===value){return index}}return index}function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string)){++result}return result}function unicodeToArray(string){return string.match(reUnicode)||[]}function unicodeWords(string){return string.match(reUnicodeWord)||[]}var runInContext=function runInContext(context){context=context==null?root:_.defaults(root.Object(),context,_.pick(root,contextProps));var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=context["__core-js_shared__"];var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var nativeObjectToString=objectProto.toString;var objectCtorString=funcToString.call(Object);var oldDash=root._;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined;var defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();var ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout;var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse;var DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create");var metaMap=WeakMap&&new WeakMap;var realNames={};var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{}}if(objectCreate){return objectCreate(proto)}object.prototype=proto;var result=new object;object.prototype=undefined;return result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[];this.size=0}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}--this.size;return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);this.size-=result?1:0;return result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function stackClear(){this.__data__=new ListCache;this.size=0}function stackDelete(key){var data=this.__data__,result=data["delete"](key);this.size=data.size;return result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}function baseAssignValue(object,key,value){if(key=="__proto__"&&defineProperty){defineProperty(object,key,{configurable:true,enumerable:true,value:value,writable:true})}else{object[key]=value}}function baseAt(object,paths){var index=-1,length=paths.length,result=Array(length),skip=object==null;while(++index<length){result[index]=skip?undefined:get(object,paths[index])}return result}function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper}if(lower!==undefined){number=number>=lower?number:lower}}return number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))});return result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length}object=Object(object);while(length--){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value)){return false}}return true}function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length}end=start>end?0:toLength(end);while(start<end){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return object!=null&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return object!=null&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee))}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer}}if(seen){seen.push(computed)}result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)});return accumulator}function baseInvoke(object,path,args){path=castPath(path,object);object=parent(object,path);var func=object==null?object:object[toKey(last(path))];return func==null?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag}function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack)}function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false}objIsArr=true;objIsObj=false}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result)){return false}}}return true}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}baseFor(source,function(srcValue,key){if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}},keysIn)}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true)}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true)}else{newValue=[]}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){newValue=initCloneObject(srcValue)}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(!length){return}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value)}}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else{baseUnset(array,index)}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);if(n){string+=string}}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,"toString",{configurable:true,enumerable:false,value:constant(string),writable:true})};function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array==null?low:array.length;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1}else{high=mid}}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array==null?0:array.length,valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined)}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull)}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol)}else if(othIsNull||othIsSymbol){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value}}return result}function baseToNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}return+value}function baseToString(value){if(typeof value=="string"){return value}if(isArray(value)){return arrayMap(value,baseToString)+""}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}function baseUnset(object,path){path=castPath(path,object);object=parent(object,path);return object==null||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2){return length?baseUniq(arrays[0]):[]}var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length){if(othIndex!=index){result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator)}}}return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return typeof value=="function"?value:identity}function castPath(value,object){if(isArray(value)){return value}return isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),CLONE_DEEP_FLAG):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),CLONE_DEEP_FLAG):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex]}}while(rangeLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key]}if(isNew){baseAssignValue(object,key,newValue)}else{assignValue(object,key,newValue)}}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length)}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse()}while(index--){var func=funcs[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(prereq&&!wrapper&&getFuncName(func)=="wrapper"){var wrapper=new LodashWrapper([],true)}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index]}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder)}if(partials){args=composeArgs(args,partials,holders,isCurried)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried)}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos)}else if(isFlip&&length>1){args.reverse()}if(isAry&&ary<length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn)}return fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue}if(value!==undefined){result=value}if(other!==undefined){if(result===undefined){return other}if(typeof value=="string"||typeof other=="string"){value=baseToString(value);other=baseToString(other)}else{value=baseToNumber(value);other=baseToNumber(other)}result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest(function(iteratees){iteratees=arrayMap(iteratees,baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){if(!(typeof value=="string"&&typeof other=="string")){value=toNumber(value);other=toNumber(other)}return operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG);if(!(bitmask&WRAP_CURRY_BOUND_FLAG)){bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=precision==null?0:nativeMin(toInteger(precision),292);if(precision){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));pair=(toString(value)+"e").split("e");return+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object)}if(tag==setTag){return setToPairs(object)}return baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data)}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)){bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)}if(!bitmask||bitmask==WRAP_BIND_FLAG){var result=createBind(func,bitmask,thisArg)}else if(bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity)}else if((bitmask==WRAP_PARTIAL_FLAG||bitmask==(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials)}else{result=createHybrid.apply(undefined,newData)}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue}return objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){stack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack);stack["delete"](srcValue)}return objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=COMPARE_UNORDERED_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false}}var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag}else{delete value[symToStringTag]}}return result}var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[]}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)})};var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object)}}function insertWrapDetails(source,details){var length=details.length;if(!length){return source}var lastIndex=length-1;details[lastIndex]=(length>1?"& ":"")+details[lastIndex];details=details.join(length>2?", ":" ");return source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!="function"||!(funcName in LazyWrapper.prototype)){return false}if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function memoizeCapped(func){var result=memoize(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear()}return key});var cache=result.cache;return result}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG);var isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;if(!(isCommon||isCombo)){return data}if(srcBitmask&WRAP_BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]}value=source[7];if(value){data[7]=value}if(srcBitmask&WRAP_ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}function objectToString(value){return nativeObjectToString.call(value)}function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=shortOut(baseSetData);var setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)};var setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0]}}else{count=0}return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;size=size===undefined?length:size;while(++index<size){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index];array[index]=value}array.length=size;return array}var stringToPath=memoizeCapped(function(string){var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value="_."+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value)}});return details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone()}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1}else{size=nativeMax(toInteger(size),0)}var length=array==null?0:array.length;if(!length||size<1){return[]}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value}}return result}function concat(){var length=arguments.length;if(!length){return[]}var args=Array(length-1),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index]}return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[]});var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[]});var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[]});function drop(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length)}function dropRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[]}function fill(array,value,start,end){var length=array==null?0:array.length;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,getIteratee(predicate,3),index,true)}function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=array==null?0:array.length;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=array==null?0:array.length;if(!length){return[]}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth)}function fromPairs(pairs){var index=-1,length=pairs==null?0:pairs.length,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseIndexOf(array,value,index)}function initial(array){var length=array==null?0:array.length;return length?baseSlice(array,0,-1):[]}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]});var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);comparator=typeof comparator=="function"?comparator:undefined;if(comparator){mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return array==null?"":nativeJoin.call(array,separator)}function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=index<0?nativeMax(length+index,0):nativeMin(index,length-1)}return value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,true)}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=flatRest(function(array,indexes){var length=array==null?0:array.length,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function reverse(array){return array==null?array:nativeReverse.call(array)}function slice(array,start,end){var length=array==null?0:array.length;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end)}return baseSlice(array,start,end)}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index}}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,true)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true)}function sortedLastIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index}}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){var length=array==null?0:array.length;return length?baseSlice(array,1,length):[]}function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length)}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2))});var unionWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){comparator=typeof comparator=="function"?comparator:undefined;return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!(array&&array.length)){return[]}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!(array&&array.length)){return[]}var result=unzip(array);if(iteratee==null){return result}return arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))});var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))});var xorWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)});var zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=="function"?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor){interceptor(value);return value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor)}value=value.slice(start,+start+(length?1:0));value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined)}return array})});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value())}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){++result[key]}else{baseAssignValue(result,key,1)}});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex);var findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{baseAssignValue(result,key,[value])}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=="function",result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)});return result});var keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value)});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){if(collection==null){return[]}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseOrderBy(collection,iteratees,orders)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var func=isArray(collection)?arraySample:baseSample;return func(collection)}function sampleSize(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1}else{n=toInteger(n)}var func=isArray(collection)?arraySampleSize:baseSampleSize;return func(collection,n)}function shuffle(collection){var func=isArray(collection)?arrayShuffle:baseShuffle;return func(collection)}function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){return isString(collection)?stringSize(collection):collection.length}var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}return baseKeys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])});var now=ctxNow||function(){return root.Date.now()};function after(n,func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)});var bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)});var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,WRAP_FLIP_FLAG)}function memoize(func,resolver){if(typeof func!="function"||resolver!=null&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=castRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index])}return apply(func,this,args)})});var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders)});var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders)});var rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes)});function rest(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?start:toInteger(start);return baseRest(func,start)}function spread(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start==null?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array)}return apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return partial(castFunction(wrapper),value)}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}function cloneWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_SYMBOLS_FLAG,customizer)}function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}function cloneDeepWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer)}function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt);var gte=createRelationalOperation(function(value,other){return value>=other});var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var isArray=Array.isArray;var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===true||value===false||isObjectLike(value)&&baseGetTag(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse;var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return isObjectLike(value)&&value.nodeType===1&&!isPlainObject(value)}function isEmpty(value){if(value==null){return true}if(isArrayLike(value)&&(isArray(value)||typeof value=="string"||typeof value.splice=="function"||isBuffer(value)||isTypedArray(value)||isArguments(value))){return!value.length}var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}if(isPrototype(value)){return!baseKeys(value).length}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return true}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer=typeof customizer=="function"?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result}function isError(value){if(!isObjectLike(value)){return false}var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||typeof value.message=="string"&&typeof value.name=="string"&&!isPlainObject(value)}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isInteger(value){return typeof value=="number"&&value==toInteger(value)}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return value!=null&&(type=="object"||type=="function")}function isObjectLike(value){return value!=null&&typeof value=="object"}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value)){throw new Error(CORE_ERROR_TEXT)}return baseIsNative(value)}function isNull(value){return value===null}function isNil(value){return value==null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag}var lt=createRelationalOperation(baseLt);var lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value){return[]}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value)}if(symIterator&&value[symIterator]){return iteratorToArray(value[symIterator]())}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):value===0?value:0}function toString(value){return value==null?"":baseToString(value)}var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});var assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)});var at=flatRest(baseAt);function create(prototype,properties){var result=baseCreate(prototype);return properties==null?result:baseAssign(result,properties)}var defaults=baseRest(function(args){args.push(undefined,customDefaultsAssignIn);return apply(assignInWith,undefined,args)});var defaultsDeep=baseRest(function(args){args.push(undefined,customDefaultsMerge);return apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return object==null?[]:baseFunctions(object,keys(object))}function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){result[value]=key},constant(identity));var invertBy=createInverter(function(result,value,key){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}},getIteratee);var invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)});return result}function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))});return result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)});var omit=flatRest(function(object,paths){var result={};if(object==null){return result}var isDeep=false;paths=arrayMap(paths,function(path){path=castPath(path,object);isDeep||(isDeep=path.length>1);return path});copyObject(object,getAllKeysIn(object),result);if(isDeep){result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone)}var length=paths.length;while(length--){baseUnset(result,paths[length])}return result});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=flatRest(function(object,paths){return object==null?{}:basePick(object,paths)});function pickBy(object,predicate){if(object==null){return{}}var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});predicate=getIteratee(predicate);return basePickBy(object,props,function(value,path){return predicate(value,path[0])})}function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;if(!length){length=1;object=undefined}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return object==null?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys);var toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){var Ctor=object&&object.constructor;if(isArrLike){accumulator=isArr?new Ctor:[]}else if(isObject(object)){accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}else{accumulator={}}}(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function unset(object,path){return object==null?true:baseUnset(object,path)}function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return object==null?[]:baseValues(object,keys(object))}function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0}return baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}number=toNumber(number);return baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0}else{upper=toFinite(upper)}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){string=toString(string);return string&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target}function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});var lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){if(guard||radix==null){radix=0}else if(radix){radix=+radix}return nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)}function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1}else{n=toInteger(n)}return baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){if(limit&&typeof limit!="number"&&isIterateeCall(string,separator,limit)){separator=limit=undefined}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[]}string=toString(string);if(string&&(typeof separator=="string"||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(!separator&&hasUnicode(string)){return castSlice(stringToArray(string),0,limit)}}return string.split(separator,limit)}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){string=toString(string);position=position==null?0:baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined}string=toString(string);options=assignInWith({},options,settings,customDefaultsAssignIn);var imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrim,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimEnd,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length;omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength){return string}var end=length-stringSize(omission);if(end<1){return omission}var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined){return result+omission}if(strSymbols){end+=result.length-end}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index}result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()});var upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){return hasUnicodeWord(string)?unicodeWords(string):asciiWords(string)}return string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}});var bindAll=flatRest(function(object,methodNames){arrayEach(methodNames,function(key){key=toKey(key);baseAssignValue(object,key,bind(object[key],object))});return object});function cond(pairs){var length=pairs==null?0:pairs.length,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return[toIteratee(pair[0]),pair[1]]});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args)}}})}function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value}var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value}function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,CLONE_DEEP_FLAG))}function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}});var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source))}var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}});return object}function noConflict(){if(root._===this){root._=oldDash}return this}function noop(){}function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path)}}var range=createRange();var rangeRight=createRange(true);function stubArray(){return[]}function stubFalse(){return false}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return true}function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[]}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index)}return result}function toPath(value){if(isArray(value)){return arrayMap(value,toKey)}return isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0);var ceil=createRound("ceil");var divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1);var floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1);var round=createRound("round");var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func}});return source}(),{chain:false});lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();if(result.__filtered__){result.__takeCount__=nativeMin(n,result.__takeCount__)}else{result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=="function"){return new LazyWrapper(this)}return this.map(function(value){return baseInvoke(value,path,args)})});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+(methodName=="last"?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(result,chainAll)}if(isUnwrapped&&onlyLazy){return func.apply(this,args)}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result}});arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}});realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.first=lodash.prototype.head;if(symIterator){lodash.prototype[symIterator]=wrapperToIterator}return lodash};var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeModule){(freeModule.exports=_)._=_;freeExports._=_}else{root._=_}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],225:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MiniSignalBinding=function(){function MiniSignalBinding(fn,once,thisArg){if(once===undefined)once=false;_classCallCheck(this,MiniSignalBinding);this._fn=fn;this._once=once;this._thisArg=thisArg;this._next=this._prev=this._owner=null}_createClass(MiniSignalBinding,[{key:"detach",value:function detach(){if(this._owner===null)return false;this._owner.detach(this);return true}}]);return MiniSignalBinding}();function _addMiniSignalBinding(self,node){if(!self._head){self._head=node;self._tail=node}else{self._tail._next=node;node._prev=self._tail;self._tail=node}node._owner=self;return node}var MiniSignal=function(){function MiniSignal(){_classCallCheck(this,MiniSignal);this._head=this._tail=undefined}_createClass(MiniSignal,[{key:"handlers",value:function handlers(){var exists=arguments.length<=0||arguments[0]===undefined?false:arguments[0];var node=this._head;if(exists)return!!node;var ee=[];while(node){ee.push(node);node=node._next}return ee}},{key:"has",value:function has(node){if(!(node instanceof MiniSignalBinding)){throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.")}return node._owner===this}},{key:"dispatch",value:function dispatch(){var node=this._head;if(!node)return false;while(node){if(node._once)this.detach(node);node._fn.apply(node._thisArg,arguments);node=node._next}return true}},{key:"add",value:function add(fn){var thisArg=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(typeof fn!=="function"){throw new Error("MiniSignal#add(): First arg must be a Function.")}return _addMiniSignalBinding(this,new MiniSignalBinding(fn,false,thisArg))}},{key:"once",value:function once(fn){var thisArg=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(typeof fn!=="function"){throw new Error("MiniSignal#once(): First arg must be a Function.")}return _addMiniSignalBinding(this,new MiniSignalBinding(fn,true,thisArg))}},{key:"detach",value:function detach(node){if(!(node instanceof MiniSignalBinding)){throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.")}if(node._owner!==this)return this;if(node._prev)node._prev._next=node._next;if(node._next)node._next._prev=node._prev;if(node===this._head){this._head=node._next;if(node._next===null){this._tail=null}}else if(node===this._tail){this._tail=node._prev;this._tail._next=null}node._owner=null;return this}},{key:"detachAll",value:function detachAll(){var node=this._head;if(!node)return this;this._head=this._tail=null;while(node){node._owner=null;node=node._next}return this}}]);return MiniSignal}();MiniSignal.MiniSignalBinding=MiniSignalBinding;exports["default"]=MiniSignal;module.exports=exports["default"]},{}],226:[function(require,module,exports){var methods="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(",");var l=methods.length;var fn=function(){};var mockconsole={};while(l--){mockconsole[methods[l]]=fn}module.exports=mockconsole},{}],227:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0){return parse(val)}else if(type==="number"&&isNaN(val)===false){return options.long?fmtLong(val):fmtShort(val)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse(str){str=String(str);if(str.length>100){return}var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}function fmtShort(ms){if(ms>=d){return Math.round(ms/d)+"d"}if(ms>=h){return Math.round(ms/h)+"h"}if(ms>=m){return Math.round(ms/m)+"m"}if(ms>=s){return Math.round(ms/s)+"s"}return ms+"ms"}function fmtLong(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n){return}if(ms<n*1.5){return Math.floor(ms/n)+" "+name}return Math.ceil(ms/n)+" "+name+"s"}},{}],228:[function(require,module,exports){(function(global){function MediaStreamRecorder(mediaStream){if(!mediaStream){throw"MediaStream is mandatory."}this.start=function(timeSlice){var Recorder;if(typeof MediaRecorder!=="undefined"){Recorder=MediaRecorderWrapper}else if(IsChrome||IsOpera||IsEdge){if(this.mimeType.indexOf("video")!==-1){Recorder=WhammyRecorder}else if(this.mimeType.indexOf("audio")!==-1){Recorder=StereoAudioRecorder}}if(this.mimeType==="image/gif"){Recorder=GifRecorder}if(this.mimeType==="audio/wav"||this.mimeType==="audio/pcm"){Recorder=StereoAudioRecorder}if(this.recorderType){Recorder=this.recorderType}mediaRecorder=new Recorder(mediaStream);mediaRecorder.blobs=[];var self=this;mediaRecorder.ondataavailable=function(data){mediaRecorder.blobs.push(data);self.ondataavailable(data)};mediaRecorder.onstop=this.onstop;mediaRecorder.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames;mediaRecorder=mergeProps(mediaRecorder,this);mediaRecorder.start(timeSlice)};this.onStartedDrawingNonBlankFrames=function(){};this.clearOldRecordedFrames=function(){if(!mediaRecorder){return}mediaRecorder.clearOldRecordedFrames()};this.stop=function(){if(mediaRecorder){mediaRecorder.stop()}};this.ondataavailable=function(blob){console.log("ondataavailable..",blob)};this.onstop=function(error){console.warn("stopped..",error)};this.save=function(file,fileName){if(!file){if(!mediaRecorder){return}ConcatenateBlobs(mediaRecorder.blobs,mediaRecorder.blobs[0].type,function(concatenatedBlob){invokeSaveAsDialog(concatenatedBlob)});return}invokeSaveAsDialog(file,fileName)};this.pause=function(){if(!mediaRecorder){return}mediaRecorder.pause();console.log("Paused recording.",this.mimeType||mediaRecorder.mimeType)};this.resume=function(){if(!mediaRecorder){return}mediaRecorder.resume();console.log("Resumed recording.",this.mimeType||mediaRecorder.mimeType)};this.recorderType=null;this.mimeType="video/webm";this.disableLogs=false;var mediaRecorder}function MultiStreamRecorder(mediaStream){if(!mediaStream){throw"MediaStream is mandatory."}var self=this;var isMediaRecorder=isMediaRecorderCompatible();this.stream=mediaStream;this.start=function(timeSlice){audioRecorder=new MediaStreamRecorder(mediaStream);videoRecorder=new MediaStreamRecorder(mediaStream);audioRecorder.mimeType="audio/ogg";videoRecorder.mimeType="video/webm";for(var prop in this){if(typeof this[prop]!=="function"){audioRecorder[prop]=videoRecorder[prop]=this[prop]}}audioRecorder.ondataavailable=function(blob){if(!audioVideoBlobs[recordingInterval]){audioVideoBlobs[recordingInterval]={}}audioVideoBlobs[recordingInterval].audio=blob;if(audioVideoBlobs[recordingInterval].video&&!audioVideoBlobs[recordingInterval].onDataAvailableEventFired){audioVideoBlobs[recordingInterval].onDataAvailableEventFired=true;fireOnDataAvailableEvent(audioVideoBlobs[recordingInterval])}};videoRecorder.ondataavailable=function(blob){if(isMediaRecorder){return self.ondataavailable({video:blob,audio:blob})}if(!audioVideoBlobs[recordingInterval]){audioVideoBlobs[recordingInterval]={}}audioVideoBlobs[recordingInterval].video=blob;if(audioVideoBlobs[recordingInterval].audio&&!audioVideoBlobs[recordingInterval].onDataAvailableEventFired){audioVideoBlobs[recordingInterval].onDataAvailableEventFired=true;fireOnDataAvailableEvent(audioVideoBlobs[recordingInterval])}};function fireOnDataAvailableEvent(blobs){recordingInterval++;self.ondataavailable(blobs)}videoRecorder.onstop=audioRecorder.onstop=function(error){self.onstop(error)};if(!isMediaRecorder){videoRecorder.onStartedDrawingNonBlankFrames=function(){videoRecorder.clearOldRecordedFrames();audioRecorder.start(timeSlice)};videoRecorder.start(timeSlice)}else{videoRecorder.start(timeSlice)}};this.stop=function(){if(audioRecorder){audioRecorder.stop()}if(videoRecorder){videoRecorder.stop()}};this.ondataavailable=function(blob){console.log("ondataavailable..",blob)};this.onstop=function(error){console.warn("stopped..",error)};this.pause=function(){if(audioRecorder){audioRecorder.pause()}if(videoRecorder){videoRecorder.pause()}};this.resume=function(){if(audioRecorder){audioRecorder.resume()}if(videoRecorder){videoRecorder.resume()}};var audioRecorder;var videoRecorder;var audioVideoBlobs={};var recordingInterval=0}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.MultiStreamRecorder=MultiStreamRecorder}var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(that){if(typeof window!=="undefined"){return}if(typeof window==="undefined"&&typeof global!=="undefined"){global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}};that.window=global}else if(typeof window==="undefined"){}if(typeof document==="undefined"){that.document={};document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}}if(typeof location==="undefined"){that.location={protocol:"file:",href:"",hash:""}}if(typeof screen==="undefined"){that.screen={width:0,height:0}}})(typeof global!=="undefined"?global:window);var AudioContext=window.AudioContext;if(typeof AudioContext==="undefined"){if(typeof webkitAudioContext!=="undefined"){AudioContext=webkitAudioContext}if(typeof mozAudioContext!=="undefined"){AudioContext=mozAudioContext}}if(typeof window==="undefined"){window={}}var AudioContext=window.AudioContext;if(typeof AudioContext==="undefined"){if(typeof webkitAudioContext!=="undefined"){AudioContext=webkitAudioContext}if(typeof mozAudioContext!=="undefined"){AudioContext=mozAudioContext}}var URL=window.URL;if(typeof URL==="undefined"&&typeof webkitURL!=="undefined"){URL=webkitURL}if(typeof navigator!=="undefined"){if(typeof navigator.webkitGetUserMedia!=="undefined"){navigator.getUserMedia=navigator.webkitGetUserMedia}if(typeof navigator.mozGetUserMedia!=="undefined"){navigator.getUserMedia=navigator.mozGetUserMedia}}else{navigator={getUserMedia:function(){},userAgent:browserFakeUserAgent}}var IsEdge=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob);var IsOpera=false;if(typeof opera!=="undefined"&&navigator.userAgent&&navigator.userAgent.indexOf("OPR/")!==-1){IsOpera=true}var IsChrome=!IsEdge&&!IsEdge&&!!navigator.webkitGetUserMedia;var MediaStream=window.MediaStream;if(typeof MediaStream==="undefined"&&typeof webkitMediaStream!=="undefined"){MediaStream=webkitMediaStream}if(typeof MediaStream!=="undefined"){if(!("getVideoTracks"in MediaStream.prototype)){MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks){return[]}var tracks=[];this.getTracks.forEach(function(track){if(track.kind.toString().indexOf("video")!==-1){tracks.push(track)}});return tracks};MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks){return[]}var tracks=[];this.getTracks.forEach(function(track){if(track.kind.toString().indexOf("audio")!==-1){tracks.push(track)}});return tracks}}if(!("stop"in MediaStream.prototype)){MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(track){if(!!track.stop){track.stop()}});this.getVideoTracks().forEach(function(track){if(!!track.stop){track.stop()}})}}}if(typeof location!=="undefined"){if(location.href.indexOf("file:")===0){console.error("Please load this HTML file on HTTP or HTTPS.")}}function mergeProps(mergein,mergeto){for(var t in mergeto){if(typeof mergeto[t]!=="function"){mergein[t]=mergeto[t]}}return mergein}function dropFirstFrame(arr){arr.shift();return arr}function invokeSaveAsDialog(file,fileName){if(!file){throw"Blob object is required."}if(!file.type){try{file.type="video/webm"}catch(e){}}var fileExtension=(file.type||"video/webm").split("/")[1];if(fileName&&fileName.indexOf(".")!==-1){var splitted=fileName.split(".");fileName=splitted[0];fileExtension=splitted[1]}var fileFullName=(fileName||Math.round(Math.random()*9999999999)+888888888)+"."+fileExtension;if(typeof navigator.msSaveOrOpenBlob!=="undefined"){return navigator.msSaveOrOpenBlob(file,fileFullName)}else if(typeof navigator.msSaveBlob!=="undefined"){return navigator.msSaveBlob(file,fileFullName)}var hyperlink=document.createElement("a");hyperlink.href=URL.createObjectURL(file);hyperlink.target="_blank";hyperlink.download=fileFullName;if(!!navigator.mozGetUserMedia){hyperlink.onclick=function(){(document.body||document.documentElement).removeChild(hyperlink)};(document.body||document.documentElement).appendChild(hyperlink)}var evt=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});hyperlink.dispatchEvent(evt);if(!navigator.mozGetUserMedia){URL.revokeObjectURL(hyperlink.href)}}function bytesToSize(bytes){var k=1e3;var sizes=["Bytes","KB","MB","GB","TB"];if(bytes===0){return"0 Bytes"}var i=parseInt(Math.floor(Math.log(bytes)/Math.log(k)),10);return(bytes/Math.pow(k,i)).toPrecision(3)+" "+sizes[i]}var ObjectStore={AudioContext:AudioContext};function isMediaRecorderCompatible(){var isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;var isChrome=!!window.chrome&&!isOpera;var isFirefox=typeof window.InstallTrigger!=="undefined";if(isFirefox){return true}if(!isChrome){return false}var nVer=navigator.appVersion;var nAgt=navigator.userAgent;var fullVersion=""+parseFloat(navigator.appVersion);var majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if(isChrome){verOffset=nAgt.indexOf("Chrome");fullVersion=nAgt.substring(verOffset+7)}if((ix=fullVersion.indexOf(";"))!==-1){fullVersion=fullVersion.substring(0,ix)}if((ix=fullVersion.indexOf(" "))!==-1){fullVersion=fullVersion.substring(0,ix)}majorVersion=parseInt(""+fullVersion,10);if(isNaN(majorVersion)){fullVersion=""+parseFloat(navigator.appVersion);majorVersion=parseInt(navigator.appVersion,10)}return majorVersion>=49}var ObjectStore={AudioContext:window.AudioContext||window.webkitAudioContext};function MediaRecorderWrapper(mediaStream){var self=this;this.start=function(timeSlice,__disableLogs){if(!self.mimeType){self.mimeType="video/webm"}if(self.mimeType.indexOf("audio")!==-1){if(mediaStream.getVideoTracks().length&&mediaStream.getAudioTracks().length){var stream;if(!!navigator.mozGetUserMedia){stream=new MediaStream;stream.addTrack(mediaStream.getAudioTracks()[0])}else{stream=new MediaStream(mediaStream.getAudioTracks())}mediaStream=stream}}if(self.mimeType.indexOf("audio")!==-1){self.mimeType=IsChrome?"audio/webm":"audio/ogg"}self.dontFireOnDataAvailableEvent=false;var recorderHints={mimeType:self.mimeType};if(!self.disableLogs&&!__disableLogs){console.log("Passing following params over MediaRecorder API.",recorderHints)}if(mediaRecorder){mediaRecorder=null}if(IsChrome&&!isMediaRecorderCompatible()){recorderHints="video/vp8"}try{mediaRecorder=new MediaRecorder(mediaStream,recorderHints)}catch(e){mediaRecorder=new MediaRecorder(mediaStream)}if("canRecordMimeType"in mediaRecorder&&mediaRecorder.canRecordMimeType(self.mimeType)===false){if(!self.disableLogs){console.warn("MediaRecorder API seems unable to record mimeType:",self.mimeType)}}mediaRecorder.ignoreMutedMedia=self.ignoreMutedMedia||false;var firedOnDataAvailableOnce=false;mediaRecorder.ondataavailable=function(e){if(self.dontFireOnDataAvailableEvent){return}if(!e.data||!e.data.size||e.data.size<26800||firedOnDataAvailableOnce){return}firedOnDataAvailableOnce=true;var blob=self.getNativeBlob?e.data:new Blob([e.data],{type:self.mimeType||"video/webm"});self.ondataavailable(blob);self.dontFireOnDataAvailableEvent=true;if(!!mediaRecorder){mediaRecorder.stop();mediaRecorder=null}self.start(timeSlice,"__disableLogs")};mediaRecorder.onerror=function(error){if(!self.disableLogs){if(error.name==="InvalidState"){console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.")}else if(error.name==="OutOfMemory"){console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.")}else if(error.name==="IllegalStreamModification"){console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.")}else if(error.name==="OtherRecordingError"){console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.")}else if(error.name==="GenericError"){console.error("The UA cannot provide the codec or recording option that has been requested.",error)}else{console.error("MediaRecorder Error",error)}}if(!!mediaRecorder&&mediaRecorder.state!=="inactive"&&mediaRecorder.state!=="stopped"){mediaRecorder.stop()}};try{mediaRecorder.start(36e5)}catch(e){mediaRecorder=null}setTimeout(function(){if(!mediaRecorder){return}if(mediaRecorder.state==="recording"){mediaRecorder.requestData()}},timeSlice)};this.stop=function(callback){if(!mediaRecorder){return}if(mediaRecorder.state==="recording"){mediaRecorder.requestData();setTimeout(function(){self.dontFireOnDataAvailableEvent=true;if(!!mediaRecorder&&mediaRecorder.state==="recording"){mediaRecorder.stop()}mediaRecorder=null},2e3)}};this.pause=function(){if(!mediaRecorder){return}if(mediaRecorder.state==="recording"){mediaRecorder.pause()}};this.ondataavailable=function(blob){console.log("recorded-blob",blob)};this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=false;var disableLogs=self.disableLogs;self.disableLogs=true;this.record();self.disableLogs=disableLogs;return}if(!mediaRecorder){return}if(mediaRecorder.state==="paused"){mediaRecorder.resume()}};this.clearRecordedData=function(){if(!mediaRecorder){return}this.pause();this.dontFireOnDataAvailableEvent=true;this.stop()};var mediaRecorder;function isMediaStreamActive(){if("active"in mediaStream){if(!mediaStream.active){return false}}else if("ended"in mediaStream){if(mediaStream.ended){return false}}return true}(function looper(){if(!mediaRecorder){return}if(isMediaStreamActive()===false){self.stop();return}setTimeout(looper,1e3)})()}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.MediaRecorderWrapper=MediaRecorderWrapper}function StereoAudioRecorder(mediaStream){this.start=function(timeSlice){timeSlice=timeSlice||1e3;mediaRecorder=new StereoAudioRecorderHelper(mediaStream,this);mediaRecorder.record();timeout=setInterval(function(){mediaRecorder.requestData()},timeSlice)};this.stop=function(){if(mediaRecorder){mediaRecorder.stop();clearTimeout(timeout)}};this.pause=function(){if(!mediaRecorder){return}mediaRecorder.pause()};this.resume=function(){if(!mediaRecorder){return}mediaRecorder.resume()};this.ondataavailable=function(){};var mediaRecorder;var timeout}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.StereoAudioRecorder=StereoAudioRecorder}function StereoAudioRecorderHelper(mediaStream,root){var deviceSampleRate=44100;if(!ObjectStore.AudioContextConstructor){ObjectStore.AudioContextConstructor=new ObjectStore.AudioContext}deviceSampleRate=ObjectStore.AudioContextConstructor.sampleRate;var leftchannel=[];var rightchannel=[];var scriptprocessornode;var recording=false;var recordingLength=0;var volume;var audioInput;var sampleRate=root.sampleRate||deviceSampleRate;var mimeType=root.mimeType||"audio/wav";var isPCM=mimeType.indexOf("audio/pcm")>-1;var context;var numChannels=root.audioChannels||2;this.record=function(){recording=true;leftchannel.length=rightchannel.length=0;recordingLength=0};this.requestData=function(){if(isPaused){return}if(recordingLength===0){requestDataInvoked=false;return}requestDataInvoked=true;var internalLeftChannel=leftchannel.slice(0);var internalRightChannel=rightchannel.slice(0);var internalRecordingLength=recordingLength;leftchannel.length=rightchannel.length=[];recordingLength=0;requestDataInvoked=false;var leftBuffer=mergeBuffers(internalLeftChannel,internalRecordingLength);var interleaved=leftBuffer;if(numChannels===2){var rightBuffer=mergeBuffers(internalRightChannel,internalRecordingLength);interleaved=interleave(leftBuffer,rightBuffer)}if(isPCM){var blob=new Blob([convertoFloat32ToInt16(interleaved)],{type:"audio/pcm"});console.debug("audio recorded blob size:",bytesToSize(blob.size));root.ondataavailable(blob);return}var buffer=new ArrayBuffer(44+interleaved.length*2);var view=new DataView(buffer);writeUTFBytes(view,0,"RIFF");view.setUint32(4,44+interleaved.length*2-8,true);writeUTFBytes(view,8,"WAVE");writeUTFBytes(view,12,"fmt ");view.setUint32(16,16,true);view.setUint16(20,1,true);view.setUint16(22,numChannels,true);view.setUint32(24,sampleRate,true);view.setUint32(28,sampleRate*numChannels*2,true);view.setUint16(32,numChannels*2,true);view.setUint16(34,16,true);writeUTFBytes(view,36,"data");view.setUint32(40,interleaved.length*2,true);var lng=interleaved.length;var index=44;var volume=1;for(var i=0;i<lng;i++){view.setInt16(index,interleaved[i]*(32767*volume),true);index+=2}var blob=new Blob([view],{type:"audio/wav"});console.debug("audio recorded blob size:",bytesToSize(blob.size));root.ondataavailable(blob)};this.stop=function(){recording=false;this.requestData();audioInput.disconnect()};function interleave(leftChannel,rightChannel){var length=leftChannel.length+rightChannel.length;var result=new Float32Array(length);var inputIndex=0;for(var index=0;index<length;){result[index++]=leftChannel[inputIndex];result[index++]=rightChannel[inputIndex];inputIndex++}return result}function mergeBuffers(channelBuffer,recordingLength){var result=new Float32Array(recordingLength);var offset=0;var lng=channelBuffer.length;for(var i=0;i<lng;i++){var buffer=channelBuffer[i];result.set(buffer,offset);offset+=buffer.length}return result}function writeUTFBytes(view,offset,string){var lng=string.length;for(var i=0;i<lng;i++){view.setUint8(offset+i,string.charCodeAt(i))}}function convertoFloat32ToInt16(buffer){var l=buffer.length;var buf=new Int16Array(l);while(l--){buf[l]=buffer[l]*65535}return buf.buffer}var context=ObjectStore.AudioContextConstructor;ObjectStore.VolumeGainNode=context.createGain();var volume=ObjectStore.VolumeGainNode;ObjectStore.AudioInput=context.createMediaStreamSource(mediaStream);var audioInput=ObjectStore.AudioInput;audioInput.connect(volume);var bufferSize=root.bufferSize||2048;if(root.bufferSize===0){bufferSize=0}if(context.createJavaScriptNode){scriptprocessornode=context.createJavaScriptNode(bufferSize,numChannels,numChannels)}else if(context.createScriptProcessor){scriptprocessornode=context.createScriptProcessor(bufferSize,numChannels,numChannels)}else{throw"WebAudio API has no support on this browser."}bufferSize=scriptprocessornode.bufferSize;console.debug("using audio buffer-size:",bufferSize);var requestDataInvoked=false;window.scriptprocessornode=scriptprocessornode;if(numChannels===1){console.debug("All right-channels are skipped.")}var isPaused=false;this.pause=function(){isPaused=true};this.resume=function(){isPaused=false};scriptprocessornode.onaudioprocess=function(e){if(!recording||requestDataInvoked||isPaused){return}var left=e.inputBuffer.getChannelData(0);leftchannel.push(new Float32Array(left));if(numChannels===2){var right=e.inputBuffer.getChannelData(1);rightchannel.push(new Float32Array(right))}recordingLength+=bufferSize};volume.connect(scriptprocessornode);scriptprocessornode.connect(context.destination)}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.StereoAudioRecorderHelper=StereoAudioRecorderHelper}function WhammyRecorder(mediaStream){this.start=function(timeSlice){timeSlice=timeSlice||1e3;mediaRecorder=new WhammyRecorderHelper(mediaStream,this);for(var prop in this){if(typeof this[prop]!=="function"){mediaRecorder[prop]=this[prop]}}mediaRecorder.record();timeout=setInterval(function(){mediaRecorder.requestData()},timeSlice)};this.stop=function(){if(mediaRecorder){mediaRecorder.stop();clearTimeout(timeout)}};this.clearOldRecordedFrames=function(){if(mediaRecorder){mediaRecorder.clearOldRecordedFrames()}};this.pause=function(){if(!mediaRecorder){return}mediaRecorder.pause()};this.resume=function(){if(!mediaRecorder){return}mediaRecorder.resume()};this.ondataavailable=function(){};var mediaRecorder;var timeout}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.WhammyRecorder=WhammyRecorder}function WhammyRecorderHelper(mediaStream,root){this.record=function(timeSlice){if(!this.width){this.width=320}if(!this.height){this.height=240}if(this.video&&this.video instanceof HTMLVideoElement){if(!this.width){this.width=video.videoWidth||video.clientWidth||320}if(!this.height){this.height=video.videoHeight||video.clientHeight||240}}if(!this.video){this.video={width:this.width,height:this.height}}if(!this.canvas||!this.canvas.width||!this.canvas.height){this.canvas={width:this.width,height:this.height}}canvas.width=this.canvas.width;canvas.height=this.canvas.height;if(this.video&&this.video instanceof HTMLVideoElement){this.isHTMLObject=true;video=this.video.cloneNode()}else{video=document.createElement("video");video.src=URL.createObjectURL(mediaStream);video.width=this.video.width;video.height=this.video.height}video.muted=true;video.play();lastTime=(new Date).getTime();whammy=new Whammy.Video(root.speed,root.quality);console.log("canvas resolutions",canvas.width,"*",canvas.height);console.log("video width/height",video.width||canvas.width,"*",video.height||canvas.height);drawFrames()};this.clearOldRecordedFrames=function(){whammy.frames=[]};var requestDataInvoked=false;this.requestData=function(){if(isPaused){return}if(!whammy.frames.length){requestDataInvoked=false;return}requestDataInvoked=true;var internalFrames=whammy.frames.slice(0);whammy.frames=dropBlackFrames(internalFrames,-1);whammy.compile(function(whammyBlob){root.ondataavailable(whammyBlob);console.debug("video recorded blob size:",bytesToSize(whammyBlob.size))});whammy.frames=[];requestDataInvoked=false};var isOnStartedDrawingNonBlankFramesInvoked=false;function drawFrames(){if(isPaused){lastTime=(new Date).getTime();setTimeout(drawFrames,500);return}if(isStopDrawing){return}if(requestDataInvoked){return setTimeout(drawFrames,100)}var duration=(new Date).getTime()-lastTime;if(!duration){return drawFrames()}lastTime=(new Date).getTime();if(!self.isHTMLObject&&video.paused){video.play()}context.drawImage(video,0,0,canvas.width,canvas.height);if(!isStopDrawing){whammy.frames.push({duration:duration,image:canvas.toDataURL("image/webp")})}if(!isOnStartedDrawingNonBlankFramesInvoked&&!isBlankFrame(whammy.frames[whammy.frames.length-1])){isOnStartedDrawingNonBlankFramesInvoked=true;root.onStartedDrawingNonBlankFrames()}setTimeout(drawFrames,10)}var isStopDrawing=false;this.stop=function(){isStopDrawing=true;this.requestData()};var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var video;var lastTime;var whammy;var self=this;function isBlankFrame(frame,_pixTolerance,_frameTolerance){var localCanvas=document.createElement("canvas");localCanvas.width=canvas.width;localCanvas.height=canvas.height;var context2d=localCanvas.getContext("2d");var sampleColor={r:0,g:0,b:0};var maxColorDifference=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2));var pixTolerance=_pixTolerance&&_pixTolerance>=0&&_pixTolerance<=1?_pixTolerance:0;var frameTolerance=_frameTolerance&&_frameTolerance>=0&&_frameTolerance<=1?_frameTolerance:0;var matchPixCount,endPixCheck,maxPixCount;var image=new Image;image.src=frame.image;context2d.drawImage(image,0,0,canvas.width,canvas.height);var imageData=context2d.getImageData(0,0,canvas.width,canvas.height);matchPixCount=0;endPixCheck=imageData.data.length;maxPixCount=imageData.data.length/4;for(var pix=0;pix<endPixCheck;pix+=4){var currentColor={r:imageData.data[pix],g:imageData.data[pix+1],b:imageData.data[pix+2]};var colorDifference=Math.sqrt(Math.pow(currentColor.r-sampleColor.r,2)+Math.pow(currentColor.g-sampleColor.g,2)+Math.pow(currentColor.b-sampleColor.b,2));if(colorDifference<=maxColorDifference*pixTolerance){matchPixCount++}}if(maxPixCount-matchPixCount<=maxPixCount*frameTolerance){return false}else{return true}}function dropBlackFrames(_frames,_framesToCheck,_pixTolerance,_frameTolerance){var localCanvas=document.createElement("canvas");localCanvas.width=canvas.width;localCanvas.height=canvas.height;var context2d=localCanvas.getContext("2d");var resultFrames=[];var checkUntilNotBlack=_framesToCheck===-1;var endCheckFrame=_framesToCheck&&_framesToCheck>0&&_framesToCheck<=_frames.length?_framesToCheck:_frames.length;var sampleColor={r:0,g:0,b:0};var maxColorDifference=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2));var pixTolerance=_pixTolerance&&_pixTolerance>=0&&_pixTolerance<=1?_pixTolerance:0;var frameTolerance=_frameTolerance&&_frameTolerance>=0&&_frameTolerance<=1?_frameTolerance:0;var doNotCheckNext=false;for(var f=0;f<endCheckFrame;f++){var matchPixCount,endPixCheck,maxPixCount;if(!doNotCheckNext){var image=new Image;image.src=_frames[f].image;context2d.drawImage(image,0,0,canvas.width,canvas.height);var imageData=context2d.getImageData(0,0,canvas.width,canvas.height);matchPixCount=0;endPixCheck=imageData.data.length;maxPixCount=imageData.data.length/4;for(var pix=0;pix<endPixCheck;pix+=4){var currentColor={r:imageData.data[pix],g:imageData.data[pix+1],b:imageData.data[pix+2]};var colorDifference=Math.sqrt(Math.pow(currentColor.r-sampleColor.r,2)+Math.pow(currentColor.g-sampleColor.g,2)+Math.pow(currentColor.b-sampleColor.b,2));if(colorDifference<=maxColorDifference*pixTolerance){matchPixCount++}}}if(!doNotCheckNext&&maxPixCount-matchPixCount<=maxPixCount*frameTolerance){}else{if(checkUntilNotBlack){doNotCheckNext=true}resultFrames.push(_frames[f])}}resultFrames=resultFrames.concat(_frames.slice(endCheckFrame));if(resultFrames.length<=0){resultFrames.push(_frames[_frames.length-1])}return resultFrames}var isPaused=false;this.pause=function(){isPaused=true};this.resume=function(){isPaused=false}}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.WhammyRecorderHelper=WhammyRecorderHelper}function GifRecorder(mediaStream){if(typeof GIFEncoder==="undefined"){throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js"}this.start=function(timeSlice){timeSlice=timeSlice||1e3;var imageWidth=this.videoWidth||320;var imageHeight=this.videoHeight||240;canvas.width=video.width=imageWidth;canvas.height=video.height=imageHeight;gifEncoder=new GIFEncoder;gifEncoder.setRepeat(0);gifEncoder.setDelay(this.frameRate||this.speed||200);gifEncoder.setQuality(this.quality||1);gifEncoder.start();startTime=Date.now();function drawVideoFrame(time){if(isPaused){setTimeout(drawVideoFrame,500,time);return}lastAnimationFrame=requestAnimationFrame(drawVideoFrame);if(typeof lastFrameTime===undefined){lastFrameTime=time}if(time-lastFrameTime<90){return}if(video.paused){video.play()}context.drawImage(video,0,0,imageWidth,imageHeight);gifEncoder.addFrame(context);lastFrameTime=time}lastAnimationFrame=requestAnimationFrame(drawVideoFrame);timeout=setTimeout(doneRecording,timeSlice)};function doneRecording(){endTime=Date.now();var gifBlob=new Blob([new Uint8Array(gifEncoder.stream().bin)],{type:"image/gif"});self.ondataavailable(gifBlob);gifEncoder.stream().bin=[]}this.stop=function(){if(lastAnimationFrame){cancelAnimationFrame(lastAnimationFrame);clearTimeout(timeout);doneRecording()}};var isPaused=false;this.pause=function(){isPaused=true};this.resume=function(){isPaused=false};this.ondataavailable=function(){};this.onstop=function(){};var self=this;var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var video=document.createElement("video");video.muted=true;video.autoplay=true;video.src=URL.createObjectURL(mediaStream);video.play();var lastAnimationFrame=null;var startTime,endTime,lastFrameTime;var gifEncoder;var timeout}if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.GifRecorder=GifRecorder}var Whammy=function(){function WhammyVideo(duration,quality){this.frames=[];if(!duration){duration=1}this.duration=1e3/duration;this.quality=quality||.8}WhammyVideo.prototype.add=function(frame,duration){if("canvas"in frame){frame=frame.canvas}if("toDataURL"in frame){frame=frame.toDataURL("image/webp",this.quality)}if(!/^data:image\/webp;base64,/gi.test(frame)){throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp"}this.frames.push({image:frame,duration:duration||this.duration})};function processInWebWorker(_function){var blob=URL.createObjectURL(new Blob([_function.toString(),"this.onmessage =  function (e) {"+_function.name+"(e.data);}"],{type:"application/javascript"}));var worker=new Worker(blob);URL.revokeObjectURL(blob);return worker}function whammyInWebWorker(frames){function ArrayToWebM(frames){var info=checkFrames(frames);if(!info){return[]}var clusterMaxDuration=3e4;var EBML=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:doubleToString(info.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:info.width,id:176},{data:info.height,id:186}]}]}]}]}];var frameNumber=0;var clusterTimecode=0;while(frameNumber<frames.length){var clusterFrames=[];var clusterDuration=0;do{clusterFrames.push(frames[frameNumber]);clusterDuration+=frames[frameNumber].duration;frameNumber++}while(frameNumber<frames.length&&clusterDuration<clusterMaxDuration);var clusterCounter=0;var cluster={id:524531317,data:getClusterData(clusterTimecode,clusterCounter,clusterFrames)};EBML[1].data.push(cluster);clusterTimecode+=clusterDuration}return generateEBML(EBML)}function getClusterData(clusterTimecode,clusterCounter,clusterFrames){return[{data:clusterTimecode,id:231}].concat(clusterFrames.map(function(webp){var block=makeSimpleBlock({discardable:0,frame:webp.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(clusterCounter)});clusterCounter+=webp.duration;return{data:block,id:163}}))}function checkFrames(frames){if(!frames[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}var width=frames[0].width,height=frames[0].height,duration=frames[0].duration;for(var i=1;i<frames.length;i++){duration+=frames[i].duration}return{duration:duration,width:width,height:height}}function numToBuffer(num){var parts=[];while(num>0){parts.push(num&255);num=num>>8}return new Uint8Array(parts.reverse())}function strToBuffer(str){return new Uint8Array(str.split("").map(function(e){return e.charCodeAt(0)}))}function bitsToBuffer(bits){var data=[];var pad=bits.length%8?new Array(1+8-bits.length%8).join("0"):"";bits=pad+bits;for(var i=0;i<bits.length;i+=8){data.push(parseInt(bits.substr(i,8),2))}return new Uint8Array(data)}function generateEBML(json){var ebml=[];for(var i=0;i<json.length;i++){var data=json[i].data;if(typeof data==="object"){data=generateEBML(data)}if(typeof data==="number"){data=bitsToBuffer(data.toString(2))}if(typeof data==="string"){data=strToBuffer(data)}var len=data.size||data.byteLength||data.length;var zeroes=Math.ceil(Math.ceil(Math.log(len)/Math.log(2))/8);var sizeToString=len.toString(2);var padded=new Array(zeroes*7+7+1-sizeToString.length).join("0")+sizeToString;var size=new Array(zeroes).join("0")+"1"+padded;ebml.push(numToBuffer(json[i].id));ebml.push(bitsToBuffer(size));ebml.push(data)}return new Blob(ebml,{type:"video/webm"})}function toBinStrOld(bits){var data="";var pad=bits.length%8?new Array(1+8-bits.length%8).join("0"):"";bits=pad+bits;for(var i=0;i<bits.length;i+=8){data+=String.fromCharCode(parseInt(bits.substr(i,8),2))}return data}function makeSimpleBlock(data){var flags=0;if(data.keyframe){flags|=128}if(data.invisible){flags|=8}if(data.lacing){flags|=data.lacing<<1}if(data.discardable){flags|=1}if(data.trackNum>127){throw"TrackNumber > 127 not supported"}var out=[data.trackNum|128,data.timecode>>8,data.timecode&255,flags].map(function(e){return String.fromCharCode(e)}).join("")+data.frame;return out}function parseWebP(riff){var VP8=riff.RIFF[0].WEBP[0];var frameStart=VP8.indexOf("*");for(var i=0,c=[];i<4;i++){c[i]=VP8.charCodeAt(frameStart+3+i)}var width,height,tmp;tmp=c[1]<<8|c[0];width=tmp&16383;tmp=c[3]<<8|c[2];height=tmp&16383;return{width:width,height:height,data:VP8,riff:riff}}function getStrLength(string,offset){return parseInt(string.substr(offset+4,4).split("").map(function(i){var unpadded=i.charCodeAt(0).toString(2);return new Array(8-unpadded.length+1).join("0")+unpadded}).join(""),2)}function parseRIFF(string){var offset=0;var chunks={};while(offset<string.length){var id=string.substr(offset,4);var len=getStrLength(string,offset);var data=string.substr(offset+4+4,len);offset+=4+4+len;chunks[id]=chunks[id]||[];if(id==="RIFF"||id==="LIST"){chunks[id].push(parseRIFF(data))}else{chunks[id].push(data)}}return chunks}function doubleToString(num){return[].slice.call(new Uint8Array(new Float64Array([num]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}var webm=new ArrayToWebM(frames.map(function(frame){var webp=parseWebP(parseRIFF(atob(frame.image.slice(23))));webp.duration=frame.duration;return webp}));postMessage(webm)}WhammyVideo.prototype.compile=function(callback){var webWorker=processInWebWorker(whammyInWebWorker);webWorker.onmessage=function(event){if(event.data.error){console.error(event.data.error);return}callback(event.data)};webWorker.postMessage(this.frames)};return{Video:WhammyVideo}}();if(typeof MediaStreamRecorder!=="undefined"){MediaStreamRecorder.Whammy=Whammy}(function(){window.ConcatenateBlobs=function(blobs,type,callback){var buffers=[];var index=0;function readAsArrayBuffer(){if(!blobs[index]){return concatenateBuffers()}var reader=new FileReader;reader.onload=function(event){buffers.push(event.target.result);index++;readAsArrayBuffer()};reader.readAsArrayBuffer(blobs[index])}readAsArrayBuffer();function concatenateBuffers(){var byteLength=0;buffers.forEach(function(buffer){byteLength+=buffer.byteLength});var tmp=new Uint16Array(byteLength);var lastOffset=0;buffers.forEach(function(buffer){var reusableByteLength=buffer.byteLength;if(reusableByteLength%2!=0){buffer=buffer.slice(0,reusableByteLength-1)}tmp.set(new Uint16Array(buffer),lastOffset);lastOffset+=reusableByteLength});var blob=new Blob([tmp.buffer],{type:type});callback(blob)}}})();if(typeof module!=="undefined"){module.exports=MediaStreamRecorder}if(typeof define==="function"&&define.amd){define("MediaStreamRecorder",[],function(){return MediaStreamRecorder})}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],229:[function(require,module,exports){assert.notEqual=notEqual;assert.notOk=notOk;assert.equal=equal;assert.ok=assert;module.exports=assert;function equal(a,b,m){assert(a==b,m)}function notEqual(a,b,m){assert(a!=b,m)}function notOk(t,m){assert(!t,m)}function assert(t,m){if(!t)throw new Error(m||"AssertionError")}},{}],230:[function(require,module,exports){var splice=require("remove-array-items");var nanotiming=require("nanotiming");var assert=require("assert");module.exports=Nanobus;function Nanobus(name){if(!(this instanceof Nanobus))return new Nanobus(name);this._name=name||"nanobus";this._starListeners=[];this._listeners={}}Nanobus.prototype.emit=function(eventName,data){assert.equal(typeof eventName,"string","nanobus.emit: eventName should be type string");var emitTiming=nanotiming(this._name+"('"+eventName+"')");var listeners=this._listeners[eventName];if(listeners&&listeners.length>0){this._emit(this._listeners[eventName],data)}if(this._starListeners.length>0){this._emit(this._starListeners,eventName,data,emitTiming.uuid)}emitTiming();return this};Nanobus.prototype.on=Nanobus.prototype.addListener=function(eventName,listener){assert.equal(typeof eventName,"string","nanobus.on: eventName should be type string");assert.equal(typeof listener,"function","nanobus.on: listener should be type function");if(eventName==="*"){this._starListeners.push(listener)}else{if(!this._listeners[eventName])this._listeners[eventName]=[];this._listeners[eventName].push(listener)}return this};Nanobus.prototype.prependListener=function(eventName,listener){assert.equal(typeof eventName,"string","nanobus.prependListener: eventName should be type string");assert.equal(typeof listener,"function","nanobus.prependListener: listener should be type function");if(eventName==="*"){this._starListeners.unshift(listener)}else{if(!this._listeners[eventName])this._listeners[eventName]=[];this._listeners[eventName].unshift(listener)}return this};Nanobus.prototype.once=function(eventName,listener){assert.equal(typeof eventName,"string","nanobus.once: eventName should be type string");assert.equal(typeof listener,"function","nanobus.once: listener should be type function");var self=this;this.on(eventName,once);function once(){listener.apply(self,arguments);self.removeListener(eventName,once)}return this};Nanobus.prototype.prependOnceListener=function(eventName,listener){assert.equal(typeof eventName,"string","nanobus.prependOnceListener: eventName should be type string");assert.equal(typeof listener,"function","nanobus.prependOnceListener: listener should be type function");var self=this;this.prependListener(eventName,once);function once(){listener.apply(self,arguments);self.removeListener(eventName,once)}return this};Nanobus.prototype.removeListener=function(eventName,listener){assert.equal(typeof eventName,"string","nanobus.removeListener: eventName should be type string");assert.equal(typeof listener,"function","nanobus.removeListener: listener should be type function");if(eventName==="*"){this._starListeners=this._starListeners.slice();return remove(this._starListeners,listener)}else{if(typeof this._listeners[eventName]!=="undefined"){this._listeners[eventName]=this._listeners[eventName].slice()}return remove(this._listeners[eventName],listener)}function remove(arr,listener){if(!arr)return;var index=arr.indexOf(listener);if(index!==-1){splice(arr,index,1);return true}}};Nanobus.prototype.removeAllListeners=function(eventName){if(eventName){if(eventName==="*"){this._starListeners=[]}else{this._listeners[eventName]=[]}}else{this._starListeners=[];this._listeners={}}return this};Nanobus.prototype.listeners=function(eventName){var listeners=eventName!=="*"?this._listeners[eventName]:this._starListeners;var ret=[];if(listeners){var ilength=listeners.length;for(var i=0;i<ilength;i++)ret.push(listeners[i])}return ret};Nanobus.prototype._emit=function(arr,eventName,data,uuid){if(typeof arr==="undefined")return;if(data===undefined){data=eventName;eventName=null}var length=arr.length;for(var i=0;i<length;i++){var listener=arr[i];if(eventName){if(uuid!==undefined)listener(eventName,data,uuid);else listener(eventName,data)}else{listener(data)}}}},{assert:5,nanotiming:241,"remove-array-items":434}],231:[function(require,module,exports){var document=require("global/document");var nanotiming=require("nanotiming");var morph=require("nanomorph");var onload=require("on-load");var OL_KEY_ID=onload.KEY_ID;var OL_ATTR_ID=onload.KEY_ATTR;var assert=require("assert");module.exports=Nanocomponent;function makeID(){return"ncid-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)}function Nanocomponent(name){this._hasWindow=typeof window!=="undefined";this._id=null;this._ncID=null;this._olID=null;this._proxy=null;this._loaded=false;this._rootNodeName=null;this._name=name||"nanocomponent";this._rerender=false;this._handleLoad=this._handleLoad.bind(this);this._handleUnload=this._handleUnload.bind(this);this._arguments=[];var self=this;Object.defineProperty(this,"element",{get:function(){var el=document.getElementById(self._id);if(el)return el.dataset.nanocomponent===self._ncID?el:undefined}})}Nanocomponent.prototype.render=function(){var timing=nanotiming(this._name+".render");var self=this;var args=new Array(arguments.length);var el;for(var i=0;i<arguments.length;i++)args[i]=arguments[i];if(!this._hasWindow){el=this.createElement.apply(this,args);timing();return el}else if(this.element){el=this.element;var shouldUpdate=this._rerender||this.update.apply(this,args);if(this._rerender)this._render=false;if(shouldUpdate){morph(el,this._handleRender(args));if(this.afterupdate)this.afterupdate(el)}if(!this._proxy){this._proxy=this._createProxy()}timing();return this._proxy}else{this._reset();el=this._handleRender(args);if(this.beforerender)this.beforerender(el);if(this.load||this.unload||this.afterreorder){onload(el,self._handleLoad,self._handleUnload,self._ncID);this._olID=el.dataset[OL_KEY_ID]}timing();return el}};Nanocomponent.prototype.rerender=function(){assert(this.element,"nanocomponent: cant rerender on an unmounted dom node");this._rerender=true;this.render.apply(this,this._arguments)};Nanocomponent.prototype._handleRender=function(args){var el=this.createElement.apply(this,args);if(!this._rootNodeName)this._rootNodeName=el.nodeName;assert(el instanceof window.HTMLElement,"nanocomponent: createElement should return a DOM node");assert.equal(this._rootNodeName,el.nodeName,"nanocomponent: root node types cannot differ between re-renders");this._arguments=args;return this._brandNode(this._ensureID(el))};Nanocomponent.prototype._createProxy=function(){var proxy=document.createElement("div");var self=this;this._brandNode(proxy);proxy.id=this._id;proxy.setAttribute("data-proxy","");proxy.isSameNode=function(el){return el&&el.dataset.nanocomponent===self._ncID};return proxy};Nanocomponent.prototype._reset=function(){this._ncID=makeID();this._olID=null;this._id=null;this._proxy=null;this._rootNodeName=null};Nanocomponent.prototype._brandNode=function(node){node.setAttribute("data-nanocomponent",this._ncID);if(this._olID)node.setAttribute(OL_ATTR_ID,this._olID);return node};Nanocomponent.prototype._ensureID=function(node){if(node.id)this._id=node.id;else node.id=this._id=this._ncID;if(this._proxy&&this._proxy.id!==this._id)this._proxy.id=this._id;return node};Nanocomponent.prototype._handleLoad=function(el){if(this._loaded){if(this.afterreorder)this.afterreorder(el);return}this._loaded=true;if(this.load)this.load(el)};Nanocomponent.prototype._handleUnload=function(el){if(this.element)return;this._loaded=false;if(this.unload)this.unload(el)};Nanocomponent.prototype.createElement=function(){throw new Error("nanocomponent: createElement should be implemented!")};Nanocomponent.prototype.update=function(){throw new Error("nanocomponent: update should be implemented!")}},{assert:229,"global/document":204,nanomorph:235,nanotiming:241,"on-load":248}],232:[function(require,module,exports){var assert=require("assert");var safeExternalLink=/[noopener|noreferrer] [noopener|noreferrer]/;var protocolLink=/^[\w-_]+:/;module.exports=href;function href(cb,root){assert.notEqual(typeof window,"undefined","nanohref: expected window to exist");root=root||window.document;assert.equal(typeof cb,"function","nanohref: cb should be type function");assert.equal(typeof root,"object","nanohref: root should be type object");window.addEventListener("click",function(e){if(e.button&&e.button!==0||e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.defaultPrevented)return;var anchor=function traverse(node){if(!node||node===root)return;if(node.localName!=="a"||node.href===undefined){return traverse(node.parentNode)}return node}(e.target);if(!anchor)return;if(window.location.origin!==anchor.origin||anchor.hasAttribute("download")||anchor.getAttribute("target")==="_blank"&&safeExternalLink.test(anchor.getAttribute("rel"))||protocolLink.test(anchor.getAttribute("href")))return;e.preventDefault();cb(anchor)})}},{assert:5}],233:[function(require,module,exports){var assert=require("assert");module.exports=nanolocation;function nanolocation(){assert.notEqual(typeof window,"undefined","nanolocation: expected window to exist");var pathname=window.location.pathname.replace(/\/$/,"");var hash=window.location.hash.replace(/^#/,"/");return pathname+hash}},{assert:5}],234:[function(require,module,exports){var assert=require("assert");var xtend=require("xtend");var emojis={trace:"🔍",debug:"🐛",info:"✨",warn:"⚠️",error:"🚨",fatal:"💀"};var levels={trace:10,debug:20,info:30,warn:40,error:50,fatal:60};var defaultColors={foreground:"#d3c0c8",background:"#2d2d2d",black:"#2d2d2d",red:"#f2777a",green:"#99cc99",yellow:"#ffcc66",blue:"#6699cc",magenta:"#cc99cc",cyan:"#66cccc",white:"#d3d0c8",brightBlack:"#747369"};module.exports=Nanologger;function Nanologger(name,opts){opts=opts||{};if(!(this instanceof Nanologger))return new Nanologger(name,opts);assert.equal(typeof opts,"object","nanologger: opts should be type object");this._name=name||"";this._colors=xtend(defaultColors,opts.colors||{});try{this.logLevel=window.localStorage.getItem("logLevel")||"info"}catch(e){this.logLevel="info"}this._logLevel=levels[this.logLevel]}Nanologger.prototype.trace=function(){var args=["trace"];for(var i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);this._print.apply(this,args)};Nanologger.prototype.debug=function(){var args=["debug"];for(var i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);this._print.apply(this,args)};Nanologger.prototype.info=function(){var args=["info"];for(var i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);this._print.apply(this,args)};Nanologger.prototype.warn=function(){var args=["warn"];for(var i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);this._print.apply(this,args)};Nanologger.prototype.error=function(){var args=["error"];for(var i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);this._print.apply(this,args)};Nanologger.prototype.fatal=function(){var args=["fatal"];for(var i=0,len=arguments.length;i<len;i++)args.push(arguments[i]);this._print.apply(this,args)};Nanologger.prototype._print=function(level){if(levels[level]<this._logLevel)return;var time=getTimeStamp();var emoji=emojis[level];var name=this._name||"unknown";var msgColor=level==="error"||level.fatal?this._colors.red:level==="warn"?this._colors.yellow:this._colors.green;var objs=[];var args=[null];var msg="%c%s "+emoji+" %c%s";args.push(color(this._colors.brightBlack),time);args.push(color(this._colors.magenta),name);for(var i=1,len=arguments.length;i<len;i++){var arg=arguments[i];if(typeof arg==="string"){if(i===1){msg+=" %c%s";args.push(color(msgColor));args.push(arg)}else if(/ms$/.test(arg)){msg+=" %c%s";args.push(color(this._colors.brightBlack));args.push(arg)}else{msg+=" %c%s";args.push(color(this._colors.white));args.push(arg)}}else if(typeof arg==="number"){msg+=" %c%d";args.push(color(this._colors.magenta));args.push(arg)}else{objs.push(arg)}}args[0]=msg;objs.forEach(function(obj){args.push(obj)});Function.prototype.apply.apply(console.log,[console,args])};function color(color){return"color: "+color+";"}function getTimeStamp(){var date=new Date;var hours=pad(date.getHours().toString());var minutes=pad(date.getMinutes().toString());var seconds=pad(date.getSeconds().toString());return hours+":"+minutes+":"+seconds}function pad(str){return str.length!==2?0+str:str}},{assert:5,xtend:574}],235:[function(require,module,exports){var assert=require("assert");var morph=require("./lib/morph");var TEXT_NODE=3;module.exports=nanomorph;function nanomorph(oldTree,newTree){assert.equal(typeof oldTree,"object","nanomorph: oldTree should be an object");assert.equal(typeof newTree,"object","nanomorph: newTree should be an object");var tree=walk(newTree,oldTree);return tree}function walk(newNode,oldNode){if(!oldNode){return newNode}else if(!newNode){return null}else if(newNode.isSameNode&&newNode.isSameNode(oldNode)){return oldNode}else if(newNode.tagName!==oldNode.tagName){return newNode}else{morph(newNode,oldNode);updateChildren(newNode,oldNode);return oldNode}}function updateChildren(newNode,oldNode){var oldChild,newChild,morphed,oldMatch;var offset=0;for(var i=0;;i++){oldChild=oldNode.childNodes[i];newChild=newNode.childNodes[i-offset];if(!oldChild&&!newChild){break}else if(!newChild){oldNode.removeChild(oldChild);i--}else if(!oldChild){oldNode.appendChild(newChild);offset++}else if(same(newChild,oldChild)){morphed=walk(newChild,oldChild);if(morphed!==oldChild){oldNode.replaceChild(morphed,oldChild);offset++}}else{oldMatch=null;for(var j=i;j<oldNode.childNodes.length;j++){if(same(oldNode.childNodes[j],newChild)){oldMatch=oldNode.childNodes[j];break}}if(oldMatch){morphed=walk(newChild,oldMatch);if(morphed!==oldMatch)offset++;oldNode.insertBefore(morphed,oldChild)}else if(!newChild.id&&!oldChild.id){morphed=walk(newChild,oldChild);if(morphed!==oldChild){oldNode.replaceChild(morphed,oldChild);offset++}}else{oldNode.insertBefore(newChild,oldChild);offset++}}}}function same(a,b){if(a.id)return a.id===b.id;if(a.isSameNode)return a.isSameNode(b);if(a.tagName!==b.tagName)return false;if(a.type===TEXT_NODE)return a.nodeValue===b.nodeValue;return false}},{"./lib/morph":237,assert:229}],236:[function(require,module,exports){module.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"]},{}],237:[function(require,module,exports){var events=require("./events");var eventsLength=events.length;var ELEMENT_NODE=1;var TEXT_NODE=3;var COMMENT_NODE=8;module.exports=morph;function morph(newNode,oldNode){var nodeType=newNode.nodeType;var nodeName=newNode.nodeName;if(nodeType===ELEMENT_NODE){copyAttrs(newNode,oldNode)}if(nodeType===TEXT_NODE||nodeType===COMMENT_NODE){if(oldNode.nodeValue!==newNode.nodeValue){oldNode.nodeValue=newNode.nodeValue}}if(nodeName==="INPUT")updateInput(newNode,oldNode);else if(nodeName==="OPTION")updateOption(newNode,oldNode);else if(nodeName==="TEXTAREA")updateTextarea(newNode,oldNode);copyEvents(newNode,oldNode)}function copyAttrs(newNode,oldNode){var oldAttrs=oldNode.attributes;var newAttrs=newNode.attributes;var attrNamespaceURI=null;var attrValue=null;var fromValue=null;var attrName=null;var attr=null;for(var i=newAttrs.length-1;i>=0;--i){attr=newAttrs[i];attrName=attr.name;attrNamespaceURI=attr.namespaceURI;attrValue=attr.value;if(attrNamespaceURI){attrName=attr.localName||attrName;fromValue=oldNode.getAttributeNS(attrNamespaceURI,attrName);if(fromValue!==attrValue){oldNode.setAttributeNS(attrNamespaceURI,attrName,attrValue)}}else{if(!oldNode.hasAttribute(attrName)){oldNode.setAttribute(attrName,attrValue)}else{fromValue=oldNode.getAttribute(attrName);if(fromValue!==attrValue){if(attrValue==="null"||attrValue==="undefined"){oldNode.removeAttribute(attrName)}else{oldNode.setAttribute(attrName,attrValue)}}}}}for(var j=oldAttrs.length-1;j>=0;--j){attr=oldAttrs[j];if(attr.specified!==false){attrName=attr.name;attrNamespaceURI=attr.namespaceURI;if(attrNamespaceURI){attrName=attr.localName||attrName;if(!newNode.hasAttributeNS(attrNamespaceURI,attrName)){oldNode.removeAttributeNS(attrNamespaceURI,attrName)}}else{if(!newNode.hasAttributeNS(null,attrName)){oldNode.removeAttribute(attrName)}}}}}function copyEvents(newNode,oldNode){for(var i=0;i<eventsLength;i++){var ev=events[i];if(newNode[ev]){oldNode[ev]=newNode[ev]}else if(oldNode[ev]){oldNode[ev]=undefined}}}function updateOption(newNode,oldNode){updateAttribute(newNode,oldNode,"selected")}function updateInput(newNode,oldNode){var newValue=newNode.value;var oldValue=oldNode.value;updateAttribute(newNode,oldNode,"checked");updateAttribute(newNode,oldNode,"disabled");if(newValue!==oldValue){oldNode.setAttribute("value",newValue);oldNode.value=newValue}if(newValue==="null"){oldNode.value="";oldNode.removeAttribute("value")}if(!newNode.hasAttributeNS(null,"value")){oldNode.removeAttribute("value")}else if(oldNode.type==="range"){oldNode.value=newValue}}function updateTextarea(newNode,oldNode){var newValue=newNode.value;if(newValue!==oldNode.value){oldNode.value=newValue}if(oldNode.firstChild&&oldNode.firstChild.nodeValue!==newValue){if(newValue===""&&oldNode.firstChild.nodeValue===oldNode.placeholder){return}oldNode.firstChild.nodeValue=newValue}}function updateAttribute(newNode,oldNode,name){if(newNode[name]!==oldNode[name]){oldNode[name]=newNode[name];if(newNode[name]){oldNode.setAttribute(name,"")}else{oldNode.removeAttribute(name)}}}},{"./events":236}],238:[function(require,module,exports){var reg=new RegExp("([^?=&]+)(=([^&]*))?","g");var assert=require("assert");module.exports=qs;function qs(url){assert.equal(typeof url,"string","nanoquery: url should be type string");assert.ok(typeof window!=="undefined","nanoquery: expected window to exist");var obj={};url.replace(/^.*\?/,"").replace(reg,function(a0,a1,a2,a3){obj[window.decodeURIComponent(a1)]=window.decodeURIComponent(a3)});return obj}},{assert:5}],239:[function(require,module,exports){"use strict";var assert=require("assert");module.exports=nanoraf;function nanoraf(render,raf){assert.equal(typeof render,"function","nanoraf: render should be a function");assert.ok(typeof raf==="function"||typeof raf==="undefined","nanoraf: raf should be a function or undefined");if(!raf)raf=window.requestAnimationFrame;var redrawScheduled=false;var args=null;return function frame(){if(args===null&&!redrawScheduled){redrawScheduled=true;raf(function redraw(){redrawScheduled=false;var length=args.length;var _args=new Array(length);for(var i=0;i<length;i++)_args[i]=args[i];render.apply(render,_args);args=null})}args=arguments}}},{assert:5}],240:[function(require,module,exports){var wayfarer=require("wayfarer");var isLocalFile=/file:\/\//.test(typeof window==="object"&&window.location&&window.location.origin);var electron="^(file://|/)(.*.html?/?)?";var protocol="^(http(s)?(://))?(www.)?";var domain="[a-zA-Z0-9-_.]+(:[0-9]{1,5})?(/{1})?";var qs="[?].*$";var stripElectron=new RegExp(electron);var prefix=new RegExp(protocol+domain);var normalize=new RegExp("#");var suffix=new RegExp(qs);module.exports=Nanorouter;function Nanorouter(opts){opts=opts||{};var router=wayfarer(opts.default||"/404");var curry=opts.curry||false;var prevCallback=null;var prevRoute=null;emit.router=router;emit.on=on;return emit;function on(routename,listener){routename=routename.replace(/^[#/]/,"");router.on(routename,listener)}function emit(route){if(!curry){return router(route)}else{route=pathname(route,isLocalFile);if(route===prevRoute){return prevCallback()}else{prevRoute=route;prevCallback=router(route);return prevCallback()}}}}function pathname(route,isElectron){if(isElectron)route=route.replace(stripElectron,"");else route=route.replace(prefix,"");return route.replace(suffix,"").replace(normalize,"/")}},{wayfarer:558}],241:[function(require,module,exports){var assert=require("assert");var onIdle=require("./lib/on-idle");var perf;var disabled=true;try{perf=window.performance;disabled=window.localStorage.DISABLE_NANOTIMING==="true"||!perf.mark}catch(e){}module.exports=nanotiming;function nanotiming(name){assert.equal(typeof name,"string","nanotiming: name should be type string");if(disabled)return noop;var uuid=(perf.now()*100).toFixed();var startName="start-"+uuid+"-"+name;perf.mark(startName);function end(cb){var endName="end-"+uuid+"-"+name;perf.mark(endName);onIdle(function(){var measureName=name+" ["+uuid+"]";perf.measure(measureName,startName,endName);perf.clearMarks(startName);perf.clearMarks(endName);if(cb)cb(name)})}end.uuid=uuid;return end}function noop(cb){if(cb)onIdle(cb)}},{"./lib/on-idle":242,assert:5}],242:[function(require,module,exports){var assert=require("assert");var dftOpts={};var hasWindow=typeof window!=="undefined";var hasIdle=hasWindow&&window.requestIdleCallback;module.exports=onIdle;function onIdle(cb,opts){opts=opts||dftOpts;var timerId;assert.equal(typeof cb,"function","on-idle: cb should be type function");assert.equal(typeof opts,"object","on-idle: opts should be type object");if(hasIdle){timerId=window.requestIdleCallback(function(idleDeadline){if(idleDeadline.timeRemaining()<=10&&!idleDeadline.didTimeout){return onIdle(cb,opts)}else{cb(idleDeadline)}},opts);return window.cancelIdleCallback.bind(window,timerId)}else if(hasWindow){timerId=setTimeout(cb,0);return clearTimeout.bind(window,timerId)}}},{assert:5}],243:[function(require,module,exports){module.exports=[["#69d2e7","#a7dbd8","#e0e4cc","#f38630","#fa6900"],["#fe4365","#fc9d9a","#f9cdad","#c8c8a9","#83af9b"],["#ecd078","#d95b43","#c02942","#542437","#53777a"],["#556270","#4ecdc4","#c7f464","#ff6b6b","#c44d58"],["#774f38","#e08e79","#f1d4af","#ece5ce","#c5e0dc"],["#e8ddcb","#cdb380","#036564","#033649","#031634"],["#490a3d","#bd1550","#e97f02","#f8ca00","#8a9b0f"],["#594f4f","#547980","#45ada8","#9de0ad","#e5fcc2"],["#00a0b0","#6a4a3c","#cc333f","#eb6841","#edc951"],["#e94e77","#d68189","#c6a49a","#c6e5d9","#f4ead5"],["#3fb8af","#7fc7af","#dad8a7","#ff9e9d","#ff3d7f"],["#d9ceb2","#948c75","#d5ded9","#7a6a53","#99b2b7"],["#ffffff","#cbe86b","#f2e9e1","#1c140d","#cbe86b"],["#efffcd","#dce9be","#555152","#2e2633","#99173c"],["#343838","#005f6b","#008c9e","#00b4cc","#00dffc"],["#413e4a","#73626e","#b38184","#f0b49e","#f7e4be"],["#ff4e50","#fc913a","#f9d423","#ede574","#e1f5c4"],["#99b898","#fecea8","#ff847c","#e84a5f","#2a363b"],["#655643","#80bca3","#f6f7bd","#e6ac27","#bf4d28"],["#00a8c6","#40c0cb","#f9f2e7","#aee239","#8fbe00"],["#351330","#424254","#64908a","#e8caa4","#cc2a41"],["#554236","#f77825","#d3ce3d","#f1efa5","#60b99a"],["#ff9900","#424242","#e9e9e9","#bcbcbc","#3299bb"],["#5d4157","#838689","#a8caba","#cad7b2","#ebe3aa"],["#8c2318","#5e8c6a","#88a65e","#bfb35a","#f2c45a"],["#fad089","#ff9c5b","#f5634a","#ed303c","#3b8183"],["#ff4242","#f4fad2","#d4ee5e","#e1edb9","#f0f2eb"],["#d1e751","#ffffff","#000000","#4dbce9","#26ade4"],["#f8b195","#f67280","#c06c84","#6c5b7b","#355c7d"],["#1b676b","#519548","#88c425","#bef202","#eafde6"],["#bcbdac","#cfbe27","#f27435","#f02475","#3b2d38"],["#5e412f","#fcebb6","#78c0a8","#f07818","#f0a830"],["#452632","#91204d","#e4844a","#e8bf56","#e2f7ce"],["#eee6ab","#c5bc8e","#696758","#45484b","#36393b"],["#f0d8a8","#3d1c00","#86b8b1","#f2d694","#fa2a00"],["#f04155","#ff823a","#f2f26f","#fff7bd","#95cfb7"],["#2a044a","#0b2e59","#0d6759","#7ab317","#a0c55f"],["#bbbb88","#ccc68d","#eedd99","#eec290","#eeaa88"],["#b9d7d9","#668284","#2a2829","#493736","#7b3b3b"],["#b3cc57","#ecf081","#ffbe40","#ef746f","#ab3e5b"],["#a3a948","#edb92e","#f85931","#ce1836","#009989"],["#67917a","#170409","#b8af03","#ccbf82","#e33258"],["#e8d5b7","#0e2430","#fc3a51","#f5b349","#e8d5b9"],["#aab3ab","#c4cbb7","#ebefc9","#eee0b7","#e8caaf"],["#300030","#480048","#601848","#c04848","#f07241"],["#ab526b","#bca297","#c5ceae","#f0e2a4","#f4ebc3"],["#607848","#789048","#c0d860","#f0f0d8","#604848"],["#a8e6ce","#dcedc2","#ffd3b5","#ffaaa6","#ff8c94"],["#3e4147","#fffedf","#dfba69","#5a2e2e","#2a2c31"],["#b6d8c0","#c8d9bf","#dadabd","#ecdbbc","#fedcba"],["#fc354c","#29221f","#13747d","#0abfbc","#fcf7c5"],["#1c2130","#028f76","#b3e099","#ffeaad","#d14334"],["#edebe6","#d6e1c7","#94c7b6","#403b33","#d3643b"],["#cc0c39","#e6781e","#c8cf02","#f8fcc1","#1693a7"],["#dad6ca","#1bb0ce","#4f8699","#6a5e72","#563444"],["#a7c5bd","#e5ddcb","#eb7b59","#cf4647","#524656"],["#fdf1cc","#c6d6b8","#987f69","#e3ad40","#fcd036"],["#5c323e","#a82743","#e15e32","#c0d23e","#e5f04c"],["#230f2b","#f21d41","#ebebbc","#bce3c5","#82b3ae"],["#b9d3b0","#81bda4","#b28774","#f88f79","#f6aa93"],["#3a111c","#574951","#83988e","#bcdea5","#e6f9bc"],["#5e3929","#cd8c52","#b7d1a3","#dee8be","#fcf7d3"],["#1c0113","#6b0103","#a30006","#c21a01","#f03c02"],["#382f32","#ffeaf2","#fcd9e5","#fbc5d8","#f1396d"],["#e3dfba","#c8d6bf","#93ccc6","#6cbdb5","#1a1f1e"],["#000000","#9f111b","#b11623","#292c37","#cccccc"],["#c1b398","#605951","#fbeec2","#61a6ab","#accec0"],["#8dccad","#988864","#fea6a2","#f9d6ac","#ffe9af"],["#f6f6f6","#e8e8e8","#333333","#990100","#b90504"],["#1b325f","#9cc4e4","#e9f2f9","#3a89c9","#f26c4f"],["#5e9fa3","#dcd1b4","#fab87f","#f87e7b","#b05574"],["#951f2b","#f5f4d7","#e0dfb1","#a5a36c","#535233"],["#413d3d","#040004","#c8ff00","#fa023c","#4b000f"],["#eff3cd","#b2d5ba","#61ada0","#248f8d","#605063"],["#2d2d29","#215a6d","#3ca2a2","#92c7a3","#dfece6"],["#cfffdd","#b4dec1","#5c5863","#a85163","#ff1f4c"],["#4e395d","#827085","#8ebe94","#ccfc8e","#dc5b3e"],["#9dc9ac","#fffec7","#f56218","#ff9d2e","#919167"],["#a1dbb2","#fee5ad","#faca66","#f7a541","#f45d4c"],["#ffefd3","#fffee4","#d0ecea","#9fd6d2","#8b7a5e"],["#a8a7a7","#cc527a","#e8175d","#474747","#363636"],["#ffedbf","#f7803c","#f54828","#2e0d23","#f8e4c1"],["#f8edd1","#d88a8a","#474843","#9d9d93","#c5cfc6"],["#f38a8a","#55443d","#a0cab5","#cde9ca","#f1edd0"],["#4e4d4a","#353432","#94ba65","#2790b0","#2b4e72"],["#0ca5b0","#4e3f30","#fefeeb","#f8f4e4","#a5b3aa"],["#a70267","#f10c49","#fb6b41","#f6d86b","#339194"],["#9d7e79","#ccac95","#9a947c","#748b83","#5b756c"],["#edf6ee","#d1c089","#b3204d","#412e28","#151101"],["#046d8b","#309292","#2fb8ac","#93a42a","#ecbe13"],["#4d3b3b","#de6262","#ffb88c","#ffd0b3","#f5e0d3"],["#fffbb7","#a6f6af","#66b6ab","#5b7c8d","#4f2958"],["#ff003c","#ff8a00","#fabe28","#88c100","#00c176"],["#fcfef5","#e9ffe1","#cdcfb7","#d6e6c3","#fafbe3"],["#9cddc8","#bfd8ad","#ddd9ab","#f7af63","#633d2e"],["#30261c","#403831","#36544f","#1f5f61","#0b8185"],["#d1313d","#e5625c","#f9bf76","#8eb2c5","#615375"],["#ffe181","#eee9e5","#fad3b2","#ffba7f","#ff9c97"],["#aaff00","#ffaa00","#ff00aa","#aa00ff","#00aaff"],["#c2412d","#d1aa34","#a7a844","#a46583","#5a1e4a"]]},{}],244:[function(require,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],245:[function(require,module,exports){var assert=require("assert");module.exports=objectChangeCallsite;function objectChangeCallsite(target,callback){assert.equal(typeof target,"object","object-change-callsite: target should be type object");assert.equal(typeof callback,"function","object-change-callsite: callback should be type function");return new Proxy(target,{set:function(obj,prop,value){var err=new Error;var trace=strip(err.stack);callback(prop,value,trace);obj[prop]=value;return true},deleteProperty:function(target,prop){var err=new Error;var trace=strip(err.stack);callback(prop,undefined,trace);if(prop in target){delete target[prop];return true}return false}})}function strip(str){var arr=str.split("\n");arr=arr.slice(2);arr[0]=arr[0].replace(/^ {4}at /,"");return"\n"+arr.join("\n")}},{assert:5}],246:[function(require,module,exports){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj){if(has.call(obj,key)){keys.push(key)}}return keys};exports.values=function(obj){var vals=[];for(var key in obj){if(has.call(obj,key)){vals.push(obj[key])}}return vals};exports.merge=function(a,b){for(var key in b){if(has.call(b,key)){a[key]=b[key]}}return a};exports.length=function(obj){return exports.keys(obj).length};exports.isEmpty=function(obj){return 0==exports.length(obj)}},{}],247:[function(require,module,exports){var assert=require("assert");var dftOpts={};var hasWindow=typeof window!=="undefined";var hasIdle=hasWindow&&window.requestIdleCallback;module.exports=onIdle;function onIdle(cb,opts){opts=opts||dftOpts;var timerId;assert.equal(typeof cb,"function","on-idle: cb should be type function");assert.equal(typeof opts,"object","on-idle: opts should be type object");if(hasIdle){timerId=window.requestIdleCallback(function(idleDeadline){if(idleDeadline.timeRemaining()<=1&&!idleDeadline.didTimeout){return onIdle(cb,opts)}else{cb(idleDeadline)}},opts);return window.cancelIdleCallback.bind(window,timerId)}else if(hasWindow){timerId=setTimeout(cb,0);return clearTimeout.bind(window,timerId)}}},{assert:229}],248:[function(require,module,exports){var document=require("global/document");var window=require("global/window");var assert=require("assert");var watch=Object.create(null);var KEY_ID="onloadid"+(new Date%9e6).toString(36);var KEY_ATTR="data-"+KEY_ID;var INDEX=0;if(window&&window.MutationObserver){var observer=new MutationObserver(function(mutations){if(Object.keys(watch).length<1)return;for(var i=0;i<mutations.length;i++){if(mutations[i].attributeName===KEY_ATTR){eachAttr(mutations[i],turnon,turnoff);continue}eachMutation(mutations[i].removedNodes,turnoff);eachMutation(mutations[i].addedNodes,turnon)}});if(document.body){beginObserve(observer)}else{document.addEventListener("DOMContentLoaded",function(event){beginObserve(observer)})}}function beginObserve(observer){observer.observe(document.body,{childList:true,subtree:true,attributes:true,attributeOldValue:true,attributeFilter:[KEY_ATTR]})}module.exports=function onload(el,on,off,caller){assert(document.body,"on-load: will not work prior to DOMContentLoaded");on=on||function(){};off=off||function(){};el.setAttribute(KEY_ATTR,"o"+INDEX);watch["o"+INDEX]=[on,off,0,caller||onload.caller];INDEX+=1;return el};module.exports.KEY_ATTR=KEY_ATTR;module.exports.KEY_ID=KEY_ID;function turnon(index,el){if(watch[index][0]&&watch[index][2]===0){watch[index][0](el);watch[index][2]=1}}function turnoff(index,el){if(watch[index][1]&&watch[index][2]===1){watch[index][1](el);watch[index][2]=0}}function eachAttr(mutation,on,off){var newValue=mutation.target.getAttribute(KEY_ATTR);if(sameOrigin(mutation.oldValue,newValue)){watch[newValue]=watch[mutation.oldValue];return}if(watch[mutation.oldValue]){off(mutation.oldValue,mutation.target)}if(watch[newValue]){on(newValue,mutation.target)}}function sameOrigin(oldValue,newValue){if(!oldValue||!newValue)return false;return watch[oldValue][3]===watch[newValue][3]}function eachMutation(nodes,fn){var keys=Object.keys(watch);for(var i=0;i<nodes.length;i++){if(nodes[i]&&nodes[i].getAttribute&&nodes[i].getAttribute(KEY_ATTR)){var onloadid=nodes[i].getAttribute(KEY_ATTR);keys.forEach(function(k){if(onloadid===k){fn(k,nodes[i])}})}if(nodes[i].childNodes.length>0){eachMutation(nodes[i].childNodes,fn)}}}},{assert:229,"global/document":204,"global/window":205}],249:[function(require,module,exports){var onIdle=require("on-idle");var assert=require("assert");module.exports=onPerformance;function onPerformance(cb){assert.equal(typeof cb,"function","on-performance: cb should be type function");var PerformanceObserver=typeof window!=="undefined"&&window.PerformanceObserver;if(!PerformanceObserver)return;var observer=new PerformanceObserver(handler);observer.observe({entryTypes:["frame","measure","navigation","resource","longtask"]});window.performance.getEntries().forEach(function(entry){onIdle(function(){cb(entry);clear(entry)})});function handler(list){list.getEntries().forEach(function(entry){onIdle(function(){cb(entry);clear(entry)})})}window["obs"+window.performance.now()]=observer;return observer.disconnect.bind(observer);function clear(entry){var type=entry.entryType;if(type==="measure"){window.performance.clearMeasures(entry.name)}else if(type==="resource"){window.performance.clearResourceTimings()}}}},{assert:5,"on-idle":247}],250:[function(require,module,exports){"use strict";module.exports=function parseURI(str,opts){opts=opts||{};var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var m=o.parser[opts.strictMode?"strict":"loose"].exec(str);var uri={};var i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2});return uri}},{}],251:[function(require,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/;var rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g;var rtrimLeft=/^\s+/;var rtrimRight=/\s+$/;module.exports=function parsejson(data){if("string"!=typeof data||!data){return null}data=data.replace(rtrimLeft,"").replace(rtrimRight,"");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],252:[function(require,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],253:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}return uri}},{}],254:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:423}],255:[function(require,module,exports){var EMPTY_ARRAY_BUFFER=new ArrayBuffer(0);var Buffer=function(gl,type,data,drawType){this.gl=gl;this.buffer=gl.createBuffer();this.type=type||gl.ARRAY_BUFFER;this.drawType=drawType||gl.STATIC_DRAW;this.data=EMPTY_ARRAY_BUFFER;if(data){this.upload(data)}this._updateID=0};Buffer.prototype.upload=function(data,offset,dontBind){if(!dontBind)this.bind();var gl=this.gl;data=data||this.data;offset=offset||0;if(this.data.byteLength>=data.byteLength){gl.bufferSubData(this.type,offset,data)}else{gl.bufferData(this.type,data,this.drawType)}this.data=data};Buffer.prototype.bind=function(){var gl=this.gl;gl.bindBuffer(this.type,this.buffer)};Buffer.createVertexBuffer=function(gl,data,drawType){return new Buffer(gl,gl.ARRAY_BUFFER,data,drawType)};Buffer.createIndexBuffer=function(gl,data,drawType){return new Buffer(gl,gl.ELEMENT_ARRAY_BUFFER,data,drawType)};Buffer.create=function(gl,type,data,drawType){return new Buffer(gl,type,data,drawType)};Buffer.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};module.exports=Buffer},{}],256:[function(require,module,exports){var Texture=require("./GLTexture");var Framebuffer=function(gl,width,height){this.gl=gl;this.framebuffer=gl.createFramebuffer();this.stencil=null;this.texture=null;this.width=width||100;this.height=height||100};Framebuffer.prototype.enableTexture=function(texture){var gl=this.gl;this.texture=texture||new Texture(gl);this.texture.bind();this.bind();gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture.texture,0)};Framebuffer.prototype.enableStencil=function(){if(this.stencil)return;var gl=this.gl;this.stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencil);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,this.width,this.height)};Framebuffer.prototype.clear=function(r,g,b,a){this.bind();var gl=this.gl;gl.clearColor(r,g,b,a);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)};Framebuffer.prototype.bind=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer)};Framebuffer.prototype.unbind=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null)};Framebuffer.prototype.resize=function(width,height){var gl=this.gl;this.width=width;this.height=height;if(this.texture){this.texture.uploadData(null,width,height)}if(this.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width,height)}};Framebuffer.prototype.destroy=function(){var gl=this.gl;if(this.texture){this.texture.destroy()}gl.deleteFramebuffer(this.framebuffer);this.gl=null;this.stencil=null;this.texture=null};Framebuffer.createRGBA=function(gl,width,height,data){var texture=Texture.fromData(gl,null,width,height);texture.enableNearestScaling();texture.enableWrapClamp();var fbo=new Framebuffer(gl,width,height);fbo.enableTexture(texture);fbo.unbind();return fbo};Framebuffer.createFloat32=function(gl,width,height,data){var texture=new Texture.fromData(gl,data,width,height);texture.enableNearestScaling();texture.enableWrapClamp();var fbo=new Framebuffer(gl,width,height);fbo.enableTexture(texture);fbo.unbind();return fbo};module.exports=Framebuffer},{"./GLTexture":258}],257:[function(require,module,exports){var compileProgram=require("./shader/compileProgram"),extractAttributes=require("./shader/extractAttributes"),extractUniforms=require("./shader/extractUniforms"),setPrecision=require("./shader/setPrecision"),generateUniformAccessObject=require("./shader/generateUniformAccessObject");var Shader=function(gl,vertexSrc,fragmentSrc,precision,attributeLocations){this.gl=gl;if(precision){vertexSrc=setPrecision(vertexSrc,precision);fragmentSrc=setPrecision(fragmentSrc,precision)}this.program=compileProgram(gl,vertexSrc,fragmentSrc,attributeLocations);this.attributes=extractAttributes(gl,this.program);this.uniformData=extractUniforms(gl,this.program);this.uniforms=generateUniformAccessObject(gl,this.uniformData)};Shader.prototype.bind=function(){this.gl.useProgram(this.program)};Shader.prototype.destroy=function(){this.attributes=null;this.uniformData=null;this.uniforms=null;var gl=this.gl;gl.deleteProgram(this.program)};module.exports=Shader},{"./shader/compileProgram":263,"./shader/extractAttributes":265,"./shader/extractUniforms":266,"./shader/generateUniformAccessObject":267,"./shader/setPrecision":271}],258:[function(require,module,exports){var Texture=function(gl,width,height,format,type){this.gl=gl;this.texture=gl.createTexture();this.mipmap=false;this.premultiplyAlpha=false;this.width=width||-1;this.height=height||-1;this.format=format||gl.RGBA;this.type=type||gl.UNSIGNED_BYTE};Texture.prototype.upload=function(source){this.bind();var gl=this.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var newWidth=source.videoWidth||source.width;var newHeight=source.videoHeight||source.height;if(newHeight!==this.height||newWidth!==this.width){gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.format,this.type,source)}else{gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.format,this.type,source)}this.width=newWidth;this.height=newHeight};var FLOATING_POINT_AVAILABLE=false;Texture.prototype.uploadData=function(data,width,height){this.bind();var gl=this.gl;if(data instanceof Float32Array){if(!FLOATING_POINT_AVAILABLE){var ext=gl.getExtension("OES_texture_float");if(ext){FLOATING_POINT_AVAILABLE=true}else{throw new Error("floating point textures not available")}}this.type=gl.FLOAT}else{this.type=this.type||gl.UNSIGNED_BYTE}gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);if(width!==this.width||height!==this.height){gl.texImage2D(gl.TEXTURE_2D,0,this.format,width,height,0,this.format,this.type,data||null)}else{gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,width,height,this.format,this.type,data||null)}this.width=width;this.height=height};Texture.prototype.bind=function(location){var gl=this.gl;if(location!==undefined){gl.activeTexture(gl.TEXTURE0+location)}gl.bindTexture(gl.TEXTURE_2D,this.texture)};Texture.prototype.unbind=function(){var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,null)};Texture.prototype.minFilter=function(linear){var gl=this.gl;this.bind();if(this.mipmap){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linear?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linear?gl.LINEAR:gl.NEAREST)}};Texture.prototype.magFilter=function(linear){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,linear?gl.LINEAR:gl.NEAREST)};Texture.prototype.enableMipmap=function(){var gl=this.gl;this.bind();this.mipmap=true;gl.generateMipmap(gl.TEXTURE_2D)};Texture.prototype.enableLinearScaling=function(){this.minFilter(true);this.magFilter(true)};Texture.prototype.enableNearestScaling=function(){this.minFilter(false);this.magFilter(false)};Texture.prototype.enableWrapClamp=function(){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)};Texture.prototype.enableWrapRepeat=function(){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)};Texture.prototype.enableWrapMirrorRepeat=function(){var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.MIRRORED_REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.MIRRORED_REPEAT)};Texture.prototype.destroy=function(){var gl=this.gl;gl.deleteTexture(this.texture)};Texture.fromSource=function(gl,source,premultiplyAlpha){var texture=new Texture(gl);texture.premultiplyAlpha=premultiplyAlpha||false;texture.upload(source);return texture};Texture.fromData=function(gl,data,width,height){var texture=new Texture(gl);texture.uploadData(data,width,height);return texture};module.exports=Texture},{}],259:[function(require,module,exports){var setVertexAttribArrays=require("./setVertexAttribArrays");function VertexArrayObject(gl,state){this.nativeVaoExtension=null;if(!VertexArrayObject.FORCE_NATIVE){this.nativeVaoExtension=gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object")}this.nativeState=state;if(this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var maxAttribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(maxAttribs),attribState:new Array(maxAttribs)}}this.gl=gl;this.attributes=[];this.indexBuffer=null;this.dirty=false}VertexArrayObject.prototype.constructor=VertexArrayObject;module.exports=VertexArrayObject;VertexArrayObject.FORCE_NATIVE=false;VertexArrayObject.prototype.bind=function(){if(this.nativeVao){this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);if(this.dirty){this.dirty=false;this.activate()}}else{this.activate()}return this};VertexArrayObject.prototype.unbind=function(){if(this.nativeVao){this.nativeVaoExtension.bindVertexArrayOES(null)}return this};VertexArrayObject.prototype.activate=function(){var gl=this.gl;var lastBuffer=null;for(var i=0;i<this.attributes.length;i++){var attrib=this.attributes[i];if(lastBuffer!==attrib.buffer){attrib.buffer.bind();lastBuffer=attrib.buffer}gl.vertexAttribPointer(attrib.attribute.location,attrib.attribute.size,attrib.type||gl.FLOAT,attrib.normalized||false,attrib.stride||0,attrib.start||0)}setVertexAttribArrays(gl,this.attributes,this.nativeState);if(this.indexBuffer){this.indexBuffer.bind()}return this};VertexArrayObject.prototype.addAttribute=function(buffer,attribute,type,normalized,stride,start){this.attributes.push({buffer:buffer,attribute:attribute,location:attribute.location,type:type||this.gl.FLOAT,normalized:normalized||false,stride:stride||0,start:start||0});this.dirty=true;return this};VertexArrayObject.prototype.addIndex=function(buffer){this.indexBuffer=buffer;this.dirty=true;return this};VertexArrayObject.prototype.clear=function(){if(this.nativeVao){this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao)}this.attributes.length=0;this.indexBuffer=null;return this};VertexArrayObject.prototype.draw=function(type,size,start){var gl=this.gl;if(this.indexBuffer){gl.drawElements(type,size||this.indexBuffer.data.length,gl.UNSIGNED_SHORT,(start||0)*2)}else{gl.drawArrays(type,start,size||this.getSize())}return this};VertexArrayObject.prototype.destroy=function(){this.gl=null;this.indexBuffer=null;this.attributes=null;this.nativeState=null;if(this.nativeVao){this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao)}this.nativeVaoExtension=null;this.nativeVao=null};VertexArrayObject.prototype.getSize=function(){var attrib=this.attributes[0];return attrib.buffer.data.length/(attrib.stride/4||attrib.attribute.size)}},{"./setVertexAttribArrays":262}],260:[function(require,module,exports){var createContext=function(canvas,options){var gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options);if(!gl){throw new Error("This browser does not support webGL. Try using the canvas renderer")}return gl};module.exports=createContext},{}],261:[function(require,module,exports){var gl={createContext:require("./createContext"),setVertexAttribArrays:require("./setVertexAttribArrays"),GLBuffer:require("./GLBuffer"),GLFramebuffer:require("./GLFramebuffer"),GLShader:require("./GLShader"),GLTexture:require("./GLTexture"),VertexArrayObject:require("./VertexArrayObject"),shader:require("./shader")};if(typeof module!=="undefined"&&module.exports){module.exports=gl}if(typeof window!=="undefined"){window.PIXI=window.PIXI||{};window.PIXI.glCore=gl}},{"./GLBuffer":255,"./GLFramebuffer":256,"./GLShader":257,"./GLTexture":258,"./VertexArrayObject":259,"./createContext":260,"./setVertexAttribArrays":262,"./shader":268}],262:[function(require,module,exports){var setVertexAttribArrays=function(gl,attribs,state){var i;if(state){var tempAttribState=state.tempAttribState,attribState=state.attribState;for(i=0;i<tempAttribState.length;i++){tempAttribState[i]=false}for(i=0;i<attribs.length;i++){tempAttribState[attribs[i].attribute.location]=true}for(i=0;i<attribState.length;i++){if(attribState[i]!==tempAttribState[i]){attribState[i]=tempAttribState[i];if(state.attribState[i]){gl.enableVertexAttribArray(i)}else{gl.disableVertexAttribArray(i)}}}}else{for(i=0;i<attribs.length;i++){var attrib=attribs[i];gl.enableVertexAttribArray(attrib.attribute.location)}}};module.exports=setVertexAttribArrays},{}],263:[function(require,module,exports){var compileProgram=function(gl,vertexSrc,fragmentSrc,attributeLocations){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,vertexSrc);var glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,fragmentSrc);var program=gl.createProgram();gl.attachShader(program,glVertShader);gl.attachShader(program,glFragShader);if(attributeLocations){for(var i in attributeLocations){gl.bindAttribLocation(program,attributeLocations[i],i)}}gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Pixi.js Error: Could not initialize shader.");console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS));console.error("gl.getError()",gl.getError());if(gl.getProgramInfoLog(program)!==""){console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program))}gl.deleteProgram(program);program=null}gl.deleteShader(glVertShader);gl.deleteShader(glFragShader);return program};var compileShader=function(gl,type,src){var shader=gl.createShader(type);gl.shaderSource(shader,src);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.log(gl.getShaderInfoLog(shader));return null}return shader};module.exports=compileProgram},{}],264:[function(require,module,exports){var defaultValue=function(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"bool":return false;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}};var booleanArray=function(size){var array=new Array(size);for(var i=0;i<array.length;i++){array[i]=false}return array};module.exports=defaultValue},{}],265:[function(require,module,exports){var mapType=require("./mapType");var mapSize=require("./mapSize");var extractAttributes=function(gl,program){var attributes={};var totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);var type=mapType(gl,attribData.type);attributes[attribData.name]={type:type,size:mapSize(type),location:gl.getAttribLocation(program,attribData.name),pointer:pointer}}return attributes};var pointer=function(type,normalized,stride,start){gl.vertexAttribPointer(this.location,this.size,type||gl.FLOAT,normalized||false,stride||0,start||0)};module.exports=extractAttributes},{"./mapSize":269,"./mapType":270}],266:[function(require,module,exports){var mapType=require("./mapType");var defaultValue=require("./defaultValue");var extractUniforms=function(gl,program){var uniforms={};var totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i);var name=uniformData.name.replace(/\[.*?\]/,"");var type=mapType(gl,uniformData.type);uniforms[name]={type:type,size:uniformData.size,location:gl.getUniformLocation(program,name),value:defaultValue(type,uniformData.size)}}return uniforms};module.exports=extractUniforms},{"./defaultValue":264,"./mapType":270}],267:[function(require,module,exports){var generateUniformAccessObject=function(gl,uniformData){var uniforms={data:{}};uniforms.gl=gl;var uniformKeys=Object.keys(uniformData);for(var i=0;i<uniformKeys.length;i++){var fullName=uniformKeys[i];var nameTokens=fullName.split(".");var name=nameTokens[nameTokens.length-1];var uniformGroup=getUniformGroup(nameTokens,uniforms);var uniform=uniformData[fullName];uniformGroup.data[name]=uniform;uniformGroup.gl=gl;Object.defineProperty(uniformGroup,name,{get:generateGetter(name),set:generateSetter(name,uniform)})}return uniforms};var generateGetter=function(name){var template=getterTemplate.replace("%%",name);return new Function(template)};var generateSetter=function(name,uniform){var template=setterTemplate.replace(/%%/g,name);var setTemplate;if(uniform.size===1){setTemplate=GLSL_TO_SINGLE_SETTERS[uniform.type]}else{setTemplate=GLSL_TO_ARRAY_SETTERS[uniform.type]}if(setTemplate){template+="\nthis.gl."+setTemplate+";"}return new Function("value",template)};var getUniformGroup=function(nameTokens,uniform){var cur=uniform;for(var i=0;i<nameTokens.length-1;i++){var o=cur[nameTokens[i]]||{data:{}};cur[nameTokens[i]]=o;cur=o}return cur};var getterTemplate=["return this.data.%%.value;"].join("\n");var setterTemplate=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n");var GLSL_TO_SINGLE_SETTERS={float:"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])",int:"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"};var GLSL_TO_ARRAY_SETTERS={float:"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)",int:"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"};module.exports=generateUniformAccessObject},{}],268:[function(require,module,exports){module.exports={compileProgram:require("./compileProgram"),defaultValue:require("./defaultValue"),extractAttributes:require("./extractAttributes"),extractUniforms:require("./extractUniforms"),generateUniformAccessObject:require("./generateUniformAccessObject"),setPrecision:require("./setPrecision"),mapSize:require("./mapSize"),mapType:require("./mapType")}},{"./compileProgram":263,"./defaultValue":264,"./extractAttributes":265,"./extractUniforms":266,"./generateUniformAccessObject":267,"./mapSize":269,"./mapType":270,"./setPrecision":271}],269:[function(require,module,exports){var mapSize=function(type){return GLSL_TO_SIZE[type]};var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};module.exports=mapSize},{}],270:[function(require,module,exports){var mapSize=function(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]};var GL_TABLE=null;var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};module.exports=mapSize},{}],271:[function(require,module,exports){var setPrecision=function(src,precision){if(src.substring(0,9)!=="precision"){return"precision "+precision+" float;\n"+src}return src};module.exports=setPrecision},{}],272:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../core");var core=_interopRequireWildcard(_core);var _ismobilejs=require("ismobilejs");var _ismobilejs2=_interopRequireDefault(_ismobilejs);var _accessibleTarget=require("./accessibleTarget");var _accessibleTarget2=_interopRequireDefault(_accessibleTarget);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}core.utils.mixins.delayMixin(core.DisplayObject.prototype,_accessibleTarget2.default);var KEY_CODE_TAB=9;var DIV_TOUCH_SIZE=100;var DIV_TOUCH_POS_X=0;var DIV_TOUCH_POS_Y=0;var DIV_TOUCH_ZINDEX=2;var DIV_HOOK_SIZE=1;var DIV_HOOK_POS_X=-1e3;var DIV_HOOK_POS_Y=-1e3;var DIV_HOOK_ZINDEX=2;var AccessibilityManager=function(){function AccessibilityManager(renderer){_classCallCheck(this,AccessibilityManager);if((_ismobilejs2.default.tablet||_ismobilejs2.default.phone)&&!navigator.isCocoonJS){this.createTouchHook()}var div=document.createElement("div");div.style.width=DIV_TOUCH_SIZE+"px";div.style.height=DIV_TOUCH_SIZE+"px";div.style.position="absolute";div.style.top=DIV_TOUCH_POS_X+"px";div.style.left=DIV_TOUCH_POS_Y+"px";div.style.zIndex=DIV_TOUCH_ZINDEX;this.div=div;this.pool=[];this.renderId=0;this.debug=false;this.renderer=renderer;this.children=[];this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this.isActive=false;this.isMobileAccessabillity=false;window.addEventListener("keydown",this._onKeyDown,false)}AccessibilityManager.prototype.createTouchHook=function createTouchHook(){var _this=this;var hookDiv=document.createElement("button");hookDiv.style.width=DIV_HOOK_SIZE+"px";hookDiv.style.height=DIV_HOOK_SIZE+"px";hookDiv.style.position="absolute";hookDiv.style.top=DIV_HOOK_POS_X+"px";hookDiv.style.left=DIV_HOOK_POS_Y+"px";hookDiv.style.zIndex=DIV_HOOK_ZINDEX;hookDiv.style.backgroundColor="#FF0000";hookDiv.title="HOOK DIV";hookDiv.addEventListener("focus",function(){_this.isMobileAccessabillity=true;_this.activate();document.body.removeChild(hookDiv)});document.body.appendChild(hookDiv)};AccessibilityManager.prototype.activate=function activate(){if(this.isActive){return}this.isActive=true;window.document.addEventListener("mousemove",this._onMouseMove,true);window.removeEventListener("keydown",this._onKeyDown,false);this.renderer.on("postrender",this.update,this);if(this.renderer.view.parentNode){this.renderer.view.parentNode.appendChild(this.div)}};AccessibilityManager.prototype.deactivate=function deactivate(){if(!this.isActive||this.isMobileAccessabillity){return}this.isActive=false;window.document.removeEventListener("mousemove",this._onMouseMove);window.addEventListener("keydown",this._onKeyDown,false);this.renderer.off("postrender",this.update);if(this.div.parentNode){this.div.parentNode.removeChild(this.div)}};AccessibilityManager.prototype.updateAccessibleObjects=function updateAccessibleObjects(displayObject){if(!displayObject.visible){return}if(displayObject.accessible&&displayObject.interactive){if(!displayObject._accessibleActive){this.addChild(displayObject)}displayObject.renderId=this.renderId}var children=displayObject.children;for(var i=children.length-1;i>=0;i--){this.updateAccessibleObjects(children[i])}};AccessibilityManager.prototype.update=function update(){if(!this.renderer.renderingToScreen){return}this.updateAccessibleObjects(this.renderer._lastObjectRendered);var rect=this.renderer.view.getBoundingClientRect();var sx=rect.width/this.renderer.width;var sy=rect.height/this.renderer.height;var div=this.div;div.style.left=rect.left+"px";div.style.top=rect.top+"px";div.style.width=this.renderer.width+"px";div.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId){child._accessibleActive=false;core.utils.removeItems(this.children,i,1);this.div.removeChild(child._accessibleDiv);this.pool.push(child._accessibleDiv);child._accessibleDiv=null;i--;if(this.children.length===0){this.deactivate()}}else{div=child._accessibleDiv;var hitArea=child.hitArea;var wt=child.worldTransform;if(child.hitArea){div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px";div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px";div.style.width=hitArea.width*wt.a*sx+"px";div.style.height=hitArea.height*wt.d*sy+"px"}else{hitArea=child.getBounds();this.capHitArea(hitArea);div.style.left=hitArea.x*sx+"px";div.style.top=hitArea.y*sy+"px";div.style.width=hitArea.width*sx+"px";div.style.height=hitArea.height*sy+"px"}}}this.renderId++};AccessibilityManager.prototype.capHitArea=function capHitArea(hitArea){if(hitArea.x<0){hitArea.width+=hitArea.x;hitArea.x=0}if(hitArea.y<0){hitArea.height+=hitArea.y;hitArea.y=0}if(hitArea.x+hitArea.width>this.renderer.width){hitArea.width=this.renderer.width-hitArea.x}if(hitArea.y+hitArea.height>this.renderer.height){hitArea.height=this.renderer.height-hitArea.y}};AccessibilityManager.prototype.addChild=function addChild(displayObject){var div=this.pool.pop();if(!div){div=document.createElement("button");div.style.width=DIV_TOUCH_SIZE+"px";div.style.height=DIV_TOUCH_SIZE+"px";div.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent";div.style.position="absolute";div.style.zIndex=DIV_TOUCH_ZINDEX;div.style.borderStyle="none";div.addEventListener("click",this._onClick.bind(this));div.addEventListener("focus",this._onFocus.bind(this));div.addEventListener("focusout",this._onFocusOut.bind(this))}if(displayObject.accessibleTitle){div.title=displayObject.accessibleTitle}else if(!displayObject.accessibleTitle&&!displayObject.accessibleHint){div.title="displayObject "+this.tabIndex}if(displayObject.accessibleHint){div.setAttribute("aria-label",displayObject.accessibleHint)}displayObject._accessibleActive=true;displayObject._accessibleDiv=div;div.displayObject=displayObject;this.children.push(displayObject);this.div.appendChild(displayObject._accessibleDiv);displayObject._accessibleDiv.tabIndex=displayObject.tabIndex};AccessibilityManager.prototype._onClick=function _onClick(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"click",interactionManager.eventData)};AccessibilityManager.prototype._onFocus=function _onFocus(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseover",interactionManager.eventData)};AccessibilityManager.prototype._onFocusOut=function _onFocusOut(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseout",interactionManager.eventData)};AccessibilityManager.prototype._onKeyDown=function _onKeyDown(e){if(e.keyCode!==KEY_CODE_TAB){return}this.activate()};AccessibilityManager.prototype._onMouseMove=function _onMouseMove(){this.deactivate()};AccessibilityManager.prototype.destroy=function destroy(){this.div=null;for(var i=0;i<this.children.length;i++){this.children[i].div=null}window.document.removeEventListener("mousemove",this._onMouseMove);window.removeEventListener("keydown",this._onKeyDown);this.pool=null;this.children=null;this.renderer=null};return AccessibilityManager}();exports.default=AccessibilityManager;core.WebGLRenderer.registerPlugin("accessibility",AccessibilityManager);core.CanvasRenderer.registerPlugin("accessibility",AccessibilityManager)},{"../core":297,"./accessibleTarget":273,ismobilejs:220}],273:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default={accessible:false,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:false,_accessibleDiv:false}},{}],274:[function(require,module,exports){"use strict";exports.__esModule=true;var _accessibleTarget=require("./accessibleTarget");Object.defineProperty(exports,"accessibleTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_accessibleTarget).default}});var _AccessibilityManager=require("./AccessibilityManager");Object.defineProperty(exports,"AccessibilityManager",{enumerable:true,get:function get(){return _interopRequireDefault(_AccessibilityManager).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./AccessibilityManager":272,"./accessibleTarget":273}],275:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _autoDetectRenderer=require("./autoDetectRenderer");var _Container=require("./display/Container");var _Container2=_interopRequireDefault(_Container);var _ticker=require("./ticker");var _settings=require("./settings");var _settings2=_interopRequireDefault(_settings);var _const=require("./const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Application=function(){function Application(options,arg2,arg3,arg4,arg5){_classCallCheck(this,Application);if(typeof options==="number"){options=Object.assign({width:options,height:arg2||_settings2.default.RENDER_OPTIONS.height,forceCanvas:!!arg4,sharedTicker:!!arg5},arg3)}this._options=options=Object.assign({autoStart:true,sharedTicker:false,forceCanvas:false,sharedLoader:false},options);this.renderer=(0,_autoDetectRenderer.autoDetectRenderer)(options);this.stage=new _Container2.default;this._ticker=null;this.ticker=options.sharedTicker?_ticker.shared:new _ticker.Ticker;if(options.autoStart){this.start()}}Application.prototype.render=function render(){this.renderer.render(this.stage)};Application.prototype.stop=function stop(){this._ticker.stop()};Application.prototype.start=function start(){this._ticker.start()};Application.prototype.destroy=function destroy(removeView){var oldTicker=this._ticker;this.ticker=null;oldTicker.destroy();this.stage.destroy();this.stage=null;this.renderer.destroy(removeView);this.renderer=null;this._options=null};_createClass(Application,[{key:"ticker",set:function set(ticker){if(this._ticker){this._ticker.remove(this.render,this)}this._ticker=ticker;if(ticker){ticker.add(this.render,this,_const.UPDATE_PRIORITY.LOW)}},get:function get(){return this._ticker}},{key:"view",get:function get(){return this.renderer.view}},{key:"screen",get:function get(){return this.renderer.screen}}]);return Application}();exports.default=Application},{"./autoDetectRenderer":277,"./const":278,"./display/Container":280,"./settings":333,"./ticker":353}],276:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _settings=require("./settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function checkPrecision(src,def){if(src instanceof Array){if(src[0].substring(0,9)!=="precision"){var copy=src.slice(0);copy.unshift("precision "+def+" float;");return copy}}else if(src.substring(0,9)!=="precision"){return"precision "+def+" float;\n"+src}return src}var Shader=function(_GLShader){_inherits(Shader,_GLShader);function Shader(gl,vertexSrc,fragmentSrc){_classCallCheck(this,Shader);return _possibleConstructorReturn(this,_GLShader.call(this,gl,checkPrecision(vertexSrc,_settings2.default.PRECISION_VERTEX),checkPrecision(fragmentSrc,_settings2.default.PRECISION_FRAGMENT)))}return Shader}(_pixiGlCore.GLShader);exports.default=Shader},{"./settings":333,"pixi-gl-core":261}],277:[function(require,module,exports){"use strict";exports.__esModule=true;exports.autoDetectRenderer=autoDetectRenderer;var _utils=require("./utils");var utils=_interopRequireWildcard(_utils);var _CanvasRenderer=require("./renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _WebGLRenderer=require("./renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function autoDetectRenderer(options,arg1,arg2,arg3){var forceCanvas=options&&options.forceCanvas;if(arg3!==undefined){forceCanvas=arg3}if(!forceCanvas&&utils.isWebGLSupported()){return new _WebGLRenderer2.default(options,arg1,arg2)}return new _CanvasRenderer2.default(options,arg1,arg2)}},{"./renderers/canvas/CanvasRenderer":309,"./renderers/webgl/WebGLRenderer":316,"./utils":357}],278:[function(require,module,exports){"use strict";exports.__esModule=true;var VERSION=exports.VERSION="4.6.0";var PI_2=exports.PI_2=Math.PI*2;var RAD_TO_DEG=exports.RAD_TO_DEG=180/Math.PI;var DEG_TO_RAD=exports.DEG_TO_RAD=Math.PI/180;var RENDERER_TYPE=exports.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2};var BLEND_MODES=exports.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19};var DRAW_MODES=exports.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};var SCALE_MODES=exports.SCALE_MODES={LINEAR:0,NEAREST:1};var WRAP_MODES=exports.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2};var GC_MODES=exports.GC_MODES={AUTO:0,MANUAL:1};var URL_FILE_EXTENSION=exports.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i;var DATA_URI=exports.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i;var SVG_SIZE=exports.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var SHAPES=exports.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4};var PRECISION=exports.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"};var TRANSFORM_MODE=exports.TRANSFORM_MODE={STATIC:0,DYNAMIC:1};var TEXT_GRADIENT=exports.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1};var UPDATE_PRIORITY=exports.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},{}],279:[function(require,module,exports){"use strict";exports.__esModule=true;var _math=require("../math");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Bounds=function(){function Bounds(){_classCallCheck(this,Bounds);this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;this.rect=null}Bounds.prototype.isEmpty=function isEmpty(){return this.minX>this.maxX||this.minY>this.maxY};Bounds.prototype.clear=function clear(){this.updateID++;this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity};Bounds.prototype.getRectangle=function getRectangle(rect){if(this.minX>this.maxX||this.minY>this.maxY){return _math.Rectangle.EMPTY}rect=rect||new _math.Rectangle(0,0,1,1);rect.x=this.minX;rect.y=this.minY;rect.width=this.maxX-this.minX;rect.height=this.maxY-this.minY;return rect};Bounds.prototype.addPoint=function addPoint(point){this.minX=Math.min(this.minX,point.x);this.maxX=Math.max(this.maxX,point.x);this.minY=Math.min(this.minY,point.y);this.maxY=Math.max(this.maxY,point.y)};Bounds.prototype.addQuad=function addQuad(vertices){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=vertices[0];var y=vertices[1];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[2];y=vertices[3];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[4];y=vertices[5];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[6];y=vertices[7];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addFrame=function addFrame(transform,x0,y0,x1,y1){var matrix=transform.worldTransform;var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=a*x0+c*y0+tx;var y=b*x0+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y0+tx;y=b*x1+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x0+c*y1+tx;y=b*x0+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y1+tx;y=b*x1+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addVertices=function addVertices(transform,vertices,beginOffset,endOffset){var matrix=transform.worldTransform;var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;for(var i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i];var rawY=vertices[i+1];var x=a*rawX+c*rawY+tx;var y=d*rawY+b*rawX+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addBounds=function addBounds(bounds){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX;this.minY=bounds.minY<minY?bounds.minY:minY;this.maxX=bounds.maxX>maxX?bounds.maxX:maxX;this.maxY=bounds.maxY>maxY?bounds.maxY:maxY};Bounds.prototype.addBoundsMask=function addBoundsMask(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX;var _minY=bounds.minY>mask.minY?bounds.minY:mask.minY;var _maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX;var _maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY}};Bounds.prototype.addBoundsArea=function addBoundsArea(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x;var _minY=bounds.minY>area.y?bounds.minY:area.y;var _maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width;var _maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY}};return Bounds}();exports.default=Bounds},{"../math":302}],280:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _DisplayObject2=require("./DisplayObject");var _DisplayObject3=_interopRequireDefault(_DisplayObject2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Container=function(_DisplayObject){_inherits(Container,_DisplayObject);function Container(){_classCallCheck(this,Container);var _this=_possibleConstructorReturn(this,_DisplayObject.call(this));_this.children=[];return _this}Container.prototype.onChildrenChange=function onChildrenChange(){};Container.prototype.addChild=function addChild(child){var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.addChild(arguments[i])}}else{if(child.parent){child.parent.removeChild(child)}child.parent=this;child.transform._parentID=-1;this.children.push(child);this._boundsID++;this.onChildrenChange(this.children.length-1);child.emit("added",this)}return child};Container.prototype.addChildAt=function addChildAt(child,index){if(index<0||index>this.children.length){throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length)}if(child.parent){child.parent.removeChild(child)}child.parent=this;child.transform._parentID=-1;this.children.splice(index,0,child);this._boundsID++;this.onChildrenChange(index);child.emit("added",this);return child};Container.prototype.swapChildren=function swapChildren(child,child2){if(child===child2){return}var index1=this.getChildIndex(child);var index2=this.getChildIndex(child2);this.children[index1]=child2;this.children[index2]=child;this.onChildrenChange(index1<index2?index1:index2)};Container.prototype.getChildIndex=function getChildIndex(child){var index=this.children.indexOf(child);if(index===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return index};Container.prototype.setChildIndex=function setChildIndex(child,index){if(index<0||index>=this.children.length){throw new Error("The supplied index is out of bounds")}var currentIndex=this.getChildIndex(child);(0,_utils.removeItems)(this.children,currentIndex,1);this.children.splice(index,0,child);this.onChildrenChange(index)};Container.prototype.getChildAt=function getChildAt(index){if(index<0||index>=this.children.length){throw new Error("getChildAt: Index ("+index+") does not exist.")}return this.children[index]};Container.prototype.removeChild=function removeChild(child){var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.removeChild(arguments[i])}}else{var index=this.children.indexOf(child);if(index===-1)return null;child.parent=null;child.transform._parentID=-1;(0,_utils.removeItems)(this.children,index,1);this._boundsID++;this.onChildrenChange(index);child.emit("removed",this)}return child};Container.prototype.removeChildAt=function removeChildAt(index){var child=this.getChildAt(index);child.parent=null;child.transform._parentID=-1;(0,_utils.removeItems)(this.children,index,1);this._boundsID++;this.onChildrenChange(index);child.emit("removed",this);return child};Container.prototype.removeChildren=function removeChildren(){var beginIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var endIndex=arguments[1];var begin=beginIndex;var end=typeof endIndex==="number"?endIndex:this.children.length;var range=end-begin;var removed=void 0;if(range>0&&range<=end){removed=this.children.splice(begin,range);for(var i=0;i<removed.length;++i){removed[i].parent=null;if(removed[i].transform){removed[i].transform._parentID=-1}}this._boundsID++;this.onChildrenChange(beginIndex);for(var _i=0;_i<removed.length;++_i){removed[_i].emit("removed",this)}return removed}else if(range===0&&this.children.length===0){return[]}throw new RangeError("removeChildren: numeric values are outside the acceptable range.")};Container.prototype.updateTransform=function updateTransform(){this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];if(child.visible){child.updateTransform()}}};Container.prototype.calculateBounds=function calculateBounds(){this._bounds.clear();this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];if(!child.visible||!child.renderable){continue}child.calculateBounds();if(child._mask){child._mask.calculateBounds();this._bounds.addBoundsMask(child._bounds,child._mask._bounds)}else if(child.filterArea){this._bounds.addBoundsArea(child._bounds,child.filterArea)}else{this._bounds.addBounds(child._bounds)}}this._lastBoundsID=this._boundsID};Container.prototype._calculateBounds=function _calculateBounds(){};Container.prototype.renderWebGL=function renderWebGL(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask||this._filters){this.renderAdvancedWebGL(renderer)}else{this._renderWebGL(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].renderWebGL(renderer)}}};Container.prototype.renderAdvancedWebGL=function renderAdvancedWebGL(renderer){renderer.flush();var filters=this._filters;var mask=this._mask;if(filters){if(!this._enabledFilters){this._enabledFilters=[]}this._enabledFilters.length=0;for(var i=0;i<filters.length;i++){if(filters[i].enabled){this._enabledFilters.push(filters[i])}}if(this._enabledFilters.length){renderer.filterManager.pushFilter(this,this._enabledFilters)}}if(mask){renderer.maskManager.pushMask(this,this._mask)}this._renderWebGL(renderer);for(var _i2=0,j=this.children.length;_i2<j;_i2++){this.children[_i2].renderWebGL(renderer)}renderer.flush();if(mask){renderer.maskManager.popMask(this,this._mask)}if(filters&&this._enabledFilters&&this._enabledFilters.length){renderer.filterManager.popFilter()}};Container.prototype._renderWebGL=function _renderWebGL(renderer){};Container.prototype._renderCanvas=function _renderCanvas(renderer){};Container.prototype.renderCanvas=function renderCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask){renderer.maskManager.pushMask(this._mask)}this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].renderCanvas(renderer)}if(this._mask){renderer.maskManager.popMask(renderer)}};Container.prototype.destroy=function destroy(options){_DisplayObject.prototype.destroy.call(this);var destroyChildren=typeof options==="boolean"?options:options&&options.children;var oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren){for(var i=0;i<oldChildren.length;++i){oldChildren[i].destroy(options)}}};_createClass(Container,[{key:"width",get:function get(){return this.scale.x*this.getLocalBounds().width},set:function set(value){var width=this.getLocalBounds().width;if(width!==0){this.scale.x=value/width}else{this.scale.x=1}this._width=value}},{key:"height",get:function get(){return this.scale.y*this.getLocalBounds().height},set:function set(value){var height=this.getLocalBounds().height;if(height!==0){this.scale.y=value/height}else{this.scale.y=1}this._height=value}}]);return Container}(_DisplayObject3.default);exports.default=Container;Container.prototype.containerUpdateTransform=Container.prototype.updateTransform},{"../utils":357,"./DisplayObject":281}],281:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _TransformStatic=require("./TransformStatic");var _TransformStatic2=_interopRequireDefault(_TransformStatic);var _Transform=require("./Transform");var _Transform2=_interopRequireDefault(_Transform);var _Bounds=require("./Bounds");var _Bounds2=_interopRequireDefault(_Bounds);var _math=require("../math");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DisplayObject=function(_EventEmitter){_inherits(DisplayObject,_EventEmitter);function DisplayObject(){_classCallCheck(this,DisplayObject);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));var TransformClass=_settings2.default.TRANSFORM_MODE===_const.TRANSFORM_MODE.STATIC?_TransformStatic2.default:_Transform2.default;_this.tempDisplayObjectParent=null;_this.transform=new TransformClass;_this.alpha=1;_this.visible=true;_this.renderable=true;_this.parent=null;_this.worldAlpha=1;_this.filterArea=null;_this._filters=null;_this._enabledFilters=null;_this._bounds=new _Bounds2.default;_this._boundsID=0;_this._lastBoundsID=-1;_this._boundsRect=null;_this._localBoundsRect=null;_this._mask=null;_this._destroyed=false;return _this}DisplayObject.prototype.updateTransform=function updateTransform(){this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;this._bounds.updateID++};DisplayObject.prototype._recursivePostUpdateTransform=function _recursivePostUpdateTransform(){if(this.parent){this.parent._recursivePostUpdateTransform();this.transform.updateTransform(this.parent.transform)}else{this.transform.updateTransform(this._tempDisplayObjectParent.transform)}};DisplayObject.prototype.getBounds=function getBounds(skipUpdate,rect){if(!skipUpdate){if(!this.parent){this.parent=this._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this._recursivePostUpdateTransform();this.updateTransform()}}if(this._boundsID!==this._lastBoundsID){this.calculateBounds()}if(!rect){if(!this._boundsRect){this._boundsRect=new _math.Rectangle}rect=this._boundsRect}return this._bounds.getRectangle(rect)};DisplayObject.prototype.getLocalBounds=function getLocalBounds(rect){var transformRef=this.transform;var parentRef=this.parent;this.parent=null;this.transform=this._tempDisplayObjectParent.transform;if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new _math.Rectangle}rect=this._localBoundsRect}var bounds=this.getBounds(false,rect);this.parent=parentRef;this.transform=transformRef;return bounds};DisplayObject.prototype.toGlobal=function toGlobal(position,point){var skipUpdate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}}return this.worldTransform.apply(position,point)};DisplayObject.prototype.toLocal=function toLocal(position,from,point,skipUpdate){if(from){position=from.toGlobal(position,point,skipUpdate)}if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}}return this.worldTransform.applyInverse(position,point)};DisplayObject.prototype.renderWebGL=function renderWebGL(renderer){};DisplayObject.prototype.renderCanvas=function renderCanvas(renderer){};DisplayObject.prototype.setParent=function setParent(container){if(!container||!container.addChild){throw new Error("setParent: Argument must be a Container")}container.addChild(this);return container};DisplayObject.prototype.setTransform=function setTransform(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var scaleX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var scaleY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var rotation=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var skewX=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var skewY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var pivotX=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var pivotY=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;this.position.x=x;this.position.y=y;this.scale.x=!scaleX?1:scaleX;this.scale.y=!scaleY?1:scaleY;this.rotation=rotation;this.skew.x=skewX;this.skew.y=skewY;this.pivot.x=pivotX;this.pivot.y=pivotY;return this};DisplayObject.prototype.destroy=function destroy(){this.removeAllListeners();if(this.parent){this.parent.removeChild(this)}this.transform=null;this.parent=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.filterArea=null;this.interactive=false;this.interactiveChildren=false;this._destroyed=true};_createClass(DisplayObject,[{key:"_tempDisplayObjectParent",get:function get(){if(this.tempDisplayObjectParent===null){this.tempDisplayObjectParent=new DisplayObject}return this.tempDisplayObjectParent}},{key:"x",get:function get(){return this.position.x},set:function set(value){this.transform.position.x=value}},{key:"y",get:function get(){return this.position.y},set:function set(value){this.transform.position.y=value}},{key:"worldTransform",get:function get(){return this.transform.worldTransform}},{key:"localTransform",get:function get(){return this.transform.localTransform}},{key:"position",get:function get(){return this.transform.position},set:function set(value){this.transform.position.copy(value)}},{key:"scale",get:function get(){return this.transform.scale},set:function set(value){this.transform.scale.copy(value)}},{key:"pivot",get:function get(){return this.transform.pivot},set:function set(value){this.transform.pivot.copy(value)}},{key:"skew",get:function get(){return this.transform.skew},set:function set(value){this.transform.skew.copy(value)}},{key:"rotation",get:function get(){return this.transform.rotation},set:function set(value){this.transform.rotation=value}},{key:"worldVisible",get:function get(){var item=this;do{if(!item.visible){return false}item=item.parent}while(item);return true}},{key:"mask",get:function get(){return this._mask},set:function set(value){if(this._mask){this._mask.renderable=true}this._mask=value;if(this._mask){this._mask.renderable=false}}},{key:"filters",get:function get(){return this._filters&&this._filters.slice()},set:function set(value){this._filters=value&&value.slice()}}]);return DisplayObject}(_eventemitter2.default);exports.default=DisplayObject;DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform},{"../const":278,"../math":302,"../settings":333,"./Bounds":279,"./Transform":282,"./TransformStatic":284,eventemitter3:172}],282:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _math=require("../math");var _TransformBase2=require("./TransformBase");var _TransformBase3=_interopRequireDefault(_TransformBase2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Transform=function(_TransformBase){_inherits(Transform,_TransformBase);function Transform(){_classCallCheck(this,Transform);var _this=_possibleConstructorReturn(this,_TransformBase.call(this));_this.position=new _math.Point(0,0);_this.scale=new _math.Point(1,1);_this.skew=new _math.ObservablePoint(_this.updateSkew,_this,0,0);_this.pivot=new _math.Point(0,0);_this._rotation=0;_this._cx=1;_this._sx=0;_this._cy=0;_this._sy=1;return _this}Transform.prototype.updateSkew=function updateSkew(){this._cx=Math.cos(this._rotation+this.skew._y);this._sx=Math.sin(this._rotation+this.skew._y);this._cy=-Math.sin(this._rotation-this.skew._x);this._sy=Math.cos(this._rotation-this.skew._x)};Transform.prototype.updateLocalTransform=function updateLocalTransform(){var lt=this.localTransform;lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d)};Transform.prototype.updateTransform=function updateTransform(parentTransform){var lt=this.localTransform;lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);var pt=parentTransform.worldTransform;var wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._worldID++};Transform.prototype.setFromMatrix=function setFromMatrix(matrix){matrix.decompose(this)};_createClass(Transform,[{key:"rotation",get:function get(){return this._rotation},set:function set(value){this._rotation=value;this.updateSkew()}}]);return Transform}(_TransformBase3.default);exports.default=Transform},{"../math":302,"./TransformBase":283}],283:[function(require,module,exports){"use strict";exports.__esModule=true;var _math=require("../math");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TransformBase=function(){function TransformBase(){_classCallCheck(this,TransformBase);this.worldTransform=new _math.Matrix;this.localTransform=new _math.Matrix;this._worldID=0;this._parentID=0}TransformBase.prototype.updateLocalTransform=function updateLocalTransform(){};TransformBase.prototype.updateTransform=function updateTransform(parentTransform){var pt=parentTransform.worldTransform;var wt=this.worldTransform;var lt=this.localTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._worldID++};return TransformBase}();exports.default=TransformBase;TransformBase.prototype.updateWorldTransform=TransformBase.prototype.updateTransform;TransformBase.IDENTITY=new TransformBase},{"../math":302}],284:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _math=require("../math");var _TransformBase2=require("./TransformBase");var _TransformBase3=_interopRequireDefault(_TransformBase2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TransformStatic=function(_TransformBase){_inherits(TransformStatic,_TransformBase);function TransformStatic(){_classCallCheck(this,TransformStatic);var _this=_possibleConstructorReturn(this,_TransformBase.call(this));_this.position=new _math.ObservablePoint(_this.onChange,_this,0,0);_this.scale=new _math.ObservablePoint(_this.onChange,_this,1,1);_this.pivot=new _math.ObservablePoint(_this.onChange,_this,0,0);_this.skew=new _math.ObservablePoint(_this.updateSkew,_this,0,0);_this._rotation=0;_this._cx=1;_this._sx=0;_this._cy=0;_this._sy=1;_this._localID=0;_this._currentLocalID=0;return _this}TransformStatic.prototype.onChange=function onChange(){this._localID++};TransformStatic.prototype.updateSkew=function updateSkew(){this._cx=Math.cos(this._rotation+this.skew._y);this._sx=Math.sin(this._rotation+this.skew._y);this._cy=-Math.sin(this._rotation-this.skew._x);this._sy=Math.cos(this._rotation-this.skew._x);this._localID++};TransformStatic.prototype.updateLocalTransform=function updateLocalTransform(){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale._x;lt.b=this._sx*this.scale._x;lt.c=this._cy*this.scale._y;lt.d=this._sy*this.scale._y;lt.tx=this.position._x-(this.pivot._x*lt.a+this.pivot._y*lt.c);lt.ty=this.position._y-(this.pivot._x*lt.b+this.pivot._y*lt.d);this._currentLocalID=this._localID;this._parentID=-1}};TransformStatic.prototype.updateTransform=function updateTransform(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale._x;lt.b=this._sx*this.scale._x;lt.c=this._cy*this.scale._y;lt.d=this._sy*this.scale._y;lt.tx=this.position._x-(this.pivot._x*lt.a+this.pivot._y*lt.c);lt.ty=this.position._y-(this.pivot._x*lt.b+this.pivot._y*lt.d);this._currentLocalID=this._localID;this._parentID=-1}if(this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform;var wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._parentID=parentTransform._worldID;this._worldID++}};TransformStatic.prototype.setFromMatrix=function setFromMatrix(matrix){matrix.decompose(this);this._localID++};_createClass(TransformStatic,[{key:"rotation",get:function get(){return this._rotation},set:function set(value){this._rotation=value;this.updateSkew()}}]);return TransformStatic}(_TransformBase3.default);exports.default=TransformStatic},{"../math":302,"./TransformBase":283}],285:[function(require,module,exports){"use strict";exports.__esModule=true;var _Container2=require("../display/Container");var _Container3=_interopRequireDefault(_Container2);var _RenderTexture=require("../textures/RenderTexture");var _RenderTexture2=_interopRequireDefault(_RenderTexture);var _Texture=require("../textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _GraphicsData=require("./GraphicsData");var _GraphicsData2=_interopRequireDefault(_GraphicsData);var _Sprite=require("../sprites/Sprite");var _Sprite2=_interopRequireDefault(_Sprite);var _math=require("../math");var _utils=require("../utils");var _const=require("../const");var _Bounds=require("../display/Bounds");var _Bounds2=_interopRequireDefault(_Bounds);var _bezierCurveTo2=require("./utils/bezierCurveTo");var _bezierCurveTo3=_interopRequireDefault(_bezierCurveTo2);var _CanvasRenderer=require("../renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var canvasRenderer=void 0;var tempMatrix=new _math.Matrix;var tempPoint=new _math.Point;var tempColor1=new Float32Array(4);var tempColor2=new Float32Array(4);var Graphics=function(_Container){_inherits(Graphics,_Container);function Graphics(){var nativeLines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,Graphics);var _this=_possibleConstructorReturn(this,_Container.call(this));_this.fillAlpha=1;_this.lineWidth=0;_this.nativeLines=nativeLines;_this.lineColor=0;_this.graphicsData=[];_this.tint=16777215;_this._prevTint=16777215;_this.blendMode=_const.BLEND_MODES.NORMAL;_this.currentPath=null;_this._webGL={};_this.isMask=false;_this.boundsPadding=0;_this._localBounds=new _Bounds2.default;_this.dirty=0;_this.fastRectDirty=-1;_this.clearDirty=0;_this.boundsDirty=-1;_this.cachedSpriteDirty=false;_this._spriteRect=null;_this._fastRect=false;return _this}Graphics.prototype.clone=function clone(){var clone=new Graphics;clone.renderable=this.renderable;clone.fillAlpha=this.fillAlpha;clone.lineWidth=this.lineWidth;clone.lineColor=this.lineColor;clone.tint=this.tint;clone.blendMode=this.blendMode;clone.isMask=this.isMask;clone.boundsPadding=this.boundsPadding;clone.dirty=0;clone.cachedSpriteDirty=this.cachedSpriteDirty;for(var i=0;i<this.graphicsData.length;++i){clone.graphicsData.push(this.graphicsData[i].clone())}clone.currentPath=clone.graphicsData[clone.graphicsData.length-1];clone.updateLocalBounds();return clone};Graphics.prototype.lineStyle=function lineStyle(){var lineWidth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var color=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var alpha=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.lineWidth=lineWidth;this.lineColor=color;this.lineAlpha=alpha;if(this.currentPath){if(this.currentPath.shape.points.length){var shape=new _math.Polygon(this.currentPath.shape.points.slice(-2));shape.closed=false;this.drawShape(shape)}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};Graphics.prototype.moveTo=function moveTo(x,y){var shape=new _math.Polygon([x,y]);shape.closed=false;this.drawShape(shape);return this};Graphics.prototype.lineTo=function lineTo(x,y){this.currentPath.shape.points.push(x,y);this.dirty++;return this};Graphics.prototype.quadraticCurveTo=function quadraticCurveTo(cpX,cpY,toX,toY){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var n=20;var points=this.currentPath.shape.points;var xa=0;var ya=0;if(points.length===0){this.moveTo(0,0)}var fromX=points[points.length-2];var fromY=points[points.length-1];for(var i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j;ya=fromY+(cpY-fromY)*j;points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}this.dirty++;return this};Graphics.prototype.bezierCurveTo=function bezierCurveTo(cpX,cpY,cpX2,cpY2,toX,toY){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var points=this.currentPath.shape.points;var fromX=points[points.length-2];var fromY=points[points.length-1];points.length-=2;(0,_bezierCurveTo3.default)(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY,points);this.dirty++;return this};Graphics.prototype.arcTo=function arcTo(x1,y1,x2,y2,radius){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(x1,y1)}}else{this.moveTo(x1,y1)}var points=this.currentPath.shape.points;var fromX=points[points.length-2];var fromY=points[points.length-1];var a1=fromY-y1;var b1=fromX-x1;var a2=y2-y1;var b2=x2-x1;var mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0){if(points[points.length-2]!==x1||points[points.length-1]!==y1){points.push(x1,y1)}}else{var dd=a1*a1+b1*b1;var cc=a2*a2+b2*b2;var tt=a1*a2+b1*b2;var k1=radius*Math.sqrt(dd)/mm;var k2=radius*Math.sqrt(cc)/mm;var j1=k1*tt/dd;var j2=k2*tt/cc;var cx=k1*b2+k2*b1;var cy=k1*a2+k2*a1;var px=b1*(k2+j1);var py=a1*(k2+j1);var qx=b2*(k1+j2);var qy=a2*(k1+j2);var startAngle=Math.atan2(py-cy,px-cx);var endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1)}this.dirty++;return this};Graphics.prototype.arc=function arc(cx,cy,radius,startAngle,endAngle){var anticlockwise=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(startAngle===endAngle){return this}if(!anticlockwise&&endAngle<=startAngle){endAngle+=Math.PI*2}else if(anticlockwise&&startAngle<=endAngle){startAngle+=Math.PI*2}var sweep=endAngle-startAngle;var segs=Math.ceil(Math.abs(sweep)/(Math.PI*2))*40;if(sweep===0){return this}var startX=cx+Math.cos(startAngle)*radius;var startY=cy+Math.sin(startAngle)*radius;var points=this.currentPath?this.currentPath.shape.points:null;if(points){if(points[points.length-2]!==startX||points[points.length-1]!==startY){points.push(startX,startY)}}else{this.moveTo(startX,startY);points=this.currentPath.shape.points}var theta=sweep/(segs*2);var theta2=theta*2;var cTheta=Math.cos(theta);var sTheta=Math.sin(theta);var segMinus=segs-1;var remainder=segMinus%1/segMinus;for(var i=0;i<=segMinus;++i){var real=i+remainder*i;var angle=theta+startAngle+theta2*real;var c=Math.cos(angle);var s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}this.dirty++;return this};Graphics.prototype.beginFill=function beginFill(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var alpha=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.filling=true;this.fillColor=color;this.fillAlpha=alpha;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};Graphics.prototype.endFill=function endFill(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};Graphics.prototype.drawRect=function drawRect(x,y,width,height){this.drawShape(new _math.Rectangle(x,y,width,height));return this};Graphics.prototype.drawRoundedRect=function drawRoundedRect(x,y,width,height,radius){this.drawShape(new _math.RoundedRectangle(x,y,width,height,radius));return this};Graphics.prototype.drawCircle=function drawCircle(x,y,radius){this.drawShape(new _math.Circle(x,y,radius));return this};Graphics.prototype.drawEllipse=function drawEllipse(x,y,width,height){this.drawShape(new _math.Ellipse(x,y,width,height));return this};Graphics.prototype.drawPolygon=function drawPolygon(path){var points=path;var closed=true;if(points instanceof _math.Polygon){closed=points.closed;points=points.points}if(!Array.isArray(points)){points=new Array(arguments.length);for(var i=0;i<points.length;++i){points[i]=arguments[i]}}var shape=new _math.Polygon(points);shape.closed=closed;this.drawShape(shape);return this};Graphics.prototype.clear=function clear(){if(this.lineWidth||this.filling||this.graphicsData.length>0){this.lineWidth=0;this.filling=false;this.boundsDirty=-1;this.dirty++;this.clearDirty++;this.graphicsData.length=0}this.currentPath=null;this._spriteRect=null;return this};Graphics.prototype.isFastRect=function isFastRect(){return this.graphicsData.length===1&&this.graphicsData[0].shape.type===_const.SHAPES.RECT&&!this.graphicsData[0].lineWidth};Graphics.prototype._renderWebGL=function _renderWebGL(renderer){if(this.dirty!==this.fastRectDirty){this.fastRectDirty=this.dirty;this._fastRect=this.isFastRect()}if(this._fastRect){this._renderSpriteRect(renderer)}else{renderer.setObjectRenderer(renderer.plugins.graphics);renderer.plugins.graphics.render(this)}};Graphics.prototype._renderSpriteRect=function _renderSpriteRect(renderer){var rect=this.graphicsData[0].shape;if(!this._spriteRect){this._spriteRect=new _Sprite2.default(new _Texture2.default(_Texture2.default.WHITE))}var sprite=this._spriteRect;if(this.tint===16777215){sprite.tint=this.graphicsData[0].fillColor}else{var t1=tempColor1;var t2=tempColor2;(0,_utils.hex2rgb)(this.graphicsData[0].fillColor,t1);(0,_utils.hex2rgb)(this.tint,t2);t1[0]*=t2[0];t1[1]*=t2[1];t1[2]*=t2[2];sprite.tint=(0,_utils.rgb2hex)(t1)}sprite.alpha=this.graphicsData[0].fillAlpha;sprite.worldAlpha=this.worldAlpha*sprite.alpha;sprite.blendMode=this.blendMode;sprite._texture._frame.width=rect.width;sprite._texture._frame.height=rect.height;sprite.transform.worldTransform=this.transform.worldTransform;sprite.anchor.set(-rect.x/rect.width,-rect.y/rect.height);sprite._onAnchorUpdate();sprite._renderWebGL(renderer)};Graphics.prototype._renderCanvas=function _renderCanvas(renderer){if(this.isMask===true){return}renderer.plugins.graphics.render(this)};Graphics.prototype._calculateBounds=function _calculateBounds(){if(this.boundsDirty!==this.dirty){this.boundsDirty=this.dirty;this.updateLocalBounds();this.cachedSpriteDirty=true}var lb=this._localBounds;this._bounds.addFrame(this.transform,lb.minX,lb.minY,lb.maxX,lb.maxY)};Graphics.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var graphicsData=this.graphicsData;for(var i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(!data.fill){continue}if(data.shape){if(data.shape.contains(tempPoint.x,tempPoint.y)){if(data.holes){for(var _i=0;_i<data.holes.length;_i++){var hole=data.holes[_i];if(hole.contains(tempPoint.x,tempPoint.y)){return false}}}return true}}}return false};Graphics.prototype.updateLocalBounds=function updateLocalBounds(){var minX=Infinity;var maxX=-Infinity;var minY=Infinity;var maxY=-Infinity;if(this.graphicsData.length){var shape=0;var x=0;var y=0;var w=0;var h=0;for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i];var type=data.type;var lineWidth=data.lineWidth;shape=data.shape;if(type===_const.SHAPES.RECT||type===_const.SHAPES.RREC){x=shape.x-lineWidth/2;y=shape.y-lineWidth/2;w=shape.width+lineWidth;h=shape.height+lineWidth;minX=x<minX?x:minX;maxX=x+w>maxX?x+w:maxX;minY=y<minY?y:minY;maxY=y+h>maxY?y+h:maxY}else if(type===_const.SHAPES.CIRC){x=shape.x;y=shape.y;w=shape.radius+lineWidth/2;h=shape.radius+lineWidth/2;minX=x-w<minX?x-w:minX;maxX=x+w>maxX?x+w:maxX;minY=y-h<minY?y-h:minY;maxY=y+h>maxY?y+h:maxY}else if(type===_const.SHAPES.ELIP){x=shape.x;y=shape.y;w=shape.width+lineWidth/2;h=shape.height+lineWidth/2;minX=x-w<minX?x-w:minX;maxX=x+w>maxX?x+w:maxX;minY=y-h<minY?y-h:minY;maxY=y+h>maxY?y+h:maxY}else{var points=shape.points;var x2=0;var y2=0;var dx=0;var dy=0;var rw=0;var rh=0;var cx=0;var cy=0;for(var j=0;j+2<points.length;j+=2){x=points[j];y=points[j+1];x2=points[j+2];y2=points[j+3];dx=Math.abs(x2-x);dy=Math.abs(y2-y);h=lineWidth;w=Math.sqrt(dx*dx+dy*dy);if(w<1e-9){continue}rw=(h/w*dy+dx)/2;rh=(h/w*dx+dy)/2;cx=(x2+x)/2;cy=(y2+y)/2;minX=cx-rw<minX?cx-rw:minX;maxX=cx+rw>maxX?cx+rw:maxX;minY=cy-rh<minY?cy-rh:minY;maxY=cy+rh>maxY?cy+rh:maxY}}}}else{minX=0;maxX=0;minY=0;maxY=0}var padding=this.boundsPadding;this._localBounds.minX=minX-padding;this._localBounds.maxX=maxX+padding;this._localBounds.minY=minY-padding;this._localBounds.maxY=maxY+padding};Graphics.prototype.drawShape=function drawShape(shape){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;var data=new _GraphicsData2.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,shape);this.graphicsData.push(data);if(data.type===_const.SHAPES.POLY){data.shape.closed=data.shape.closed||this.filling;this.currentPath=data}this.dirty++;return data};Graphics.prototype.generateCanvasTexture=function generateCanvasTexture(scaleMode){var resolution=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var bounds=this.getLocalBounds();var canvasBuffer=_RenderTexture2.default.create(bounds.width,bounds.height,scaleMode,resolution);if(!canvasRenderer){canvasRenderer=new _CanvasRenderer2.default}this.transform.updateLocalTransform();this.transform.localTransform.copy(tempMatrix);tempMatrix.invert();tempMatrix.tx-=bounds.x;tempMatrix.ty-=bounds.y;canvasRenderer.render(this,canvasBuffer,true,tempMatrix);var texture=_Texture2.default.fromCanvas(canvasBuffer.baseTexture._canvasRenderTarget.canvas,scaleMode,"graphics");texture.baseTexture.resolution=resolution;texture.baseTexture.update();return texture};Graphics.prototype.closePath=function closePath(){var currentPath=this.currentPath;if(currentPath&&currentPath.shape){currentPath.shape.close()}return this};Graphics.prototype.addHole=function addHole(){var hole=this.graphicsData.pop();this.currentPath=this.graphicsData[this.graphicsData.length-1];this.currentPath.addHole(hole.shape);this.currentPath=null;return this};Graphics.prototype.destroy=function destroy(options){_Container.prototype.destroy.call(this,options);for(var i=0;i<this.graphicsData.length;++i){this.graphicsData[i].destroy()}for(var id in this._webgl){for(var j=0;j<this._webgl[id].data.length;++j){this._webgl[id].data[j].destroy()}}if(this._spriteRect){this._spriteRect.destroy()}this.graphicsData=null;this.currentPath=null;this._webgl=null;this._localBounds=null};return Graphics}(_Container3.default);exports.default=Graphics;Graphics._SPRITE_TEXTURE=null},{"../const":278,"../display/Bounds":279,"../display/Container":280,"../math":302,"../renderers/canvas/CanvasRenderer":309,"../sprites/Sprite":334,"../textures/RenderTexture":345,"../textures/Texture":347,"../utils":357,"./GraphicsData":286,"./utils/bezierCurveTo":288}],286:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GraphicsData=function(){function GraphicsData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,nativeLines,shape){_classCallCheck(this,GraphicsData);this.lineWidth=lineWidth;this.nativeLines=nativeLines;this.lineColor=lineColor;this.lineAlpha=lineAlpha;this._lineTint=lineColor;this.fillColor=fillColor;this.fillAlpha=fillAlpha;this._fillTint=fillColor;this.fill=fill;this.holes=[];this.shape=shape;this.type=shape.type}GraphicsData.prototype.clone=function clone(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape)};GraphicsData.prototype.addHole=function addHole(shape){this.holes.push(shape)};GraphicsData.prototype.destroy=function destroy(){this.shape=null;this.holes=null};return GraphicsData}();exports.default=GraphicsData},{}],287:[function(require,module,exports){"use strict";exports.__esModule=true;var _CanvasRenderer=require("../../renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CanvasGraphicsRenderer=function(){function CanvasGraphicsRenderer(renderer){_classCallCheck(this,CanvasGraphicsRenderer);this.renderer=renderer}CanvasGraphicsRenderer.prototype.render=function render(graphics){var renderer=this.renderer;var context=renderer.context;var worldAlpha=graphics.worldAlpha;var transform=graphics.transform.worldTransform;var resolution=renderer.resolution;if(this._prevTint!==this.tint){this.dirty=true}context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);if(graphics.dirty){this.updateGraphicsTint(graphics);graphics.dirty=false}renderer.setBlendMode(graphics.blendMode);for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];var shape=data.shape;var fillColor=data._fillTint;var lineColor=data._lineTint;context.lineWidth=data.lineWidth;if(data.type===_const.SHAPES.POLY){context.beginPath();this.renderPolygon(shape.points,shape.closed,context);for(var j=0;j<data.holes.length;j++){this.renderPolygon(data.holes[j].points,true,context)}if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===_const.SHAPES.RECT){if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fillRect(shape.x,shape.y,shape.width,shape.height)}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.strokeRect(shape.x,shape.y,shape.width,shape.height)}}else if(data.type===_const.SHAPES.CIRC){context.beginPath();context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===_const.SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;context.beginPath();var kappa=.5522848;var ox=w/2*kappa;var oy=h/2*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===_const.SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context.beginPath();context.moveTo(rx,ry+radius);context.lineTo(rx,ry+height-radius);context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context.lineTo(rx+width-radius,ry+height);context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context.lineTo(rx+width,ry+radius);context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context.lineTo(rx+radius,ry);context.quadraticCurveTo(rx,ry,rx,ry+radius);context.closePath();if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}}};CanvasGraphicsRenderer.prototype.updateGraphicsTint=function updateGraphicsTint(graphics){graphics._prevTint=graphics.tint;var tintR=(graphics.tint>>16&255)/255;var tintG=(graphics.tint>>8&255)/255;var tintB=(graphics.tint&255)/255;for(var i=0;i<graphics.graphicsData.length;++i){var data=graphics.graphicsData[i];var fillColor=data.fillColor|0;var lineColor=data.lineColor|0;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(fillColor&255)/255*tintB*255;data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(lineColor&255)/255*tintB*255}};CanvasGraphicsRenderer.prototype.renderPolygon=function renderPolygon(points,close,context){context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;++j){context.lineTo(points[j*2],points[j*2+1])}if(close){context.closePath()}};CanvasGraphicsRenderer.prototype.destroy=function destroy(){this.renderer=null};return CanvasGraphicsRenderer}();exports.default=CanvasGraphicsRenderer;_CanvasRenderer2.default.registerPlugin("graphics",CanvasGraphicsRenderer)},{"../../const":278,"../../renderers/canvas/CanvasRenderer":309}],288:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=bezierCurveTo;function bezierCurveTo(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){var path=arguments.length>8&&arguments[8]!==undefined?arguments[8]:[];var n=20;var dt=0;var dt2=0;var dt3=0;var t2=0;var t3=0;path.push(fromX,fromY);for(var i=1,j=0;i<=n;++i){j=i/n;dt=1-j;dt2=dt*dt;dt3=dt2*dt;t2=j*j;t3=t2*j;path.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY)}return path}},{}],289:[function(require,module,exports){"use strict";exports.__esModule=true;var _utils=require("../../utils");var _const=require("../../const");var _ObjectRenderer2=require("../../renderers/webgl/utils/ObjectRenderer");var _ObjectRenderer3=_interopRequireDefault(_ObjectRenderer2);var _WebGLRenderer=require("../../renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);var _WebGLGraphicsData=require("./WebGLGraphicsData");var _WebGLGraphicsData2=_interopRequireDefault(_WebGLGraphicsData);var _PrimitiveShader=require("./shaders/PrimitiveShader");var _PrimitiveShader2=_interopRequireDefault(_PrimitiveShader);var _buildPoly=require("./utils/buildPoly");var _buildPoly2=_interopRequireDefault(_buildPoly);var _buildRectangle=require("./utils/buildRectangle");var _buildRectangle2=_interopRequireDefault(_buildRectangle);var _buildRoundedRectangle=require("./utils/buildRoundedRectangle");var _buildRoundedRectangle2=_interopRequireDefault(_buildRoundedRectangle);var _buildCircle=require("./utils/buildCircle");var _buildCircle2=_interopRequireDefault(_buildCircle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var GraphicsRenderer=function(_ObjectRenderer){_inherits(GraphicsRenderer,_ObjectRenderer);function GraphicsRenderer(renderer){_classCallCheck(this,GraphicsRenderer);var _this=_possibleConstructorReturn(this,_ObjectRenderer.call(this,renderer));_this.graphicsDataPool=[];_this.primitiveShader=null;_this.gl=renderer.gl;_this.CONTEXT_UID=0;return _this}GraphicsRenderer.prototype.onContextChange=function onContextChange(){this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.primitiveShader=new _PrimitiveShader2.default(this.gl)};GraphicsRenderer.prototype.destroy=function destroy(){_ObjectRenderer3.default.prototype.destroy.call(this);for(var i=0;i<this.graphicsDataPool.length;++i){this.graphicsDataPool[i].destroy()}this.graphicsDataPool=null};GraphicsRenderer.prototype.render=function render(graphics){var renderer=this.renderer;var gl=renderer.gl;var webGLData=void 0;var webGL=graphics._webGL[this.CONTEXT_UID];if(!webGL||graphics.dirty!==webGL.dirty){this.updateGraphics(graphics);webGL=graphics._webGL[this.CONTEXT_UID]}var shader=this.primitiveShader;renderer.bindShader(shader);renderer.state.setBlendMode(graphics.blendMode);for(var i=0,n=webGL.data.length;i<n;i++){webGLData=webGL.data[i];var shaderTemp=webGLData.shader;renderer.bindShader(shaderTemp);shaderTemp.uniforms.translationMatrix=graphics.transform.worldTransform.toArray(true);shaderTemp.uniforms.tint=(0,_utils.hex2rgb)(graphics.tint);shaderTemp.uniforms.alpha=graphics.worldAlpha;renderer.bindVao(webGLData.vao);if(webGLData.nativeLines){gl.drawArrays(gl.LINES,0,webGLData.points.length/6)}else{webGLData.vao.draw(gl.TRIANGLE_STRIP,webGLData.indices.length)}}};GraphicsRenderer.prototype.updateGraphics=function updateGraphics(graphics){var gl=this.renderer.gl;var webGL=graphics._webGL[this.CONTEXT_UID];if(!webGL){webGL=graphics._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:gl,clearDirty:-1,dirty:-1}}webGL.dirty=graphics.dirty;if(graphics.clearDirty!==webGL.clearDirty){webGL.clearDirty=graphics.clearDirty;for(var i=0;i<webGL.data.length;i++){this.graphicsDataPool.push(webGL.data[i])}webGL.data.length=0;webGL.lastIndex=0}var webGLData=void 0;var webGLDataNativeLines=void 0;for(var _i=webGL.lastIndex;_i<graphics.graphicsData.length;_i++){var data=graphics.graphicsData[_i];webGLData=this.getWebGLData(webGL,0);if(data.nativeLines&&data.lineWidth){webGLDataNativeLines=this.getWebGLData(webGL,0,true);webGL.lastIndex++}if(data.type===_const.SHAPES.POLY){(0,_buildPoly2.default)(data,webGLData,webGLDataNativeLines)}if(data.type===_const.SHAPES.RECT){(0,_buildRectangle2.default)(data,webGLData,webGLDataNativeLines)}else if(data.type===_const.SHAPES.CIRC||data.type===_const.SHAPES.ELIP){(0,_buildCircle2.default)(data,webGLData,webGLDataNativeLines)}else if(data.type===_const.SHAPES.RREC){(0,_buildRoundedRectangle2.default)(data,webGLData,webGLDataNativeLines)}webGL.lastIndex++}this.renderer.bindVao(null);for(var _i2=0;_i2<webGL.data.length;_i2++){webGLData=webGL.data[_i2];if(webGLData.dirty){webGLData.upload()}}};GraphicsRenderer.prototype.getWebGLData=function getWebGLData(gl,type,nativeLines){var webGLData=gl.data[gl.data.length-1];if(!webGLData||webGLData.nativeLines!==nativeLines||webGLData.points.length>32e4){webGLData=this.graphicsDataPool.pop()||new _WebGLGraphicsData2.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState);webGLData.nativeLines=nativeLines;webGLData.reset(type);gl.data.push(webGLData)}webGLData.dirty=true;return webGLData};return GraphicsRenderer}(_ObjectRenderer3.default);exports.default=GraphicsRenderer;_WebGLRenderer2.default.registerPlugin("graphics",GraphicsRenderer)},{"../../const":278,"../../renderers/webgl/WebGLRenderer":316,"../../renderers/webgl/utils/ObjectRenderer":326,"../../utils":357,"./WebGLGraphicsData":290,"./shaders/PrimitiveShader":291,"./utils/buildCircle":292,"./utils/buildPoly":294,"./utils/buildRectangle":295,"./utils/buildRoundedRectangle":296}],290:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var WebGLGraphicsData=function(){function WebGLGraphicsData(gl,shader,attribsState){_classCallCheck(this,WebGLGraphicsData);this.gl=gl;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl);this.dirty=true;this.nativeLines=false;this.glPoints=null;this.glIndices=null;this.shader=shader;this.vao=new _pixiGlCore2.default.VertexArrayObject(gl,attribsState).addIndex(this.indexBuffer).addAttribute(this.buffer,shader.attributes.aVertexPosition,gl.FLOAT,false,4*6,0).addAttribute(this.buffer,shader.attributes.aColor,gl.FLOAT,false,4*6,2*4)}WebGLGraphicsData.prototype.reset=function reset(){this.points.length=0;this.indices.length=0};WebGLGraphicsData.prototype.upload=function upload(){this.glPoints=new Float32Array(this.points);this.buffer.upload(this.glPoints);this.glIndices=new Uint16Array(this.indices);this.indexBuffer.upload(this.glIndices);this.dirty=false};WebGLGraphicsData.prototype.destroy=function destroy(){this.color=null;this.points=null;this.indices=null;this.vao.destroy();this.buffer.destroy();this.indexBuffer.destroy();this.gl=null;this.buffer=null;this.indexBuffer=null;this.glPoints=null;this.glIndices=null};return WebGLGraphicsData}();exports.default=WebGLGraphicsData},{"pixi-gl-core":261}],291:[function(require,module,exports){"use strict";exports.__esModule=true;var _Shader2=require("../../../Shader");var _Shader3=_interopRequireDefault(_Shader2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PrimitiveShader=function(_Shader){_inherits(PrimitiveShader,_Shader);function PrimitiveShader(gl){_classCallCheck(this,PrimitiveShader);return _possibleConstructorReturn(this,_Shader.call(this,gl,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return PrimitiveShader}(_Shader3.default);exports.default=PrimitiveShader},{"../../../Shader":276}],292:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildCircle;var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _const=require("../../../const");var _utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildCircle(graphicsData,webGLData,webGLDataNativeLines){var circleData=graphicsData.shape;var x=circleData.x;var y=circleData.y;var width=void 0;var height=void 0;if(graphicsData.type===_const.SHAPES.CIRC){width=circleData.radius;height=circleData.radius}else{width=circleData.width;height=circleData.height}if(width===0||height===0){return}var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(circleData.width+circleData.height));var seg=Math.PI*2/totalSegs;if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;indices.push(vecPos);for(var i=0;i<totalSegs+1;i++){verts.push(x,y,r,g,b,alpha);verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha);indices.push(vecPos++,vecPos++)}indices.push(vecPos-1)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[];for(var _i=0;_i<totalSegs+1;_i++){graphicsData.points.push(x+Math.sin(seg*_i)*width,y+Math.cos(seg*_i)*height)}(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines);graphicsData.points=tempPoints}}},{"../../../const":278,"../../../utils":357,"./buildLine":293}],293:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(graphicsData,webGLData,webGLDataNativeLines){if(graphicsData.nativeLines){buildNativeLine(graphicsData,webGLDataNativeLines)}else{buildLine(graphicsData,webGLData)}};var _math=require("../../../math");var _utils=require("../../../utils");function buildLine(graphicsData,webGLData){var points=graphicsData.points;if(points.length===0){return}var firstPoint=new _math.Point(points[0],points[1]);var lastPoint=new _math.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x===lastPoint.x&&firstPoint.y===lastPoint.y){points=points.slice();points.pop();points.pop();lastPoint=new _math.Point(points[points.length-2],points[points.length-1]);var midPointX=lastPoint.x+(firstPoint.x-lastPoint.x)*.5;var midPointY=lastPoint.y+(firstPoint.y-lastPoint.y)*.5;points.unshift(midPointX,midPointY);points.push(midPointX,midPointY)}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var indexCount=points.length;var indexStart=verts.length/6;var width=graphicsData.lineWidth/2;var color=(0,_utils.hex2rgb)(graphicsData.lineColor);var alpha=graphicsData.lineAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var p1x=points[0];var p1y=points[1];var p2x=points[2];var p2y=points[3];var p3x=0;var p3y=0;var perpx=-(p1y-p2y);var perpy=p1x-p2x;var perp2x=0;var perp2y=0;var perp3x=0;var perp3y=0;var dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p1x-perpx,p1y-perpy,r,g,b,alpha);verts.push(p1x+perpx,p1y+perpy,r,g,b,alpha);for(var i=1;i<length-1;++i){p1x=points[(i-1)*2];p1y=points[(i-1)*2+1];p2x=points[i*2];p2y=points[i*2+1];p3x=points[(i+1)*2];p3y=points[(i+1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x/=dist;perp2y/=dist;perp2x*=width;perp2y*=width;var a1=-perpy+p1y-(-perpy+p2y);var b1=-perpx+p2x-(-perpx+p1x);var c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);var a2=-perp2y+p3y-(-perp2y+p2y);var b2=-perp2x+p2x-(-perp2x+p3x);var c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);var denom=a1*b2-a2*b1;if(Math.abs(denom)<.1){denom+=10.1;verts.push(p2x-perpx,p2y-perpy,r,g,b,alpha);verts.push(p2x+perpx,p2y+perpy,r,g,b,alpha);continue}var px=(b1*c2-b2*c1)/denom;var py=(a2*c1-a1*c2)/denom;var pdist=(px-p2x)*(px-p2x)+(py-p2y)*(py-p2y);if(pdist>196*width*width){perp3x=perpx-perp2x;perp3y=perpy-perp2y;dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y);perp3x/=dist;perp3y/=dist;perp3x*=width;perp3y*=width;verts.push(p2x-perp3x,p2y-perp3y);verts.push(r,g,b,alpha);verts.push(p2x+perp3x,p2y+perp3y);verts.push(r,g,b,alpha);verts.push(p2x-perp3x,p2y-perp3y);verts.push(r,g,b,alpha);indexCount++}else{verts.push(px,py);verts.push(r,g,b,alpha);verts.push(p2x-(px-p2x),p2y-(py-p2y));verts.push(r,g,b,alpha)}}p1x=points[(length-2)*2];p1y=points[(length-2)*2+1];p2x=points[(length-1)*2];p2y=points[(length-1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p2x-perpx,p2y-perpy);verts.push(r,g,b,alpha);verts.push(p2x+perpx,p2y+perpy);verts.push(r,g,b,alpha);indices.push(indexStart);for(var _i=0;_i<indexCount;++_i){indices.push(indexStart++)}indices.push(indexStart-1)}function buildNativeLine(graphicsData,webGLData){var i=0;var points=graphicsData.points;if(points.length===0)return;var verts=webGLData.points;var length=points.length/2;var color=(0,_utils.hex2rgb)(graphicsData.lineColor);var alpha=graphicsData.lineAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;for(i=1;i<length;i++){var p1x=points[(i-1)*2];var p1y=points[(i-1)*2+1];var p2x=points[i*2];var p2y=points[i*2+1];verts.push(p1x,p1y);verts.push(r,g,b,alpha);verts.push(p2x,p2y);verts.push(r,g,b,alpha)}}},{"../../../math":302,"../../../utils":357}],294:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildPoly;var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _utils=require("../../../utils");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildPoly(graphicsData,webGLData,webGLDataNativeLines){graphicsData.points=graphicsData.shape.points.slice();var points=graphicsData.points;if(graphicsData.fill&&points.length>=6){var holeArray=[];var holes=graphicsData.holes;for(var i=0;i<holes.length;i++){var hole=holes[i];holeArray.push(points.length/2);points=points.concat(hole.points)}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var triangles=(0,_earcut2.default)(points,holeArray,2);if(!triangles){return}var vertPos=verts.length/6;for(var _i=0;_i<triangles.length;_i+=3){indices.push(triangles[_i]+vertPos);indices.push(triangles[_i]+vertPos);indices.push(triangles[_i+1]+vertPos);indices.push(triangles[_i+2]+vertPos);indices.push(triangles[_i+2]+vertPos)}for(var _i2=0;_i2<length;_i2++){verts.push(points[_i2*2],points[_i2*2+1],r,g,b,alpha)}}if(graphicsData.lineWidth>0){(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines)}}},{"../../../utils":357,"./buildLine":293,earcut:157}],295:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildRectangle;var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildRectangle(graphicsData,webGLData,webGLDataNativeLines){var rectData=graphicsData.shape;var x=rectData.x;var y=rectData.y;var width=rectData.width;var height=rectData.height;if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vertPos=verts.length/6;verts.push(x,y);verts.push(r,g,b,alpha);verts.push(x+width,y);verts.push(r,g,b,alpha);verts.push(x,y+height);verts.push(r,g,b,alpha);verts.push(x+width,y+height);verts.push(r,g,b,alpha);indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y];(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines);graphicsData.points=tempPoints}}},{"../../../utils":357,"./buildLine":293}],296:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=buildRoundedRectangle;var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _buildLine=require("./buildLine");var _buildLine2=_interopRequireDefault(_buildLine);var _utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildRoundedRectangle(graphicsData,webGLData,webGLDataNativeLines){var rrectData=graphicsData.shape;var x=rrectData.x;var y=rrectData.y;var width=rrectData.width;var height=rrectData.height;var radius=rrectData.radius;var recPoints=[];recPoints.push(x,y+radius);quadraticBezierCurve(x,y+height-radius,x,y+height,x+radius,y+height,recPoints);quadraticBezierCurve(x+width-radius,y+height,x+width,y+height,x+width,y+height-radius,recPoints);quadraticBezierCurve(x+width,y+radius,x+width,y,x+width-radius,y,recPoints);quadraticBezierCurve(x+radius,y,x,y,x,y+radius+1e-10,recPoints);if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;var triangles=(0,_earcut2.default)(recPoints,null,2);for(var i=0,j=triangles.length;i<j;i+=3){indices.push(triangles[i]+vecPos);indices.push(triangles[i]+vecPos);indices.push(triangles[i+1]+vecPos);indices.push(triangles[i+2]+vecPos);indices.push(triangles[i+2]+vecPos)}for(var _i=0,_j=recPoints.length;_i<_j;_i++){verts.push(recPoints[_i],recPoints[++_i],r,g,b,alpha)}}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=recPoints;(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines);graphicsData.points=tempPoints}}function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}function quadraticBezierCurve(fromX,fromY,cpX,cpY,toX,toY){var out=arguments.length>6&&arguments[6]!==undefined?arguments[6]:[];var n=20;var points=out;var xa=0;var ya=0;var xb=0;var yb=0;var x=0;var y=0;for(var i=0,j=0;i<=n;++i){j=i/n;xa=getPt(fromX,cpX,j);ya=getPt(fromY,cpY,j);xb=getPt(cpX,toX,j);yb=getPt(cpY,toY,j);x=getPt(xa,xb,j);y=getPt(ya,yb,j);points.push(x,y)}return points}},{"../../../utils":357,"./buildLine":293,earcut:157}],297:[function(require,module,exports){"use strict";exports.__esModule=true;exports.autoDetectRenderer=exports.Application=exports.Filter=exports.SpriteMaskFilter=exports.Quad=exports.RenderTarget=exports.ObjectRenderer=exports.WebGLManager=exports.Shader=exports.CanvasRenderTarget=exports.TextureUvs=exports.VideoBaseTexture=exports.BaseRenderTexture=exports.RenderTexture=exports.BaseTexture=exports.TextureMatrix=exports.Texture=exports.Spritesheet=exports.CanvasGraphicsRenderer=exports.GraphicsRenderer=exports.GraphicsData=exports.Graphics=exports.TextMetrics=exports.TextStyle=exports.Text=exports.SpriteRenderer=exports.CanvasTinter=exports.CanvasSpriteRenderer=exports.Sprite=exports.TransformBase=exports.TransformStatic=exports.Transform=exports.Container=exports.DisplayObject=exports.Bounds=exports.glCore=exports.WebGLRenderer=exports.CanvasRenderer=exports.ticker=exports.utils=exports.settings=undefined;var _const=require("./const");Object.keys(_const).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _const[key]}})});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _pixiGlCore=require("pixi-gl-core");Object.defineProperty(exports,"glCore",{enumerable:true,get:function get(){return _interopRequireDefault(_pixiGlCore).default}});var _Bounds=require("./display/Bounds");Object.defineProperty(exports,"Bounds",{enumerable:true,get:function get(){return _interopRequireDefault(_Bounds).default}});var _DisplayObject=require("./display/DisplayObject");Object.defineProperty(exports,"DisplayObject",{enumerable:true,get:function get(){return _interopRequireDefault(_DisplayObject).default}});var _Container=require("./display/Container");Object.defineProperty(exports,"Container",{enumerable:true,get:function get(){return _interopRequireDefault(_Container).default}});var _Transform=require("./display/Transform");Object.defineProperty(exports,"Transform",{enumerable:true,get:function get(){return _interopRequireDefault(_Transform).default}});var _TransformStatic=require("./display/TransformStatic");Object.defineProperty(exports,"TransformStatic",{enumerable:true,get:function get(){return _interopRequireDefault(_TransformStatic).default}});var _TransformBase=require("./display/TransformBase");Object.defineProperty(exports,"TransformBase",{enumerable:true,get:function get(){return _interopRequireDefault(_TransformBase).default}});var _Sprite=require("./sprites/Sprite");Object.defineProperty(exports,"Sprite",{enumerable:true,get:function get(){return _interopRequireDefault(_Sprite).default}});var _CanvasSpriteRenderer=require("./sprites/canvas/CanvasSpriteRenderer");Object.defineProperty(exports,"CanvasSpriteRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasSpriteRenderer).default}});var _CanvasTinter=require("./sprites/canvas/CanvasTinter");Object.defineProperty(exports,"CanvasTinter",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasTinter).default}});var _SpriteRenderer=require("./sprites/webgl/SpriteRenderer");Object.defineProperty(exports,"SpriteRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_SpriteRenderer).default}});var _Text=require("./text/Text");Object.defineProperty(exports,"Text",{enumerable:true,get:function get(){return _interopRequireDefault(_Text).default}});var _TextStyle=require("./text/TextStyle");Object.defineProperty(exports,"TextStyle",{enumerable:true,get:function get(){return _interopRequireDefault(_TextStyle).default}});var _TextMetrics=require("./text/TextMetrics");Object.defineProperty(exports,"TextMetrics",{enumerable:true,get:function get(){return _interopRequireDefault(_TextMetrics).default}});var _Graphics=require("./graphics/Graphics");Object.defineProperty(exports,"Graphics",{enumerable:true,get:function get(){return _interopRequireDefault(_Graphics).default}});var _GraphicsData=require("./graphics/GraphicsData");Object.defineProperty(exports,"GraphicsData",{enumerable:true,get:function get(){return _interopRequireDefault(_GraphicsData).default}});var _GraphicsRenderer=require("./graphics/webgl/GraphicsRenderer");Object.defineProperty(exports,"GraphicsRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_GraphicsRenderer).default}});var _CanvasGraphicsRenderer=require("./graphics/canvas/CanvasGraphicsRenderer");Object.defineProperty(exports,"CanvasGraphicsRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasGraphicsRenderer).default}});var _Spritesheet=require("./textures/Spritesheet");Object.defineProperty(exports,"Spritesheet",{enumerable:true,get:function get(){return _interopRequireDefault(_Spritesheet).default}});var _Texture=require("./textures/Texture");Object.defineProperty(exports,"Texture",{enumerable:true,get:function get(){return _interopRequireDefault(_Texture).default}});var _TextureMatrix=require("./textures/TextureMatrix");Object.defineProperty(exports,"TextureMatrix",{enumerable:true,get:function get(){return _interopRequireDefault(_TextureMatrix).default}});var _BaseTexture=require("./textures/BaseTexture");Object.defineProperty(exports,"BaseTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_BaseTexture).default}});var _RenderTexture=require("./textures/RenderTexture");Object.defineProperty(exports,"RenderTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_RenderTexture).default}});var _BaseRenderTexture=require("./textures/BaseRenderTexture");Object.defineProperty(exports,"BaseRenderTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_BaseRenderTexture).default}});var _VideoBaseTexture=require("./textures/VideoBaseTexture");Object.defineProperty(exports,"VideoBaseTexture",{enumerable:true,get:function get(){return _interopRequireDefault(_VideoBaseTexture).default}});var _TextureUvs=require("./textures/TextureUvs");Object.defineProperty(exports,"TextureUvs",{enumerable:true,get:function get(){return _interopRequireDefault(_TextureUvs).default}});var _CanvasRenderTarget=require("./renderers/canvas/utils/CanvasRenderTarget");Object.defineProperty(exports,"CanvasRenderTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasRenderTarget).default}});var _Shader=require("./Shader");Object.defineProperty(exports,"Shader",{enumerable:true,get:function get(){return _interopRequireDefault(_Shader).default}});var _WebGLManager=require("./renderers/webgl/managers/WebGLManager");Object.defineProperty(exports,"WebGLManager",{enumerable:true,get:function get(){return _interopRequireDefault(_WebGLManager).default}});var _ObjectRenderer=require("./renderers/webgl/utils/ObjectRenderer");Object.defineProperty(exports,"ObjectRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_ObjectRenderer).default}});var _RenderTarget=require("./renderers/webgl/utils/RenderTarget");Object.defineProperty(exports,"RenderTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_RenderTarget).default}});var _Quad=require("./renderers/webgl/utils/Quad");Object.defineProperty(exports,"Quad",{enumerable:true,get:function get(){return _interopRequireDefault(_Quad).default}});var _SpriteMaskFilter=require("./renderers/webgl/filters/spriteMask/SpriteMaskFilter");Object.defineProperty(exports,"SpriteMaskFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_SpriteMaskFilter).default}});var _Filter=require("./renderers/webgl/filters/Filter");Object.defineProperty(exports,"Filter",{enumerable:true,get:function get(){return _interopRequireDefault(_Filter).default}});var _Application=require("./Application");Object.defineProperty(exports,"Application",{enumerable:true,get:function get(){return _interopRequireDefault(_Application).default}});var _autoDetectRenderer=require("./autoDetectRenderer");Object.defineProperty(exports,"autoDetectRenderer",{enumerable:true,get:function get(){return _autoDetectRenderer.autoDetectRenderer}});var _utils=require("./utils");var utils=_interopRequireWildcard(_utils);var _ticker=require("./ticker");var ticker=_interopRequireWildcard(_ticker);var _settings=require("./settings");var _settings2=_interopRequireDefault(_settings);var _CanvasRenderer=require("./renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _WebGLRenderer=require("./renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.settings=_settings2.default;exports.utils=utils;exports.ticker=ticker;exports.CanvasRenderer=_CanvasRenderer2.default;exports.WebGLRenderer=_WebGLRenderer2.default},{"./Application":275,"./Shader":276,"./autoDetectRenderer":277,"./const":278,"./display/Bounds":279,"./display/Container":280,"./display/DisplayObject":281,"./display/Transform":282,"./display/TransformBase":283,"./display/TransformStatic":284,"./graphics/Graphics":285,"./graphics/GraphicsData":286,"./graphics/canvas/CanvasGraphicsRenderer":287,"./graphics/webgl/GraphicsRenderer":289,"./math":302,"./renderers/canvas/CanvasRenderer":309,"./renderers/canvas/utils/CanvasRenderTarget":311,"./renderers/webgl/WebGLRenderer":316,"./renderers/webgl/filters/Filter":318,"./renderers/webgl/filters/spriteMask/SpriteMaskFilter":321,"./renderers/webgl/managers/WebGLManager":325,"./renderers/webgl/utils/ObjectRenderer":326,"./renderers/webgl/utils/Quad":327,"./renderers/webgl/utils/RenderTarget":328,"./settings":333,"./sprites/Sprite":334,"./sprites/canvas/CanvasSpriteRenderer":335,"./sprites/canvas/CanvasTinter":336,"./sprites/webgl/SpriteRenderer":338,"./text/Text":340,"./text/TextMetrics":341,"./text/TextStyle":342,"./textures/BaseRenderTexture":343,"./textures/BaseTexture":344,"./textures/RenderTexture":345,"./textures/Spritesheet":346,"./textures/Texture":347,"./textures/TextureMatrix":348,"./textures/TextureUvs":349,"./textures/VideoBaseTexture":350,"./ticker":353,"./utils":357,"pixi-gl-core":261}],298:[function(require,module,exports){"use strict";exports.__esModule=true;var _Matrix=require("./Matrix");var _Matrix2=_interopRequireDefault(_Matrix);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1];var uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1];var vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1];var vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1];var tempMatrices=[];var mul=[];function signum(x){if(x<0){return-1}if(x>0){return 1}return 0}function init(){for(var i=0;i<16;i++){var row=[];mul.push(row);for(var j=0;j<16;j++){var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]);var _uy=signum(uy[i]*ux[j]+vy[i]*uy[j]);var _vx=signum(ux[i]*vx[j]+vx[i]*vy[j]);var _vy=signum(uy[i]*vx[j]+vy[i]*vy[j]);for(var k=0;k<16;k++){if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}}}for(var _i=0;_i<16;_i++){var mat=new _Matrix2.default;mat.set(ux[_i],uy[_i],vx[_i],vy[_i],0,0);tempMatrices.push(mat)}}init();var GroupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function uX(ind){return ux[ind]},uY:function uY(ind){return uy[ind]},vX:function vX(ind){return vx[ind]},vY:function vY(ind){return vy[ind]},inv:function inv(rotation){if(rotation&8){return rotation&15}return-rotation&7},add:function add(rotationSecond,rotationFirst){return mul[rotationSecond][rotationFirst]},sub:function sub(rotationSecond,rotationFirst){return mul[rotationSecond][GroupD8.inv(rotationFirst)]},rotate180:function rotate180(rotation){return rotation^4},isVertical:function isVertical(rotation){return(rotation&3)===2},byDirection:function byDirection(dx,dy){if(Math.abs(dx)*2<=Math.abs(dy)){if(dy>=0){return GroupD8.S}return GroupD8.N}else if(Math.abs(dy)*2<=Math.abs(dx)){if(dx>0){return GroupD8.E}return GroupD8.W}else if(dy>0){if(dx>0){return GroupD8.SE}return GroupD8.SW}else if(dx>0){return GroupD8.NE}return GroupD8.NW},matrixAppendRotationInv:function matrixAppendRotationInv(matrix,rotation){var tx=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var ty=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var mat=tempMatrices[GroupD8.inv(rotation)];mat.tx=tx;mat.ty=ty;matrix.append(mat)}};exports.default=GroupD8},{"./Matrix":299}],299:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Point=require("./Point");var _Point2=_interopRequireDefault(_Point);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Matrix=function(){function Matrix(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var tx=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var ty=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;_classCallCheck(this,Matrix);this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;this.array=null}Matrix.prototype.fromArray=function fromArray(array){this.a=array[0];this.b=array[1];this.c=array[3];this.d=array[4];this.tx=array[2];this.ty=array[5]};Matrix.prototype.set=function set(a,b,c,d,tx,ty){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;return this};Matrix.prototype.toArray=function toArray(transpose,out){if(!this.array){this.array=new Float32Array(9)}var array=out||this.array;if(transpose){array[0]=this.a;array[1]=this.b;array[2]=0;array[3]=this.c;array[4]=this.d;array[5]=0;array[6]=this.tx;array[7]=this.ty;array[8]=1}else{array[0]=this.a;array[1]=this.c;array[2]=this.tx;array[3]=this.b;array[4]=this.d;array[5]=this.ty;array[6]=0;array[7]=0;array[8]=1}return array};Matrix.prototype.apply=function apply(pos,newPos){newPos=newPos||new _Point2.default;var x=pos.x;var y=pos.y;newPos.x=this.a*x+this.c*y+this.tx;newPos.y=this.b*x+this.d*y+this.ty;return newPos};Matrix.prototype.applyInverse=function applyInverse(pos,newPos){newPos=newPos||new _Point2.default;var id=1/(this.a*this.d+this.c*-this.b);var x=pos.x;var y=pos.y;newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id;newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id;return newPos};Matrix.prototype.translate=function translate(x,y){this.tx+=x;this.ty+=y;return this};Matrix.prototype.scale=function scale(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;return this};Matrix.prototype.rotate=function rotate(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var a1=this.a;var c1=this.c;var tx1=this.tx;this.a=a1*cos-this.b*sin;this.b=a1*sin+this.b*cos;this.c=c1*cos-this.d*sin;this.d=c1*sin+this.d*cos;this.tx=tx1*cos-this.ty*sin;this.ty=tx1*sin+this.ty*cos;return this};Matrix.prototype.append=function append(matrix){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;this.a=matrix.a*a1+matrix.b*c1;this.b=matrix.a*b1+matrix.b*d1;this.c=matrix.c*a1+matrix.d*c1;this.d=matrix.c*b1+matrix.d*d1;this.tx=matrix.tx*a1+matrix.ty*c1+this.tx;this.ty=matrix.tx*b1+matrix.ty*d1+this.ty;return this};Matrix.prototype.setTransform=function setTransform(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){var sr=Math.sin(rotation);var cr=Math.cos(rotation);var cy=Math.cos(skewY);var sy=Math.sin(skewY);var nsx=-Math.sin(skewX);var cx=Math.cos(skewX);var a=cr*scaleX;var b=sr*scaleX;var c=-sr*scaleY;var d=cr*scaleY;this.a=cy*a+sy*c;this.b=cy*b+sy*d;this.c=nsx*a+cx*c;this.d=nsx*b+cx*d;this.tx=x+(pivotX*a+pivotY*c);this.ty=y+(pivotX*b+pivotY*d);return this};Matrix.prototype.prepend=function prepend(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a;var c1=this.c;this.a=a1*matrix.a+this.b*matrix.c;this.b=a1*matrix.b+this.b*matrix.d;this.c=c1*matrix.a+this.d*matrix.c;this.d=c1*matrix.b+this.d*matrix.d}this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx;this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty;return this};Matrix.prototype.decompose=function decompose(transform){var a=this.a;var b=this.b;var c=this.c;var d=this.d;var skewX=-Math.atan2(-c,d);var skewY=Math.atan2(b,a);var delta=Math.abs(skewX+skewY);if(delta<1e-5){transform.rotation=skewY;if(a<0&&d>=0){transform.rotation+=transform.rotation<=0?Math.PI:-Math.PI}transform.skew.x=transform.skew.y=0}else{transform.skew.x=skewX;transform.skew.y=skewY}transform.scale.x=Math.sqrt(a*a+b*b);transform.scale.y=Math.sqrt(c*c+d*d);transform.position.x=this.tx;transform.position.y=this.ty;return transform};Matrix.prototype.invert=function invert(){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;this.a=d1/n;this.b=-b1/n;this.c=-c1/n;this.d=a1/n;this.tx=(c1*this.ty-d1*tx1)/n;this.ty=-(a1*this.ty-b1*tx1)/n;return this};Matrix.prototype.identity=function identity(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};Matrix.prototype.clone=function clone(){var matrix=new Matrix;matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};Matrix.prototype.copy=function copy(matrix){matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};_createClass(Matrix,null,[{key:"IDENTITY",get:function get(){return new Matrix}},{key:"TEMP_MATRIX",get:function get(){return new Matrix}}]);return Matrix}();exports.default=Matrix},{"./Point":301}],300:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ObservablePoint=function(){function ObservablePoint(cb,scope){var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var y=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,ObservablePoint);this._x=x;this._y=y;this.cb=cb;this.scope=scope}ObservablePoint.prototype.set=function set(x,y){var _x=x||0;var _y=y||(y!==0?_x:0);if(this._x!==_x||this._y!==_y){this._x=_x;this._y=_y;this.cb.call(this.scope)}};ObservablePoint.prototype.copy=function copy(point){if(this._x!==point.x||this._y!==point.y){this._x=point.x;this._y=point.y;this.cb.call(this.scope)}};_createClass(ObservablePoint,[{key:"x",get:function get(){return this._x},set:function set(value){if(this._x!==value){this._x=value;this.cb.call(this.scope)}}},{key:"y",get:function get(){return this._y},set:function set(value){if(this._y!==value){this._y=value;this.cb.call(this.scope)}}}]);return ObservablePoint}();exports.default=ObservablePoint},{}],301:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Point=function(){function Point(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Point);this.x=x;this.y=y}Point.prototype.clone=function clone(){return new Point(this.x,this.y)};Point.prototype.copy=function copy(p){this.set(p.x,p.y)};Point.prototype.equals=function equals(p){return p.x===this.x&&p.y===this.y};Point.prototype.set=function set(x,y){this.x=x||0;this.y=y||(y!==0?this.x:0)};return Point}();exports.default=Point},{}],302:[function(require,module,exports){"use strict";exports.__esModule=true;var _Point=require("./Point");Object.defineProperty(exports,"Point",{enumerable:true,get:function get(){return _interopRequireDefault(_Point).default}});var _ObservablePoint=require("./ObservablePoint");Object.defineProperty(exports,"ObservablePoint",{enumerable:true,get:function get(){return _interopRequireDefault(_ObservablePoint).default}});var _Matrix=require("./Matrix");Object.defineProperty(exports,"Matrix",{enumerable:true,get:function get(){return _interopRequireDefault(_Matrix).default}});var _GroupD=require("./GroupD8");Object.defineProperty(exports,"GroupD8",{enumerable:true,get:function get(){return _interopRequireDefault(_GroupD).default}});var _Circle=require("./shapes/Circle");Object.defineProperty(exports,"Circle",{enumerable:true,get:function get(){return _interopRequireDefault(_Circle).default}});var _Ellipse=require("./shapes/Ellipse");Object.defineProperty(exports,"Ellipse",{enumerable:true,get:function get(){return _interopRequireDefault(_Ellipse).default}});var _Polygon=require("./shapes/Polygon");Object.defineProperty(exports,"Polygon",{enumerable:true,get:function get(){return _interopRequireDefault(_Polygon).default}});var _Rectangle=require("./shapes/Rectangle");Object.defineProperty(exports,"Rectangle",{enumerable:true,get:function get(){return _interopRequireDefault(_Rectangle).default}});var _RoundedRectangle=require("./shapes/RoundedRectangle");Object.defineProperty(exports,"RoundedRectangle",{enumerable:true,get:function get(){return _interopRequireDefault(_RoundedRectangle).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./GroupD8":298,"./Matrix":299,"./ObservablePoint":300,"./Point":301,"./shapes/Circle":303,"./shapes/Ellipse":304,"./shapes/Polygon":305,"./shapes/Rectangle":306,"./shapes/RoundedRectangle":307}],303:[function(require,module,exports){"use strict";exports.__esModule=true;var _Rectangle=require("./Rectangle");var _Rectangle2=_interopRequireDefault(_Rectangle);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Circle=function(){function Circle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var radius=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Circle);this.x=x;this.y=y;this.radius=radius;this.type=_const.SHAPES.CIRC}Circle.prototype.clone=function clone(){return new Circle(this.x,this.y,this.radius)};Circle.prototype.contains=function contains(x,y){if(this.radius<=0){return false}var r2=this.radius*this.radius;var dx=this.x-x;var dy=this.y-y;dx*=dx;dy*=dy;return dx+dy<=r2};Circle.prototype.getBounds=function getBounds(){return new _Rectangle2.default(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)};return Circle}();exports.default=Circle},{"../../const":278,"./Rectangle":306}],304:[function(require,module,exports){"use strict";exports.__esModule=true;var _Rectangle=require("./Rectangle");var _Rectangle2=_interopRequireDefault(_Rectangle);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Ellipse=function(){function Ellipse(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Ellipse);this.x=x;this.y=y;this.width=width;this.height=height;this.type=_const.SHAPES.ELIP}Ellipse.prototype.clone=function clone(){return new Ellipse(this.x,this.y,this.width,this.height)};Ellipse.prototype.contains=function contains(x,y){if(this.width<=0||this.height<=0){return false}var normx=(x-this.x)/this.width;var normy=(y-this.y)/this.height;normx*=normx;normy*=normy;return normx+normy<=1};Ellipse.prototype.getBounds=function getBounds(){return new _Rectangle2.default(this.x-this.width,this.y-this.height,this.width,this.height)};return Ellipse}();exports.default=Ellipse},{"../../const":278,"./Rectangle":306}],305:[function(require,module,exports){"use strict";exports.__esModule=true;var _Point=require("../Point");var _Point2=_interopRequireDefault(_Point);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Polygon=function(){function Polygon(){for(var _len=arguments.length,points=Array(_len),_key=0;_key<_len;_key++){points[_key]=arguments[_key]}_classCallCheck(this,Polygon);if(Array.isArray(points[0])){points=points[0]}if(points[0]instanceof _Point2.default){var p=[];for(var i=0,il=points.length;i<il;i++){p.push(points[i].x,points[i].y)}points=p}this.closed=true;this.points=points;this.type=_const.SHAPES.POLY}Polygon.prototype.clone=function clone(){return new Polygon(this.points.slice())};Polygon.prototype.close=function close(){var points=this.points;if(points[0]!==points[points.length-2]||points[1]!==points[points.length-1]){points.push(points[0],points[1])}};Polygon.prototype.contains=function contains(x,y){var inside=false;var length=this.points.length/2;for(var i=0,j=length-1;i<length;j=i++){var xi=this.points[i*2];var yi=this.points[i*2+1];var xj=this.points[j*2];var yj=this.points[j*2+1];var intersect=yi>y!==yj>y&&x<(xj-xi)*((y-yi)/(yj-yi))+xi;if(intersect){inside=!inside}}return inside};return Polygon}();exports.default=Polygon},{"../../const":278,"../Point":301}],306:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _const=require("../../const");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Rectangle=function(){function Rectangle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Rectangle);this.x=Number(x);this.y=Number(y);this.width=Number(width);this.height=Number(height);this.type=_const.SHAPES.RECT}Rectangle.prototype.clone=function clone(){return new Rectangle(this.x,this.y,this.width,this.height)};Rectangle.prototype.copy=function copy(rectangle){this.x=rectangle.x;this.y=rectangle.y;this.width=rectangle.width;this.height=rectangle.height;return this};Rectangle.prototype.contains=function contains(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<this.x+this.width){if(y>=this.y&&y<this.y+this.height){return true}}return false};Rectangle.prototype.pad=function pad(paddingX,paddingY){paddingX=paddingX||0;paddingY=paddingY||(paddingY!==0?paddingX:0);this.x-=paddingX;this.y-=paddingY;this.width+=paddingX*2;this.height+=paddingY*2};Rectangle.prototype.fit=function fit(rectangle){if(this.x<rectangle.x){this.width+=this.x;if(this.width<0){this.width=0}this.x=rectangle.x}if(this.y<rectangle.y){this.height+=this.y;if(this.height<0){this.height=0}this.y=rectangle.y}if(this.x+this.width>rectangle.x+rectangle.width){this.width=rectangle.width-this.x;if(this.width<0){this.width=0}}if(this.y+this.height>rectangle.y+rectangle.height){this.height=rectangle.height-this.y;if(this.height<0){this.height=0}}};Rectangle.prototype.enlarge=function enlarge(rectangle){var x1=Math.min(this.x,rectangle.x);var x2=Math.max(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.min(this.y,rectangle.y);var y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=x2-x1;this.y=y1;this.height=y2-y1};_createClass(Rectangle,[{key:"left",get:function get(){return this.x}},{key:"right",get:function get(){return this.x+this.width}},{key:"top",get:function get(){return this.y}},{key:"bottom",get:function get(){return this.y+this.height}}],[{key:"EMPTY",get:function get(){return new Rectangle(0,0,0,0)}}]);return Rectangle}();exports.default=Rectangle},{"../../const":278}],307:[function(require,module,exports){"use strict";exports.__esModule=true;var _const=require("../../const");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RoundedRectangle=function(){function RoundedRectangle(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var radius=arguments.length>4&&arguments[4]!==undefined?arguments[4]:20;_classCallCheck(this,RoundedRectangle);this.x=x;this.y=y;this.width=width;this.height=height;this.radius=radius;this.type=_const.SHAPES.RREC}RoundedRectangle.prototype.clone=function clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};RoundedRectangle.prototype.contains=function contains(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<=this.x+this.width){if(y>=this.y&&y<=this.y+this.height){if(y>=this.y+this.radius&&y<=this.y+this.height-this.radius||x>=this.x+this.radius&&x<=this.x+this.width-this.radius){return true}var dx=x-(this.x+this.radius);var dy=y-(this.y+this.radius);var radius2=this.radius*this.radius;if(dx*dx+dy*dy<=radius2){return true}dx=x-(this.x+this.width-this.radius);if(dx*dx+dy*dy<=radius2){return true}dy=y-(this.y+this.height-this.radius);if(dx*dx+dy*dy<=radius2){return true}dx=x-(this.x+this.radius);if(dx*dx+dy*dy<=radius2){return true}}}return false};return RoundedRectangle}();exports.default=RoundedRectangle},{"../../const":278}],308:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _math=require("../math");var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _Container=require("../display/Container");var _Container2=_interopRequireDefault(_Container);var _RenderTexture=require("../textures/RenderTexture");var _RenderTexture2=_interopRequireDefault(_RenderTexture);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempMatrix=new _math.Matrix;var SystemRenderer=function(_EventEmitter){_inherits(SystemRenderer,_EventEmitter);function SystemRenderer(system,options,arg2,arg3){_classCallCheck(this,SystemRenderer);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));(0,_utils.sayHello)(system);if(typeof options==="number"){options=Object.assign({width:options,height:arg2||_settings2.default.RENDER_OPTIONS.height},arg3)}options=Object.assign({},_settings2.default.RENDER_OPTIONS,options);_this.options=options;_this.type=_const.RENDERER_TYPE.UNKNOWN;_this.screen=new _math.Rectangle(0,0,options.width,options.height);_this.view=options.view||document.createElement("canvas");_this.resolution=options.resolution||_settings2.default.RESOLUTION;_this.transparent=options.transparent;_this.autoResize=options.autoResize||false;_this.blendModes=null;_this.preserveDrawingBuffer=options.preserveDrawingBuffer;_this.clearBeforeRender=options.clearBeforeRender;_this.roundPixels=options.roundPixels;_this._backgroundColor=0;_this._backgroundColorRgba=[0,0,0,0];_this._backgroundColorString="#000000";_this.backgroundColor=options.backgroundColor||_this._backgroundColor;_this._tempDisplayObjectParent=new _Container2.default;_this._lastObjectRendered=_this._tempDisplayObjectParent;return _this}SystemRenderer.prototype.resize=function resize(screenWidth,screenHeight){this.screen.width=screenWidth;this.screen.height=screenHeight;this.view.width=screenWidth*this.resolution;this.view.height=screenHeight*this.resolution;if(this.autoResize){this.view.style.width=screenWidth+"px";this.view.style.height=screenHeight+"px"}};SystemRenderer.prototype.generateTexture=function generateTexture(displayObject,scaleMode,resolution){var bounds=displayObject.getLocalBounds();var renderTexture=_RenderTexture2.default.create(bounds.width|0,bounds.height|0,scaleMode,resolution);tempMatrix.tx=-bounds.x;tempMatrix.ty=-bounds.y;this.render(displayObject,renderTexture,false,tempMatrix,true);return renderTexture};SystemRenderer.prototype.destroy=function destroy(removeView){if(removeView&&this.view.parentNode){this.view.parentNode.removeChild(this.view)}this.type=_const.RENDERER_TYPE.UNKNOWN;this.view=null;this.screen=null;this.resolution=0;this.transparent=false;this.autoResize=false;this.blendModes=null;this.options=null;this.preserveDrawingBuffer=false;this.clearBeforeRender=false;this.roundPixels=false;this._backgroundColor=0;this._backgroundColorRgba=null;this._backgroundColorString=null;this._tempDisplayObjectParent=null;this._lastObjectRendered=null};_createClass(SystemRenderer,[{key:"width",get:function get(){return this.view.width}},{key:"height",get:function get(){return this.view.height}},{key:"backgroundColor",get:function get(){return this._backgroundColor},set:function set(value){this._backgroundColor=value;this._backgroundColorString=(0,_utils.hex2string)(value);(0,_utils.hex2rgb)(value,this._backgroundColorRgba)}}]);return SystemRenderer}(_eventemitter2.default);exports.default=SystemRenderer},{"../const":278,"../display/Container":280,"../math":302,"../settings":333,"../textures/RenderTexture":345,"../utils":357,eventemitter3:172}],309:[function(require,module,exports){"use strict";exports.__esModule=true;var _SystemRenderer2=require("../SystemRenderer");var _SystemRenderer3=_interopRequireDefault(_SystemRenderer2);var _CanvasMaskManager=require("./utils/CanvasMaskManager");var _CanvasMaskManager2=_interopRequireDefault(_CanvasMaskManager);var _CanvasRenderTarget=require("./utils/CanvasRenderTarget");var _CanvasRenderTarget2=_interopRequireDefault(_CanvasRenderTarget);var _mapCanvasBlendModesToPixi=require("./utils/mapCanvasBlendModesToPixi");var _mapCanvasBlendModesToPixi2=_interopRequireDefault(_mapCanvasBlendModesToPixi);var _utils=require("../../utils");var _const=require("../../const");var _settings=require("../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CanvasRenderer=function(_SystemRenderer){_inherits(CanvasRenderer,_SystemRenderer);function CanvasRenderer(options,arg2,arg3){_classCallCheck(this,CanvasRenderer);var _this=_possibleConstructorReturn(this,_SystemRenderer.call(this,"Canvas",options,arg2,arg3));_this.type=_const.RENDERER_TYPE.CANVAS;_this.rootContext=_this.view.getContext("2d",{alpha:_this.transparent});_this.context=_this.rootContext;_this.refresh=true;_this.maskManager=new _CanvasMaskManager2.default(_this);_this.smoothProperty="imageSmoothingEnabled";if(!_this.rootContext.imageSmoothingEnabled){if(_this.rootContext.webkitImageSmoothingEnabled){_this.smoothProperty="webkitImageSmoothingEnabled"}else if(_this.rootContext.mozImageSmoothingEnabled){_this.smoothProperty="mozImageSmoothingEnabled"}else if(_this.rootContext.oImageSmoothingEnabled){_this.smoothProperty="oImageSmoothingEnabled"}else if(_this.rootContext.msImageSmoothingEnabled){_this.smoothProperty="msImageSmoothingEnabled"}}_this.initPlugins();_this.blendModes=(0,_mapCanvasBlendModesToPixi2.default)();_this._activeBlendMode=null;_this.renderingToScreen=false;_this.resize(_this.options.width,_this.options.height);return _this}CanvasRenderer.prototype.render=function render(displayObject,renderTexture,clear,transform,skipUpdateTransform){if(!this.view){return}this.renderingToScreen=!renderTexture;this.emit("prerender");var rootResolution=this.resolution;if(renderTexture){renderTexture=renderTexture.baseTexture||renderTexture;if(!renderTexture._canvasRenderTarget){renderTexture._canvasRenderTarget=new _CanvasRenderTarget2.default(renderTexture.width,renderTexture.height,renderTexture.resolution);renderTexture.source=renderTexture._canvasRenderTarget.canvas;renderTexture.valid=true}this.context=renderTexture._canvasRenderTarget.context;this.resolution=renderTexture._canvasRenderTarget.resolution}else{this.context=this.rootContext}var context=this.context;if(!renderTexture){this._lastObjectRendered=displayObject}if(!skipUpdateTransform){var cacheParent=displayObject.parent;var tempWt=this._tempDisplayObjectParent.transform.worldTransform;if(transform){transform.copy(tempWt);this._tempDisplayObjectParent.transform._worldID=-1}else{tempWt.identity()}displayObject.parent=this._tempDisplayObjectParent;displayObject.updateTransform();displayObject.parent=cacheParent}context.save();context.setTransform(1,0,0,1,0,0);context.globalAlpha=1;this._activeBlendMode=_const.BLEND_MODES.NORMAL;context.globalCompositeOperation=this.blendModes[_const.BLEND_MODES.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){context.fillStyle="black";context.clear()}if(clear!==undefined?clear:this.clearBeforeRender){if(this.renderingToScreen){if(this.transparent){context.clearRect(0,0,this.width,this.height)}else{context.fillStyle=this._backgroundColorString;context.fillRect(0,0,this.width,this.height)}}}var tempContext=this.context;this.context=context;displayObject.renderCanvas(this);this.context=tempContext;context.restore();this.resolution=rootResolution;this.emit("postrender")};CanvasRenderer.prototype.clear=function clear(clearColor){var context=this.context;clearColor=clearColor||this._backgroundColorString;if(!this.transparent&&clearColor){context.fillStyle=clearColor;context.fillRect(0,0,this.width,this.height)}else{context.clearRect(0,0,this.width,this.height)}};CanvasRenderer.prototype.setBlendMode=function setBlendMode(blendMode){if(this._activeBlendMode===blendMode){return}this._activeBlendMode=blendMode;this.context.globalCompositeOperation=this.blendModes[blendMode]};CanvasRenderer.prototype.destroy=function destroy(removeView){this.destroyPlugins();_SystemRenderer.prototype.destroy.call(this,removeView);this.context=null;this.refresh=true;this.maskManager.destroy();this.maskManager=null;this.smoothProperty=null};CanvasRenderer.prototype.resize=function resize(screenWidth,screenHeight){_SystemRenderer.prototype.resize.call(this,screenWidth,screenHeight);if(this.smoothProperty){this.rootContext[this.smoothProperty]=_settings2.default.SCALE_MODE===_const.SCALE_MODES.LINEAR}};CanvasRenderer.prototype.invalidateBlendMode=function invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)};return CanvasRenderer}(_SystemRenderer3.default);exports.default=CanvasRenderer;_utils.pluginTarget.mixin(CanvasRenderer)},{"../../const":278,"../../settings":333,"../../utils":357,"../SystemRenderer":308,"./utils/CanvasMaskManager":310,"./utils/CanvasRenderTarget":311,"./utils/mapCanvasBlendModesToPixi":313}],310:[function(require,module,exports){"use strict";exports.__esModule=true;var _const=require("../../../const");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CanvasMaskManager=function(){function CanvasMaskManager(renderer){_classCallCheck(this,CanvasMaskManager);this.renderer=renderer}CanvasMaskManager.prototype.pushMask=function pushMask(maskData){var renderer=this.renderer;renderer.context.save();var cacheAlpha=maskData.alpha;var transform=maskData.transform.worldTransform;var resolution=renderer.resolution;renderer.context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);if(!maskData._texture){this.renderGraphicsShape(maskData);renderer.context.clip()}maskData.worldAlpha=cacheAlpha};CanvasMaskManager.prototype.renderGraphicsShape=function renderGraphicsShape(graphics){var context=this.renderer.context;var len=graphics.graphicsData.length;if(len===0){return}context.beginPath();for(var i=0;i<len;i++){var data=graphics.graphicsData[i];var shape=data.shape;if(data.type===_const.SHAPES.POLY){var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++){context.lineTo(points[j*2],points[j*2+1])}if(points[0]===points[points.length-2]&&points[1]===points[points.length-1]){context.closePath()}}else if(data.type===_const.SHAPES.RECT){context.rect(shape.x,shape.y,shape.width,shape.height);context.closePath()}else if(data.type===_const.SHAPES.CIRC){context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context.closePath()}else if(data.type===_const.SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;var kappa=.5522848;var ox=w/2*kappa;var oy=h/2*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath()}else if(data.type===_const.SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context.moveTo(rx,ry+radius);context.lineTo(rx,ry+height-radius);context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context.lineTo(rx+width-radius,ry+height);context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context.lineTo(rx+width,ry+radius);context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context.lineTo(rx+radius,ry);context.quadraticCurveTo(rx,ry,rx,ry+radius);context.closePath()}}};CanvasMaskManager.prototype.popMask=function popMask(renderer){renderer.context.restore();renderer.invalidateBlendMode()};CanvasMaskManager.prototype.destroy=function destroy(){};return CanvasMaskManager}();exports.default=CanvasMaskManager},{"../../../const":278}],311:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _settings=require("../../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CanvasRenderTarget=function(){function CanvasRenderTarget(width,height,resolution){_classCallCheck(this,CanvasRenderTarget);this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=resolution||_settings2.default.RESOLUTION;this.resize(width,height)}CanvasRenderTarget.prototype.clear=function clear(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderTarget.prototype.resize=function resize(width,height){this.canvas.width=width*this.resolution;this.canvas.height=height*this.resolution};CanvasRenderTarget.prototype.destroy=function destroy(){this.context=null;this.canvas=null};_createClass(CanvasRenderTarget,[{key:"width",get:function get(){return this.canvas.width},set:function set(val){this.canvas.width=val}},{key:"height",get:function get(){return this.canvas.height},set:function set(val){this.canvas.height=val}}]);return CanvasRenderTarget}();exports.default=CanvasRenderTarget},{"../../../settings":333}],312:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=canUseNewCanvasBlendModes;function createColoredCanvas(color){var canvas=document.createElement("canvas");canvas.width=6;canvas.height=1;var context=canvas.getContext("2d");context.fillStyle=color;context.fillRect(0,0,6,1);return canvas}function canUseNewCanvasBlendModes(){if(typeof document==="undefined"){return false}var magenta=createColoredCanvas("#ff00ff");var yellow=createColoredCanvas("#ffff00");var canvas=document.createElement("canvas");canvas.width=6;canvas.height=1;var context=canvas.getContext("2d");context.globalCompositeOperation="multiply";context.drawImage(magenta,0,0);context.drawImage(yellow,2,0);var imageData=context.getImageData(2,0,1,1);if(!imageData){return false}var data=imageData.data;return data[0]===255&&data[1]===0&&data[2]===0}},{}],313:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapCanvasBlendModesToPixi;var _const=require("../../../const");var _canUseNewCanvasBlendModes=require("./canUseNewCanvasBlendModes");var _canUseNewCanvasBlendModes2=_interopRequireDefault(_canUseNewCanvasBlendModes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function mapCanvasBlendModesToPixi(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if((0,_canUseNewCanvasBlendModes2.default)()){array[_const.BLEND_MODES.NORMAL]="source-over";array[_const.BLEND_MODES.ADD]="lighter";array[_const.BLEND_MODES.MULTIPLY]="multiply";array[_const.BLEND_MODES.SCREEN]="screen";array[_const.BLEND_MODES.OVERLAY]="overlay";array[_const.BLEND_MODES.DARKEN]="darken";array[_const.BLEND_MODES.LIGHTEN]="lighten";array[_const.BLEND_MODES.COLOR_DODGE]="color-dodge";array[_const.BLEND_MODES.COLOR_BURN]="color-burn";array[_const.BLEND_MODES.HARD_LIGHT]="hard-light";array[_const.BLEND_MODES.SOFT_LIGHT]="soft-light";array[_const.BLEND_MODES.DIFFERENCE]="difference";array[_const.BLEND_MODES.EXCLUSION]="exclusion";array[_const.BLEND_MODES.HUE]="hue";array[_const.BLEND_MODES.SATURATION]="saturate";array[_const.BLEND_MODES.COLOR]="color";array[_const.BLEND_MODES.LUMINOSITY]="luminosity"}else{array[_const.BLEND_MODES.NORMAL]="source-over";array[_const.BLEND_MODES.ADD]="lighter";array[_const.BLEND_MODES.MULTIPLY]="source-over";array[_const.BLEND_MODES.SCREEN]="source-over";array[_const.BLEND_MODES.OVERLAY]="source-over";array[_const.BLEND_MODES.DARKEN]="source-over";array[_const.BLEND_MODES.LIGHTEN]="source-over";array[_const.BLEND_MODES.COLOR_DODGE]="source-over";array[_const.BLEND_MODES.COLOR_BURN]="source-over";array[_const.BLEND_MODES.HARD_LIGHT]="source-over";array[_const.BLEND_MODES.SOFT_LIGHT]="source-over";array[_const.BLEND_MODES.DIFFERENCE]="source-over";array[_const.BLEND_MODES.EXCLUSION]="source-over";array[_const.BLEND_MODES.HUE]="source-over";array[_const.BLEND_MODES.SATURATION]="source-over";array[_const.BLEND_MODES.COLOR]="source-over";array[_const.BLEND_MODES.LUMINOSITY]="source-over"}array[_const.BLEND_MODES.NORMAL_NPM]=array[_const.BLEND_MODES.NORMAL];array[_const.BLEND_MODES.ADD_NPM]=array[_const.BLEND_MODES.ADD];array[_const.BLEND_MODES.SCREEN_NPM]=array[_const.BLEND_MODES.SCREEN];return array}},{"../../../const":278,"./canUseNewCanvasBlendModes":312}],314:[function(require,module,exports){"use strict";exports.__esModule=true;var _const=require("../../const");var _settings=require("../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextureGarbageCollector=function(){function TextureGarbageCollector(renderer){_classCallCheck(this,TextureGarbageCollector);this.renderer=renderer;this.count=0;this.checkCount=0;this.maxIdle=_settings2.default.GC_MAX_IDLE;this.checkCountMax=_settings2.default.GC_MAX_CHECK_COUNT;this.mode=_settings2.default.GC_MODE}TextureGarbageCollector.prototype.update=function update(){this.count++;if(this.mode===_const.GC_MODES.MANUAL){return}this.checkCount++;if(this.checkCount>this.checkCountMax){this.checkCount=0;this.run()}};TextureGarbageCollector.prototype.run=function run(){var tm=this.renderer.textureManager;var managedTextures=tm._managedTextures;var wasRemoved=false;for(var i=0;i<managedTextures.length;i++){var texture=managedTextures[i];if(!texture._glRenderTargets&&this.count-texture.touched>this.maxIdle){tm.destroyTexture(texture,true);managedTextures[i]=null;wasRemoved=true}}if(wasRemoved){var j=0;for(var _i=0;_i<managedTextures.length;_i++){if(managedTextures[_i]!==null){managedTextures[j++]=managedTextures[_i]}}managedTextures.length=j}};TextureGarbageCollector.prototype.unload=function unload(displayObject){var tm=this.renderer.textureManager;if(displayObject._texture&&displayObject._texture._glRenderTargets){tm.destroyTexture(displayObject._texture,true)}for(var i=displayObject.children.length-1;i>=0;i--){this.unload(displayObject.children[i])}};return TextureGarbageCollector}();exports.default=TextureGarbageCollector},{"../../const":278,"../../settings":333}],315:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _const=require("../../const");var _RenderTarget=require("./utils/RenderTarget");var _RenderTarget2=_interopRequireDefault(_RenderTarget);var _utils=require("../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextureManager=function(){function TextureManager(renderer){_classCallCheck(this,TextureManager);this.renderer=renderer;this.gl=renderer.gl;this._managedTextures=[]}TextureManager.prototype.bindTexture=function bindTexture(){};TextureManager.prototype.getTexture=function getTexture(){};TextureManager.prototype.updateTexture=function updateTexture(texture,location){var gl=this.gl;var isRenderTexture=!!texture._glRenderTargets;if(!texture.hasLoaded){return null}var boundTextures=this.renderer.boundTextures;if(location===undefined){location=0;for(var i=0;i<boundTextures.length;++i){if(boundTextures[i]===texture){location=i;break}}}boundTextures[location]=texture;gl.activeTexture(gl.TEXTURE0+location);var glTexture=texture._glTextures[this.renderer.CONTEXT_UID];if(!glTexture){if(isRenderTexture){var renderTarget=new _RenderTarget2.default(this.gl,texture.width,texture.height,texture.scaleMode,texture.resolution);renderTarget.resize(texture.width,texture.height);texture._glRenderTargets[this.renderer.CONTEXT_UID]=renderTarget;glTexture=renderTarget.texture}else{glTexture=new _pixiGlCore.GLTexture(this.gl,null,null,null,null);glTexture.bind(location);glTexture.premultiplyAlpha=true;glTexture.upload(texture.source)}texture._glTextures[this.renderer.CONTEXT_UID]=glTexture;texture.on("update",this.updateTexture,this);texture.on("dispose",this.destroyTexture,this);this._managedTextures.push(texture);if(texture.isPowerOfTwo){if(texture.mipmap){glTexture.enableMipmap()}if(texture.wrapMode===_const.WRAP_MODES.CLAMP){glTexture.enableWrapClamp()}else if(texture.wrapMode===_const.WRAP_MODES.REPEAT){glTexture.enableWrapRepeat()}else{glTexture.enableWrapMirrorRepeat()}}else{glTexture.enableWrapClamp()}if(texture.scaleMode===_const.SCALE_MODES.NEAREST){glTexture.enableNearestScaling()}else{glTexture.enableLinearScaling()}}else if(isRenderTexture){texture._glRenderTargets[this.renderer.CONTEXT_UID].resize(texture.width,texture.height)}else{glTexture.upload(texture.source)}return glTexture};TextureManager.prototype.destroyTexture=function destroyTexture(texture,skipRemove){texture=texture.baseTexture||texture;if(!texture.hasLoaded){return}var uid=this.renderer.CONTEXT_UID;var glTextures=texture._glTextures;var glRenderTargets=texture._glRenderTargets;if(glTextures[uid]){this.renderer.unbindTexture(texture);glTextures[uid].destroy();texture.off("update",this.updateTexture,this);texture.off("dispose",this.destroyTexture,this);delete glTextures[uid];if(!skipRemove){var i=this._managedTextures.indexOf(texture);if(i!==-1){(0,_utils.removeItems)(this._managedTextures,i,1)}}}if(glRenderTargets&&glRenderTargets[uid]){glRenderTargets[uid].destroy();delete glRenderTargets[uid]}};TextureManager.prototype.removeAll=function removeAll(){for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];if(texture._glTextures[this.renderer.CONTEXT_UID]){delete texture._glTextures[this.renderer.CONTEXT_UID]}}};TextureManager.prototype.destroy=function destroy(){for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];this.destroyTexture(texture,true);texture.off("update",this.updateTexture,this);texture.off("dispose",this.destroyTexture,this)}this._managedTextures=null};return TextureManager}();exports.default=TextureManager},{"../../const":278,"../../utils":357,"./utils/RenderTarget":328,"pixi-gl-core":261}],316:[function(require,module,exports){"use strict";exports.__esModule=true;var _SystemRenderer2=require("../SystemRenderer");var _SystemRenderer3=_interopRequireDefault(_SystemRenderer2);var _MaskManager=require("./managers/MaskManager");var _MaskManager2=_interopRequireDefault(_MaskManager);var _StencilManager=require("./managers/StencilManager");var _StencilManager2=_interopRequireDefault(_StencilManager);var _FilterManager=require("./managers/FilterManager");var _FilterManager2=_interopRequireDefault(_FilterManager);var _RenderTarget=require("./utils/RenderTarget");var _RenderTarget2=_interopRequireDefault(_RenderTarget);var _ObjectRenderer=require("./utils/ObjectRenderer");var _ObjectRenderer2=_interopRequireDefault(_ObjectRenderer);var _TextureManager=require("./TextureManager");var _TextureManager2=_interopRequireDefault(_TextureManager);var _BaseTexture=require("../../textures/BaseTexture");var _BaseTexture2=_interopRequireDefault(_BaseTexture);var _TextureGarbageCollector=require("./TextureGarbageCollector");var _TextureGarbageCollector2=_interopRequireDefault(_TextureGarbageCollector);var _WebGLState=require("./WebGLState");var _WebGLState2=_interopRequireDefault(_WebGLState);var _mapWebGLDrawModesToPixi=require("./utils/mapWebGLDrawModesToPixi");var _mapWebGLDrawModesToPixi2=_interopRequireDefault(_mapWebGLDrawModesToPixi);var _validateContext=require("./utils/validateContext");var _validateContext2=_interopRequireDefault(_validateContext);var _utils=require("../../utils");var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CONTEXT_UID=0;var WebGLRenderer=function(_SystemRenderer){_inherits(WebGLRenderer,_SystemRenderer);function WebGLRenderer(options,arg2,arg3){_classCallCheck(this,WebGLRenderer);var _this=_possibleConstructorReturn(this,_SystemRenderer.call(this,"WebGL",options,arg2,arg3));_this.legacy=_this.options.legacy;if(_this.legacy){_pixiGlCore2.default.VertexArrayObject.FORCE_NATIVE=true}_this.type=_const.RENDERER_TYPE.WEBGL;_this.handleContextLost=_this.handleContextLost.bind(_this);_this.handleContextRestored=_this.handleContextRestored.bind(_this);_this.view.addEventListener("webglcontextlost",_this.handleContextLost,false);_this.view.addEventListener("webglcontextrestored",_this.handleContextRestored,false);_this._contextOptions={alpha:_this.transparent,antialias:_this.options.antialias,premultipliedAlpha:_this.transparent&&_this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:_this.options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference};_this._backgroundColorRgba[3]=_this.transparent?0:1;_this.maskManager=new _MaskManager2.default(_this);_this.stencilManager=new _StencilManager2.default(_this);_this.emptyRenderer=new _ObjectRenderer2.default(_this);_this.currentRenderer=_this.emptyRenderer;_this.textureManager=null;_this.filterManager=null;_this.initPlugins();if(_this.options.context){(0,_validateContext2.default)(_this.options.context)}_this.gl=_this.options.context||_pixiGlCore2.default.createContext(_this.view,_this._contextOptions);_this.CONTEXT_UID=CONTEXT_UID++;_this.state=new _WebGLState2.default(_this.gl);_this.renderingToScreen=true;_this.boundTextures=null;_this._activeShader=null;_this._activeVao=null;_this._activeRenderTarget=null;_this._initContext();_this.drawModes=(0,_mapWebGLDrawModesToPixi2.default)(_this.gl);_this._nextTextureLocation=0;_this.setBlendMode(0);return _this}WebGLRenderer.prototype._initContext=function _initContext(){var gl=this.gl;if(gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")){gl.getExtension("WEBGL_lose_context").restoreContext()}var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null;this._activeVao=null;this.boundTextures=new Array(maxTextures);this.emptyTextures=new Array(maxTextures);this.textureManager=new _TextureManager2.default(this);this.filterManager=new _FilterManager2.default(this);this.textureGC=new _TextureGarbageCollector2.default(this);this.state.resetToDefault();this.rootRenderTarget=new _RenderTarget2.default(gl,this.width,this.height,null,this.resolution,true);this.rootRenderTarget.clearColor=this._backgroundColorRgba;this.bindRenderTarget(this.rootRenderTarget);var emptyGLTexture=new _pixiGlCore2.default.GLTexture.fromData(gl,null,1,1);var tempObj={_glTextures:{}};tempObj._glTextures[this.CONTEXT_UID]={};for(var i=0;i<maxTextures;i++){var empty=new _BaseTexture2.default;empty._glTextures[this.CONTEXT_UID]=emptyGLTexture;this.boundTextures[i]=tempObj;this.emptyTextures[i]=empty;this.bindTexture(null,i)}this.emit("context",gl);this.resize(this.screen.width,this.screen.height)};WebGLRenderer.prototype.render=function render(displayObject,renderTexture,clear,transform,skipUpdateTransform){this.renderingToScreen=!renderTexture;this.emit("prerender");if(!this.gl||this.gl.isContextLost()){return}this._nextTextureLocation=0;if(!renderTexture){this._lastObjectRendered=displayObject}if(!skipUpdateTransform){var cacheParent=displayObject.parent;displayObject.parent=this._tempDisplayObjectParent;displayObject.updateTransform();displayObject.parent=cacheParent}this.bindRenderTexture(renderTexture,transform);this.currentRenderer.start();if(clear!==undefined?clear:this.clearBeforeRender){this._activeRenderTarget.clear()}displayObject.renderWebGL(this);this.currentRenderer.flush();this.textureGC.update();this.emit("postrender")};WebGLRenderer.prototype.setObjectRenderer=function setObjectRenderer(objectRenderer){if(this.currentRenderer===objectRenderer){return}this.currentRenderer.stop();this.currentRenderer=objectRenderer;this.currentRenderer.start()};WebGLRenderer.prototype.flush=function flush(){this.setObjectRenderer(this.emptyRenderer)};WebGLRenderer.prototype.resize=function resize(screenWidth,screenHeight){_SystemRenderer3.default.prototype.resize.call(this,screenWidth,screenHeight);this.rootRenderTarget.resize(screenWidth,screenHeight);if(this._activeRenderTarget===this.rootRenderTarget){this.rootRenderTarget.activate();if(this._activeShader){this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(true)}}};WebGLRenderer.prototype.setBlendMode=function setBlendMode(blendMode){this.state.setBlendMode(blendMode)};WebGLRenderer.prototype.clear=function clear(clearColor){this._activeRenderTarget.clear(clearColor)};WebGLRenderer.prototype.setTransform=function setTransform(matrix){this._activeRenderTarget.transform=matrix};WebGLRenderer.prototype.clearRenderTexture=function clearRenderTexture(renderTexture,clearColor){var baseTexture=renderTexture.baseTexture;var renderTarget=baseTexture._glRenderTargets[this.CONTEXT_UID];if(renderTarget){renderTarget.clear(clearColor)}return this};WebGLRenderer.prototype.bindRenderTexture=function bindRenderTexture(renderTexture,transform){var renderTarget=void 0;if(renderTexture){var baseTexture=renderTexture.baseTexture;if(!baseTexture._glRenderTargets[this.CONTEXT_UID]){this.textureManager.updateTexture(baseTexture,0)}this.unbindTexture(baseTexture);renderTarget=baseTexture._glRenderTargets[this.CONTEXT_UID];renderTarget.setFrame(renderTexture.frame)}else{renderTarget=this.rootRenderTarget}renderTarget.transform=transform;this.bindRenderTarget(renderTarget);return this};WebGLRenderer.prototype.bindRenderTarget=function bindRenderTarget(renderTarget){if(renderTarget!==this._activeRenderTarget){this._activeRenderTarget=renderTarget;renderTarget.activate();if(this._activeShader){this._activeShader.uniforms.projectionMatrix=renderTarget.projectionMatrix.toArray(true)}this.stencilManager.setMaskStack(renderTarget.stencilMaskStack)}return this};WebGLRenderer.prototype.bindShader=function bindShader(shader,autoProject){if(this._activeShader!==shader){this._activeShader=shader;shader.bind();if(autoProject!==false){shader.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(true)}}return this};WebGLRenderer.prototype.bindTexture=function bindTexture(texture,location,forceLocation){texture=texture||this.emptyTextures[location];texture=texture.baseTexture||texture;texture.touched=this.textureGC.count;if(!forceLocation){for(var i=0;i<this.boundTextures.length;i++){if(this.boundTextures[i]===texture){return i}}if(location===undefined){this._nextTextureLocation++;this._nextTextureLocation%=this.boundTextures.length;location=this.boundTextures.length-this._nextTextureLocation-1}}else{location=location||0}var gl=this.gl;var glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture){this.textureManager.updateTexture(texture,location)}else{this.boundTextures[location]=texture;gl.activeTexture(gl.TEXTURE0+location);gl.bindTexture(gl.TEXTURE_2D,glTexture.texture)}return location};WebGLRenderer.prototype.unbindTexture=function unbindTexture(texture){var gl=this.gl;texture=texture.baseTexture||texture;for(var i=0;i<this.boundTextures.length;i++){if(this.boundTextures[i]===texture){this.boundTextures[i]=this.emptyTextures[i];gl.activeTexture(gl.TEXTURE0+i);gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[i]._glTextures[this.CONTEXT_UID].texture)}}return this};WebGLRenderer.prototype.createVao=function createVao(){return new _pixiGlCore2.default.VertexArrayObject(this.gl,this.state.attribState)};WebGLRenderer.prototype.bindVao=function bindVao(vao){if(this._activeVao===vao){return this}if(vao){vao.bind()}else if(this._activeVao){this._activeVao.unbind()}this._activeVao=vao;return this};WebGLRenderer.prototype.reset=function reset(){this.setObjectRenderer(this.emptyRenderer);this._activeShader=null;this._activeVao=null;this._activeRenderTarget=this.rootRenderTarget;for(var i=0;i<this.boundTextures.length;i++){this.boundTextures[i]=this.emptyTextures[i]}this.rootRenderTarget.activate();this.state.resetToDefault();return this};WebGLRenderer.prototype.handleContextLost=function handleContextLost(event){event.preventDefault()};WebGLRenderer.prototype.handleContextRestored=function handleContextRestored(){this.textureManager.removeAll();this.filterManager.destroy(true);this._initContext()};WebGLRenderer.prototype.destroy=function destroy(removeView){this.destroyPlugins();this.view.removeEventListener("webglcontextlost",this.handleContextLost);this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);this.textureManager.destroy();_SystemRenderer.prototype.destroy.call(this,removeView);this.uid=0;this.maskManager.destroy();this.stencilManager.destroy();this.filterManager.destroy();this.maskManager=null;this.filterManager=null;this.textureManager=null;this.currentRenderer=null;this.handleContextLost=null;this.handleContextRestored=null;this._contextOptions=null;this.gl.useProgram(null);if(this.gl.getExtension("WEBGL_lose_context")){this.gl.getExtension("WEBGL_lose_context").loseContext()}this.gl=null};return WebGLRenderer}(_SystemRenderer3.default);exports.default=WebGLRenderer;_utils.pluginTarget.mixin(WebGLRenderer)},{"../../const":278,"../../textures/BaseTexture":344,"../../utils":357,"../SystemRenderer":308,"./TextureGarbageCollector":314,"./TextureManager":315,"./WebGLState":317,"./managers/FilterManager":322,"./managers/MaskManager":323,"./managers/StencilManager":324,"./utils/ObjectRenderer":326,"./utils/RenderTarget":328,"./utils/mapWebGLDrawModesToPixi":331,"./utils/validateContext":332,"pixi-gl-core":261}],317:[function(require,module,exports){"use strict";exports.__esModule=true;var _mapWebGLBlendModesToPixi=require("./utils/mapWebGLBlendModesToPixi");var _mapWebGLBlendModesToPixi2=_interopRequireDefault(_mapWebGLBlendModesToPixi);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BLEND=0;var DEPTH_TEST=1;var FRONT_FACE=2;var CULL_FACE=3;var BLEND_FUNC=4;var WebGLState=function(){function WebGLState(gl){_classCallCheck(this,WebGLState);this.activeState=new Uint8Array(16);this.defaultState=new Uint8Array(16);this.defaultState[0]=1;this.stackIndex=0;this.stack=[];this.gl=gl;this.maxAttribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)};this.blendModes=(0,_mapWebGLBlendModesToPixi2.default)(gl);this.nativeVaoExtension=gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object")}WebGLState.prototype.push=function push(){var state=this.stack[this.stackIndex];if(!state){state=this.stack[this.stackIndex]=new Uint8Array(16)}++this.stackIndex;for(var i=0;i<this.activeState.length;i++){state[i]=this.activeState[i]}};WebGLState.prototype.pop=function pop(){var state=this.stack[--this.stackIndex];this.setState(state)};WebGLState.prototype.setState=function setState(state){this.setBlend(state[BLEND]);this.setDepthTest(state[DEPTH_TEST]);this.setFrontFace(state[FRONT_FACE]);this.setCullFace(state[CULL_FACE]);this.setBlendMode(state[BLEND_FUNC])};WebGLState.prototype.setBlend=function setBlend(value){value=value?1:0;if(this.activeState[BLEND]===value){return}this.activeState[BLEND]=value;this.gl[value?"enable":"disable"](this.gl.BLEND)};WebGLState.prototype.setBlendMode=function setBlendMode(value){if(value===this.activeState[BLEND_FUNC]){return}this.activeState[BLEND_FUNC]=value;var mode=this.blendModes[value];if(mode.length===2){this.gl.blendFunc(mode[0],mode[1])}else{this.gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3])}};WebGLState.prototype.setDepthTest=function setDepthTest(value){value=value?1:0;if(this.activeState[DEPTH_TEST]===value){return}this.activeState[DEPTH_TEST]=value;this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)};WebGLState.prototype.setCullFace=function setCullFace(value){value=value?1:0;if(this.activeState[CULL_FACE]===value){return}this.activeState[CULL_FACE]=value;this.gl[value?"enable":"disable"](this.gl.CULL_FACE)};WebGLState.prototype.setFrontFace=function setFrontFace(value){value=value?1:0;if(this.activeState[FRONT_FACE]===value){return}this.activeState[FRONT_FACE]=value;this.gl.frontFace(this.gl[value?"CW":"CCW"])};WebGLState.prototype.resetAttributes=function resetAttributes(){for(var i=0;i<this.attribState.tempAttribState.length;i++){this.attribState.tempAttribState[i]=0}for(var _i=0;_i<this.attribState.attribState.length;_i++){this.attribState.attribState[_i]=0}for(var _i2=1;_i2<this.maxAttribs;_i2++){this.gl.disableVertexAttribArray(_i2)}};WebGLState.prototype.resetToDefault=function resetToDefault(){if(this.nativeVaoExtension){this.nativeVaoExtension.bindVertexArrayOES(null)}this.resetAttributes();for(var i=0;i<this.activeState.length;++i){this.activeState[i]=32}this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,false);this.setState(this.defaultState)};return WebGLState}();exports.default=WebGLState},{"./utils/mapWebGLBlendModesToPixi":330}],318:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extractUniformsFromSrc=require("./extractUniformsFromSrc");var _extractUniformsFromSrc2=_interopRequireDefault(_extractUniformsFromSrc);var _utils=require("../../../utils");var _const=require("../../../const");var _settings=require("../../../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SOURCE_KEY_MAP={};var Filter=function(){function Filter(vertexSrc,fragmentSrc,uniforms){_classCallCheck(this,Filter);this.vertexSrc=vertexSrc||Filter.defaultVertexSrc;this.fragmentSrc=fragmentSrc||Filter.defaultFragmentSrc;this._blendMode=_const.BLEND_MODES.NORMAL;this.uniformData=uniforms||(0,_extractUniformsFromSrc2.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler");this.uniforms={};for(var i in this.uniformData){this.uniforms[i]=this.uniformData[i].value;if(this.uniformData[i].type){this.uniformData[i].type=this.uniformData[i].type.toLowerCase()}}this.glShaders={};if(!SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc]){SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc]=(0,_utils.uid)()}this.glShaderKey=SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc];this.padding=4;this.resolution=_settings2.default.RESOLUTION;this.enabled=true;this.autoFit=true}Filter.prototype.apply=function apply(filterManager,input,output,clear,currentState){filterManager.applyFilter(this,input,output,clear)};_createClass(Filter,[{key:"blendMode",get:function get(){return this._blendMode},set:function set(value){this._blendMode=value}}],[{key:"defaultVertexSrc",get:function get(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function get(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]);return Filter}();exports.default=Filter},{"../../../const":278,"../../../settings":333,"../../../utils":357,"./extractUniformsFromSrc":319}],319:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=extractUniformsFromSrc;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var defaultValue=_pixiGlCore2.default.shader.defaultValue;function extractUniformsFromSrc(vertexSrc,fragmentSrc,mask){var vertUniforms=extractUniformsFromString(vertexSrc,mask);var fragUniforms=extractUniformsFromString(fragmentSrc,mask);return Object.assign(vertUniforms,fragUniforms)}function extractUniformsFromString(string){var maskRegex=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$");var uniforms={};var nameSplit=void 0;var lines=string.replace(/\s+/g," ").split(/\s*;\s*/);for(var i=0;i<lines.length;i++){var line=lines[i].trim();if(line.indexOf("uniform")>-1){var splitLine=line.split(" ");var type=splitLine[1];var name=splitLine[2];var size=1;if(name.indexOf("[")>-1){nameSplit=name.split(/\[|]/);name=nameSplit[0];size*=Number(nameSplit[1])}if(!name.match(maskRegex)){uniforms[name]={value:defaultValue(type,size),name:name,type:type}}}}return uniforms}},{"pixi-gl-core":261}],320:[function(require,module,exports){"use strict";exports.__esModule=true;exports.calculateScreenSpaceMatrix=calculateScreenSpaceMatrix;exports.calculateNormalizedScreenSpaceMatrix=calculateNormalizedScreenSpaceMatrix;exports.calculateSpriteMatrix=calculateSpriteMatrix;var _math=require("../../../math");function calculateScreenSpaceMatrix(outputMatrix,filterArea,textureSize){var mappedMatrix=outputMatrix.identity();mappedMatrix.translate(filterArea.x/textureSize.width,filterArea.y/textureSize.height);mappedMatrix.scale(textureSize.width,textureSize.height);return mappedMatrix}function calculateNormalizedScreenSpaceMatrix(outputMatrix,filterArea,textureSize){var mappedMatrix=outputMatrix.identity();mappedMatrix.translate(filterArea.x/textureSize.width,filterArea.y/textureSize.height);var translateScaleX=textureSize.width/filterArea.width;var translateScaleY=textureSize.height/filterArea.height;mappedMatrix.scale(translateScaleX,translateScaleY);return mappedMatrix}function calculateSpriteMatrix(outputMatrix,filterArea,textureSize,sprite){var orig=sprite._texture.orig;var mappedMatrix=outputMatrix.set(textureSize.width,0,0,textureSize.height,filterArea.x,filterArea.y);var worldTransform=sprite.worldTransform.copy(_math.Matrix.TEMP_MATRIX);worldTransform.invert();mappedMatrix.prepend(worldTransform);mappedMatrix.scale(1/orig.width,1/orig.height);mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y);return mappedMatrix}},{"../../../math":302}],321:[function(require,module,exports){"use strict";exports.__esModule=true;var _Filter2=require("../Filter");var _Filter3=_interopRequireDefault(_Filter2);var _math=require("../../../../math");var _path=require("path");var _TextureMatrix=require("../../../../textures/TextureMatrix");var _TextureMatrix2=_interopRequireDefault(_TextureMatrix);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SpriteMaskFilter=function(_Filter){_inherits(SpriteMaskFilter,_Filter);function SpriteMaskFilter(sprite){_classCallCheck(this,SpriteMaskFilter);var maskMatrix=new _math.Matrix;var _this=_possibleConstructorReturn(this,_Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));sprite.renderable=false;_this.maskSprite=sprite;_this.maskMatrix=maskMatrix;return _this}SpriteMaskFilter.prototype.apply=function apply(filterManager,input,output){var maskSprite=this.maskSprite;var tex=this.maskSprite.texture;if(!tex.valid){return}if(!tex.transform){tex.transform=new _TextureMatrix2.default(tex,0)}tex.transform.update();this.uniforms.mask=tex;this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.transform.mapCoord);this.uniforms.alpha=maskSprite.worldAlpha;this.uniforms.maskClamp=tex.transform.uClampFrame;filterManager.applyFilter(this,input,output)};return SpriteMaskFilter}(_Filter3.default);exports.default=SpriteMaskFilter},{"../../../../math":302,"../../../../textures/TextureMatrix":348,"../Filter":318,path:254}],322:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("./WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);var _RenderTarget=require("../utils/RenderTarget");var _RenderTarget2=_interopRequireDefault(_RenderTarget);var _Quad=require("../utils/Quad");var _Quad2=_interopRequireDefault(_Quad);var _math=require("../../../math");var _Shader=require("../../../Shader");var _Shader2=_interopRequireDefault(_Shader);var _filterTransforms=require("../filters/filterTransforms");var filterTransforms=_interopRequireWildcard(_filterTransforms);var _bitTwiddle=require("bit-twiddle");var _bitTwiddle2=_interopRequireDefault(_bitTwiddle);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FilterState=function FilterState(){_classCallCheck(this,FilterState);this.renderTarget=null;this.sourceFrame=new _math.Rectangle;this.destinationFrame=new _math.Rectangle;this.filters=[];this.target=null;this.resolution=1};var FilterManager=function(_WebGLManager){_inherits(FilterManager,_WebGLManager);function FilterManager(renderer){_classCallCheck(this,FilterManager);var _this=_possibleConstructorReturn(this,_WebGLManager.call(this,renderer));_this.gl=_this.renderer.gl;_this.quad=new _Quad2.default(_this.gl,renderer.state.attribState);_this.shaderCache={};_this.pool={};_this.filterData=null;_this.managedFilters=[];return _this}FilterManager.prototype.pushFilter=function pushFilter(target,filters){var renderer=this.renderer;var filterData=this.filterData;if(!filterData){filterData=this.renderer._activeRenderTarget.filterStack;var filterState=new FilterState;filterState.sourceFrame=filterState.destinationFrame=this.renderer._activeRenderTarget.size;filterState.renderTarget=renderer._activeRenderTarget;this.renderer._activeRenderTarget.filterData=filterData={index:0,stack:[filterState]};this.filterData=filterData}var currentState=filterData.stack[++filterData.index];if(!currentState){currentState=filterData.stack[filterData.index]=new FilterState}var resolution=filters[0].resolution;var padding=filters[0].padding|0;var targetBounds=target.filterArea||target.getBounds(true);var sourceFrame=currentState.sourceFrame;var destinationFrame=currentState.destinationFrame;sourceFrame.x=(targetBounds.x*resolution|0)/resolution;sourceFrame.y=(targetBounds.y*resolution|0)/resolution;sourceFrame.width=(targetBounds.width*resolution|0)/resolution;sourceFrame.height=(targetBounds.height*resolution|0)/resolution;if(filterData.stack[0].renderTarget.transform){}else if(filters[0].autoFit){sourceFrame.fit(filterData.stack[0].destinationFrame)}sourceFrame.pad(padding);destinationFrame.width=sourceFrame.width;destinationFrame.height=sourceFrame.height;var renderTarget=this.getPotRenderTarget(renderer.gl,sourceFrame.width,sourceFrame.height,resolution);currentState.target=target;currentState.filters=filters;currentState.resolution=resolution;currentState.renderTarget=renderTarget;renderTarget.setFrame(destinationFrame,sourceFrame);renderer.bindRenderTarget(renderTarget);renderTarget.clear()};FilterManager.prototype.popFilter=function popFilter(){var filterData=this.filterData;var lastState=filterData.stack[filterData.index-1];var currentState=filterData.stack[filterData.index];this.quad.map(currentState.renderTarget.size,currentState.sourceFrame).upload();var filters=currentState.filters;if(filters.length===1){filters[0].apply(this,currentState.renderTarget,lastState.renderTarget,false,currentState);this.freePotRenderTarget(currentState.renderTarget)}else{var flip=currentState.renderTarget;var flop=this.getPotRenderTarget(this.renderer.gl,currentState.sourceFrame.width,currentState.sourceFrame.height,currentState.resolution);flop.setFrame(currentState.destinationFrame,currentState.sourceFrame);flop.clear();var i=0;for(i=0;i<filters.length-1;++i){filters[i].apply(this,flip,flop,true,currentState);var t=flip;flip=flop;flop=t}filters[i].apply(this,flip,lastState.renderTarget,false,currentState);this.freePotRenderTarget(flip);this.freePotRenderTarget(flop)}filterData.index--;if(filterData.index===0){this.filterData=null}};FilterManager.prototype.applyFilter=function applyFilter(filter,input,output,clear){var renderer=this.renderer;var gl=renderer.gl;var shader=filter.glShaders[renderer.CONTEXT_UID];if(!shader){if(filter.glShaderKey){shader=this.shaderCache[filter.glShaderKey];if(!shader){shader=new _Shader2.default(this.gl,filter.vertexSrc,filter.fragmentSrc);filter.glShaders[renderer.CONTEXT_UID]=this.shaderCache[filter.glShaderKey]=shader}}else{shader=filter.glShaders[renderer.CONTEXT_UID]=new _Shader2.default(this.gl,filter.vertexSrc,filter.fragmentSrc)}this.managedFilters.push(filter);renderer.bindVao(null);this.quad.initVao(shader)}renderer.bindVao(this.quad.vao);renderer.bindRenderTarget(output);if(clear){gl.disable(gl.SCISSOR_TEST);renderer.clear();gl.enable(gl.SCISSOR_TEST)}if(output===renderer.maskManager.scissorRenderTarget){renderer.maskManager.pushScissorMask(null,renderer.maskManager.scissorData)}renderer.bindShader(shader);var tex=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=tex;this.syncUniforms(shader,filter);renderer.state.setBlendMode(filter.blendMode);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,input.texture.texture);this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0);gl.bindTexture(gl.TEXTURE_2D,tex._glTextures[this.renderer.CONTEXT_UID].texture)};FilterManager.prototype.syncUniforms=function syncUniforms(shader,filter){var uniformData=filter.uniformData;var uniforms=filter.uniforms;var textureCount=1;var currentState=void 0;if(shader.uniforms.filterArea){currentState=this.filterData.stack[this.filterData.index];var filterArea=shader.uniforms.filterArea;filterArea[0]=currentState.renderTarget.size.width;filterArea[1]=currentState.renderTarget.size.height;filterArea[2]=currentState.sourceFrame.x;filterArea[3]=currentState.sourceFrame.y;shader.uniforms.filterArea=filterArea}if(shader.uniforms.filterClamp){currentState=currentState||this.filterData.stack[this.filterData.index];var filterClamp=shader.uniforms.filterClamp;filterClamp[0]=0;filterClamp[1]=0;filterClamp[2]=(currentState.sourceFrame.width-1)/currentState.renderTarget.size.width;filterClamp[3]=(currentState.sourceFrame.height-1)/currentState.renderTarget.size.height;shader.uniforms.filterClamp=filterClamp}for(var i in uniformData){var type=uniformData[i].type;if(type==="sampler2d"&&uniforms[i]!==0){if(uniforms[i].baseTexture){shader.uniforms[i]=this.renderer.bindTexture(uniforms[i].baseTexture,textureCount)}else{shader.uniforms[i]=textureCount;var gl=this.renderer.gl;this.renderer.boundTextures[textureCount]=this.renderer.emptyTextures[textureCount];gl.activeTexture(gl.TEXTURE0+textureCount);uniforms[i].texture.bind()}textureCount++}else if(type==="mat3"){if(uniforms[i].a!==undefined){shader.uniforms[i]=uniforms[i].toArray(true)}else{shader.uniforms[i]=uniforms[i]}}else if(type==="vec2"){if(uniforms[i].x!==undefined){var val=shader.uniforms[i]||new Float32Array(2);val[0]=uniforms[i].x;val[1]=uniforms[i].y;shader.uniforms[i]=val}else{shader.uniforms[i]=uniforms[i]}}else if(type==="float"){if(shader.uniforms.data[i].value!==uniformData[i]){shader.uniforms[i]=uniforms[i]}}else{shader.uniforms[i]=uniforms[i]}}};FilterManager.prototype.getRenderTarget=function getRenderTarget(clear,resolution){var currentState=this.filterData.stack[this.filterData.index];var renderTarget=this.getPotRenderTarget(this.renderer.gl,currentState.sourceFrame.width,currentState.sourceFrame.height,resolution||currentState.resolution);renderTarget.setFrame(currentState.destinationFrame,currentState.sourceFrame);return renderTarget};FilterManager.prototype.returnRenderTarget=function returnRenderTarget(renderTarget){this.freePotRenderTarget(renderTarget)};FilterManager.prototype.calculateScreenSpaceMatrix=function calculateScreenSpaceMatrix(outputMatrix){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateScreenSpaceMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size)};FilterManager.prototype.calculateNormalizedScreenSpaceMatrix=function calculateNormalizedScreenSpaceMatrix(outputMatrix){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateNormalizedScreenSpaceMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size,currentState.destinationFrame)};FilterManager.prototype.calculateSpriteMatrix=function calculateSpriteMatrix(outputMatrix,sprite){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateSpriteMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size,sprite)};FilterManager.prototype.destroy=function destroy(){var contextLost=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var renderer=this.renderer;var filters=this.managedFilters;for(var i=0;i<filters.length;i++){if(!contextLost){filters[i].glShaders[renderer.CONTEXT_UID].destroy()}delete filters[i].glShaders[renderer.CONTEXT_UID]}this.shaderCache={};if(!contextLost){this.emptyPool()}else{this.pool={}}};FilterManager.prototype.getPotRenderTarget=function getPotRenderTarget(gl,minWidth,minHeight,resolution){minWidth=_bitTwiddle2.default.nextPow2(minWidth*resolution);minHeight=_bitTwiddle2.default.nextPow2(minHeight*resolution);var key=(minWidth&65535)<<16|minHeight&65535;if(!this.pool[key]){this.pool[key]=[]}var renderTarget=this.pool[key].pop();if(!renderTarget){var tex=this.renderer.boundTextures[0];gl.activeTexture(gl.TEXTURE0);renderTarget=new _RenderTarget2.default(gl,minWidth,minHeight,null,1);gl.bindTexture(gl.TEXTURE_2D,tex._glTextures[this.renderer.CONTEXT_UID].texture)}renderTarget.resolution=resolution;renderTarget.defaultFrame.width=renderTarget.size.width=minWidth/resolution;renderTarget.defaultFrame.height=renderTarget.size.height=minHeight/resolution;return renderTarget};FilterManager.prototype.emptyPool=function emptyPool(){for(var i in this.pool){var textures=this.pool[i];if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true)}}}this.pool={}};FilterManager.prototype.freePotRenderTarget=function freePotRenderTarget(renderTarget){var minWidth=renderTarget.size.width*renderTarget.resolution;var minHeight=renderTarget.size.height*renderTarget.resolution;var key=(minWidth&65535)<<16|minHeight&65535;this.pool[key].push(renderTarget)};return FilterManager}(_WebGLManager3.default);exports.default=FilterManager},{"../../../Shader":276,"../../../math":302,"../filters/filterTransforms":320,"../utils/Quad":327,"../utils/RenderTarget":328,"./WebGLManager":325,"bit-twiddle":23}],323:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("./WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);var _SpriteMaskFilter=require("../filters/spriteMask/SpriteMaskFilter");var _SpriteMaskFilter2=_interopRequireDefault(_SpriteMaskFilter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MaskManager=function(_WebGLManager){_inherits(MaskManager,_WebGLManager);function MaskManager(renderer){_classCallCheck(this,MaskManager);var _this=_possibleConstructorReturn(this,_WebGLManager.call(this,renderer));_this.scissor=false;_this.scissorData=null;_this.scissorRenderTarget=null;_this.enableScissor=true;_this.alphaMaskPool=[];_this.alphaMaskIndex=0;return _this}MaskManager.prototype.pushMask=function pushMask(target,maskData){if(maskData.texture){this.pushSpriteMask(target,maskData)}else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&maskData.isFastRect()){var matrix=maskData.worldTransform;var rot=Math.atan2(matrix.b,matrix.a);rot=Math.round(rot*(180/Math.PI));if(rot%90){this.pushStencilMask(maskData)}else{this.pushScissorMask(target,maskData)}}else{this.pushStencilMask(maskData)}};MaskManager.prototype.popMask=function popMask(target,maskData){if(maskData.texture){this.popSpriteMask(target,maskData)}else if(this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length){this.popScissorMask(target,maskData)}else{this.popStencilMask(target,maskData)}};MaskManager.prototype.pushSpriteMask=function pushSpriteMask(target,maskData){var alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];if(!alphaMaskFilter){alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new _SpriteMaskFilter2.default(maskData)]}alphaMaskFilter[0].resolution=this.renderer.resolution;alphaMaskFilter[0].maskSprite=maskData;target.filterArea=maskData.getBounds(true);this.renderer.filterManager.pushFilter(target,alphaMaskFilter);this.alphaMaskIndex++};MaskManager.prototype.popSpriteMask=function popSpriteMask(){this.renderer.filterManager.popFilter();this.alphaMaskIndex--};MaskManager.prototype.pushStencilMask=function pushStencilMask(maskData){this.renderer.currentRenderer.stop();this.renderer.stencilManager.pushStencil(maskData)};MaskManager.prototype.popStencilMask=function popStencilMask(){this.renderer.currentRenderer.stop();this.renderer.stencilManager.popStencil()};MaskManager.prototype.pushScissorMask=function pushScissorMask(target,maskData){maskData.renderable=true;var renderTarget=this.renderer._activeRenderTarget;var bounds=maskData.getBounds();bounds.fit(renderTarget.size);maskData.renderable=false;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var resolution=this.renderer.resolution;this.renderer.gl.scissor(bounds.x*resolution,(renderTarget.root?renderTarget.size.height-bounds.y-bounds.height:bounds.y)*resolution,bounds.width*resolution,bounds.height*resolution);this.scissorRenderTarget=renderTarget;this.scissorData=maskData;this.scissor=true};MaskManager.prototype.popScissorMask=function popScissorMask(){this.scissorRenderTarget=null;this.scissorData=null;this.scissor=false;var gl=this.renderer.gl;gl.disable(gl.SCISSOR_TEST)};return MaskManager}(_WebGLManager3.default);exports.default=MaskManager},{"../filters/spriteMask/SpriteMaskFilter":321,"./WebGLManager":325}],324:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("./WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StencilManager=function(_WebGLManager){_inherits(StencilManager,_WebGLManager);function StencilManager(renderer){_classCallCheck(this,StencilManager);var _this=_possibleConstructorReturn(this,_WebGLManager.call(this,renderer));_this.stencilMaskStack=null;return _this}StencilManager.prototype.setMaskStack=function setMaskStack(stencilMaskStack){this.stencilMaskStack=stencilMaskStack;var gl=this.renderer.gl;if(stencilMaskStack.length===0){gl.disable(gl.STENCIL_TEST)}else{gl.enable(gl.STENCIL_TEST)}};StencilManager.prototype.pushStencil=function pushStencil(graphics){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);this.renderer._activeRenderTarget.attachStencilBuffer();var gl=this.renderer.gl;var prevMaskCount=this.stencilMaskStack.length;if(prevMaskCount===0){gl.enable(gl.STENCIL_TEST)}this.stencilMaskStack.push(graphics);gl.colorMask(false,false,false,false);gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask());gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);this.renderer.plugins.graphics.render(graphics);this._useCurrent()};StencilManager.prototype.popStencil=function popStencil(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var gl=this.renderer.gl;var graphics=this.stencilMaskStack.pop();if(this.stencilMaskStack.length===0){gl.disable(gl.STENCIL_TEST);gl.clear(gl.STENCIL_BUFFER_BIT);gl.clearStencil(0)}else{gl.colorMask(false,false,false,false);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);this.renderer.plugins.graphics.render(graphics);this._useCurrent()}};StencilManager.prototype._useCurrent=function _useCurrent(){var gl=this.renderer.gl;gl.colorMask(true,true,true,true);gl.stencilFunc(gl.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask());gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)};StencilManager.prototype._getBitwiseMask=function _getBitwiseMask(){return(1<<this.stencilMaskStack.length)-1};StencilManager.prototype.destroy=function destroy(){_WebGLManager3.default.prototype.destroy.call(this);this.stencilMaskStack.stencilStack=null};return StencilManager}(_WebGLManager3.default);exports.default=StencilManager},{"./WebGLManager":325}],325:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var WebGLManager=function(){function WebGLManager(renderer){_classCallCheck(this,WebGLManager);this.renderer=renderer;this.renderer.on("context",this.onContextChange,this)}WebGLManager.prototype.onContextChange=function onContextChange(){};WebGLManager.prototype.destroy=function destroy(){this.renderer.off("context",this.onContextChange,this);this.renderer=null};return WebGLManager}();exports.default=WebGLManager},{}],326:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLManager2=require("../managers/WebGLManager");var _WebGLManager3=_interopRequireDefault(_WebGLManager2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ObjectRenderer=function(_WebGLManager){_inherits(ObjectRenderer,_WebGLManager);function ObjectRenderer(){_classCallCheck(this,ObjectRenderer);return _possibleConstructorReturn(this,_WebGLManager.apply(this,arguments))}ObjectRenderer.prototype.start=function start(){};ObjectRenderer.prototype.stop=function stop(){this.flush()};ObjectRenderer.prototype.flush=function flush(){};ObjectRenderer.prototype.render=function render(object){};return ObjectRenderer}(_WebGLManager3.default);exports.default=ObjectRenderer},{"../managers/WebGLManager":325}],327:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _createIndicesForQuads=require("../../../utils/createIndicesForQuads");var _createIndicesForQuads2=_interopRequireDefault(_createIndicesForQuads);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Quad=function(){function Quad(gl,state){_classCallCheck(this,Quad);this.gl=gl;this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]);this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.interleaved=new Float32Array(8*2);for(var i=0;i<4;i++){this.interleaved[i*4]=this.vertices[i*2];this.interleaved[i*4+1]=this.vertices[i*2+1];this.interleaved[i*4+2]=this.uvs[i*2];this.interleaved[i*4+3]=this.uvs[i*2+1]}this.indices=(0,_createIndicesForQuads2.default)(1);this.vertexBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,this.interleaved,gl.STATIC_DRAW);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW);this.vao=new _pixiGlCore2.default.VertexArrayObject(gl,state)}Quad.prototype.initVao=function initVao(shader){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,shader.attributes.aVertexPosition,this.gl.FLOAT,false,4*4,0).addAttribute(this.vertexBuffer,shader.attributes.aTextureCoord,this.gl.FLOAT,false,4*4,2*4)};Quad.prototype.map=function map(targetTextureFrame,destinationFrame){var x=0;var y=0;this.uvs[0]=x;this.uvs[1]=y;this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[3]=y;this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height;this.uvs[6]=x;this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height;x=destinationFrame.x;y=destinationFrame.y;this.vertices[0]=x;this.vertices[1]=y;this.vertices[2]=x+destinationFrame.width;this.vertices[3]=y;this.vertices[4]=x+destinationFrame.width;this.vertices[5]=y+destinationFrame.height;this.vertices[6]=x;this.vertices[7]=y+destinationFrame.height;return this};Quad.prototype.upload=function upload(){for(var i=0;i<4;i++){this.interleaved[i*4]=this.vertices[i*2];this.interleaved[i*4+1]=this.vertices[i*2+1];this.interleaved[i*4+2]=this.uvs[i*2];this.interleaved[i*4+3]=this.uvs[i*2+1]}this.vertexBuffer.upload(this.interleaved);return this};Quad.prototype.destroy=function destroy(){var gl=this.gl;gl.deleteBuffer(this.vertexBuffer);gl.deleteBuffer(this.indexBuffer)};return Quad}();exports.default=Quad},{"../../../utils/createIndicesForQuads":355,"pixi-gl-core":261}],328:[function(require,module,exports){"use strict";exports.__esModule=true;var _math=require("../../../math");var _const=require("../../../const");var _settings=require("../../../settings");var _settings2=_interopRequireDefault(_settings);var _pixiGlCore=require("pixi-gl-core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RenderTarget=function(){function RenderTarget(gl,width,height,scaleMode,resolution,root){_classCallCheck(this,RenderTarget);this.gl=gl;this.frameBuffer=null;this.texture=null;this.clearColor=[0,0,0,0];this.size=new _math.Rectangle(0,0,1,1);this.resolution=resolution||_settings2.default.RESOLUTION;this.projectionMatrix=new _math.Matrix;this.transform=null;this.frame=null;this.defaultFrame=new _math.Rectangle;this.destinationFrame=null;this.sourceFrame=null;this.stencilBuffer=null;this.stencilMaskStack=[];this.filterData=null;this.scaleMode=scaleMode!==undefined?scaleMode:_settings2.default.SCALE_MODE;this.root=root;if(!this.root){this.frameBuffer=_pixiGlCore.GLFramebuffer.createRGBA(gl,100,100);if(this.scaleMode===_const.SCALE_MODES.NEAREST){this.frameBuffer.texture.enableNearestScaling()}else{this.frameBuffer.texture.enableLinearScaling()}this.texture=this.frameBuffer.texture}else{this.frameBuffer=new _pixiGlCore.GLFramebuffer(gl,100,100);this.frameBuffer.framebuffer=null}this.setFrame();this.resize(width,height)}RenderTarget.prototype.clear=function clear(clearColor){var cc=clearColor||this.clearColor;this.frameBuffer.clear(cc[0],cc[1],cc[2],cc[3])};RenderTarget.prototype.attachStencilBuffer=function attachStencilBuffer(){if(!this.root){this.frameBuffer.enableStencil()}};RenderTarget.prototype.setFrame=function setFrame(destinationFrame,sourceFrame){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame;this.sourceFrame=sourceFrame||this.sourceFrame||this.destinationFrame};RenderTarget.prototype.activate=function activate(){var gl=this.gl;this.frameBuffer.bind();this.calculateProjection(this.destinationFrame,this.sourceFrame);if(this.transform){this.projectionMatrix.append(this.transform)}if(this.destinationFrame!==this.sourceFrame){gl.enable(gl.SCISSOR_TEST);gl.scissor(this.destinationFrame.x|0,this.destinationFrame.y|0,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)}else{gl.disable(gl.SCISSOR_TEST)}gl.viewport(this.destinationFrame.x|0,this.destinationFrame.y|0,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)};RenderTarget.prototype.calculateProjection=function calculateProjection(destinationFrame,sourceFrame){var pm=this.projectionMatrix;sourceFrame=sourceFrame||destinationFrame;pm.identity();if(!this.root){pm.a=1/destinationFrame.width*2;pm.d=1/destinationFrame.height*2;pm.tx=-1-sourceFrame.x*pm.a;pm.ty=-1-sourceFrame.y*pm.d}else{pm.a=1/destinationFrame.width*2;pm.d=-1/destinationFrame.height*2;pm.tx=-1-sourceFrame.x*pm.a;pm.ty=1-sourceFrame.y*pm.d}};RenderTarget.prototype.resize=function resize(width,height){width=width|0;height=height|0;if(this.size.width===width&&this.size.height===height){return}this.size.width=width;this.size.height=height;this.defaultFrame.width=width;this.defaultFrame.height=height;this.frameBuffer.resize(width*this.resolution,height*this.resolution);var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame)};RenderTarget.prototype.destroy=function destroy(){this.frameBuffer.destroy();this.frameBuffer=null;this.texture=null};return RenderTarget}();exports.default=RenderTarget},{"../../../const":278,"../../../math":302,"../../../settings":333,"pixi-gl-core":261}],329:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=checkMaxIfStatmentsInShader;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function checkMaxIfStatmentsInShader(maxIfs,gl){var createTempContext=!gl;if(maxIfs===0){throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`")}if(createTempContext){var tinyCanvas=document.createElement("canvas");tinyCanvas.width=1;tinyCanvas.height=1;gl=_pixiGlCore2.default.createContext(tinyCanvas)}var shader=gl.createShader(gl.FRAGMENT_SHADER);while(true){var fragmentSrc=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));gl.shaderSource(shader,fragmentSrc);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){maxIfs=maxIfs/2|0}else{break}}if(createTempContext){if(gl.getExtension("WEBGL_lose_context")){gl.getExtension("WEBGL_lose_context").loseContext()}}return maxIfs}function generateIfTestSrc(maxIfs){var src="";for(var i=0;i<maxIfs;++i){if(i>0){src+="\nelse "}if(i<maxIfs-1){src+="if(test == "+i+".0){}"}}return src}},{"pixi-gl-core":261}],330:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapWebGLBlendModesToPixi;var _const=require("../../../const");function mapWebGLBlendModesToPixi(gl){var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];array[_const.BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.ADD]=[gl.ONE,gl.DST_ALPHA];array[_const.BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR];array[_const.BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[_const.BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.DST_ALPHA,gl.ONE,gl.DST_ALPHA];array[_const.BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_COLOR];return array}},{"../../../const":278}],331:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapWebGLDrawModesToPixi;var _const=require("../../../const");function mapWebGLDrawModesToPixi(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};object[_const.DRAW_MODES.POINTS]=gl.POINTS;object[_const.DRAW_MODES.LINES]=gl.LINES;object[_const.DRAW_MODES.LINE_LOOP]=gl.LINE_LOOP;object[_const.DRAW_MODES.LINE_STRIP]=gl.LINE_STRIP;object[_const.DRAW_MODES.TRIANGLES]=gl.TRIANGLES;object[_const.DRAW_MODES.TRIANGLE_STRIP]=gl.TRIANGLE_STRIP;object[_const.DRAW_MODES.TRIANGLE_FAN]=gl.TRIANGLE_FAN;return object}},{"../../../const":278}],332:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=validateContext;function validateContext(gl){var attributes=gl.getContextAttributes();if(!attributes.stencil){console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}}},{}],333:[function(require,module,exports){"use strict";exports.__esModule=true;var _maxRecommendedTextures=require("./utils/maxRecommendedTextures");var _maxRecommendedTextures2=_interopRequireDefault(_maxRecommendedTextures);var _canUploadSameBuffer=require("./utils/canUploadSameBuffer");var _canUploadSameBuffer2=_interopRequireDefault(_canUploadSameBuffer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:true,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,_maxRecommendedTextures2.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:false,forceFXAA:false,autoResize:false,transparent:false,backgroundColor:0,clearBeforeRender:true,preserveDrawingBuffer:false,roundPixels:false,width:800,height:600,legacy:false},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,_canUploadSameBuffer2.default)()}},{"./utils/canUploadSameBuffer":354,"./utils/maxRecommendedTextures":359}],334:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _math=require("../math");var _utils=require("../utils");var _const=require("../const");var _Texture=require("../textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _Container2=require("../display/Container");var _Container3=_interopRequireDefault(_Container2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempPoint=new _math.Point;var Sprite=function(_Container){_inherits(Sprite,_Container);function Sprite(texture){_classCallCheck(this,Sprite);var _this=_possibleConstructorReturn(this,_Container.call(this));_this._anchor=new _math.ObservablePoint(_this._onAnchorUpdate,_this);_this._texture=null;_this._width=0;_this._height=0;_this._tint=null;_this._tintRGB=null;_this.tint=16777215;_this.blendMode=_const.BLEND_MODES.NORMAL;_this.shader=null;_this.cachedTint=16777215;_this.texture=texture||_Texture2.default.EMPTY;_this.vertexData=new Float32Array(8);_this.vertexTrimmedData=null;_this._transformID=-1;_this._textureID=-1;_this._transformTrimmedID=-1;_this._textureTrimmedID=-1;_this.pluginName="sprite";return _this}Sprite.prototype._onTextureUpdate=function _onTextureUpdate(){this._textureID=-1;this._textureTrimmedID=-1;this.cachedTint=16777215;if(this._width){this.scale.x=(0,_utils.sign)(this.scale.x)*this._width/this._texture.orig.width}if(this._height){this.scale.y=(0,_utils.sign)(this.scale.y)*this._height/this._texture.orig.height}};Sprite.prototype._onAnchorUpdate=function _onAnchorUpdate(){this._transformID=-1;this._transformTrimmedID=-1};Sprite.prototype.calculateVertices=function calculateVertices(){if(this._transformID===this.transform._worldID&&this._textureID===this._texture._updateID){return}this._transformID=this.transform._worldID;this._textureID=this._texture._updateID;var texture=this._texture;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var vertexData=this.vertexData;var trim=texture.trim;var orig=texture.orig;var anchor=this._anchor;var w0=0;var w1=0;var h0=0;var h1=0;if(trim){w1=trim.x-anchor._x*orig.width;w0=w1+trim.width;h1=trim.y-anchor._y*orig.height;h0=h1+trim.height}else{w1=-anchor._x*orig.width;w0=w1+orig.width;h1=-anchor._y*orig.height;h0=h1+orig.height}vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty};Sprite.prototype.calculateTrimmedVertices=function calculateTrimmedVertices(){if(!this.vertexTrimmedData){this.vertexTrimmedData=new Float32Array(8)}else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID){return}this._transformTrimmedID=this.transform._worldID;this._textureTrimmedID=this._texture._updateID;var texture=this._texture;var vertexData=this.vertexTrimmedData;var orig=texture.orig;var anchor=this._anchor;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var w1=-anchor._x*orig.width;var w0=w1+orig.width;var h1=-anchor._y*orig.height;var h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty};Sprite.prototype._renderWebGL=function _renderWebGL(renderer){this.calculateVertices();renderer.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};Sprite.prototype._renderCanvas=function _renderCanvas(renderer){renderer.plugins[this.pluginName].render(this)};Sprite.prototype._calculateBounds=function _calculateBounds(){var trim=this._texture.trim;var orig=this._texture.orig;if(!trim||trim.width===orig.width&&trim.height===orig.height){this.calculateVertices();this._bounds.addQuad(this.vertexData)}else{this.calculateTrimmedVertices();this._bounds.addQuad(this.vertexTrimmedData)}};Sprite.prototype.getLocalBounds=function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._texture.orig.width*-this._anchor._x;this._bounds.minY=this._texture.orig.height*-this._anchor._y;this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x);this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new _math.Rectangle}rect=this._localBoundsRect}return this._bounds.getRectangle(rect)}return _Container.prototype.getLocalBounds.call(this,rect)};Sprite.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture.orig.width;var height=this._texture.orig.height;var x1=-width*this.anchor.x;var y1=0;if(tempPoint.x>=x1&&tempPoint.x<x1+width){y1=-height*this.anchor.y;if(tempPoint.y>=y1&&tempPoint.y<y1+height){return true}}return false};Sprite.prototype.destroy=function destroy(options){_Container.prototype.destroy.call(this,options);this._anchor=null;var destroyTexture=typeof options==="boolean"?options:options&&options.texture;if(destroyTexture){var destroyBaseTexture=typeof options==="boolean"?options:options&&options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null;this.shader=null};Sprite.from=function from(source){return new Sprite(_Texture2.default.from(source))};Sprite.fromFrame=function fromFrame(frameId){var texture=_utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache')}return new Sprite(texture)};Sprite.fromImage=function fromImage(imageId,crossorigin,scaleMode){return new Sprite(_Texture2.default.fromImage(imageId,crossorigin,scaleMode))};_createClass(Sprite,[{key:"width",get:function get(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function set(value){var s=(0,_utils.sign)(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value}},{key:"height",get:function get(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function set(value){var s=(0,_utils.sign)(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value}},{key:"anchor",get:function get(){return this._anchor},set:function set(value){this._anchor.copy(value)}},{key:"tint",get:function get(){return this._tint},set:function set(value){this._tint=value;this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16)}},{key:"texture",get:function get(){return this._texture},set:function set(value){if(this._texture===value){return}this._texture=value;this.cachedTint=16777215;this._textureID=-1;this._textureTrimmedID=-1;if(value){if(value.baseTexture.hasLoaded){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}}}]);return Sprite}(_Container3.default);exports.default=Sprite},{"../const":278,"../display/Container":280,"../math":302,"../textures/Texture":347,"../utils":357}],335:[function(require,module,exports){"use strict";exports.__esModule=true;var _CanvasRenderer=require("../../renderers/canvas/CanvasRenderer");var _CanvasRenderer2=_interopRequireDefault(_CanvasRenderer);var _const=require("../../const");var _math=require("../../math");var _CanvasTinter=require("./CanvasTinter");var _CanvasTinter2=_interopRequireDefault(_CanvasTinter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var canvasRenderWorldTransform=new _math.Matrix;var CanvasSpriteRenderer=function(){function CanvasSpriteRenderer(renderer){_classCallCheck(this,CanvasSpriteRenderer);this.renderer=renderer}CanvasSpriteRenderer.prototype.render=function render(sprite){var texture=sprite._texture;var renderer=this.renderer;var width=texture._frame.width;var height=texture._frame.height;var wt=sprite.transform.worldTransform;var dx=0;var dy=0;if(texture.orig.width<=0||texture.orig.height<=0||!texture.baseTexture.source){return}renderer.setBlendMode(sprite.blendMode);if(texture.valid){renderer.context.globalAlpha=sprite.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===_const.SCALE_MODES.LINEAR;if(renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled){renderer.context[renderer.smoothProperty]=smoothingEnabled}if(texture.trim){dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width;dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height}else{dx=(.5-sprite.anchor.x)*texture.orig.width;dy=(.5-sprite.anchor.y)*texture.orig.height}if(texture.rotate){wt.copy(canvasRenderWorldTransform);wt=canvasRenderWorldTransform;_math.GroupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy);dx=0;dy=0}dx-=width/2;dy-=height/2;if(renderer.roundPixels){renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution|0,wt.ty*renderer.resolution|0);dx=dx|0;dy=dy|0}else{renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution,wt.ty*renderer.resolution)}var resolution=texture.baseTexture.resolution;if(sprite.tint!==16777215){if(sprite.cachedTint!==sprite.tint||sprite.tintedTexture.tintId!==sprite._texture._updateID){sprite.cachedTint=sprite.tint;sprite.tintedTexture=_CanvasTinter2.default.getTintedTexture(sprite,sprite.tint)}renderer.context.drawImage(sprite.tintedTexture,0,0,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}else{renderer.context.drawImage(texture.baseTexture.source,texture._frame.x*resolution,texture._frame.y*resolution,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}}};CanvasSpriteRenderer.prototype.destroy=function destroy(){this.renderer=null};return CanvasSpriteRenderer}();exports.default=CanvasSpriteRenderer;_CanvasRenderer2.default.registerPlugin("sprite",CanvasSpriteRenderer)},{"../../const":278,"../../math":302,"../../renderers/canvas/CanvasRenderer":309,"./CanvasTinter":336}],336:[function(require,module,exports){"use strict";exports.__esModule=true;var _utils=require("../../utils");var _canUseNewCanvasBlendModes=require("../../renderers/canvas/utils/canUseNewCanvasBlendModes");var _canUseNewCanvasBlendModes2=_interopRequireDefault(_canUseNewCanvasBlendModes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CanvasTinter={getTintedTexture:function getTintedTexture(sprite,color){var texture=sprite._texture;color=CanvasTinter.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};var cachedTexture=texture.tintCache[stringColor];var canvas=void 0;if(cachedTexture){if(cachedTexture.tintId===texture._updateID){return texture.tintCache[stringColor]}canvas=texture.tintCache[stringColor]}else{canvas=CanvasTinter.canvas||document.createElement("canvas")}CanvasTinter.tintMethod(texture,color,canvas);canvas.tintId=texture._updateID;if(CanvasTinter.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL();texture.tintCache[stringColor]=tintImage}else{texture.tintCache[stringColor]=canvas;CanvasTinter.canvas=null}return canvas},tintWithMultiply:function tintWithMultiply(texture,color,canvas){var context=canvas.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=Math.ceil(crop.width);canvas.height=Math.ceil(crop.height);context.save();context.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context.fillRect(0,0,crop.width,crop.height);context.globalCompositeOperation="multiply";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.globalCompositeOperation="destination-atop";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.restore()},tintWithOverlay:function tintWithOverlay(texture,color,canvas){var context=canvas.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=Math.ceil(crop.width);canvas.height=Math.ceil(crop.height);context.save();context.globalCompositeOperation="copy";context.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context.fillRect(0,0,crop.width,crop.height);context.globalCompositeOperation="destination-atop";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.restore()},tintWithPerPixel:function tintWithPerPixel(texture,color,canvas){var context=canvas.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=Math.ceil(crop.width);canvas.height=Math.ceil(crop.height);context.save();context.globalCompositeOperation="copy";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.restore();var rgbValues=(0,_utils.hex2rgb)(color);var r=rgbValues[0];var g=rgbValues[1];var b=rgbValues[2];var pixelData=context.getImageData(0,0,crop.width,crop.height);var pixels=pixelData.data;for(var i=0;i<pixels.length;i+=4){pixels[i+0]*=r;pixels[i+1]*=g;pixels[i+2]*=b}context.putImageData(pixelData,0,0)},roundColor:function roundColor(color){var step=CanvasTinter.cacheStepsPerColorChannel;var rgbValues=(0,_utils.hex2rgb)(color);rgbValues[0]=Math.min(255,rgbValues[0]/step*step);rgbValues[1]=Math.min(255,rgbValues[1]/step*step);rgbValues[2]=Math.min(255,rgbValues[2]/step*step);return(0,_utils.rgb2hex)(rgbValues)},cacheStepsPerColorChannel:8,convertTintToImage:false,canUseMultiply:(0,_canUseNewCanvasBlendModes2.default)(),tintMethod:0};CanvasTinter.tintMethod=CanvasTinter.canUseMultiply?CanvasTinter.tintWithMultiply:CanvasTinter.tintWithPerPixel;exports.default=CanvasTinter},{"../../renderers/canvas/utils/canUseNewCanvasBlendModes":312,"../../utils":357}],337:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Buffer=function(){function Buffer(size){_classCallCheck(this,Buffer);this.vertices=new ArrayBuffer(size);this.float32View=new Float32Array(this.vertices);this.uint32View=new Uint32Array(this.vertices)}Buffer.prototype.destroy=function destroy(){this.vertices=null;this.positions=null;this.uvs=null;this.colors=null};return Buffer}();exports.default=Buffer},{}],338:[function(require,module,exports){"use strict";exports.__esModule=true;var _ObjectRenderer2=require("../../renderers/webgl/utils/ObjectRenderer");var _ObjectRenderer3=_interopRequireDefault(_ObjectRenderer2);var _WebGLRenderer=require("../../renderers/webgl/WebGLRenderer");var _WebGLRenderer2=_interopRequireDefault(_WebGLRenderer);var _createIndicesForQuads=require("../../utils/createIndicesForQuads");var _createIndicesForQuads2=_interopRequireDefault(_createIndicesForQuads);var _generateMultiTextureShader=require("./generateMultiTextureShader");var _generateMultiTextureShader2=_interopRequireDefault(_generateMultiTextureShader);var _checkMaxIfStatmentsInShader=require("../../renderers/webgl/utils/checkMaxIfStatmentsInShader");var _checkMaxIfStatmentsInShader2=_interopRequireDefault(_checkMaxIfStatmentsInShader);var _BatchBuffer=require("./BatchBuffer");var _BatchBuffer2=_interopRequireDefault(_BatchBuffer);var _settings=require("../../settings");var _settings2=_interopRequireDefault(_settings);var _utils=require("../../utils");var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _bitTwiddle=require("bit-twiddle");var _bitTwiddle2=_interopRequireDefault(_bitTwiddle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TICK=0;var TEXTURE_TICK=0;var SpriteRenderer=function(_ObjectRenderer){_inherits(SpriteRenderer,_ObjectRenderer);function SpriteRenderer(renderer){_classCallCheck(this,SpriteRenderer);var _this=_possibleConstructorReturn(this,_ObjectRenderer.call(this,renderer));_this.vertSize=5;_this.vertByteSize=_this.vertSize*4;_this.size=_settings2.default.SPRITE_BATCH_SIZE;_this.buffers=[];for(var i=1;i<=_bitTwiddle2.default.nextPow2(_this.size);i*=2){_this.buffers.push(new _BatchBuffer2.default(i*4*_this.vertByteSize))}_this.indices=(0,_createIndicesForQuads2.default)(_this.size);_this.shader=null;_this.currentIndex=0;_this.groups=[];for(var k=0;k<_this.size;k++){_this.groups[k]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0}}_this.sprites=[];_this.vertexBuffers=[];_this.vaos=[];_this.vaoMax=2;_this.vertexCount=0;_this.renderer.on("prerender",_this.onPrerender,_this);return _this}SpriteRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;if(this.renderer.legacy){this.MAX_TEXTURES=1}else{this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),_settings2.default.SPRITE_MAX_TEXTURES);this.MAX_TEXTURES=(0,_checkMaxIfStatmentsInShader2.default)(this.MAX_TEXTURES,gl)}this.shader=(0,_generateMultiTextureShader2.default)(gl,this.MAX_TEXTURES);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW);this.renderer.bindVao(null);var attrs=this.shader.attributes;for(var i=0;i<this.vaoMax;i++){var vertexBuffer=this.vertexBuffers[i]=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,null,gl.STREAM_DRAW);var vao=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(vertexBuffer,attrs.aVertexPosition,gl.FLOAT,false,this.vertByteSize,0).addAttribute(vertexBuffer,attrs.aTextureCoord,gl.UNSIGNED_SHORT,true,this.vertByteSize,2*4).addAttribute(vertexBuffer,attrs.aColor,gl.UNSIGNED_BYTE,true,this.vertByteSize,3*4);if(attrs.aTextureId){vao.addAttribute(vertexBuffer,attrs.aTextureId,gl.FLOAT,false,this.vertByteSize,4*4)}this.vaos[i]=vao}this.vao=this.vaos[0];this.currentBlendMode=99999;this.boundTextures=new Array(this.MAX_TEXTURES)};SpriteRenderer.prototype.onPrerender=function onPrerender(){this.vertexCount=0};SpriteRenderer.prototype.render=function render(sprite){if(this.currentIndex>=this.size){this.flush()}if(!sprite._texture._uvs){return}this.sprites[this.currentIndex++]=sprite};SpriteRenderer.prototype.flush=function flush(){if(this.currentIndex===0){return}var gl=this.renderer.gl;var MAX_TEXTURES=this.MAX_TEXTURES;var np2=_bitTwiddle2.default.nextPow2(this.currentIndex);var log2=_bitTwiddle2.default.log2(np2);var buffer=this.buffers[log2];var sprites=this.sprites;var groups=this.groups;var float32View=buffer.float32View;var uint32View=buffer.uint32View;var boundTextures=this.boundTextures;var rendererBoundTextures=this.renderer.boundTextures;var touch=this.renderer.textureGC.count;var index=0;var nextTexture=void 0;var currentTexture=void 0;var groupCount=1;var textureCount=0;var currentGroup=groups[0];var vertexData=void 0;var uvs=void 0;var blendMode=_utils.premultiplyBlendMode[sprites[0]._texture.baseTexture.premultipliedAlpha?1:0][sprites[0].blendMode];currentGroup.textureCount=0;currentGroup.start=0;currentGroup.blend=blendMode;TICK++;var i=void 0;for(i=0;i<MAX_TEXTURES;++i){boundTextures[i]=rendererBoundTextures[i];boundTextures[i]._virtalBoundId=i}for(i=0;i<this.currentIndex;++i){var sprite=sprites[i];nextTexture=sprite._texture.baseTexture;var spriteBlendMode=_utils.premultiplyBlendMode[Number(nextTexture.premultipliedAlpha)][sprite.blendMode];if(blendMode!==spriteBlendMode){blendMode=spriteBlendMode;currentTexture=null;textureCount=MAX_TEXTURES;TICK++}if(currentTexture!==nextTexture){currentTexture=nextTexture;if(nextTexture._enabled!==TICK){if(textureCount===MAX_TEXTURES){TICK++;currentGroup.size=i-currentGroup.start;textureCount=0;currentGroup=groups[groupCount++];currentGroup.blend=blendMode;currentGroup.textureCount=0;currentGroup.start=i}nextTexture.touched=touch;if(nextTexture._virtalBoundId===-1){for(var j=0;j<MAX_TEXTURES;++j){var tIndex=(j+TEXTURE_TICK)%MAX_TEXTURES;var t=boundTextures[tIndex];if(t._enabled!==TICK){TEXTURE_TICK++;t._virtalBoundId=-1;nextTexture._virtalBoundId=tIndex;boundTextures[tIndex]=nextTexture;break}}}nextTexture._enabled=TICK;currentGroup.textureCount++;currentGroup.ids[textureCount]=nextTexture._virtalBoundId;currentGroup.textures[textureCount++]=nextTexture}}vertexData=sprite.vertexData;uvs=sprite._texture._uvs.uvsUint32;if(this.renderer.roundPixels){var resolution=this.renderer.resolution;float32View[index]=(vertexData[0]*resolution|0)/resolution;float32View[index+1]=(vertexData[1]*resolution|0)/resolution;float32View[index+5]=(vertexData[2]*resolution|0)/resolution;float32View[index+6]=(vertexData[3]*resolution|0)/resolution;float32View[index+10]=(vertexData[4]*resolution|0)/resolution;float32View[index+11]=(vertexData[5]*resolution|0)/resolution;float32View[index+15]=(vertexData[6]*resolution|0)/resolution;float32View[index+16]=(vertexData[7]*resolution|0)/resolution}else{float32View[index]=vertexData[0];float32View[index+1]=vertexData[1];float32View[index+5]=vertexData[2];float32View[index+6]=vertexData[3];float32View[index+10]=vertexData[4];float32View[index+11]=vertexData[5];float32View[index+15]=vertexData[6];float32View[index+16]=vertexData[7]}uint32View[index+2]=uvs[0];uint32View[index+7]=uvs[1];uint32View[index+12]=uvs[2];uint32View[index+17]=uvs[3];var alpha=Math.min(sprite.worldAlpha,1);var argb=alpha<1&&nextTexture.premultipliedAlpha?(0,_utils.premultiplyTint)(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);uint32View[index+3]=uint32View[index+8]=uint32View[index+13]=uint32View[index+18]=argb;float32View[index+4]=float32View[index+9]=float32View[index+14]=float32View[index+19]=nextTexture._virtalBoundId;index+=20}currentGroup.size=i-currentGroup.start;if(!_settings2.default.CAN_UPLOAD_SAME_BUFFER){if(this.vaoMax<=this.vertexCount){this.vaoMax++;var attrs=this.shader.attributes;var vertexBuffer=this.vertexBuffers[this.vertexCount]=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,null,gl.STREAM_DRAW);var vao=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(vertexBuffer,attrs.aVertexPosition,gl.FLOAT,false,this.vertByteSize,0).addAttribute(vertexBuffer,attrs.aTextureCoord,gl.UNSIGNED_SHORT,true,this.vertByteSize,2*4).addAttribute(vertexBuffer,attrs.aColor,gl.UNSIGNED_BYTE,true,this.vertByteSize,3*4);if(attrs.aTextureId){vao.addAttribute(vertexBuffer,attrs.aTextureId,gl.FLOAT,false,this.vertByteSize,4*4)}this.vaos[this.vertexCount]=vao}this.renderer.bindVao(this.vaos[this.vertexCount]);this.vertexBuffers[this.vertexCount].upload(buffer.vertices,0,false);this.vertexCount++}else{this.vertexBuffers[this.vertexCount].upload(buffer.vertices,0,true)}for(i=0;i<MAX_TEXTURES;++i){rendererBoundTextures[i]._virtalBoundId=-1}for(i=0;i<groupCount;++i){var group=groups[i];var groupTextureCount=group.textureCount;for(var _j=0;_j<groupTextureCount;_j++){currentTexture=group.textures[_j];if(rendererBoundTextures[group.ids[_j]]!==currentTexture){this.renderer.bindTexture(currentTexture,group.ids[_j],true)}currentTexture._virtalBoundId=-1}this.renderer.state.setBlendMode(group.blend);gl.drawElements(gl.TRIANGLES,group.size*6,gl.UNSIGNED_SHORT,group.start*6*2)}this.currentIndex=0};SpriteRenderer.prototype.start=function start(){this.renderer.bindShader(this.shader);if(_settings2.default.CAN_UPLOAD_SAME_BUFFER){this.renderer.bindVao(this.vaos[this.vertexCount]);this.vertexBuffers[this.vertexCount].bind()}};SpriteRenderer.prototype.stop=function stop(){this.flush()};SpriteRenderer.prototype.destroy=function destroy(){for(var i=0;i<this.vaoMax;i++){if(this.vertexBuffers[i]){this.vertexBuffers[i].destroy()}if(this.vaos[i]){this.vaos[i].destroy()}}if(this.indexBuffer){this.indexBuffer.destroy()}this.renderer.off("prerender",this.onPrerender,this);_ObjectRenderer.prototype.destroy.call(this);if(this.shader){this.shader.destroy();this.shader=null}this.vertexBuffers=null;this.vaos=null;this.indexBuffer=null;this.indices=null;this.sprites=null;for(var _i=0;_i<this.buffers.length;++_i){this.buffers[_i].destroy()}};return SpriteRenderer}(_ObjectRenderer3.default);exports.default=SpriteRenderer;_WebGLRenderer2.default.registerPlugin("sprite",SpriteRenderer)},{"../../renderers/webgl/WebGLRenderer":316,"../../renderers/webgl/utils/ObjectRenderer":326,"../../renderers/webgl/utils/checkMaxIfStatmentsInShader":329,"../../settings":333,"../../utils":357,"../../utils/createIndicesForQuads":355,"./BatchBuffer":337,"./generateMultiTextureShader":339,"bit-twiddle":23,"pixi-gl-core":261}],339:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=generateMultiTextureShader;var _Shader=require("../../Shader");var _Shader2=_interopRequireDefault(_Shader);var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fragTemplate=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n");function generateMultiTextureShader(gl,maxTextures){var vertexSrc="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n";var fragmentSrc=fragTemplate;fragmentSrc=fragmentSrc.replace(/%count%/gi,maxTextures);fragmentSrc=fragmentSrc.replace(/%forloop%/gi,generateSampleSrc(maxTextures));var shader=new _Shader2.default(gl,vertexSrc,fragmentSrc);var sampleValues=[];for(var i=0;i<maxTextures;i++){sampleValues[i]=i}shader.bind();shader.uniforms.uSamplers=sampleValues;return shader}function generateSampleSrc(maxTextures){var src="";src+="\n";src+="\n";for(var i=0;i<maxTextures;i++){if(i>0){src+="\nelse "}if(i<maxTextures-1){src+="if(textureId == "+i+".0)"}src+="\n{";src+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);";src+="\n}"}src+="\n";src+="\n";return src}},{"../../Shader":276,path:254}],340:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Sprite2=require("../sprites/Sprite");var _Sprite3=_interopRequireDefault(_Sprite2);var _Texture=require("../textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _math=require("../math");var _utils=require("../utils");var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _TextStyle=require("./TextStyle");var _TextStyle2=_interopRequireDefault(_TextStyle);var _TextMetrics=require("./TextMetrics");var _TextMetrics2=_interopRequireDefault(_TextMetrics);var _trimCanvas=require("../utils/trimCanvas");var _trimCanvas2=_interopRequireDefault(_trimCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultDestroyOptions={texture:true,children:false,baseTexture:true};var Text=function(_Sprite){_inherits(Text,_Sprite);function Text(text,style,canvas){_classCallCheck(this,Text);canvas=canvas||document.createElement("canvas");canvas.width=3;canvas.height=3;var texture=_Texture2.default.fromCanvas(canvas,_settings2.default.SCALE_MODE,"text");texture.orig=new _math.Rectangle;texture.trim=new _math.Rectangle;var _this=_possibleConstructorReturn(this,_Sprite.call(this,texture));_Texture2.default.addToCache(_this._texture,_this._texture.baseTexture.textureCacheIds[0]);_this.canvas=canvas;_this.context=_this.canvas.getContext("2d");_this.resolution=_settings2.default.RESOLUTION;_this._text=null;_this._style=null;_this._styleListener=null;_this._font="";_this.text=text;_this.style=style;_this.localStyleID=-1;return _this}Text.prototype.updateText=function updateText(respectDirty){var style=this._style;if(this.localStyleID!==style.styleID){this.dirty=true;this.localStyleID=style.styleID}if(!this.dirty&&respectDirty){return}this._font=this._style.toFontString();var context=this.context;var measured=_TextMetrics2.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas);var width=measured.width;var height=measured.height;var lines=measured.lines;var lineHeight=measured.lineHeight;var lineWidths=measured.lineWidths;var maxLineWidth=measured.maxLineWidth;var fontProperties=measured.fontProperties;this.canvas.width=Math.ceil((width+style.padding*2)*this.resolution);this.canvas.height=Math.ceil((height+style.padding*2)*this.resolution);context.scale(this.resolution,this.resolution);context.clearRect(0,0,this.canvas.width,this.canvas.height);context.font=this._font;context.strokeStyle=style.stroke;context.lineWidth=style.strokeThickness;context.textBaseline=style.textBaseline;context.lineJoin=style.lineJoin;context.miterLimit=style.miterLimit;var linePositionX=void 0;var linePositionY=void 0;if(style.dropShadow){context.fillStyle=style.dropShadowColor;context.globalAlpha=style.dropShadowAlpha;context.shadowBlur=style.dropShadowBlur;if(style.dropShadowBlur>0){context.shadowColor=style.dropShadowColor}var xShadowOffset=Math.cos(style.dropShadowAngle)*style.dropShadowDistance;var yShadowOffset=Math.sin(style.dropShadowAngle)*style.dropShadowDistance;for(var i=0;i<lines.length;i++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[i]}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[i])/2}if(style.fill){this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset+style.padding,linePositionY+yShadowOffset+style.padding);if(style.stroke&&style.strokeThickness){context.strokeStyle=style.dropShadowColor;this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset+style.padding,linePositionY+yShadowOffset+style.padding,true);context.strokeStyle=style.stroke}}}}context.shadowBlur=0;context.globalAlpha=1;context.fillStyle=this._generateFillStyle(style,lines);for(var _i=0;_i<lines.length;_i++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+_i*lineHeight+fontProperties.ascent;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[_i]}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[_i])/2}if(style.stroke&&style.strokeThickness){this.drawLetterSpacing(lines[_i],linePositionX+style.padding,linePositionY+style.padding,true)}if(style.fill){this.drawLetterSpacing(lines[_i],linePositionX+style.padding,linePositionY+style.padding)}}this.updateTexture()};Text.prototype.drawLetterSpacing=function drawLetterSpacing(text,x,y){var isStroke=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var style=this._style;var letterSpacing=style.letterSpacing;if(letterSpacing===0){if(isStroke){this.context.strokeText(text,x,y)}else{this.context.fillText(text,x,y)}return}var characters=String.prototype.split.call(text,"");var currentPosition=x;var index=0;var current="";while(index<text.length){current=characters[index++];if(isStroke){this.context.strokeText(current,currentPosition,y)}else{this.context.fillText(current,currentPosition,y)}currentPosition+=this.context.measureText(current).width+letterSpacing}};Text.prototype.updateTexture=function updateTexture(){var canvas=this.canvas;if(this._style.trim){var trimmed=(0,_trimCanvas2.default)(canvas);canvas.width=trimmed.width;canvas.height=trimmed.height;this.context.putImageData(trimmed.data,0,0)}var texture=this._texture;var style=this._style;var padding=style.trim?0:style.padding;var baseTexture=texture.baseTexture;baseTexture.hasLoaded=true;baseTexture.resolution=this.resolution;baseTexture.realWidth=canvas.width;baseTexture.realHeight=canvas.height;baseTexture.width=canvas.width/this.resolution;baseTexture.height=canvas.height/this.resolution;texture.trim.width=texture._frame.width=canvas.width/this.resolution;texture.trim.height=texture._frame.height=canvas.height/this.resolution;texture.trim.x=-padding;texture.trim.y=-padding;texture.orig.width=texture._frame.width-padding*2;texture.orig.height=texture._frame.height-padding*2;this._onTextureUpdate();baseTexture.emit("update",baseTexture);this.dirty=false};Text.prototype.renderWebGL=function renderWebGL(renderer){if(this.resolution!==renderer.resolution){this.resolution=renderer.resolution;this.dirty=true}this.updateText(true);_Sprite.prototype.renderWebGL.call(this,renderer)};Text.prototype._renderCanvas=function _renderCanvas(renderer){if(this.resolution!==renderer.resolution){this.resolution=renderer.resolution;this.dirty=true}this.updateText(true);_Sprite.prototype._renderCanvas.call(this,renderer)};Text.prototype.getLocalBounds=function getLocalBounds(rect){this.updateText(true);return _Sprite.prototype.getLocalBounds.call(this,rect)};Text.prototype._calculateBounds=function _calculateBounds(){this.updateText(true);this.calculateVertices();this._bounds.addQuad(this.vertexData)};Text.prototype._onStyleChange=function _onStyleChange(){this.dirty=true};Text.prototype._generateFillStyle=function _generateFillStyle(style,lines){if(!Array.isArray(style.fill)){return style.fill}if(navigator.isCocoonJS){return style.fill[0]}var gradient=void 0;var totalIterations=void 0;var currentIteration=void 0;var stop=void 0;var width=this.canvas.width/this.resolution;var height=this.canvas.height/this.resolution;var fill=style.fill.slice();var fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length){var lengthPlus1=fill.length+1;for(var i=1;i<lengthPlus1;++i){fillGradientStops.push(i/lengthPlus1)}}fill.unshift(style.fill[0]);fillGradientStops.unshift(0);fill.push(style.fill[style.fill.length-1]);fillGradientStops.push(1);if(style.fillGradientType===_const.TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,0,width/2,height);totalIterations=(fill.length+1)*lines.length;currentIteration=0;for(var _i2=0;_i2<lines.length;_i2++){currentIteration+=1;for(var j=0;j<fill.length;j++){if(typeof fillGradientStops[j]==="number"){stop=fillGradientStops[j]/lines.length+_i2/lines.length}else{stop=currentIteration/totalIterations}gradient.addColorStop(stop,fill[j]);currentIteration++}}}else{gradient=this.context.createLinearGradient(0,height/2,width,height/2);totalIterations=fill.length+1;currentIteration=1;for(var _i3=0;_i3<fill.length;_i3++){if(typeof fillGradientStops[_i3]==="number"){stop=fillGradientStops[_i3]}else{stop=currentIteration/totalIterations}gradient.addColorStop(stop,fill[_i3]);currentIteration++}}return gradient};Text.prototype.destroy=function destroy(options){if(typeof options==="boolean"){options={children:options}}options=Object.assign({},defaultDestroyOptions,options);_Sprite.prototype.destroy.call(this,options);this.context=null;this.canvas=null;this._style=null};_createClass(Text,[{key:"width",get:function get(){this.updateText(true);return Math.abs(this.scale.x)*this._texture.orig.width},set:function set(value){this.updateText(true);var s=(0,_utils.sign)(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value}},{key:"height",get:function get(){this.updateText(true);return Math.abs(this.scale.y)*this._texture.orig.height},set:function set(value){this.updateText(true);var s=(0,_utils.sign)(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value}},{key:"style",get:function get(){return this._style},set:function set(style){style=style||{};if(style instanceof _TextStyle2.default){this._style=style}else{this._style=new _TextStyle2.default(style)}this.localStyleID=-1;this.dirty=true}},{key:"text",get:function get(){return this._text},set:function set(text){text=String(text===""||text===null||text===undefined?" ":text);if(this._text===text){return}this._text=text;this.dirty=true}}]);return Text}(_Sprite3.default);exports.default=Text},{"../const":278,"../math":302,"../settings":333,"../sprites/Sprite":334,"../textures/Texture":347,"../utils":357,"../utils/trimCanvas":362,"./TextMetrics":341,"./TextStyle":342}],341:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextMetrics=function(){function TextMetrics(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){_classCallCheck(this,TextMetrics);this.text=text;this.style=style;this.width=width;this.height=height;this.lines=lines;this.lineWidths=lineWidths;this.lineHeight=lineHeight;this.maxLineWidth=maxLineWidth;this.fontProperties=fontProperties}TextMetrics.measureText=function measureText(text,style,wordWrap){var canvas=arguments.length>3&&arguments[3]!==undefined?arguments[3]:TextMetrics._canvas;wordWrap=wordWrap||style.wordWrap;var font=style.toFontString();var fontProperties=TextMetrics.measureFont(font);var context=canvas.getContext("2d");context.font=font;var outputText=wordWrap?TextMetrics.wordWrap(text,style,canvas):text;var lines=outputText.split(/(?:\r\n|\r|\n)/);var lineWidths=new Array(lines.length);var maxLineWidth=0;for(var i=0;i<lines.length;i++){var lineWidth=context.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth;maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;if(style.dropShadow){width+=style.dropShadowDistance}var lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness;var height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness)+(lines.length-1)*(lineHeight+style.leading);if(style.dropShadow){height+=style.dropShadowDistance}return new TextMetrics(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties)};TextMetrics.wordWrap=function wordWrap(text,style){var canvas=arguments.length>2&&arguments[2]!==undefined?arguments[2]:TextMetrics._canvas;var context=canvas.getContext("2d");var result="";var lines=text.split("\n");var wordWrapWidth=style.wordWrapWidth;var characterCache={};for(var i=0;i<lines.length;i++){var spaceLeft=wordWrapWidth;var words=lines[i].split(" ");for(var j=0;j<words.length;j++){var wordWidth=context.measureText(words[j]).width;if(style.breakWords&&wordWidth>wordWrapWidth){var characters=words[j].split("");for(var c=0;c<characters.length;c++){var character=characters[c];var characterWidth=characterCache[character];if(characterWidth===undefined){characterWidth=context.measureText(character).width;characterCache[character]=characterWidth}if(characterWidth>spaceLeft){result+="\n"+character;spaceLeft=wordWrapWidth-characterWidth}else{if(c===0){result+=" "}result+=character;spaceLeft-=characterWidth}}}else{var wordWidthWithSpace=wordWidth+context.measureText(" ").width;if(j===0||wordWidthWithSpace>spaceLeft){if(j>0){result+="\n"}result+=words[j];spaceLeft=wordWrapWidth-wordWidth}else{spaceLeft-=wordWidthWithSpace;result+=" "+words[j]}}}if(i<lines.length-1){result+="\n"}}return result};TextMetrics.measureFont=function measureFont(font){if(TextMetrics._fonts[font]){return TextMetrics._fonts[font]}var properties={};var canvas=TextMetrics._canvas;var context=TextMetrics._context;context.font=font;var width=Math.ceil(context.measureText("|MÉq").width);var baseline=Math.ceil(context.measureText("M").width);var height=2*baseline;baseline=baseline*1.4|0;canvas.width=width;canvas.height=height;context.fillStyle="#f00";context.fillRect(0,0,width,height);context.font=font;context.textBaseline="alphabetic";context.fillStyle="#000";context.fillText("|MÉq",0,baseline);var imagedata=context.getImageData(0,0,width,height).data;var pixels=imagedata.length;var line=width*4;var i=0;var idx=0;var stop=false;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4){if(imagedata[idx+j]!==255){stop=true;break}}if(!stop){idx+=line}else{break}}properties.ascent=baseline-i;idx=pixels-line;stop=false;for(i=height;i>baseline;--i){for(var _j=0;_j<line;_j+=4){if(imagedata[idx+_j]!==255){stop=true;break}}if(!stop){idx-=line}else{break}}properties.descent=i-baseline;properties.fontSize=properties.ascent+properties.descent;TextMetrics._fonts[font]=properties;return properties};return TextMetrics}();exports.default=TextMetrics;var canvas=document.createElement("canvas");canvas.width=canvas.height=10;TextMetrics._canvas=canvas;TextMetrics._context=canvas.getContext("2d");TextMetrics._fonts={}},{}],342:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _const=require("../const");var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var defaultStyle={align:"left",breakWords:false,dropShadow:false,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:_const.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:false,wordWrap:false,wordWrapWidth:100,leading:0};var TextStyle=function(){function TextStyle(style){_classCallCheck(this,TextStyle);this.styleID=0;Object.assign(this,defaultStyle,style)}TextStyle.prototype.clone=function clone(){var clonedProperties={};for(var key in defaultStyle){clonedProperties[key]=this[key]}return new TextStyle(clonedProperties)};TextStyle.prototype.reset=function reset(){Object.assign(this,defaultStyle)};TextStyle.prototype.toFontString=function toFontString(){var fontSizeString=typeof this.fontSize==="number"?this.fontSize+"px":this.fontSize;var fontFamilies=this.fontFamily;if(!Array.isArray(this.fontFamily)){fontFamilies=this.fontFamily.split(",")}for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();if(!/([\"\'])[^\'\"]+\1/.test(fontFamily)){fontFamily='"'+fontFamily+'"'}fontFamilies[i]=fontFamily}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+fontSizeString+" "+fontFamilies.join(",")};_createClass(TextStyle,[{key:"align",get:function get(){return this._align},set:function set(align){if(this._align!==align){this._align=align;this.styleID++}}},{key:"breakWords",get:function get(){return this._breakWords},set:function set(breakWords){if(this._breakWords!==breakWords){this._breakWords=breakWords;this.styleID++}}},{key:"dropShadow",get:function get(){return this._dropShadow},set:function set(dropShadow){if(this._dropShadow!==dropShadow){this._dropShadow=dropShadow;this.styleID++}}},{key:"dropShadowAlpha",get:function get(){return this._dropShadowAlpha},set:function set(dropShadowAlpha){if(this._dropShadowAlpha!==dropShadowAlpha){this._dropShadowAlpha=dropShadowAlpha;this.styleID++}}},{key:"dropShadowAngle",get:function get(){return this._dropShadowAngle},set:function set(dropShadowAngle){if(this._dropShadowAngle!==dropShadowAngle){this._dropShadowAngle=dropShadowAngle;this.styleID++}}},{key:"dropShadowBlur",get:function get(){return this._dropShadowBlur},set:function set(dropShadowBlur){if(this._dropShadowBlur!==dropShadowBlur){this._dropShadowBlur=dropShadowBlur;this.styleID++}}},{key:"dropShadowColor",get:function get(){return this._dropShadowColor},set:function set(dropShadowColor){var outputColor=getColor(dropShadowColor);if(this._dropShadowColor!==outputColor){this._dropShadowColor=outputColor;this.styleID++}}},{key:"dropShadowDistance",get:function get(){return this._dropShadowDistance},set:function set(dropShadowDistance){if(this._dropShadowDistance!==dropShadowDistance){this._dropShadowDistance=dropShadowDistance;this.styleID++}}},{key:"fill",get:function get(){return this._fill},set:function set(fill){var outputColor=getColor(fill);if(this._fill!==outputColor){this._fill=outputColor;this.styleID++}}},{key:"fillGradientType",get:function get(){return this._fillGradientType},set:function set(fillGradientType){if(this._fillGradientType!==fillGradientType){this._fillGradientType=fillGradientType;this.styleID++}}},{key:"fillGradientStops",get:function get(){return this._fillGradientStops},set:function set(fillGradientStops){if(!areArraysEqual(this._fillGradientStops,fillGradientStops)){this._fillGradientStops=fillGradientStops;this.styleID++}}},{key:"fontFamily",get:function get(){return this._fontFamily},set:function set(fontFamily){if(this.fontFamily!==fontFamily){this._fontFamily=fontFamily;this.styleID++}}},{key:"fontSize",get:function get(){return this._fontSize},set:function set(fontSize){if(this._fontSize!==fontSize){this._fontSize=fontSize;this.styleID++}}},{key:"fontStyle",get:function get(){return this._fontStyle},set:function set(fontStyle){if(this._fontStyle!==fontStyle){this._fontStyle=fontStyle;this.styleID++}}},{key:"fontVariant",get:function get(){return this._fontVariant},set:function set(fontVariant){if(this._fontVariant!==fontVariant){this._fontVariant=fontVariant;this.styleID++}}},{key:"fontWeight",get:function get(){return this._fontWeight},set:function set(fontWeight){if(this._fontWeight!==fontWeight){this._fontWeight=fontWeight;this.styleID++}}},{key:"letterSpacing",get:function get(){return this._letterSpacing},set:function set(letterSpacing){if(this._letterSpacing!==letterSpacing){this._letterSpacing=letterSpacing;this.styleID++}}},{key:"lineHeight",get:function get(){return this._lineHeight},set:function set(lineHeight){if(this._lineHeight!==lineHeight){this._lineHeight=lineHeight;this.styleID++}}},{key:"leading",get:function get(){return this._leading},set:function set(leading){if(this._leading!==leading){this._leading=leading;this.styleID++}}},{key:"lineJoin",get:function get(){return this._lineJoin},set:function set(lineJoin){if(this._lineJoin!==lineJoin){this._lineJoin=lineJoin;this.styleID++}}},{key:"miterLimit",get:function get(){return this._miterLimit},set:function set(miterLimit){if(this._miterLimit!==miterLimit){this._miterLimit=miterLimit;this.styleID++}}},{key:"padding",get:function get(){return this._padding},set:function set(padding){if(this._padding!==padding){this._padding=padding;this.styleID++}}},{key:"stroke",get:function get(){return this._stroke},set:function set(stroke){var outputColor=getColor(stroke);if(this._stroke!==outputColor){this._stroke=outputColor;this.styleID++}}},{key:"strokeThickness",get:function get(){return this._strokeThickness},set:function set(strokeThickness){if(this._strokeThickness!==strokeThickness){this._strokeThickness=strokeThickness;this.styleID++}}},{key:"textBaseline",get:function get(){return this._textBaseline},set:function set(textBaseline){if(this._textBaseline!==textBaseline){this._textBaseline=textBaseline;this.styleID++}}},{key:"trim",get:function get(){return this._trim},set:function set(trim){if(this._trim!==trim){this._trim=trim;this.styleID++}}},{key:"wordWrap",get:function get(){return this._wordWrap},set:function set(wordWrap){if(this._wordWrap!==wordWrap){this._wordWrap=wordWrap;this.styleID++}}},{key:"wordWrapWidth",get:function get(){return this._wordWrapWidth},set:function set(wordWrapWidth){if(this._wordWrapWidth!==wordWrapWidth){this._wordWrapWidth=wordWrapWidth;this.styleID++}}}]);return TextStyle}();exports.default=TextStyle;function getSingleColor(color){if(typeof color==="number"){return(0,_utils.hex2string)(color)}else if(typeof color==="string"){if(color.indexOf("0x")===0){color=color.replace("0x","#")}}return color}function getColor(color){if(!Array.isArray(color)){return getSingleColor(color)}else{for(var i=0;i<color.length;++i){color[i]=getSingleColor(color[i])}return color}}function areArraysEqual(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2)){return false}if(array1.length!==array2.length){return false}for(var i=0;i<array1.length;++i){if(array1[i]!==array2[i]){return false}}return true}},{"../const":278,"../utils":357}],343:[function(require,module,exports){"use strict";exports.__esModule=true;var _BaseTexture2=require("./BaseTexture");var _BaseTexture3=_interopRequireDefault(_BaseTexture2);var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BaseRenderTexture=function(_BaseTexture){_inherits(BaseRenderTexture,_BaseTexture);function BaseRenderTexture(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var scaleMode=arguments[2];var resolution=arguments[3];_classCallCheck(this,BaseRenderTexture);var _this=_possibleConstructorReturn(this,_BaseTexture.call(this,null,scaleMode));_this.resolution=resolution||_settings2.default.RESOLUTION;_this.width=Math.ceil(width);_this.height=Math.ceil(height);_this.realWidth=_this.width*_this.resolution;_this.realHeight=_this.height*_this.resolution;_this.scaleMode=scaleMode!==undefined?scaleMode:_settings2.default.SCALE_MODE;_this.hasLoaded=true;_this._glRenderTargets={};_this._canvasRenderTarget=null;_this.valid=false;return _this}BaseRenderTexture.prototype.resize=function resize(width,height){width=Math.ceil(width);height=Math.ceil(height);if(width===this.width&&height===this.height){return}this.valid=width>0&&height>0;this.width=width;this.height=height;this.realWidth=this.width*this.resolution;this.realHeight=this.height*this.resolution;if(!this.valid){return}this.emit("update",this)};BaseRenderTexture.prototype.destroy=function destroy(){_BaseTexture.prototype.destroy.call(this,true);this.renderer=null};return BaseRenderTexture}(_BaseTexture3.default);exports.default=BaseRenderTexture},{"../settings":333,"./BaseTexture":344}],344:[function(require,module,exports){"use strict";exports.__esModule=true;var _utils=require("../utils");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _determineCrossOrigin=require("../utils/determineCrossOrigin");var _determineCrossOrigin2=_interopRequireDefault(_determineCrossOrigin);var _bitTwiddle=require("bit-twiddle");var _bitTwiddle2=_interopRequireDefault(_bitTwiddle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BaseTexture=function(_EventEmitter){_inherits(BaseTexture,_EventEmitter);function BaseTexture(source,scaleMode,resolution){_classCallCheck(this,BaseTexture);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));_this.uid=(0,_utils.uid)();_this.touched=0;_this.resolution=resolution||_settings2.default.RESOLUTION;_this.width=100;_this.height=100;_this.realWidth=100;_this.realHeight=100;_this.scaleMode=scaleMode!==undefined?scaleMode:_settings2.default.SCALE_MODE;_this.hasLoaded=false;_this.isLoading=false;_this.source=null;_this.origSource=null;_this.imageType=null;_this.sourceScale=1;_this.premultipliedAlpha=true;_this.imageUrl=null;_this.isPowerOfTwo=false;_this.mipmap=_settings2.default.MIPMAP_TEXTURES;_this.wrapMode=_settings2.default.WRAP_MODE;_this._glTextures={};_this._enabled=0;_this._virtalBoundId=-1;_this._destroyed=false;_this.textureCacheIds=[];if(source){_this.loadSource(source)}return _this}BaseTexture.prototype.update=function update(){if(this.imageType!=="svg"){this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width;this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height;this._updateDimensions()}this.emit("update",this)};BaseTexture.prototype._updateDimensions=function _updateDimensions(){this.width=this.realWidth/this.resolution;this.height=this.realHeight/this.resolution;this.isPowerOfTwo=_bitTwiddle2.default.isPow2(this.realWidth)&&_bitTwiddle2.default.isPow2(this.realHeight)};BaseTexture.prototype.loadSource=function loadSource(source){var wasLoading=this.isLoading;this.hasLoaded=false;this.isLoading=false;if(wasLoading&&this.source){this.source.onload=null;this.source.onerror=null}var firstSourceLoaded=!this.source;this.source=source;if((source.src&&source.complete||source.getContext)&&source.width&&source.height){this._updateImageType();if(this.imageType==="svg"){this._loadSvgSource()}else{this._sourceLoaded()}if(firstSourceLoaded){this.emit("loaded",this)}}else if(!source.getContext){this.isLoading=true;var scope=this;source.onload=function(){scope._updateImageType();source.onload=null;source.onerror=null;if(!scope.isLoading){return}scope.isLoading=false;scope._sourceLoaded();if(scope.imageType==="svg"){scope._loadSvgSource();return}scope.emit("loaded",scope)};source.onerror=function(){source.onload=null;source.onerror=null;if(!scope.isLoading){return}scope.isLoading=false;scope.emit("error",scope)};if(source.complete&&source.src){source.onload=null;source.onerror=null;if(scope.imageType==="svg"){scope._loadSvgSource();return}this.isLoading=false;if(source.width&&source.height){this._sourceLoaded();if(wasLoading){this.emit("loaded",this)}}else if(wasLoading){this.emit("error",this)}}}};BaseTexture.prototype._updateImageType=function _updateImageType(){if(!this.imageUrl){return}var dataUri=(0,_utils.decomposeDataUri)(this.imageUrl);var imageType=void 0;if(dataUri&&dataUri.mediaType==="image"){var firstSubType=dataUri.subType.split("+")[0];imageType=(0,_utils.getUrlFileExtension)("."+firstSubType);if(!imageType){throw new Error("Invalid image type in data URI.")}}else{imageType=(0,_utils.getUrlFileExtension)(this.imageUrl);if(!imageType){imageType="png"}}this.imageType=imageType};BaseTexture.prototype._loadSvgSource=function _loadSvgSource(){if(this.imageType!=="svg"){return}var dataUri=(0,_utils.decomposeDataUri)(this.imageUrl);if(dataUri){this._loadSvgSourceUsingDataUri(dataUri)}else{this._loadSvgSourceUsingXhr()}};BaseTexture.prototype._loadSvgSourceUsingDataUri=function _loadSvgSourceUsingDataUri(dataUri){var svgString=void 0;if(dataUri.encoding==="base64"){if(!atob){throw new Error("Your browser doesn't support base64 conversions.")}svgString=atob(dataUri.data)}else{svgString=dataUri.data}this._loadSvgSourceUsingString(svgString)};BaseTexture.prototype._loadSvgSourceUsingXhr=function _loadSvgSourceUsingXhr(){var _this2=this;var svgXhr=new XMLHttpRequest;svgXhr.onload=function(){if(svgXhr.readyState!==svgXhr.DONE||svgXhr.status!==200){throw new Error("Failed to load SVG using XHR.")}_this2._loadSvgSourceUsingString(svgXhr.response)};svgXhr.onerror=function(){return _this2.emit("error",_this2)};svgXhr.open("GET",this.imageUrl,true);svgXhr.send()};BaseTexture.prototype._loadSvgSourceUsingString=function _loadSvgSourceUsingString(svgString){var svgSize=(0,_utils.getSvgSize)(svgString);var svgWidth=svgSize.width;var svgHeight=svgSize.height;if(!svgWidth||!svgHeight){throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.")}this.realWidth=Math.round(svgWidth*this.sourceScale);this.realHeight=Math.round(svgHeight*this.sourceScale);this._updateDimensions();var canvas=document.createElement("canvas");canvas.width=this.realWidth;canvas.height=this.realHeight;canvas._pixiId="canvas_"+(0,_utils.uid)();canvas.getContext("2d").drawImage(this.source,0,0,svgWidth,svgHeight,0,0,this.realWidth,this.realHeight);this.origSource=this.source;this.source=canvas;BaseTexture.addToCache(this,canvas._pixiId);this.isLoading=false;this._sourceLoaded();this.emit("loaded",this)};BaseTexture.prototype._sourceLoaded=function _sourceLoaded(){this.hasLoaded=true;this.update()};BaseTexture.prototype.destroy=function destroy(){if(this.imageUrl){delete _utils.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS){this.source.src=""}}this.source=null;this.dispose();BaseTexture.removeFromCache(this);this.textureCacheIds=null;this._destroyed=true};BaseTexture.prototype.dispose=function dispose(){this.emit("dispose",this)};BaseTexture.prototype.updateSourceImage=function updateSourceImage(newSrc){this.source.src=newSrc;this.loadSource(this.source)};BaseTexture.fromImage=function fromImage(imageUrl,crossorigin,scaleMode,sourceScale){var baseTexture=_utils.BaseTextureCache[imageUrl];if(!baseTexture){var image=new Image;if(crossorigin===undefined&&imageUrl.indexOf("data:")!==0){image.crossOrigin=(0,_determineCrossOrigin2.default)(imageUrl)}else if(crossorigin){image.crossOrigin=typeof crossorigin==="string"?crossorigin:"anonymous"}baseTexture=new BaseTexture(image,scaleMode);baseTexture.imageUrl=imageUrl;if(sourceScale){baseTexture.sourceScale=sourceScale}baseTexture.resolution=(0,_utils.getResolutionOfUrl)(imageUrl);image.src=imageUrl;BaseTexture.addToCache(baseTexture,imageUrl)}return baseTexture};BaseTexture.fromCanvas=function fromCanvas(canvas,scaleMode){var origin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"canvas";if(!canvas._pixiId){canvas._pixiId=origin+"_"+(0,_utils.uid)()}var baseTexture=_utils.BaseTextureCache[canvas._pixiId];if(!baseTexture){baseTexture=new BaseTexture(canvas,scaleMode);BaseTexture.addToCache(baseTexture,canvas._pixiId)}return baseTexture};BaseTexture.from=function from(source,scaleMode,sourceScale){if(typeof source==="string"){return BaseTexture.fromImage(source,undefined,scaleMode,sourceScale)}else if(source instanceof HTMLImageElement){var imageUrl=source.src;var baseTexture=_utils.BaseTextureCache[imageUrl];if(!baseTexture){baseTexture=new BaseTexture(source,scaleMode);baseTexture.imageUrl=imageUrl;if(sourceScale){baseTexture.sourceScale=sourceScale}baseTexture.resolution=(0,_utils.getResolutionOfUrl)(imageUrl);BaseTexture.addToCache(baseTexture,imageUrl)}return baseTexture}else if(source instanceof HTMLCanvasElement){return BaseTexture.fromCanvas(source,scaleMode)}return source};BaseTexture.addToCache=function addToCache(baseTexture,id){if(id){if(baseTexture.textureCacheIds.indexOf(id)===-1){baseTexture.textureCacheIds.push(id)}if(_utils.BaseTextureCache[id]){console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry")}_utils.BaseTextureCache[id]=baseTexture}};BaseTexture.removeFromCache=function removeFromCache(baseTexture){if(typeof baseTexture==="string"){var baseTextureFromCache=_utils.BaseTextureCache[baseTexture];if(baseTextureFromCache){var index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);if(index>-1){baseTextureFromCache.textureCacheIds.splice(index,1)}delete _utils.BaseTextureCache[baseTexture];return baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i){delete _utils.BaseTextureCache[baseTexture.textureCacheIds[i]]}baseTexture.textureCacheIds.length=0;return baseTexture}return null};return BaseTexture}(_eventemitter2.default);exports.default=BaseTexture},{"../settings":333,"../utils":357,"../utils/determineCrossOrigin":356,"bit-twiddle":23,eventemitter3:172}],345:[function(require,module,exports){"use strict";exports.__esModule=true;var _BaseRenderTexture=require("./BaseRenderTexture");var _BaseRenderTexture2=_interopRequireDefault(_BaseRenderTexture);var _Texture2=require("./Texture");var _Texture3=_interopRequireDefault(_Texture2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var RenderTexture=function(_Texture){_inherits(RenderTexture,_Texture);function RenderTexture(baseRenderTexture,frame){_classCallCheck(this,RenderTexture);var _legacyRenderer=null;if(!(baseRenderTexture instanceof _BaseRenderTexture2.default)){var width=arguments[1];var height=arguments[2];var scaleMode=arguments[3];var resolution=arguments[4];console.warn("Please use RenderTexture.create("+width+", "+height+") instead of the ctor directly.");_legacyRenderer=arguments[0];frame=null;baseRenderTexture=new _BaseRenderTexture2.default(width,height,scaleMode,resolution)}var _this=_possibleConstructorReturn(this,_Texture.call(this,baseRenderTexture,frame));_this.legacyRenderer=_legacyRenderer;_this.valid=true;_this._updateUvs();return _this}RenderTexture.prototype.resize=function resize(width,height,doNotResizeBaseTexture){width=Math.ceil(width);height=Math.ceil(height);this.valid=width>0&&height>0;this._frame.width=this.orig.width=width;this._frame.height=this.orig.height=height;if(!doNotResizeBaseTexture){this.baseTexture.resize(width,height)}this._updateUvs()};RenderTexture.create=function create(width,height,scaleMode,resolution){return new RenderTexture(new _BaseRenderTexture2.default(width,height,scaleMode,resolution))};return RenderTexture}(_Texture3.default);exports.default=RenderTexture},{"./BaseRenderTexture":343,"./Texture":347}],346:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _=require("../");var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Spritesheet=function(){_createClass(Spritesheet,null,[{key:"BATCH_SIZE",get:function get(){return 1e3}}]);function Spritesheet(baseTexture,data){var resolutionFilename=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_classCallCheck(this,Spritesheet);this.baseTexture=baseTexture;this.textures={};this.data=data;this.resolution=this._updateResolution(resolutionFilename||this.baseTexture.imageUrl);this._frames=this.data.frames;this._frameKeys=Object.keys(this._frames);this._batchIndex=0;this._callback=null}Spritesheet.prototype._updateResolution=function _updateResolution(resolutionFilename){var scale=this.data.meta.scale;var resolution=(0,_utils.getResolutionOfUrl)(resolutionFilename,null);if(resolution===null){resolution=scale!==undefined?parseFloat(scale):1}if(resolution!==1){this.baseTexture.resolution=resolution;this.baseTexture.update()}return resolution};Spritesheet.prototype.parse=function parse(callback){this._batchIndex=0;this._callback=callback;if(this._frameKeys.length<=Spritesheet.BATCH_SIZE){this._processFrames(0);this._parseComplete()}else{this._nextBatch()}};Spritesheet.prototype._processFrames=function _processFrames(initialFrameIndex){var frameIndex=initialFrameIndex;var maxFrames=Spritesheet.BATCH_SIZE;var sourceScale=this.baseTexture.sourceScale;while(frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length){var i=this._frameKeys[frameIndex];var rect=this._frames[i].frame;if(rect){var frame=null;var trim=null;var orig=new _.Rectangle(0,0,Math.floor(this._frames[i].sourceSize.w*sourceScale)/this.resolution,Math.floor(this._frames[i].sourceSize.h*sourceScale)/this.resolution);if(this._frames[i].rotated){frame=new _.Rectangle(Math.floor(rect.x*sourceScale)/this.resolution,Math.floor(rect.y*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution)}else{frame=new _.Rectangle(Math.floor(rect.x*sourceScale)/this.resolution,Math.floor(rect.y*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution)}if(this._frames[i].trimmed){trim=new _.Rectangle(Math.floor(this._frames[i].spriteSourceSize.x*sourceScale)/this.resolution,Math.floor(this._frames[i].spriteSourceSize.y*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution)}this.textures[i]=new _.Texture(this.baseTexture,frame,orig,trim,this._frames[i].rotated?2:0);_.Texture.addToCache(this.textures[i],i)}frameIndex++}};Spritesheet.prototype._parseComplete=function _parseComplete(){var callback=this._callback;this._callback=null;this._batchIndex=0;callback.call(this,this.textures)};Spritesheet.prototype._nextBatch=function _nextBatch(){var _this=this;this._processFrames(this._batchIndex*Spritesheet.BATCH_SIZE);this._batchIndex++;setTimeout(function(){if(_this._batchIndex*Spritesheet.BATCH_SIZE<_this._frameKeys.length){_this._nextBatch()}else{_this._parseComplete()}},0)};Spritesheet.prototype.destroy=function destroy(){var destroyBase=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;for(var i in this.textures){this.textures[i].destroy()}this._frames=null;this._frameKeys=null;this.data=null;this.textures=null;if(destroyBase){this.baseTexture.destroy()}this.baseTexture=null};return Spritesheet}();exports.default=Spritesheet},{"../":297,"../utils":357}],347:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _BaseTexture=require("./BaseTexture");var _BaseTexture2=_interopRequireDefault(_BaseTexture);var _VideoBaseTexture=require("./VideoBaseTexture");var _VideoBaseTexture2=_interopRequireDefault(_VideoBaseTexture);var _TextureUvs=require("./TextureUvs");var _TextureUvs2=_interopRequireDefault(_TextureUvs);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _math=require("../math");var _utils=require("../utils");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Texture=function(_EventEmitter){_inherits(Texture,_EventEmitter);function Texture(baseTexture,frame,orig,trim,rotate){_classCallCheck(this,Texture);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));_this.noFrame=false;if(!frame){_this.noFrame=true;frame=new _math.Rectangle(0,0,1,1)}if(baseTexture instanceof Texture){baseTexture=baseTexture.baseTexture}_this.baseTexture=baseTexture;_this._frame=frame;_this.trim=trim;_this.valid=false;_this.requiresUpdate=false;_this._uvs=null;_this.orig=orig||frame;_this._rotate=Number(rotate||0);if(rotate===true){_this._rotate=2}else if(_this._rotate%2!==0){throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually")}if(baseTexture.hasLoaded){if(_this.noFrame){frame=new _math.Rectangle(0,0,baseTexture.width,baseTexture.height);baseTexture.on("update",_this.onBaseTextureUpdated,_this)}_this.frame=frame}else{baseTexture.once("loaded",_this.onBaseTextureLoaded,_this)}_this._updateID=0;_this.transform=null;_this.textureCacheIds=[];return _this}Texture.prototype.update=function update(){this.baseTexture.update()};Texture.prototype.onBaseTextureLoaded=function onBaseTextureLoaded(baseTexture){this._updateID++;if(this.noFrame){this.frame=new _math.Rectangle(0,0,baseTexture.width,baseTexture.height)}else{this.frame=this._frame}this.baseTexture.on("update",this.onBaseTextureUpdated,this);this.emit("update",this)};Texture.prototype.onBaseTextureUpdated=function onBaseTextureUpdated(baseTexture){this._updateID++;this._frame.width=baseTexture.width;this._frame.height=baseTexture.height;this.emit("update",this)};Texture.prototype.destroy=function destroy(destroyBase){if(this.baseTexture){if(destroyBase){if(_utils.TextureCache[this.baseTexture.imageUrl]){Texture.removeFromCache(this.baseTexture.imageUrl)}this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this);this.baseTexture.off("loaded",this.onBaseTextureLoaded,this);this.baseTexture=null}this._frame=null;this._uvs=null;this.trim=null;this.orig=null;this.valid=false;Texture.removeFromCache(this);this.textureCacheIds=null};Texture.prototype.clone=function clone(){return new Texture(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)};Texture.prototype._updateUvs=function _updateUvs(){if(!this._uvs){this._uvs=new _TextureUvs2.default}this._uvs.set(this._frame,this.baseTexture,this.rotate);this._updateID++};Texture.fromImage=function fromImage(imageUrl,crossorigin,scaleMode,sourceScale){var texture=_utils.TextureCache[imageUrl];if(!texture){texture=new Texture(_BaseTexture2.default.fromImage(imageUrl,crossorigin,scaleMode,sourceScale));Texture.addToCache(texture,imageUrl)}return texture};Texture.fromFrame=function fromFrame(frameId){var texture=_utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache')}return texture};Texture.fromCanvas=function fromCanvas(canvas,scaleMode){var origin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"canvas";return new Texture(_BaseTexture2.default.fromCanvas(canvas,scaleMode,origin))};Texture.fromVideo=function fromVideo(video,scaleMode){if(typeof video==="string"){return Texture.fromVideoUrl(video,scaleMode)}return new Texture(_VideoBaseTexture2.default.fromVideo(video,scaleMode))};Texture.fromVideoUrl=function fromVideoUrl(videoUrl,scaleMode){return new Texture(_VideoBaseTexture2.default.fromUrl(videoUrl,scaleMode))};Texture.from=function from(source){if(typeof source==="string"){var texture=_utils.TextureCache[source];if(!texture){var isVideo=source.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)!==null;if(isVideo){return Texture.fromVideoUrl(source)}return Texture.fromImage(source)}return texture}else if(source instanceof HTMLImageElement){return new Texture(_BaseTexture2.default.from(source))}else if(source instanceof HTMLCanvasElement){return Texture.fromCanvas(source,_settings2.default.SCALE_MODE,"HTMLCanvasElement")}else if(source instanceof HTMLVideoElement){return Texture.fromVideo(source)}else if(source instanceof _BaseTexture2.default){return new Texture(source)}return source};Texture.fromLoader=function fromLoader(source,imageUrl,name){var baseTexture=new _BaseTexture2.default(source,undefined,(0,_utils.getResolutionOfUrl)(imageUrl));var texture=new Texture(baseTexture);baseTexture.imageUrl=imageUrl;if(!name){name=imageUrl}_BaseTexture2.default.addToCache(texture.baseTexture,name);Texture.addToCache(texture,name);if(name!==imageUrl){_BaseTexture2.default.addToCache(texture.baseTexture,imageUrl);Texture.addToCache(texture,imageUrl)}return texture};Texture.addToCache=function addToCache(texture,id){if(id){if(texture.textureCacheIds.indexOf(id)===-1){texture.textureCacheIds.push(id)}if(_utils.TextureCache[id]){console.warn("Texture added to the cache with an id ["+id+"] that already had an entry")}_utils.TextureCache[id]=texture}};Texture.removeFromCache=function removeFromCache(texture){if(typeof texture==="string"){var textureFromCache=_utils.TextureCache[texture];if(textureFromCache){var index=textureFromCache.textureCacheIds.indexOf(texture);if(index>-1){textureFromCache.textureCacheIds.splice(index,1)}delete _utils.TextureCache[texture];return textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i){if(_utils.TextureCache[texture.textureCacheIds[i]]===texture){delete _utils.TextureCache[texture.textureCacheIds[i]]}}texture.textureCacheIds.length=0;return texture}return null};_createClass(Texture,[{key:"frame",get:function get(){return this._frame},set:function set(frame){this._frame=frame;this.noFrame=false;var x=frame.x,y=frame.y,width=frame.width,height=frame.height;var xNotFit=x+width>this.baseTexture.width;var yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or";var errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width;var errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(errorX+" "+relationship+" "+errorY))}this.valid=width&&height&&this.baseTexture.hasLoaded;if(!this.trim&&!this.rotate){this.orig=frame}if(this.valid){this._updateUvs()}}},{key:"rotate",get:function get(){return this._rotate},set:function set(rotate){this._rotate=rotate;if(this.valid){this._updateUvs()}}},{key:"width",get:function get(){return this.orig.width}},{key:"height",get:function get(){return this.orig.height}}]);return Texture}(_eventemitter2.default);exports.default=Texture;function createWhiteTexture(){var canvas=document.createElement("canvas");canvas.width=10;canvas.height=10;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,10,10);return new Texture(new _BaseTexture2.default(canvas))}function removeAllHandlers(tex){tex.destroy=function _emptyDestroy(){};tex.on=function _emptyOn(){};tex.once=function _emptyOnce(){};tex.emit=function _emptyEmit(){}}Texture.EMPTY=new Texture(new _BaseTexture2.default);removeAllHandlers(Texture.EMPTY);removeAllHandlers(Texture.EMPTY.baseTexture);Texture.WHITE=createWhiteTexture();removeAllHandlers(Texture.WHITE);removeAllHandlers(Texture.WHITE.baseTexture)},{"../math":302,"../settings":333,"../utils":357,"./BaseTexture":344,"./TextureUvs":349,"./VideoBaseTexture":350,eventemitter3:172}],348:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Matrix=require("../math/Matrix");var _Matrix2=_interopRequireDefault(_Matrix);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var tempMat=new _Matrix2.default;var TextureMatrix=function(){function TextureMatrix(texture,clampMargin){_classCallCheck(this,TextureMatrix);this._texture=texture;this.mapCoord=new _Matrix2.default;this.uClampFrame=new Float32Array(4);this.uClampOffset=new Float32Array(2);this._lastTextureID=-1;this.clampOffset=0;this.clampMargin=typeof clampMargin==="undefined"?.5:clampMargin}TextureMatrix.prototype.multiplyUvs=function multiplyUvs(uvs,out){if(out===undefined){out=uvs}var mat=this.mapCoord;for(var i=0;i<uvs.length;i+=2){var x=uvs[i];var y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx;out[i+1]=x*mat.b+y*mat.d+mat.ty}return out};TextureMatrix.prototype.update=function update(forceUpdate){var tex=this._texture;if(!tex||!tex.valid){return false}if(!forceUpdate&&this._lastTextureID===tex._updateID){return false}this._lastTextureID=tex._updateID;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig;var trim=tex.trim;if(trim){tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height);this.mapCoord.append(tempMat)}var texBase=tex.baseTexture;var frame=this.uClampFrame;var margin=this.clampMargin/texBase.resolution;var offset=this.clampOffset;frame[0]=(tex._frame.x+margin+offset)/texBase.width;frame[1]=(tex._frame.y+margin+offset)/texBase.height;frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width;frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height;this.uClampOffset[0]=offset/texBase.realWidth;this.uClampOffset[1]=offset/texBase.realHeight;return true};_createClass(TextureMatrix,[{key:"texture",get:function get(){return this._texture},set:function set(value){this._texture=value;this._lastTextureID=-1}}]);return TextureMatrix}();exports.default=TextureMatrix},{"../math/Matrix":299}],349:[function(require,module,exports){"use strict";exports.__esModule=true;var _GroupD=require("../math/GroupD8");var _GroupD2=_interopRequireDefault(_GroupD);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TextureUvs=function(){function TextureUvs(){_classCallCheck(this,TextureUvs);this.x0=0;this.y0=0;this.x1=1;this.y1=0;this.x2=1;this.y2=1;this.x3=0;this.y3=1;this.uvsUint32=new Uint32Array(4)}TextureUvs.prototype.set=function set(frame,baseFrame,rotate){var tw=baseFrame.width;var th=baseFrame.height;if(rotate){var w2=frame.width/2/tw;var h2=frame.height/2/th;var cX=frame.x/tw+w2;var cY=frame.y/th+h2;rotate=_GroupD2.default.add(rotate,_GroupD2.default.NW);this.x0=cX+w2*_GroupD2.default.uX(rotate);this.y0=cY+h2*_GroupD2.default.uY(rotate);rotate=_GroupD2.default.add(rotate,2);this.x1=cX+w2*_GroupD2.default.uX(rotate);this.y1=cY+h2*_GroupD2.default.uY(rotate);rotate=_GroupD2.default.add(rotate,2);this.x2=cX+w2*_GroupD2.default.uX(rotate);this.y2=cY+h2*_GroupD2.default.uY(rotate);rotate=_GroupD2.default.add(rotate,2);this.x3=cX+w2*_GroupD2.default.uX(rotate);this.y3=cY+h2*_GroupD2.default.uY(rotate)}else{this.x0=frame.x/tw;this.y0=frame.y/th;this.x1=(frame.x+frame.width)/tw;this.y1=frame.y/th;this.x2=(frame.x+frame.width)/tw;this.y2=(frame.y+frame.height)/th;this.x3=frame.x/tw;this.y3=(frame.y+frame.height)/th}this.uvsUint32[0]=(this.y0*65535&65535)<<16|this.x0*65535&65535;this.uvsUint32[1]=(this.y1*65535&65535)<<16|this.x1*65535&65535;this.uvsUint32[2]=(this.y2*65535&65535)<<16|this.x2*65535&65535;this.uvsUint32[3]=(this.y3*65535&65535)<<16|this.x3*65535&65535};return TextureUvs}();exports.default=TextureUvs},{"../math/GroupD8":298}],350:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _BaseTexture2=require("./BaseTexture");var _BaseTexture3=_interopRequireDefault(_BaseTexture2);var _utils=require("../utils");var _ticker=require("../ticker");var _const=require("../const");var _determineCrossOrigin=require("../utils/determineCrossOrigin");var _determineCrossOrigin2=_interopRequireDefault(_determineCrossOrigin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VideoBaseTexture=function(_BaseTexture){_inherits(VideoBaseTexture,_BaseTexture);function VideoBaseTexture(source,scaleMode){_classCallCheck(this,VideoBaseTexture);if(!source){throw new Error("No video source element specified.")}if((source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height){source.complete=true}var _this=_possibleConstructorReturn(this,_BaseTexture.call(this,source,scaleMode));_this.width=source.videoWidth;_this.height=source.videoHeight;_this._autoUpdate=true;_this._isAutoUpdating=false;_this.autoPlay=true;_this.update=_this.update.bind(_this);_this._onCanPlay=_this._onCanPlay.bind(_this);source.addEventListener("play",_this._onPlayStart.bind(_this));source.addEventListener("pause",_this._onPlayStop.bind(_this));_this.hasLoaded=false;_this.__loaded=false;if(!_this._isSourceReady()){source.addEventListener("canplay",_this._onCanPlay);source.addEventListener("canplaythrough",_this._onCanPlay)}else{_this._onCanPlay()}return _this}VideoBaseTexture.prototype._isSourcePlaying=function _isSourcePlaying(){var source=this.source;return source.currentTime>0&&source.paused===false&&source.ended===false&&source.readyState>2};VideoBaseTexture.prototype._isSourceReady=function _isSourceReady(){return this.source.readyState===3||this.source.readyState===4};VideoBaseTexture.prototype._onPlayStart=function _onPlayStart(){if(!this.hasLoaded){this._onCanPlay()}if(!this._isAutoUpdating&&this.autoUpdate){_ticker.shared.add(this.update,this,_const.UPDATE_PRIORITY.HIGH);this._isAutoUpdating=true}};VideoBaseTexture.prototype._onPlayStop=function _onPlayStop(){if(this._isAutoUpdating){_ticker.shared.remove(this.update,this);this._isAutoUpdating=false}};VideoBaseTexture.prototype._onCanPlay=function _onCanPlay(){this.hasLoaded=true;if(this.source){this.source.removeEventListener("canplay",this._onCanPlay);this.source.removeEventListener("canplaythrough",this._onCanPlay);this.width=this.source.videoWidth;this.height=this.source.videoHeight;if(!this.__loaded){this.__loaded=true;this.emit("loaded",this)}if(this._isSourcePlaying()){this._onPlayStart()}else if(this.autoPlay){this.source.play()}}};VideoBaseTexture.prototype.destroy=function destroy(){if(this._isAutoUpdating){_ticker.shared.remove(this.update,this)}if(this.source&&this.source._pixiId){_BaseTexture3.default.removeFromCache(this.source._pixiId);delete this.source._pixiId}_BaseTexture.prototype.destroy.call(this)};VideoBaseTexture.fromVideo=function fromVideo(video,scaleMode){if(!video._pixiId){video._pixiId="video_"+(0,_utils.uid)()}var baseTexture=_utils.BaseTextureCache[video._pixiId];if(!baseTexture){baseTexture=new VideoBaseTexture(video,scaleMode);_BaseTexture3.default.addToCache(baseTexture,video._pixiId)}return baseTexture};VideoBaseTexture.fromUrl=function fromUrl(videoSrc,scaleMode,crossorigin){var video=document.createElement("video");video.setAttribute("webkit-playsinline","");video.setAttribute("playsinline","");var url=Array.isArray(videoSrc)?videoSrc[0].src||videoSrc[0]:videoSrc.src||videoSrc;if(crossorigin===undefined&&url.indexOf("data:")!==0){video.crossOrigin=(0,_determineCrossOrigin2.default)(url)}else if(crossorigin){video.crossOrigin=typeof crossorigin==="string"?crossorigin:"anonymous"}if(Array.isArray(videoSrc)){for(var i=0;i<videoSrc.length;++i){video.appendChild(createSource(videoSrc[i].src||videoSrc[i],videoSrc[i].mime))}}else{video.appendChild(createSource(url,videoSrc.mime))}video.load();return VideoBaseTexture.fromVideo(video,scaleMode)};_createClass(VideoBaseTexture,[{key:"autoUpdate",get:function get(){return this._autoUpdate},set:function set(value){if(value!==this._autoUpdate){this._autoUpdate=value;if(!this._autoUpdate&&this._isAutoUpdating){_ticker.shared.remove(this.update,this);this._isAutoUpdating=false}else if(this._autoUpdate&&!this._isAutoUpdating){_ticker.shared.add(this.update,this,_const.UPDATE_PRIORITY.HIGH);this._isAutoUpdating=true}}}}]);return VideoBaseTexture}(_BaseTexture3.default);exports.default=VideoBaseTexture;VideoBaseTexture.fromUrls=VideoBaseTexture.fromUrl;function createSource(path,type){if(!type){type="video/"+path.substr(path.lastIndexOf(".")+1)}var source=document.createElement("source");source.src=path;source.type=type;return source}},{"../const":278,"../ticker":353,"../utils":357,"../utils/determineCrossOrigin":356,"./BaseTexture":344}],351:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _const=require("../const");var _TickerListener=require("./TickerListener");var _TickerListener2=_interopRequireDefault(_TickerListener);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Ticker=function(){function Ticker(){var _this=this;_classCallCheck(this,Ticker);this._head=new _TickerListener2.default(null,null,Infinity);this._requestId=null;this._maxElapsedMS=100;this.autoStart=false;this.deltaTime=1;this.elapsedMS=1/_settings2.default.TARGET_FPMS;this.lastTime=-1;this.speed=1;this.started=false;this._tick=function(time){_this._requestId=null;if(_this.started){_this.update(time);if(_this.started&&_this._requestId===null&&_this._head.next){_this._requestId=requestAnimationFrame(_this._tick)}}}}Ticker.prototype._requestIfNeeded=function _requestIfNeeded(){if(this._requestId===null&&this._head.next){this.lastTime=performance.now();this._requestId=requestAnimationFrame(this._tick)}};Ticker.prototype._cancelIfNeeded=function _cancelIfNeeded(){if(this._requestId!==null){cancelAnimationFrame(this._requestId);this._requestId=null}};Ticker.prototype._startIfPossible=function _startIfPossible(){if(this.started){this._requestIfNeeded()}else if(this.autoStart){this.start()}};Ticker.prototype.add=function add(fn,context){var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_const.UPDATE_PRIORITY.NORMAL;return this._addListener(new _TickerListener2.default(fn,context,priority))};Ticker.prototype.addOnce=function addOnce(fn,context){var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_const.UPDATE_PRIORITY.NORMAL;return this._addListener(new _TickerListener2.default(fn,context,priority,true))};Ticker.prototype._addListener=function _addListener(listener){var current=this._head.next;var previous=this._head;if(!current){listener.connect(previous)}else{while(current){if(listener.priority>current.priority){listener.connect(previous);break}previous=current;current=current.next}if(!listener.previous){listener.connect(previous)}}this._startIfPossible();return this};Ticker.prototype.remove=function remove(fn,context){var listener=this._head.next;while(listener){if(listener.match(fn,context)){listener=listener.destroy()}else{listener=listener.next}}if(!this._head.next){this._cancelIfNeeded()}return this};Ticker.prototype.start=function start(){if(!this.started){this.started=true;this._requestIfNeeded()}};Ticker.prototype.stop=function stop(){if(this.started){this.started=false;this._cancelIfNeeded()}};Ticker.prototype.destroy=function destroy(){this.stop();var listener=this._head.next;while(listener){listener=listener.destroy(true)}this._head.destroy();this._head=null};Ticker.prototype.update=function update(){var currentTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:performance.now();var elapsedMS=void 0;if(currentTime>this.lastTime){elapsedMS=this.elapsedMS=currentTime-this.lastTime;if(elapsedMS>this._maxElapsedMS){elapsedMS=this._maxElapsedMS}this.deltaTime=elapsedMS*_settings2.default.TARGET_FPMS*this.speed;var head=this._head;var listener=head.next;while(listener){listener=listener.emit(this.deltaTime)}if(!head.next){this._cancelIfNeeded()}}else{this.deltaTime=this.elapsedMS=0}this.lastTime=currentTime};_createClass(Ticker,[{key:"FPS",get:function get(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function get(){return 1e3/this._maxElapsedMS},set:function set(fps){var minFPMS=Math.min(Math.max(0,fps)/1e3,_settings2.default.TARGET_FPMS);this._maxElapsedMS=1/minFPMS}}]);return Ticker}();exports.default=Ticker},{"../const":278,"../settings":333,"./TickerListener":352}],352:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TickerListener=function(){function TickerListener(fn){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var priority=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var once=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,TickerListener);this.fn=fn;this.context=context;this.priority=priority;this.once=once;this.next=null;this.previous=null;this._destroyed=false}TickerListener.prototype.match=function match(fn,context){context=context||null;return this.fn===fn&&this.context===context};TickerListener.prototype.emit=function emit(deltaTime){if(this.fn){if(this.context){this.fn.call(this.context,deltaTime)}else{this.fn(deltaTime)}}var redirect=this.next;if(this.once){this.destroy(true)}if(this._destroyed){this.next=null}return redirect};TickerListener.prototype.connect=function connect(previous){this.previous=previous;if(previous.next){previous.next.previous=this}this.next=previous.next;previous.next=this};TickerListener.prototype.destroy=function destroy(){var hard=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._destroyed=true;this.fn=null;this.context=null;if(this.previous){this.previous.next=this.next}if(this.next){this.next.previous=this.previous}var redirect=this.previous;this.next=hard?null:redirect;this.previous=null;return redirect};return TickerListener}();exports.default=TickerListener},{}],353:[function(require,module,exports){"use strict";exports.__esModule=true;exports.Ticker=exports.shared=undefined;var _Ticker=require("./Ticker");var _Ticker2=_interopRequireDefault(_Ticker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var shared=new _Ticker2.default;shared.autoStart=true;shared.destroy=function(){};exports.shared=shared;exports.Ticker=_Ticker2.default},{"./Ticker":351}],354:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=canUploadSameBuffer;function canUploadSameBuffer(){var ios=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);return!ios}},{}],355:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=createIndicesForQuads;function createIndicesForQuads(size){var totalIndices=size*6;var indices=new Uint16Array(totalIndices);for(var i=0,j=0;i<totalIndices;i+=6,j+=4){indices[i+0]=j+0;indices[i+1]=j+1;indices[i+2]=j+2;indices[i+3]=j+0;indices[i+4]=j+2;indices[i+5]=j+3}return indices}},{}],356:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=determineCrossOrigin;var _url2=require("url");var _url3=_interopRequireDefault(_url2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var tempAnchor=void 0;function determineCrossOrigin(url){var loc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.location;if(url.indexOf("data:")===0){return""}loc=loc||window.location;if(!tempAnchor){tempAnchor=document.createElement("a")}tempAnchor.href=url;url=_url3.default.parse(tempAnchor.href);var samePort=!url.port&&loc.port===""||url.port===loc.port;if(url.hostname!==loc.hostname||!samePort||url.protocol!==loc.protocol){return"anonymous"}return""}},{url:544}],357:[function(require,module,exports){"use strict";exports.__esModule=true;exports.premultiplyBlendMode=exports.BaseTextureCache=exports.TextureCache=exports.mixins=exports.pluginTarget=exports.EventEmitter=exports.removeItems=exports.isMobile=undefined;exports.uid=uid;exports.hex2rgb=hex2rgb;exports.hex2string=hex2string;exports.rgb2hex=rgb2hex;exports.getResolutionOfUrl=getResolutionOfUrl;exports.decomposeDataUri=decomposeDataUri;exports.getUrlFileExtension=getUrlFileExtension;exports.getSvgSize=getSvgSize;exports.skipHello=skipHello;exports.sayHello=sayHello;exports.isWebGLSupported=isWebGLSupported;exports.sign=sign;exports.destroyTextureCache=destroyTextureCache;exports.clearTextureCache=clearTextureCache;exports.correctBlendMode=correctBlendMode;exports.premultiplyTint=premultiplyTint;exports.premultiplyRgba=premultiplyRgba;exports.premultiplyTintToRgba=premultiplyTintToRgba;var _const=require("../const");var _settings=require("../settings");var _settings2=_interopRequireDefault(_settings);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _pluginTarget=require("./pluginTarget");var _pluginTarget2=_interopRequireDefault(_pluginTarget);var _mixin=require("./mixin");var mixins=_interopRequireWildcard(_mixin);var _ismobilejs=require("ismobilejs");var isMobile=_interopRequireWildcard(_ismobilejs);var _removeArrayItems=require("remove-array-items");var _removeArrayItems2=_interopRequireDefault(_removeArrayItems);var _mapPremultipliedBlendModes=require("./mapPremultipliedBlendModes");var _mapPremultipliedBlendModes2=_interopRequireDefault(_mapPremultipliedBlendModes);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var nextUid=0;var saidHello=false;exports.isMobile=isMobile;exports.removeItems=_removeArrayItems2.default;exports.EventEmitter=_eventemitter2.default;exports.pluginTarget=_pluginTarget2.default;exports.mixins=mixins;function uid(){return++nextUid}function hex2rgb(hex,out){out=out||[];out[0]=(hex>>16&255)/255;out[1]=(hex>>8&255)/255;out[2]=(hex&255)/255;return out}function hex2string(hex){hex=hex.toString(16);hex="000000".substr(0,6-hex.length)+hex;return"#"+hex}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+(rgb[2]*255|0)}function getResolutionOfUrl(url,defaultValue){var resolution=_settings2.default.RETINA_PREFIX.exec(url);if(resolution){return parseFloat(resolution[1])}return defaultValue!==undefined?defaultValue:1}function decomposeDataUri(dataUri){var dataUriMatch=_const.DATA_URI.exec(dataUri);if(dataUriMatch){return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():undefined,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():undefined,encoding:dataUriMatch[3]?dataUriMatch[3].toLowerCase():undefined,data:dataUriMatch[4]}}return undefined}function getUrlFileExtension(url){var extension=_const.URL_FILE_EXTENSION.exec(url);if(extension){return extension[1].toLowerCase()}return undefined}function getSvgSize(svgString){var sizeMatch=_const.SVG_SIZE.exec(svgString);var size={};if(sizeMatch){size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3]));size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))}return size}function skipHello(){saidHello=true}function sayHello(type){if(saidHello){return}if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c PixiJS "+_const.VERSION+" - ✰ "+type+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,args)}else if(window.console){window.console.log("PixiJS "+_const.VERSION+" - "+type+" - http://www.pixijs.com/")}saidHello=true}function isWebGLSupported(){var contextOptions={stencil:true,failIfMajorPerformanceCaveat:true};try{if(!window.WebGLRenderingContext){return false}var canvas=document.createElement("canvas");var gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions);var success=!!(gl&&gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");if(loseContext){loseContext.loseContext()}}gl=null;return success}catch(e){return false}}function sign(n){if(n===0)return 0;return n<0?-1:1}var TextureCache=exports.TextureCache=Object.create(null);var BaseTextureCache=exports.BaseTextureCache=Object.create(null);function destroyTextureCache(){var key=void 0;for(key in TextureCache){TextureCache[key].destroy()}for(key in BaseTextureCache){BaseTextureCache[key].destroy()}}function clearTextureCache(){var key=void 0;for(key in TextureCache){delete TextureCache[key]}for(key in BaseTextureCache){delete BaseTextureCache[key]}}var premultiplyBlendMode=exports.premultiplyBlendMode=(0,_mapPremultipliedBlendModes2.default)();function correctBlendMode(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode]}function premultiplyTint(tint,alpha){if(alpha===1){return(alpha*255<<24)+tint}if(alpha===0){return 0}var R=tint>>16&255;var G=tint>>8&255;var B=tint&255;R=R*alpha+.5|0;G=G*alpha+.5|0;B=B*alpha+.5|0;return(alpha*255<<24)+(R<<16)+(G<<8)+B}function premultiplyRgba(rgb,alpha,out,premultiply){out=out||new Float32Array(4);if(premultiply||premultiply===undefined){out[0]=rgb[0]*alpha;out[1]=rgb[1]*alpha;out[2]=rgb[2]*alpha}else{out[0]=rgb[0];out[1]=rgb[1];out[2]=rgb[2]}out[3]=alpha;return out}function premultiplyTintToRgba(tint,alpha,out,premultiply){out=out||new Float32Array(4);out[0]=(tint>>16&255)/255;out[1]=(tint>>8&255)/255;out[2]=(tint&255)/255;if(premultiply||premultiply===undefined){out[0]*=alpha;out[1]*=alpha;out[2]*=alpha}out[3]=alpha;return out}},{"../const":278,"../settings":333,"./mapPremultipliedBlendModes":358,"./mixin":360,"./pluginTarget":361,eventemitter3:172,ismobilejs:220,"remove-array-items":434}],358:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=mapPremultipliedBlendModes;var _const=require("../const");function mapPremultipliedBlendModes(){var pm=[];var npm=[];for(var i=0;i<32;i++){pm[i]=i;npm[i]=i}pm[_const.BLEND_MODES.NORMAL_NPM]=_const.BLEND_MODES.NORMAL;pm[_const.BLEND_MODES.ADD_NPM]=_const.BLEND_MODES.ADD;pm[_const.BLEND_MODES.SCREEN_NPM]=_const.BLEND_MODES.SCREEN;npm[_const.BLEND_MODES.NORMAL]=_const.BLEND_MODES.NORMAL_NPM;npm[_const.BLEND_MODES.ADD]=_const.BLEND_MODES.ADD_NPM;npm[_const.BLEND_MODES.SCREEN]=_const.BLEND_MODES.SCREEN_NPM;var array=[];array.push(npm);array.push(pm);return array}},{"../const":278}],359:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=maxRecommendedTextures;var _ismobilejs=require("ismobilejs");var _ismobilejs2=_interopRequireDefault(_ismobilejs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function maxRecommendedTextures(max){if(_ismobilejs2.default.tablet||_ismobilejs2.default.phone){return 4}return max}},{ismobilejs:220}],360:[function(require,module,exports){"use strict";exports.__esModule=true;exports.mixin=mixin;exports.delayMixin=delayMixin;exports.performMixins=performMixins;function mixin(target,source){if(!target||!source)return;var keys=Object.keys(source);for(var i=0;i<keys.length;++i){var propertyName=keys[i];Object.defineProperty(target,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}}var mixins=[];function delayMixin(target,source){mixins.push(target,source)}function performMixins(){for(var i=0;i<mixins.length;i+=2){mixin(mixins[i],mixins[i+1])}mixins.length=0}},{}],361:[function(require,module,exports){"use strict";exports.__esModule=true;function pluginTarget(obj){obj.__plugins={};obj.registerPlugin=function registerPlugin(pluginName,ctor){obj.__plugins[pluginName]=ctor};obj.prototype.initPlugins=function initPlugins(){this.plugins=this.plugins||{};for(var o in obj.__plugins){this.plugins[o]=new obj.__plugins[o](this)}};obj.prototype.destroyPlugins=function destroyPlugins(){for(var o in this.plugins){this.plugins[o].destroy();this.plugins[o]=null}this.plugins=null}}exports.default={mixin:function mixin(obj){pluginTarget(obj)}}},{}],362:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=trimCanvas;function trimCanvas(canvas){var width=canvas.width;var height=canvas.height;var context=canvas.getContext("2d");var imageData=context.getImageData(0,0,width,height);var pixels=imageData.data;var len=pixels.length;var bound={top:null,left:null,right:null,bottom:null};var i=void 0;var x=void 0;var y=void 0;for(i=0;i<len;i+=4){if(pixels[i+3]!==0){x=i/4%width;y=~~(i/4/width);if(bound.top===null){bound.top=y}if(bound.left===null){bound.left=x}else if(x<bound.left){bound.left=x}if(bound.right===null){bound.right=x+1}else if(bound.right<x){bound.right=x+1}if(bound.bottom===null){bound.bottom=y}else if(bound.bottom<y){bound.bottom=y}}}width=bound.right-bound.left;height=bound.bottom-bound.top+1;var data=context.getImageData(bound.left,bound.top,width,height);return{height:height,width:width,data:data}}},{}],363:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=deprecation;function warn(msg){var stack=(new Error).stack;if(typeof stack==="undefined"){console.warn("Deprecation Warning: ",msg)}else{stack=stack.split("\n").splice(3).join("\n");if(console.groupCollapsed){console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",msg);console.warn(stack);console.groupEnd()}else{console.warn("Deprecation Warning: ",msg);console.warn(stack)}}}function deprecation(core){var mesh=core.mesh,particles=core.particles,extras=core.extras,filters=core.filters,prepare=core.prepare,loaders=core.loaders,interaction=core.interaction;Object.defineProperties(core,{SpriteBatch:{get:function get(){throw new ReferenceError("SpriteBatch does not exist any more, "+"please use the new ParticleContainer instead.")}},AssetLoader:{get:function get(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, "+"please see the new PIXI.loaders.Loader class.")}},Stage:{get:function get(){warn("You do not need to use a PIXI Stage any more, you can simply render any container.");return core.Container}},DisplayObjectContainer:{get:function get(){warn("DisplayObjectContainer has been shortened to Container, please use Container from now on.");return core.Container}},Strip:{get:function get(){warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on.");return mesh.Mesh}},Rope:{get:function get(){warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on.");return mesh.Rope}},ParticleContainer:{get:function get(){warn("The ParticleContainer class has been moved to particles.ParticleContainer, "+"please use particles.ParticleContainer from now on.");return particles.ParticleContainer}},MovieClip:{get:function get(){warn("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite.");return extras.AnimatedSprite}},TilingSprite:{get:function get(){warn("The TilingSprite class has been moved to extras.TilingSprite, "+"please use extras.TilingSprite from now on.");return extras.TilingSprite}},BitmapText:{get:function get(){warn("The BitmapText class has been moved to extras.BitmapText, "+"please use extras.BitmapText from now on.");return extras.BitmapText}},blendModes:{get:function get(){warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on.");return core.BLEND_MODES}},scaleModes:{get:function get(){warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on.");return core.SCALE_MODES}},BaseTextureCache:{get:function get(){warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, "+"please use utils.BaseTextureCache from now on.");return core.utils.BaseTextureCache}},TextureCache:{get:function get(){warn("The TextureCache class has been moved to utils.TextureCache, "+"please use utils.TextureCache from now on.");return core.utils.TextureCache}},math:{get:function get(){warn("The math namespace is deprecated, please access members already accessible on PIXI.");return core}},AbstractFilter:{get:function get(){warn("AstractFilter has been renamed to Filter, please use PIXI.Filter");return core.Filter}},TransformManual:{get:function get(){warn("TransformManual has been renamed to TransformBase, please update your pixi-spine");return core.TransformBase}},TARGET_FPMS:{get:function get(){warn("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS");return core.settings.TARGET_FPMS},set:function set(value){warn("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS");core.settings.TARGET_FPMS=value}},FILTER_RESOLUTION:{get:function get(){warn("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION");return core.settings.FILTER_RESOLUTION},set:function set(value){warn("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION");core.settings.FILTER_RESOLUTION=value}},RESOLUTION:{get:function get(){warn("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION");return core.settings.RESOLUTION},set:function set(value){warn("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION");core.settings.RESOLUTION=value}},MIPMAP_TEXTURES:{get:function get(){warn("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES");return core.settings.MIPMAP_TEXTURES},set:function set(value){warn("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES");core.settings.MIPMAP_TEXTURES=value}},SPRITE_BATCH_SIZE:{get:function get(){warn("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE");return core.settings.SPRITE_BATCH_SIZE},set:function set(value){warn("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE");core.settings.SPRITE_BATCH_SIZE=value}},SPRITE_MAX_TEXTURES:{get:function get(){warn("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES");return core.settings.SPRITE_MAX_TEXTURES},set:function set(value){warn("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES");core.settings.SPRITE_MAX_TEXTURES=value}},RETINA_PREFIX:{get:function get(){warn("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX");return core.settings.RETINA_PREFIX},set:function set(value){warn("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX");core.settings.RETINA_PREFIX=value}},DEFAULT_RENDER_OPTIONS:{get:function get(){warn("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS");return core.settings.RENDER_OPTIONS}}});var defaults=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}];var _loop=function _loop(i){var deprecation=defaults[i];Object.defineProperty(core[deprecation.parent],"DEFAULT",{get:function get(){warn("PIXI."+deprecation.parent+".DEFAULT has been deprecated, "+("please use PIXI.settings."+deprecation.target));return core.settings[deprecation.target]},set:function set(value){warn("PIXI."+deprecation.parent+".DEFAULT has been deprecated, "+("please use PIXI.settings."+deprecation.target));core.settings[deprecation.target]=value}})};for(var i=0;i<defaults.length;i++){_loop(i)}Object.defineProperties(core.settings,{PRECISION:{get:function get(){warn("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT");return core.settings.PRECISION_FRAGMENT},set:function set(value){warn("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT");core.settings.PRECISION_FRAGMENT=value}}});if(extras.AnimatedSprite){Object.defineProperties(extras,{MovieClip:{get:function get(){warn("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on.");return extras.AnimatedSprite}}})}if(extras){Object.defineProperties(extras,{TextureTransform:{get:function get(){warn("The TextureTransform class has been renamed to TextureMatrix, "+"please use PIXI.TextureMatrix from now on.");return core.TextureMatrix}}})}core.DisplayObject.prototype.generateTexture=function generateTexture(renderer,scaleMode,resolution){warn("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)");return renderer.generateTexture(this,scaleMode,resolution)};core.Graphics.prototype.generateTexture=function generateTexture(scaleMode,resolution){warn("graphics generate texture has moved to the renderer. "+"Or to render a graphics to a texture using canvas please use generateCanvasTexture");return this.generateCanvasTexture(scaleMode,resolution)};core.GroupD8.isSwapWidthHeight=function isSwapWidthHeight(rotation){warn("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical");return core.GroupD8.isVertical(rotation)};core.RenderTexture.prototype.render=function render(displayObject,matrix,clear,updateTransform){this.legacyRenderer.render(displayObject,this,clear,matrix,!updateTransform);warn("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")};core.RenderTexture.prototype.getImage=function getImage(target){warn("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)");return this.legacyRenderer.extract.image(target)};core.RenderTexture.prototype.getBase64=function getBase64(target){warn("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)");return this.legacyRenderer.extract.base64(target)};core.RenderTexture.prototype.getCanvas=function getCanvas(target){warn("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)");return this.legacyRenderer.extract.canvas(target)};core.RenderTexture.prototype.getPixels=function getPixels(target){warn("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)");return this.legacyRenderer.pixels(target)};core.Sprite.prototype.setTexture=function setTexture(texture){this.texture=texture;warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")};if(extras.BitmapText){extras.BitmapText.prototype.setText=function setText(text){this.text=text;warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")}}core.Text.prototype.setText=function setText(text){this.text=text;warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")};core.Text.calculateFontProperties=function calculateFontProperties(font){warn("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont");return core.TextMetrics.measureFont(font)};Object.defineProperties(core.Text,{fontPropertiesCache:{get:function get(){warn("Text.fontPropertiesCache is deprecated");return core.TextMetrics._fonts}},fontPropertiesCanvas:{get:function get(){warn("Text.fontPropertiesCanvas is deprecated");return core.TextMetrics._canvas}},fontPropertiesContext:{get:function get(){warn("Text.fontPropertiesContext is deprecated");return core.TextMetrics._context}}});core.Text.prototype.setStyle=function setStyle(style){this.style=style;warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")};core.Text.prototype.determineFontProperties=function determineFontProperties(fontStyle){warn("determineFontProperties is now deprecated, please use TextMetrics.measureFont method");return core.TextMetrics.measureFont(fontStyle)};core.Text.getFontStyle=function getFontStyle(style){warn("getFontStyle is now deprecated, please use TextStyle.toFontString() instead");style=style||{};if(!(style instanceof core.TextStyle)){style=new core.TextStyle(style)}return style.toFontString()};Object.defineProperties(core.TextStyle.prototype,{font:{get:function get(){warn("text style property 'font' is now deprecated, please use the "+"'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");var fontSizeString=typeof this._fontSize==="number"?this._fontSize+"px":this._fontSize;return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+fontSizeString+" "+this._fontFamily},set:function set(font){warn("text style property 'font' is now deprecated, please use the "+"'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on");if(font.indexOf("italic")>1){this._fontStyle="italic"}else if(font.indexOf("oblique")>-1){this._fontStyle="oblique"}else{this._fontStyle="normal"}if(font.indexOf("small-caps")>-1){this._fontVariant="small-caps"}else{this._fontVariant="normal"}var splits=font.split(" ");var fontSizeIndex=-1;this._fontSize=26;for(var i=0;i<splits.length;++i){if(splits[i].match(/(px|pt|em|%)/)){fontSizeIndex=i;this._fontSize=splits[i];break}}this._fontWeight="normal";for(var _i=0;_i<fontSizeIndex;++_i){if(splits[_i].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=splits[_i];break}}if(fontSizeIndex>-1&&fontSizeIndex<splits.length-1){this._fontFamily="";for(var _i2=fontSizeIndex+1;_i2<splits.length;++_i2){this._fontFamily+=splits[_i2]+" "}this._fontFamily=this._fontFamily.slice(0,-1)}else{this._fontFamily="Arial"}this.styleID++}}});core.Texture.prototype.setFrame=function setFrame(frame){this.frame=frame;warn("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")};core.Texture.addTextureToCache=function addTextureToCache(texture,id){core.Texture.addToCache(texture,id);warn("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")};core.Texture.removeTextureFromCache=function removeTextureFromCache(id){warn("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. "+"Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. "+"For that, use BaseTexture.removeFromCache");core.BaseTexture.removeFromCache(id);return core.Texture.removeFromCache(id)};Object.defineProperties(filters,{AbstractFilter:{get:function get(){warn("AstractFilter has been renamed to Filter, please use PIXI.Filter");return core.AbstractFilter}},SpriteMaskFilter:{get:function get(){warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on.");return core.SpriteMaskFilter}},VoidFilter:{get:function get(){warn("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter");return filters.AlphaFilter}}});core.utils.uuid=function(){warn("utils.uuid() is deprecated, please use utils.uid() from now on.");return core.utils.uid()};core.utils.canUseNewCanvasBlendModes=function(){warn("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on");return core.CanvasTinter.canUseMultiply};var saidHello=true;Object.defineProperty(core.utils,"_saidHello",{set:function set(bool){if(bool){warn("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()");this.skipHello()}saidHello=bool},get:function get(){return saidHello}});if(prepare.BasePrepare){prepare.BasePrepare.prototype.register=function register(addHook,uploadHook){warn("renderer.plugins.prepare.register is now deprecated, "+"please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook");if(addHook){this.registerFindHook(addHook)}if(uploadHook){this.registerUploadHook(uploadHook)}return this}}if(prepare.canvas){Object.defineProperty(prepare.canvas,"UPLOADS_PER_FRAME",{set:function set(){warn("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set "+"renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function get(){warn("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use "+"renderer.plugins.prepare.limiter");return NaN}})}if(prepare.webgl){Object.defineProperty(prepare.webgl,"UPLOADS_PER_FRAME",{set:function set(){warn("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set "+"renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function get(){warn("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use "+"renderer.plugins.prepare.limiter");return NaN}})}if(loaders.Loader){var Resource=loaders.Resource;var Loader=loaders.Loader;Object.defineProperties(Resource.prototype,{isJson:{get:function get(){warn("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`.");return this.type===Resource.TYPE.JSON}},isXml:{get:function get(){warn("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`.");return this.type===Resource.TYPE.XML}},isImage:{get:function get(){warn("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`.");return this.type===Resource.TYPE.IMAGE}},isAudio:{get:function get(){warn("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`.");return this.type===Resource.TYPE.AUDIO}},isVideo:{get:function get(){warn("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`.");return this.type===Resource.TYPE.VIDEO}}});Object.defineProperties(Loader.prototype,{before:{get:function get(){warn("The before() method is deprecated, please use pre().");return this.pre}},after:{get:function get(){warn("The after() method is deprecated, please use use().");return this.use}}})}if(interaction.interactiveTarget){Object.defineProperty(interaction.interactiveTarget,"defaultCursor",{set:function set(value){warn("Property defaultCursor has been replaced with 'cursor'. ");this.cursor=value},get:function get(){warn("Property defaultCursor has been replaced with 'cursor'. ");return this.cursor}})}if(interaction.InteractionManager){Object.defineProperty(interaction.InteractionManager,"defaultCursorStyle",{set:function set(value){warn("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. ");this.cursorStyles.default=value},get:function get(){warn("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. ");return this.cursorStyles.default}});Object.defineProperty(interaction.InteractionManager,"currentCursorStyle",{set:function set(value){warn("Property currentCursorStyle has been removed."+"See the currentCursorMode property, which works differently.");this.currentCursorMode=value},get:function get(){warn("Property currentCursorStyle has been removed."+"See the currentCursorMode property, which works differently.");return this.currentCursorMode}})}}},{}],364:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TEMP_RECT=new core.Rectangle;var CanvasExtract=function(){function CanvasExtract(renderer){_classCallCheck(this,CanvasExtract);this.renderer=renderer;renderer.extract=this}CanvasExtract.prototype.image=function image(target){var image=new Image;image.src=this.base64(target);return image};CanvasExtract.prototype.base64=function base64(target){return this.canvas(target).toDataURL()};CanvasExtract.prototype.canvas=function canvas(target){var renderer=this.renderer;var context=void 0;var resolution=void 0;var frame=void 0;var renderTexture=void 0;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=renderer.generateTexture(target)}}if(renderTexture){context=renderTexture.baseTexture._canvasRenderTarget.context;resolution=renderTexture.baseTexture._canvasRenderTarget.resolution;frame=renderTexture.frame}else{context=renderer.rootContext;frame=TEMP_RECT;frame.width=this.renderer.width;frame.height=this.renderer.height}var width=frame.width*resolution;var height=frame.height*resolution;var canvasBuffer=new core.CanvasRenderTarget(width,height);var canvasData=context.getImageData(frame.x*resolution,frame.y*resolution,width,height);canvasBuffer.context.putImageData(canvasData,0,0);return canvasBuffer.canvas};CanvasExtract.prototype.pixels=function pixels(target){var renderer=this.renderer;var context=void 0;var resolution=void 0;var frame=void 0;var renderTexture=void 0;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=renderer.generateTexture(target)}}if(renderTexture){context=renderTexture.baseTexture._canvasRenderTarget.context;resolution=renderTexture.baseTexture._canvasRenderTarget.resolution;frame=renderTexture.frame}else{context=renderer.rootContext;frame=TEMP_RECT;frame.width=renderer.width;frame.height=renderer.height}return context.getImageData(0,0,frame.width*resolution,frame.height*resolution).data};CanvasExtract.prototype.destroy=function destroy(){this.renderer.extract=null;this.renderer=null};return CanvasExtract}();exports.default=CanvasExtract;core.CanvasRenderer.registerPlugin("extract",CanvasExtract)},{"../../core":297}],365:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLExtract=require("./webgl/WebGLExtract");Object.defineProperty(exports,"webgl",{enumerable:true,get:function get(){return _interopRequireDefault(_WebGLExtract).default}});var _CanvasExtract=require("./canvas/CanvasExtract");Object.defineProperty(exports,"canvas",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasExtract).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./canvas/CanvasExtract":364,"./webgl/WebGLExtract":366}],366:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TEMP_RECT=new core.Rectangle;var BYTES_PER_PIXEL=4;var WebGLExtract=function(){function WebGLExtract(renderer){_classCallCheck(this,WebGLExtract);this.renderer=renderer;renderer.extract=this}WebGLExtract.prototype.image=function image(target){var image=new Image;image.src=this.base64(target);return image};WebGLExtract.prototype.base64=function base64(target){return this.canvas(target).toDataURL()};WebGLExtract.prototype.canvas=function canvas(target){var renderer=this.renderer;var textureBuffer=void 0;var resolution=void 0;var frame=void 0;var flipY=false;var renderTexture=void 0;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=this.renderer.generateTexture(target)}}if(renderTexture){textureBuffer=renderTexture.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID];resolution=textureBuffer.resolution;frame=renderTexture.frame;flipY=false}else{textureBuffer=this.renderer.rootRenderTarget;resolution=textureBuffer.resolution;flipY=true;frame=TEMP_RECT;frame.width=textureBuffer.size.width;frame.height=textureBuffer.size.height}var width=frame.width*resolution;var height=frame.height*resolution;var canvasBuffer=new core.CanvasRenderTarget(width,height);if(textureBuffer){renderer.bindRenderTarget(textureBuffer);var webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);canvasData.data.set(webglPixels);canvasBuffer.context.putImageData(canvasData,0,0);if(flipY){canvasBuffer.context.scale(1,-1);canvasBuffer.context.drawImage(canvasBuffer.canvas,0,-height)}}return canvasBuffer.canvas};WebGLExtract.prototype.pixels=function pixels(target){var renderer=this.renderer;var textureBuffer=void 0;var resolution=void 0;var frame=void 0;var renderTexture=void 0;if(target){if(target instanceof core.RenderTexture){renderTexture=target}else{renderTexture=this.renderer.generateTexture(target)}}if(renderTexture){textureBuffer=renderTexture.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID];resolution=textureBuffer.resolution;frame=renderTexture.frame}else{textureBuffer=this.renderer.rootRenderTarget;resolution=textureBuffer.resolution;frame=TEMP_RECT;frame.width=textureBuffer.size.width;frame.height=textureBuffer.size.height}var width=frame.width*resolution;var height=frame.height*resolution;var webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height);if(textureBuffer){renderer.bindRenderTarget(textureBuffer);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels)}return webglPixels};WebGLExtract.prototype.destroy=function destroy(){this.renderer.extract=null;this.renderer=null};return WebGLExtract}();exports.default=WebGLExtract;core.WebGLRenderer.registerPlugin("extract",WebGLExtract)},{"../../core":297}],367:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AnimatedSprite=function(_core$Sprite){_inherits(AnimatedSprite,_core$Sprite);function AnimatedSprite(textures,autoUpdate){_classCallCheck(this,AnimatedSprite);var _this=_possibleConstructorReturn(this,_core$Sprite.call(this,textures[0]instanceof core.Texture?textures[0]:textures[0].texture));_this._textures=null;_this._durations=null;_this.textures=textures;_this._autoUpdate=autoUpdate!==false;_this.animationSpeed=1;_this.loop=true;_this.onComplete=null;_this.onFrameChange=null;_this.onLoop=null;_this._currentTime=0;_this.playing=false;return _this}AnimatedSprite.prototype.stop=function stop(){if(!this.playing){return}this.playing=false;if(this._autoUpdate){core.ticker.shared.remove(this.update,this)}};AnimatedSprite.prototype.play=function play(){if(this.playing){return}this.playing=true;if(this._autoUpdate){core.ticker.shared.add(this.update,this,core.UPDATE_PRIORITY.HIGH)}};AnimatedSprite.prototype.gotoAndStop=function gotoAndStop(frameNumber){this.stop();var previousFrame=this.currentFrame;this._currentTime=frameNumber;if(previousFrame!==this.currentFrame){this.updateTexture()}};AnimatedSprite.prototype.gotoAndPlay=function gotoAndPlay(frameNumber){var previousFrame=this.currentFrame;this._currentTime=frameNumber;if(previousFrame!==this.currentFrame){this.updateTexture()}this.play()};AnimatedSprite.prototype.update=function update(deltaTime){var elapsed=this.animationSpeed*deltaTime;var previousFrame=this.currentFrame;if(this._durations!==null){var lag=this._currentTime%1*this._durations[this.currentFrame];lag+=elapsed/60*1e3;while(lag<0){this._currentTime--;lag+=this._durations[this.currentFrame]}var sign=Math.sign(this.animationSpeed*deltaTime);this._currentTime=Math.floor(this._currentTime);while(lag>=this._durations[this.currentFrame]){lag-=this._durations[this.currentFrame]*sign;this._currentTime+=sign}this._currentTime+=lag/this._durations[this.currentFrame]}else{this._currentTime+=elapsed}if(this._currentTime<0&&!this.loop){this.gotoAndStop(0);if(this.onComplete){this.onComplete()}}else if(this._currentTime>=this._textures.length&&!this.loop){this.gotoAndStop(this._textures.length-1);if(this.onComplete){this.onComplete()}}else if(previousFrame!==this.currentFrame){if(this.loop&&this.onLoop){if(this.animationSpeed>0&&this.currentFrame<previousFrame){this.onLoop()}else if(this.animationSpeed<0&&this.currentFrame>previousFrame){this.onLoop()}}this.updateTexture()}};AnimatedSprite.prototype.updateTexture=function updateTexture(){this._texture=this._textures[this.currentFrame];this._textureID=-1;this.cachedTint=16777215;if(this.onFrameChange){this.onFrameChange(this.currentFrame)}};AnimatedSprite.prototype.destroy=function destroy(options){this.stop();_core$Sprite.prototype.destroy.call(this,options)};AnimatedSprite.fromFrames=function fromFrames(frames){var textures=[];for(var i=0;i<frames.length;++i){textures.push(core.Texture.fromFrame(frames[i]))}return new AnimatedSprite(textures)};AnimatedSprite.fromImages=function fromImages(images){var textures=[];for(var i=0;i<images.length;++i){textures.push(core.Texture.fromImage(images[i]))}return new AnimatedSprite(textures)};_createClass(AnimatedSprite,[{key:"totalFrames",get:function get(){return this._textures.length}},{key:"textures",get:function get(){return this._textures},set:function set(value){if(value[0]instanceof core.Texture){this._textures=value;this._durations=null}else{this._textures=[];this._durations=[];for(var i=0;i<value.length;i++){this._textures.push(value[i].texture);this._durations.push(value[i].time)}}this.gotoAndStop(0);this.updateTexture()}},{key:"currentFrame",get:function get(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;if(currentFrame<0){currentFrame+=this._textures.length}return currentFrame}}]);return AnimatedSprite}(core.Sprite);exports.default=AnimatedSprite},{"../core":297}],368:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _ObservablePoint=require("../core/math/ObservablePoint");var _ObservablePoint2=_interopRequireDefault(_ObservablePoint);var _utils=require("../core/utils");var _settings=require("../core/settings");var _settings2=_interopRequireDefault(_settings);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BitmapText=function(_core$Container){_inherits(BitmapText,_core$Container);function BitmapText(text){var style=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,BitmapText);var _this=_possibleConstructorReturn(this,_core$Container.call(this));_this._textWidth=0;_this._textHeight=0;_this._glyphs=[];_this._font={tint:style.tint!==undefined?style.tint:16777215,align:style.align||"left",name:null,size:0};_this.font=style.font;_this._text=text;_this._maxWidth=0;_this._maxLineHeight=0;_this._anchor=new _ObservablePoint2.default(function(){_this.dirty=true},_this,0,0);_this.dirty=false;_this.updateText();return _this}BitmapText.prototype.updateText=function updateText(){var data=BitmapText.fonts[this._font.name];var scale=this._font.size/data.size;var pos=new core.Point;var chars=[];var lineWidths=[];var prevCharCode=null;var lastLineWidth=0;var maxLineWidth=0;var line=0;var lastSpace=-1;var lastSpaceWidth=0;var spacesRemoved=0;var maxLineHeight=0;for(var i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(/(\s)/.test(this.text.charAt(i))){lastSpace=i;lastSpaceWidth=lastLineWidth}if(/(?:\r\n|\r|\n)/.test(this.text.charAt(i))){lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}if(lastSpace!==-1&&this._maxWidth>0&&pos.x*scale>this._maxWidth){core.utils.removeItems(chars,lastSpace-spacesRemoved,i-lastSpace);i=lastSpace;lastSpace=-1;++spacesRemoved;lineWidths.push(lastSpaceWidth);maxLineWidth=Math.max(maxLineWidth,lastSpaceWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}var charData=data.chars[charCode];if(!charData){continue}if(prevCharCode&&charData.kerning[prevCharCode]){pos.x+=charData.kerning[prevCharCode]}chars.push({texture:charData.texture,line:line,charCode:charCode,position:new core.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)});lastLineWidth=pos.x+(charData.texture.width+charData.xOffset);pos.x+=charData.xAdvance;maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height);prevCharCode=charCode}lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);var lineAlignOffsets=[];for(var _i=0;_i<=line;_i++){var alignOffset=0;if(this._font.align==="right"){alignOffset=maxLineWidth-lineWidths[_i]}else if(this._font.align==="center"){alignOffset=(maxLineWidth-lineWidths[_i])/2}lineAlignOffsets.push(alignOffset)}var lenChars=chars.length;var tint=this.tint;for(var _i2=0;_i2<lenChars;_i2++){var c=this._glyphs[_i2];if(c){c.texture=chars[_i2].texture}else{c=new core.Sprite(chars[_i2].texture);this._glyphs.push(c)}c.position.x=(chars[_i2].position.x+lineAlignOffsets[chars[_i2].line])*scale;c.position.y=chars[_i2].position.y*scale;c.scale.x=c.scale.y=scale;c.tint=tint;if(!c.parent){this.addChild(c)}}for(var _i3=lenChars;_i3<this._glyphs.length;++_i3){this.removeChild(this._glyphs[_i3])}this._textWidth=maxLineWidth*scale;this._textHeight=(pos.y+data.lineHeight)*scale;if(this.anchor.x!==0||this.anchor.y!==0){for(var _i4=0;_i4<lenChars;_i4++){this._glyphs[_i4].x-=this._textWidth*this.anchor.x;this._glyphs[_i4].y-=this._textHeight*this.anchor.y}}this._maxLineHeight=maxLineHeight*scale};BitmapText.prototype.updateTransform=function updateTransform(){this.validate();this.containerUpdateTransform()};BitmapText.prototype.getLocalBounds=function getLocalBounds(){this.validate();return _core$Container.prototype.getLocalBounds.call(this)};BitmapText.prototype.validate=function validate(){if(this.dirty){this.updateText();this.dirty=false}};BitmapText.registerFont=function registerFont(xml,texture){var data={};var info=xml.getElementsByTagName("info")[0];var common=xml.getElementsByTagName("common")[0];var fileName=xml.getElementsByTagName("page")[0].getAttribute("file");var res=(0,_utils.getResolutionOfUrl)(fileName,_settings2.default.RESOLUTION);data.font=info.getAttribute("face");data.size=parseInt(info.getAttribute("size"),10);data.lineHeight=parseInt(common.getAttribute("lineHeight"),10)/res;data.chars={};var letters=xml.getElementsByTagName("char");for(var i=0;i<letters.length;i++){var letter=letters[i];var charCode=parseInt(letter.getAttribute("id"),10);var textureRect=new core.Rectangle(parseInt(letter.getAttribute("x"),10)/res+texture.frame.x/res,parseInt(letter.getAttribute("y"),10)/res+texture.frame.y/res,parseInt(letter.getAttribute("width"),10)/res,parseInt(letter.getAttribute("height"),10)/res);data.chars[charCode]={xOffset:parseInt(letter.getAttribute("xoffset"),10)/res,yOffset:parseInt(letter.getAttribute("yoffset"),10)/res,xAdvance:parseInt(letter.getAttribute("xadvance"),10)/res,kerning:{},texture:new core.Texture(texture.baseTexture,textureRect)}}var kernings=xml.getElementsByTagName("kerning");for(var _i5=0;_i5<kernings.length;_i5++){var kerning=kernings[_i5];var first=parseInt(kerning.getAttribute("first"),10)/res;var second=parseInt(kerning.getAttribute("second"),10)/res;var amount=parseInt(kerning.getAttribute("amount"),10)/res;if(data.chars[second]){data.chars[second].kerning[first]=amount}}BitmapText.fonts[data.font]=data;return data};_createClass(BitmapText,[{key:"tint",get:function get(){return this._font.tint},set:function set(value){this._font.tint=typeof value==="number"&&value>=0?value:16777215;this.dirty=true}},{key:"align",get:function get(){return this._font.align},set:function set(value){this._font.align=value||"left";this.dirty=true}},{key:"anchor",get:function get(){return this._anchor},set:function set(value){if(typeof value==="number"){this._anchor.set(value)}else{this._anchor.copy(value)}}},{key:"font",get:function get(){return this._font},set:function set(value){if(!value){return}if(typeof value==="string"){value=value.split(" ");this._font.name=value.length===1?value[0]:value.slice(1).join(" ");this._font.size=value.length>=2?parseInt(value[0],10):BitmapText.fonts[this._font.name].size}else{this._font.name=value.name;this._font.size=typeof value.size==="number"?value.size:parseInt(value.size,10)}this.dirty=true}},{key:"text",get:function get(){return this._text},set:function set(value){value=value.toString()||" ";if(this._text===value){return}this._text=value;this.dirty=true}},{key:"maxWidth",get:function get(){return this._maxWidth},set:function set(value){if(this._maxWidth===value){return}this._maxWidth=value;this.dirty=true}},{key:"maxLineHeight",get:function get(){this.validate();return this._maxLineHeight}},{key:"textWidth",get:function get(){this.validate();return this._textWidth}},{key:"textHeight",get:function get(){this.validate();return this._textHeight}}]);return BitmapText}(core.Container);exports.default=BitmapText;BitmapText.fonts={}},{"../core":297,"../core/math/ObservablePoint":300,"../core/settings":333,"../core/utils":357}],369:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _CanvasTinter=require("../core/sprites/canvas/CanvasTinter");var _CanvasTinter2=_interopRequireDefault(_CanvasTinter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempPoint=new core.Point;var TilingSprite=function(_core$Sprite){_inherits(TilingSprite,_core$Sprite);function TilingSprite(texture){var width=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var height=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;_classCallCheck(this,TilingSprite);var _this=_possibleConstructorReturn(this,_core$Sprite.call(this,texture));_this.tileTransform=new core.TransformStatic;_this._width=width;_this._height=height;_this._canvasPattern=null;_this.uvTransform=texture.transform||new core.TextureMatrix(texture);_this.pluginName="tilingSprite";_this.uvRespectAnchor=false;return _this}TilingSprite.prototype._onTextureUpdate=function _onTextureUpdate(){if(this.uvTransform){this.uvTransform.texture=this._texture}this.cachedTint=16777215};TilingSprite.prototype._renderWebGL=function _renderWebGL(renderer){var texture=this._texture;if(!texture||!texture.valid){return}this.tileTransform.updateLocalTransform();this.uvTransform.update();renderer.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};TilingSprite.prototype._renderCanvas=function _renderCanvas(renderer){var texture=this._texture;if(!texture.baseTexture.hasLoaded){return}var context=renderer.context;var transform=this.worldTransform;var resolution=renderer.resolution;var baseTexture=texture.baseTexture;var baseTextureResolution=baseTexture.resolution;var modX=this.tilePosition.x/this.tileScale.x%texture._frame.width*baseTextureResolution;var modY=this.tilePosition.y/this.tileScale.y%texture._frame.height*baseTextureResolution;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var tempCanvas=new core.CanvasRenderTarget(texture._frame.width,texture._frame.height,baseTextureResolution);if(this.tint!==16777215){this.tintedTexture=_CanvasTinter2.default.getTintedTexture(this,this.tint);tempCanvas.context.drawImage(this.tintedTexture,0,0)}else{tempCanvas.context.drawImage(baseTexture.source,-texture._frame.x*baseTextureResolution,-texture._frame.y*baseTextureResolution)}this.cachedTint=this.tint;this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context.globalAlpha=this.worldAlpha;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);renderer.setBlendMode(this.blendMode);context.fillStyle=this._canvasPattern;context.scale(this.tileScale.x/baseTextureResolution,this.tileScale.y/baseTextureResolution);var anchorX=this.anchor.x*-this._width;var anchorY=this.anchor.y*-this._height;if(this.uvRespectAnchor){context.translate(modX,modY);context.fillRect(-modX+anchorX,-modY+anchorY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)}else{context.translate(modX+anchorX,modY+anchorY);context.fillRect(-modX,-modY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)}};TilingSprite.prototype._calculateBounds=function _calculateBounds(){var minX=this._width*-this._anchor._x;var minY=this._height*-this._anchor._y;var maxX=this._width*(1-this._anchor._x);var maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)};TilingSprite.prototype.getLocalBounds=function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._width*-this._anchor._x;this._bounds.minY=this._height*-this._anchor._y;this._bounds.maxX=this._width*(1-this._anchor._x);this._bounds.maxY=this._height*(1-this._anchor._x);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new core.Rectangle}rect=this._localBoundsRect}return this._bounds.getRectangle(rect)}return _core$Sprite.prototype.getLocalBounds.call(this,rect)};TilingSprite.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._width;var height=this._height;var x1=-width*this.anchor._x;if(tempPoint.x>=x1&&tempPoint.x<x1+width){var y1=-height*this.anchor._y;if(tempPoint.y>=y1&&tempPoint.y<y1+height){return true}}return false};TilingSprite.prototype.destroy=function destroy(options){_core$Sprite.prototype.destroy.call(this,options);this.tileTransform=null;this.uvTransform=null};TilingSprite.from=function from(source,width,height){return new TilingSprite(core.Texture.from(source),width,height)};TilingSprite.fromFrame=function fromFrame(frameId,width,height){var texture=core.utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache '+this)}return new TilingSprite(texture,width,height)};TilingSprite.fromImage=function fromImage(imageId,width,height,crossorigin,scaleMode){return new TilingSprite(core.Texture.fromImage(imageId,crossorigin,scaleMode),width,height)};_createClass(TilingSprite,[{key:"clampMargin",get:function get(){return this.uvTransform.clampMargin},set:function set(value){this.uvTransform.clampMargin=value;this.uvTransform.update(true)}},{key:"tileScale",get:function get(){return this.tileTransform.scale},set:function set(value){this.tileTransform.scale.copy(value)}},{key:"tilePosition",get:function get(){return this.tileTransform.position},set:function set(value){this.tileTransform.position.copy(value)}},{key:"width",get:function get(){return this._width},set:function set(value){this._width=value}},{key:"height",get:function get(){return this._height},set:function set(value){this._height=value}}]);return TilingSprite}(core.Sprite);exports.default=TilingSprite},{"../core":297,"../core/sprites/canvas/CanvasTinter":336}],370:[function(require,module,exports){"use strict";var _core=require("../core");var core=_interopRequireWildcard(_core);var _Texture=require("../core/textures/Texture");var _Texture2=_interopRequireDefault(_Texture);var _BaseTexture=require("../core/textures/BaseTexture");var _BaseTexture2=_interopRequireDefault(_BaseTexture);var _utils=require("../core/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DisplayObject=core.DisplayObject;var _tempMatrix=new core.Matrix;DisplayObject.prototype._cacheAsBitmap=false;DisplayObject.prototype._cacheData=false;var CacheData=function CacheData(){_classCallCheck(this,CacheData);this.textureCacheId=null;this.originalRenderWebGL=null;this.originalRenderCanvas=null;this.originalCalculateBounds=null;this.originalGetLocalBounds=null;this.originalUpdateTransform=null;this.originalHitTest=null;this.originalDestroy=null;this.originalMask=null;this.originalFilterArea=null;this.sprite=null};Object.defineProperties(DisplayObject.prototype,{cacheAsBitmap:{get:function get(){return this._cacheAsBitmap},set:function set(value){if(this._cacheAsBitmap===value){return}this._cacheAsBitmap=value;var data=void 0;if(value){if(!this._cacheData){this._cacheData=new CacheData}data=this._cacheData;data.originalRenderWebGL=this.renderWebGL;data.originalRenderCanvas=this.renderCanvas;data.originalUpdateTransform=this.updateTransform;data.originalCalculateBounds=this._calculateBounds;data.originalGetLocalBounds=this.getLocalBounds;data.originalDestroy=this.destroy;data.originalContainsPoint=this.containsPoint;data.originalMask=this._mask;data.originalFilterArea=this.filterArea;this.renderWebGL=this._renderCachedWebGL;this.renderCanvas=this._renderCachedCanvas;this.destroy=this._cacheAsBitmapDestroy}else{data=this._cacheData;if(data.sprite){this._destroyCachedDisplayObject()}this.renderWebGL=data.originalRenderWebGL;this.renderCanvas=data.originalRenderCanvas;this._calculateBounds=data.originalCalculateBounds;this.getLocalBounds=data.originalGetLocalBounds;this.destroy=data.originalDestroy;this.updateTransform=data.originalUpdateTransform;this.containsPoint=data.originalContainsPoint;this._mask=data.originalMask;this.filterArea=data.originalFilterArea}}}});DisplayObject.prototype._renderCachedWebGL=function _renderCachedWebGL(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObject(renderer);this._cacheData.sprite._transformID=-1;this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._renderWebGL(renderer)};DisplayObject.prototype._initCachedDisplayObject=function _initCachedDisplayObject(renderer){if(this._cacheData&&this._cacheData.sprite){return}var cacheAlpha=this.alpha;this.alpha=1;renderer.currentRenderer.flush();var bounds=this.getLocalBounds().clone();if(this._filters){var padding=this._filters[0].padding;bounds.pad(padding)}var cachedRenderTarget=renderer._activeRenderTarget;var stack=renderer.filterManager.filterStack;var renderTexture=core.RenderTexture.create(bounds.width|0,bounds.height|0);var textureCacheId="cacheAsBitmap_"+(0,_utils.uid)();this._cacheData.textureCacheId=textureCacheId;_BaseTexture2.default.addToCache(renderTexture.baseTexture,textureCacheId);_Texture2.default.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;m.tx=-bounds.x;m.ty=-bounds.y;this.transform.worldTransform.identity();this.renderWebGL=this._cacheData.originalRenderWebGL;renderer.render(this,renderTexture,true,m,true);renderer.bindRenderTarget(cachedRenderTarget);renderer.filterManager.filterStack=stack;this.renderWebGL=this._renderCachedWebGL;this.updateTransform=this.displayObjectUpdateTransform;this._mask=null;this.filterArea=null;var cachedSprite=new core.Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this.updateTransform()}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)};DisplayObject.prototype._renderCachedCanvas=function _renderCachedCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObjectCanvas(renderer);this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite.renderCanvas(renderer)};DisplayObject.prototype._initCachedDisplayObjectCanvas=function _initCachedDisplayObjectCanvas(renderer){if(this._cacheData&&this._cacheData.sprite){return}var bounds=this.getLocalBounds();var cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.context;var renderTexture=core.RenderTexture.create(bounds.width|0,bounds.height|0);var textureCacheId="cacheAsBitmap_"+(0,_utils.uid)();this._cacheData.textureCacheId=textureCacheId;_BaseTexture2.default.addToCache(renderTexture.baseTexture,textureCacheId);_Texture2.default.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copy(m);m.invert();m.tx-=bounds.x;m.ty-=bounds.y;this.renderCanvas=this._cacheData.originalRenderCanvas;renderer.render(this,renderTexture,true,m,false);renderer.context=cachedRenderTarget;this.renderCanvas=this._renderCachedCanvas;this._calculateBounds=this._calculateCachedBounds;this._mask=null;this.filterArea=null;var cachedSprite=new core.Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite._bounds=this._bounds;cachedSprite.alpha=cacheAlpha;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this.updateTransform()}this.updateTransform=this.displayObjectUpdateTransform;this._cacheData.sprite=cachedSprite;this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)};DisplayObject.prototype._calculateCachedBounds=function _calculateCachedBounds(){this._cacheData.sprite._calculateBounds()};DisplayObject.prototype._getCachedLocalBounds=function _getCachedLocalBounds(){return this._cacheData.sprite.getLocalBounds()};DisplayObject.prototype._destroyCachedDisplayObject=function _destroyCachedDisplayObject(){this._cacheData.sprite._texture.destroy(true);this._cacheData.sprite=null;_BaseTexture2.default.removeFromCache(this._cacheData.textureCacheId);_Texture2.default.removeFromCache(this._cacheData.textureCacheId);this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function _cacheAsBitmapDestroy(options){this.cacheAsBitmap=false;this.destroy(options)}},{"../core":297,"../core/textures/BaseTexture":344,"../core/textures/Texture":347,"../core/utils":357}],371:[function(require,module,exports){"use strict";var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}core.DisplayObject.prototype.name=null;core.Container.prototype.getChildByName=function getChildByName(name){for(var i=0;i<this.children.length;i++){if(this.children[i].name===name){return this.children[i]}}return null}},{"../core":297}],372:[function(require,module,exports){"use strict";var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}core.DisplayObject.prototype.getGlobalPosition=function getGlobalPosition(){var point=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new core.Point;var skipUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.parent){this.parent.toGlobal(this.position,point,skipUpdate)}else{point.x=this.position.x;point.y=this.position.y}return point}},{"../core":297}],373:[function(require,module,exports){"use strict";exports.__esModule=true;exports.BitmapText=exports.TilingSpriteRenderer=exports.TilingSprite=exports.AnimatedSprite=undefined;var _AnimatedSprite=require("./AnimatedSprite");Object.defineProperty(exports,"AnimatedSprite",{enumerable:true,get:function get(){return _interopRequireDefault(_AnimatedSprite).default}});var _TilingSprite=require("./TilingSprite");Object.defineProperty(exports,"TilingSprite",{enumerable:true,get:function get(){return _interopRequireDefault(_TilingSprite).default}});var _TilingSpriteRenderer=require("./webgl/TilingSpriteRenderer");Object.defineProperty(exports,"TilingSpriteRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_TilingSpriteRenderer).default}});var _BitmapText=require("./BitmapText");Object.defineProperty(exports,"BitmapText",{enumerable:true,get:function get(){return _interopRequireDefault(_BitmapText).default}});require("./cacheAsBitmap");require("./getChildByName");require("./getGlobalPosition");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./AnimatedSprite":367,"./BitmapText":368,"./TilingSprite":369,"./cacheAsBitmap":370,"./getChildByName":371,"./getGlobalPosition":372,"./webgl/TilingSpriteRenderer":374}],374:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _const=require("../../core/const");var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempMat=new core.Matrix;var TilingSpriteRenderer=function(_core$ObjectRenderer){_inherits(TilingSpriteRenderer,_core$ObjectRenderer);function TilingSpriteRenderer(renderer){_classCallCheck(this,TilingSpriteRenderer);var _this=_possibleConstructorReturn(this,_core$ObjectRenderer.call(this,renderer));_this.shader=null;_this.simpleShader=null;_this.quad=null;return _this}TilingSpriteRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;this.shader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n");this.simpleShader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n");this.renderer.bindVao(null);this.quad=new core.Quad(gl,this.renderer.state.attribState);this.quad.initVao(this.shader)};TilingSpriteRenderer.prototype.render=function render(ts){var renderer=this.renderer;var quad=this.quad;renderer.bindVao(quad.vao);var vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x;vertices[1]=vertices[3]=ts._height*-ts.anchor.y;vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x);vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);if(ts.uvRespectAnchor){vertices=quad.uvs;vertices[0]=vertices[6]=-ts.anchor.x;vertices[1]=vertices[3]=-ts.anchor.y;vertices[2]=vertices[4]=1-ts.anchor.x;vertices[5]=vertices[7]=1-ts.anchor.y}quad.upload();var tex=ts._texture;var baseTex=tex.baseTexture;var lt=ts.tileTransform.localTransform;var uv=ts.uvTransform;var isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;if(isSimple){if(!baseTex._glTextures[renderer.CONTEXT_UID]){if(baseTex.wrapMode===_const.WRAP_MODES.CLAMP){baseTex.wrapMode=_const.WRAP_MODES.REPEAT}}else{isSimple=baseTex.wrapMode!==_const.WRAP_MODES.CLAMP}}var shader=isSimple?this.simpleShader:this.shader;renderer.bindShader(shader);var w=tex.width;var h=tex.height;var W=ts._width;var H=ts._height;tempMat.set(lt.a*w/W,lt.b*w/H,lt.c*h/W,lt.d*h/H,lt.tx/W,lt.ty/H);tempMat.invert();if(isSimple){tempMat.prepend(uv.mapCoord)}else{shader.uniforms.uMapCoord=uv.mapCoord.toArray(true);shader.uniforms.uClampFrame=uv.uClampFrame;shader.uniforms.uClampOffset=uv.uClampOffset}shader.uniforms.uTransform=tempMat.toArray(true);shader.uniforms.uColor=core.utils.premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,baseTex.premultipliedAlpha);shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(true);shader.uniforms.uSampler=renderer.bindTexture(tex);renderer.setBlendMode(core.utils.correctBlendMode(ts.blendMode,baseTex.premultipliedAlpha));quad.vao.draw(this.renderer.gl.TRIANGLES,6,0)};return TilingSpriteRenderer}(core.ObjectRenderer);exports.default=TilingSpriteRenderer;core.WebGLRenderer.registerPlugin("tilingSprite",TilingSpriteRenderer)},{"../../core":297,"../../core/const":278,path:254}],375:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AlphaFilter=function(_core$Filter){_inherits(AlphaFilter,_core$Filter);function AlphaFilter(){_classCallCheck(this,AlphaFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));_this.alpha=1;_this.glShaderKey="alpha";return _this}_createClass(AlphaFilter,[{key:"alpha",get:function get(){return this.uniforms.uAlpha},set:function set(value){this.uniforms.uAlpha=value}}]);return AlphaFilter}(core.Filter);exports.default=AlphaFilter},{"../../core":297,path:254}],376:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _BlurXFilter=require("./BlurXFilter");var _BlurXFilter2=_interopRequireDefault(_BlurXFilter);var _BlurYFilter=require("./BlurYFilter");var _BlurYFilter2=_interopRequireDefault(_BlurYFilter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BlurFilter=function(_core$Filter){_inherits(BlurFilter,_core$Filter);function BlurFilter(strength,quality,resolution,kernelSize){_classCallCheck(this,BlurFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this));_this.blurXFilter=new _BlurXFilter2.default(strength,quality,resolution,kernelSize);_this.blurYFilter=new _BlurYFilter2.default(strength,quality,resolution,kernelSize);_this.padding=0;_this.resolution=resolution||core.settings.RESOLUTION;_this.quality=quality||4;_this.blur=strength||8;return _this}BlurFilter.prototype.apply=function apply(filterManager,input,output){var renderTarget=filterManager.getRenderTarget(true);this.blurXFilter.apply(filterManager,input,renderTarget,true);this.blurYFilter.apply(filterManager,renderTarget,output,false);filterManager.returnRenderTarget(renderTarget)};_createClass(BlurFilter,[{key:"blur",get:function get(){return this.blurXFilter.blur},set:function set(value){this.blurXFilter.blur=this.blurYFilter.blur=value;this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}},{key:"quality",get:function get(){return this.blurXFilter.quality},set:function set(value){this.blurXFilter.quality=this.blurYFilter.quality=value}},{key:"blurX",get:function get(){return this.blurXFilter.blur},set:function set(value){this.blurXFilter.blur=value;this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}},{key:"blurY",get:function get(){return this.blurYFilter.blur},set:function set(value){this.blurYFilter.blur=value;this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}},{key:"blendMode",get:function get(){return this.blurYFilter._blendMode},set:function set(value){this.blurYFilter._blendMode=value}}]);return BlurFilter}(core.Filter);exports.default=BlurFilter},{"../../core":297,"./BlurXFilter":377,"./BlurYFilter":378}],377:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _generateBlurVertSource=require("./generateBlurVertSource");var _generateBlurVertSource2=_interopRequireDefault(_generateBlurVertSource);var _generateBlurFragSource=require("./generateBlurFragSource");var _generateBlurFragSource2=_interopRequireDefault(_generateBlurFragSource);var _getMaxBlurKernelSize=require("./getMaxBlurKernelSize");var _getMaxBlurKernelSize2=_interopRequireDefault(_getMaxBlurKernelSize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BlurXFilter=function(_core$Filter){_inherits(BlurXFilter,_core$Filter);function BlurXFilter(strength,quality,resolution,kernelSize){_classCallCheck(this,BlurXFilter);kernelSize=kernelSize||5;var vertSrc=(0,_generateBlurVertSource2.default)(kernelSize,true);var fragSrc=(0,_generateBlurFragSource2.default)(kernelSize);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,vertSrc,fragSrc));_this.resolution=resolution||core.settings.RESOLUTION;_this._quality=0;_this.quality=quality||4;_this.strength=strength||8;_this.firstRun=true;return _this}BlurXFilter.prototype.apply=function apply(filterManager,input,output,clear){if(this.firstRun){var gl=filterManager.renderer.gl;var kernelSize=(0,_getMaxBlurKernelSize2.default)(gl);this.vertexSrc=(0,_generateBlurVertSource2.default)(kernelSize,true);this.fragmentSrc=(0,_generateBlurFragSource2.default)(kernelSize);this.firstRun=false}this.uniforms.strength=1/output.size.width*(output.size.width/input.size.width);this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;if(this.passes===1){filterManager.applyFilter(this,input,output,clear)}else{var renderTarget=filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){filterManager.applyFilter(this,flip,flop,true);var temp=flop;flop=flip;flip=temp}filterManager.applyFilter(this,flip,output,clear);filterManager.returnRenderTarget(renderTarget)}};_createClass(BlurXFilter,[{key:"blur",get:function get(){return this.strength},set:function set(value){this.padding=Math.abs(value)*2;this.strength=value}},{key:"quality",get:function get(){return this._quality},set:function set(value){this._quality=value;this.passes=value}}]);return BlurXFilter}(core.Filter);exports.default=BlurXFilter},{"../../core":297,"./generateBlurFragSource":379,"./generateBlurVertSource":380,"./getMaxBlurKernelSize":381}],378:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _generateBlurVertSource=require("./generateBlurVertSource");var _generateBlurVertSource2=_interopRequireDefault(_generateBlurVertSource);var _generateBlurFragSource=require("./generateBlurFragSource");var _generateBlurFragSource2=_interopRequireDefault(_generateBlurFragSource);var _getMaxBlurKernelSize=require("./getMaxBlurKernelSize");var _getMaxBlurKernelSize2=_interopRequireDefault(_getMaxBlurKernelSize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BlurYFilter=function(_core$Filter){_inherits(BlurYFilter,_core$Filter);function BlurYFilter(strength,quality,resolution,kernelSize){_classCallCheck(this,BlurYFilter);kernelSize=kernelSize||5;var vertSrc=(0,_generateBlurVertSource2.default)(kernelSize,false);var fragSrc=(0,_generateBlurFragSource2.default)(kernelSize);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,vertSrc,fragSrc));_this.resolution=resolution||core.settings.RESOLUTION;_this._quality=0;_this.quality=quality||4;_this.strength=strength||8;_this.firstRun=true;return _this}BlurYFilter.prototype.apply=function apply(filterManager,input,output,clear){if(this.firstRun){var gl=filterManager.renderer.gl;var kernelSize=(0,_getMaxBlurKernelSize2.default)(gl);this.vertexSrc=(0,_generateBlurVertSource2.default)(kernelSize,false);this.fragmentSrc=(0,_generateBlurFragSource2.default)(kernelSize);this.firstRun=false}this.uniforms.strength=1/output.size.height*(output.size.height/input.size.height);this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;if(this.passes===1){filterManager.applyFilter(this,input,output,clear)}else{var renderTarget=filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){filterManager.applyFilter(this,flip,flop,true);var temp=flop;flop=flip;flip=temp}filterManager.applyFilter(this,flip,output,clear);filterManager.returnRenderTarget(renderTarget)}};_createClass(BlurYFilter,[{key:"blur",get:function get(){return this.strength},set:function set(value){this.padding=Math.abs(value)*2;this.strength=value}},{key:"quality",get:function get(){return this._quality},set:function set(value){this._quality=value;this.passes=value}}]);return BlurYFilter}(core.Filter);exports.default=BlurYFilter},{"../../core":297,"./generateBlurFragSource":379,"./generateBlurVertSource":380,"./getMaxBlurKernelSize":381}],379:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=generateFragBlurSource;var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]};var fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");function generateFragBlurSource(kernelSize){var kernel=GAUSSIAN_VALUES[kernelSize];var halfLength=kernel.length;var fragSource=fragTemplate;var blurLoop="";var template="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";var value=void 0;for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i);value=i;if(i>=halfLength){value=kernelSize-i-1}blur=blur.replace("%value%",kernel[value]);blurLoop+=blur;blurLoop+="\n"}fragSource=fragSource.replace("%blur%",blurLoop);fragSource=fragSource.replace("%size%",kernelSize);return fragSource}},{}],380:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=generateVertBlurSource;var vertTemplate=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n");function generateVertBlurSource(kernelSize,x){var halfLength=Math.ceil(kernelSize/2);var vertSource=vertTemplate;var blurLoop="";var template=void 0;if(x){template="vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);"}else{template="vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);"}for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i);blur=blur.replace("%sampleIndex%",i-(halfLength-1)+".0");blurLoop+=blur;blurLoop+="\n"}vertSource=vertSource.replace("%blur%",blurLoop);vertSource=vertSource.replace("%size%",kernelSize);return vertSource}},{}],381:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=getMaxKernelSize;function getMaxKernelSize(gl){var maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS);var kernelSize=15;while(kernelSize>maxVaryings){kernelSize-=2}return kernelSize}},{}],382:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColorMatrixFilter=function(_core$Filter){_inherits(ColorMatrixFilter,_core$Filter);function ColorMatrixFilter(){_classCallCheck(this,ColorMatrixFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));_this.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];_this.alpha=1;return _this}ColorMatrixFilter.prototype._loadMatrix=function _loadMatrix(matrix){var multiply=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var newMatrix=matrix;if(multiply){this._multiply(newMatrix,this.uniforms.m,matrix);newMatrix=this._colorMatrix(newMatrix)}this.uniforms.m=newMatrix};ColorMatrixFilter.prototype._multiply=function _multiply(out,a,b){out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4];out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9];out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14];out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19];return out};ColorMatrixFilter.prototype._colorMatrix=function _colorMatrix(matrix){var m=new Float32Array(matrix);m[4]/=255;m[9]/=255;m[14]/=255;m[19]/=255;return m};ColorMatrixFilter.prototype.brightness=function brightness(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.greyscale=function greyscale(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.blackAndWhite=function blackAndWhite(multiply){var matrix=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.hue=function hue(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation);var sinR=Math.sin(rotation);var sqrt=Math.sqrt;var w=1/3;var sqrW=sqrt(w);var a00=cosR+(1-cosR)*w;var a01=w*(1-cosR)-sqrW*sinR;var a02=w*(1-cosR)+sqrW*sinR;var a10=w*(1-cosR)+sqrW*sinR;var a11=cosR+w*(1-cosR);var a12=w*(1-cosR)-sqrW*sinR;var a20=w*(1-cosR)-sqrW*sinR;var a21=w*(1-cosR)+sqrW*sinR;var a22=cosR+w*(1-cosR);var matrix=[a00,a01,a02,0,0,a10,a11,a12,0,0,a20,a21,a22,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.contrast=function contrast(amount,multiply){var v=(amount||0)+1;var o=-.5*(v-1);var matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.saturate=function saturate(){var amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var multiply=arguments[1];var x=amount*2/3+1;var y=(x-1)*-.5;var matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.desaturate=function desaturate(){this.saturate(-1)};ColorMatrixFilter.prototype.negative=function negative(multiply){var matrix=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.sepia=function sepia(multiply){var matrix=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.technicolor=function technicolor(multiply){var matrix=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.polaroid=function polaroid(multiply){var matrix=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.toBGR=function toBGR(multiply){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.kodachrome=function kodachrome(multiply){var matrix=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.browni=function browni(multiply){var matrix=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.vintage=function vintage(multiply){var matrix=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.colorTone=function colorTone(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||.2;toned=toned||.15;lightColor=lightColor||16770432;darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255;var lG=(lightColor>>8&255)/255;var lB=(lightColor&255)/255;var dR=(darkColor>>16&255)/255;var dG=(darkColor>>8&255)/255;var dB=(darkColor&255)/255;var matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.night=function night(intensity,multiply){intensity=intensity||.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.predator=function predator(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.lsd=function lsd(multiply){var matrix=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.reset=function reset(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,false)};_createClass(ColorMatrixFilter,[{key:"matrix",get:function get(){return this.uniforms.m},set:function set(value){this.uniforms.m=value}},{key:"alpha",get:function get(){return this.uniforms.uAlpha},set:function set(value){this.uniforms.uAlpha=value}}]);return ColorMatrixFilter}(core.Filter);exports.default=ColorMatrixFilter;ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale},{"../../core":297,path:254}],383:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DisplacementFilter=function(_core$Filter){_inherits(DisplacementFilter,_core$Filter);function DisplacementFilter(sprite,scale){_classCallCheck(this,DisplacementFilter);var maskMatrix=new core.Matrix;sprite.renderable=false;var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));_this.maskSprite=sprite;_this.maskMatrix=maskMatrix;_this.uniforms.mapSampler=sprite._texture;_this.uniforms.filterMatrix=maskMatrix;_this.uniforms.scale={x:1,y:1};if(scale===null||scale===undefined){scale=20}_this.scale=new core.Point(scale,scale);return _this}DisplacementFilter.prototype.apply=function apply(filterManager,input,output){var ratio=1/output.destinationFrame.width*(output.size.width/input.size.width);this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite);this.uniforms.scale.x=this.scale.x*ratio;this.uniforms.scale.y=this.scale.y*ratio;filterManager.applyFilter(this,input,output)};_createClass(DisplacementFilter,[{key:"map",get:function get(){return this.uniforms.mapSampler},set:function set(value){this.uniforms.mapSampler=value}}]);return DisplacementFilter}(core.Filter);exports.default=DisplacementFilter},{"../../core":297,path:254}],384:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FXAAFilter=function(_core$Filter){_inherits(FXAAFilter,_core$Filter);function FXAAFilter(){_classCallCheck(this,FXAAFilter);return _possibleConstructorReturn(this,_core$Filter.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return FXAAFilter}(core.Filter);exports.default=FXAAFilter},{"../../core":297,path:254}],385:[function(require,module,exports){"use strict";exports.__esModule=true;var _FXAAFilter=require("./fxaa/FXAAFilter");Object.defineProperty(exports,"FXAAFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_FXAAFilter).default}});var _NoiseFilter=require("./noise/NoiseFilter");Object.defineProperty(exports,"NoiseFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_NoiseFilter).default}});var _DisplacementFilter=require("./displacement/DisplacementFilter");Object.defineProperty(exports,"DisplacementFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_DisplacementFilter).default}});var _BlurFilter=require("./blur/BlurFilter");Object.defineProperty(exports,"BlurFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_BlurFilter).default}});var _BlurXFilter=require("./blur/BlurXFilter");Object.defineProperty(exports,"BlurXFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_BlurXFilter).default}});var _BlurYFilter=require("./blur/BlurYFilter");Object.defineProperty(exports,"BlurYFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_BlurYFilter).default}});var _ColorMatrixFilter=require("./colormatrix/ColorMatrixFilter");Object.defineProperty(exports,"ColorMatrixFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_ColorMatrixFilter).default}});var _AlphaFilter=require("./alpha/AlphaFilter");Object.defineProperty(exports,"AlphaFilter",{enumerable:true,get:function get(){return _interopRequireDefault(_AlphaFilter).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./alpha/AlphaFilter":375,"./blur/BlurFilter":376,"./blur/BlurXFilter":377,"./blur/BlurYFilter":378,"./colormatrix/ColorMatrixFilter":382,"./displacement/DisplacementFilter":383,"./fxaa/FXAAFilter":384,"./noise/NoiseFilter":386}],386:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../../core");var core=_interopRequireWildcard(_core);var _path=require("path");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NoiseFilter=function(_core$Filter){_inherits(NoiseFilter,_core$Filter);function NoiseFilter(){var noise=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.5;var seed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Math.random();_classCallCheck(this,NoiseFilter);var _this=_possibleConstructorReturn(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));_this.noise=noise;_this.seed=seed;return _this}_createClass(NoiseFilter,[{key:"noise",get:function get(){return this.uniforms.uNoise},set:function set(value){this.uniforms.uNoise=value}},{key:"seed",get:function get(){return this.uniforms.uSeed},set:function set(value){this.uniforms.uSeed=value}}]);return NoiseFilter}(core.Filter);exports.default=NoiseFilter},{"../../core":297,path:254}],387:[function(require,module,exports){(function(global){"use strict";exports.__esModule=true;exports.loader=exports.prepare=exports.particles=exports.mesh=exports.loaders=exports.interaction=exports.filters=exports.extras=exports.extract=exports.accessibility=undefined;var _polyfill=require("./polyfill");Object.keys(_polyfill).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _polyfill[key]}})});var _core=require("./core");Object.keys(_core).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _core[key]}})});var _deprecation=require("./deprecation");var _deprecation2=_interopRequireDefault(_deprecation);var _accessibility=require("./accessibility");var accessibility=_interopRequireWildcard(_accessibility);var _extract=require("./extract");var extract=_interopRequireWildcard(_extract);var _extras=require("./extras");var extras=_interopRequireWildcard(_extras);var _filters=require("./filters");var filters=_interopRequireWildcard(_filters);var _interaction=require("./interaction");var interaction=_interopRequireWildcard(_interaction);var _loaders=require("./loaders");var loaders=_interopRequireWildcard(_loaders);var _mesh=require("./mesh");var mesh=_interopRequireWildcard(_mesh);var _particles=require("./particles");var particles=_interopRequireWildcard(_particles);var _prepare=require("./prepare");var prepare=_interopRequireWildcard(_prepare);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_core.utils.mixins.performMixins();var loader=loaders.shared||null;exports.accessibility=accessibility;exports.extract=extract;exports.extras=extras;exports.filters=filters;exports.interaction=interaction;exports.loaders=loaders;exports.mesh=mesh;exports.particles=particles;exports.prepare=prepare;exports.loader=loader;if(typeof _deprecation2.default==="function"){(0,_deprecation2.default)(exports)}global.PIXI=exports}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./accessibility":274,"./core":297,"./deprecation":363,"./extract":365,"./extras":373,"./filters":385,"./interaction":392,"./loaders":395,"./mesh":404,"./particles":407,"./polyfill":413,"./prepare":417}],388:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var InteractionData=function(){function InteractionData(){_classCallCheck(this,InteractionData);this.global=new core.Point;this.target=null;this.originalEvent=null;this.identifier=null;this.isPrimary=false;this.button=0;this.buttons=0;this.width=0;this.height=0;this.tiltX=0;this.tiltY=0;this.pointerType=null;this.pressure=0;this.rotationAngle=0;this.twist=0;this.tangentialPressure=0}InteractionData.prototype.getLocalPosition=function getLocalPosition(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)};InteractionData.prototype._copyEvent=function _copyEvent(event){if(event.isPrimary){this.isPrimary=true}this.button=event.button;this.buttons=event.buttons;this.width=event.width;this.height=event.height;this.tiltX=event.tiltX;this.tiltY=event.tiltY;this.pointerType=event.pointerType;this.pressure=event.pressure;this.rotationAngle=event.rotationAngle;this.twist=event.twist||0;this.tangentialPressure=event.tangentialPressure||0};InteractionData.prototype._reset=function _reset(){this.isPrimary=false};_createClass(InteractionData,[{key:"pointerId",get:function get(){return this.identifier}}]);return InteractionData}();exports.default=InteractionData},{"../core":297}],389:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var InteractionEvent=function(){function InteractionEvent(){_classCallCheck(this,InteractionEvent);this.stopped=false;this.target=null;this.currentTarget=null;this.type=null;this.data=null}InteractionEvent.prototype.stopPropagation=function stopPropagation(){this.stopped=true};InteractionEvent.prototype._reset=function _reset(){this.stopped=false;this.currentTarget=null;this.target=null};return InteractionEvent}();exports.default=InteractionEvent},{}],390:[function(require,module,exports){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _core=require("../core");var core=_interopRequireWildcard(_core);var _InteractionData=require("./InteractionData");var _InteractionData2=_interopRequireDefault(_InteractionData);var _InteractionEvent=require("./InteractionEvent");var _InteractionEvent2=_interopRequireDefault(_InteractionEvent);var _InteractionTrackingData=require("./InteractionTrackingData");var _InteractionTrackingData2=_interopRequireDefault(_InteractionTrackingData);var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _interactiveTarget=require("./interactiveTarget");var _interactiveTarget2=_interopRequireDefault(_interactiveTarget);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}core.utils.mixins.delayMixin(core.DisplayObject.prototype,_interactiveTarget2.default);var MOUSE_POINTER_ID="MOUSE";var hitTestEvent={target:null,data:{global:null}};var InteractionManager=function(_EventEmitter){_inherits(InteractionManager,_EventEmitter);function InteractionManager(renderer,options){_classCallCheck(this,InteractionManager);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));options=options||{};_this.renderer=renderer;_this.autoPreventDefault=options.autoPreventDefault!==undefined?options.autoPreventDefault:true;_this.interactionFrequency=options.interactionFrequency||10;_this.mouse=new _InteractionData2.default;_this.mouse.identifier=MOUSE_POINTER_ID;_this.mouse.global.set(-999999);_this.activeInteractionData={};_this.activeInteractionData[MOUSE_POINTER_ID]=_this.mouse;_this.interactionDataPool=[];_this.eventData=new _InteractionEvent2.default;_this.interactionDOMElement=null;_this.moveWhenInside=false;_this.eventsAdded=false;_this.mouseOverRenderer=false;_this.supportsTouchEvents="ontouchstart"in window;_this.supportsPointerEvents=!!window.PointerEvent;_this.onPointerUp=_this.onPointerUp.bind(_this);_this.processPointerUp=_this.processPointerUp.bind(_this);_this.onPointerCancel=_this.onPointerCancel.bind(_this);_this.processPointerCancel=_this.processPointerCancel.bind(_this);_this.onPointerDown=_this.onPointerDown.bind(_this);_this.processPointerDown=_this.processPointerDown.bind(_this);_this.onPointerMove=_this.onPointerMove.bind(_this);_this.processPointerMove=_this.processPointerMove.bind(_this);_this.onPointerOut=_this.onPointerOut.bind(_this);_this.processPointerOverOut=_this.processPointerOverOut.bind(_this);_this.onPointerOver=_this.onPointerOver.bind(_this);_this.cursorStyles={default:"inherit",pointer:"pointer"};_this.currentCursorMode=null;_this.cursor=null;_this._tempPoint=new core.Point;_this.resolution=1;_this.setTargetElement(_this.renderer.view,_this.renderer.resolution);return _this}InteractionManager.prototype.hitTest=function hitTest(globalPoint,root){hitTestEvent.target=null;hitTestEvent.data.global=globalPoint;if(!root){root=this.renderer._lastObjectRendered}this.processInteractive(hitTestEvent,root,null,true);return hitTestEvent.target};InteractionManager.prototype.setTargetElement=function setTargetElement(element){var resolution=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.removeEvents();this.interactionDOMElement=element;this.resolution=resolution;this.addEvents()};InteractionManager.prototype.addEvents=function addEvents(){if(!this.interactionDOMElement){return}core.ticker.shared.add(this.update,this,core.UPDATE_PRIORITY.INTERACTION);if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="none";this.interactionDOMElement.style["-ms-touch-action"]="none"}else if(this.supportsPointerEvents){this.interactionDOMElement.style["touch-action"]="none"}if(this.supportsPointerEvents){window.document.addEventListener("pointermove",this.onPointerMove,true);this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,true);this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,true);this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,true);window.addEventListener("pointercancel",this.onPointerCancel,true);window.addEventListener("pointerup",this.onPointerUp,true)}else{window.document.addEventListener("mousemove",this.onPointerMove,true);this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,true);this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,true);this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,true);window.addEventListener("mouseup",this.onPointerUp,true)}if(this.supportsTouchEvents){this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,true);this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,true);this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,true);this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,true)}this.eventsAdded=true};InteractionManager.prototype.removeEvents=function removeEvents(){if(!this.interactionDOMElement){return}core.ticker.shared.remove(this.update,this);if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="";this.interactionDOMElement.style["-ms-touch-action"]=""}else if(this.supportsPointerEvents){this.interactionDOMElement.style["touch-action"]=""}if(this.supportsPointerEvents){window.document.removeEventListener("pointermove",this.onPointerMove,true);this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,true);this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,true);window.removeEventListener("pointercancel",this.onPointerCancel,true);window.removeEventListener("pointerup",this.onPointerUp,true)}else{window.document.removeEventListener("mousemove",this.onPointerMove,true);this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,true);this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,true);window.removeEventListener("mouseup",this.onPointerUp,true)}if(this.supportsTouchEvents){this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,true);this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,true);this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,true)}this.interactionDOMElement=null;this.eventsAdded=false};InteractionManager.prototype.update=function update(deltaTime){this._deltaTime+=deltaTime;if(this._deltaTime<this.interactionFrequency){return}this._deltaTime=0;if(!this.interactionDOMElement){return}if(this.didMove){this.didMove=false;return}this.cursor=null;for(var k in this.activeInteractionData){if(this.activeInteractionData.hasOwnProperty(k)){var interactionData=this.activeInteractionData[k];if(interactionData.originalEvent&&interactionData.pointerType!=="touch"){var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,interactionData.originalEvent,interactionData);this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,true)}}}this.setCursorMode(this.cursor)};InteractionManager.prototype.setCursorMode=function setCursorMode(mode){mode=mode||"default";if(this.currentCursorMode===mode){return}this.currentCursorMode=mode;var style=this.cursorStyles[mode];if(style){switch(typeof style==="undefined"?"undefined":_typeof(style)){case"string":this.interactionDOMElement.style.cursor=style;break;case"function":style(mode);break;case"object":Object.assign(this.interactionDOMElement.style,style);break}}else if(typeof mode==="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)){this.interactionDOMElement.style.cursor=mode}};InteractionManager.prototype.dispatchEvent=function dispatchEvent(displayObject,eventString,eventData){if(!eventData.stopped){eventData.currentTarget=displayObject;eventData.type=eventString;displayObject.emit(eventString,eventData);if(displayObject[eventString]){displayObject[eventString](eventData)}}};InteractionManager.prototype.mapPositionToPoint=function mapPositionToPoint(point,x,y){var rect=void 0;if(!this.interactionDOMElement.parentElement){rect={x:0,y:0,width:0,height:0}}else{rect=this.interactionDOMElement.getBoundingClientRect()}var resolutionMultiplier=navigator.isCocoonJS?this.resolution:1/this.resolution;point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)*resolutionMultiplier;point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)*resolutionMultiplier};InteractionManager.prototype.processInteractive=function processInteractive(interactionEvent,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible){return false}var point=interactionEvent.data.global;interactive=displayObject.interactive||interactive;var hit=false;var interactiveParent=interactive;if(displayObject.hitArea){interactiveParent=false}else if(hitTest&&displayObject._mask){if(!displayObject._mask.containsPoint(point)){hitTest=false}}if(displayObject.interactiveChildren&&displayObject.children){var children=displayObject.children;for(var i=children.length-1;i>=0;i--){var child=children[i];var childHit=this.processInteractive(interactionEvent,child,func,hitTest,interactiveParent);if(childHit){if(!child.parent){continue}interactiveParent=false;if(childHit){if(interactionEvent.target){hitTest=false}hit=true}}}}if(interactive){if(hitTest&&!interactionEvent.target){if(displayObject.hitArea){displayObject.worldTransform.applyInverse(point,this._tempPoint);if(displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)){hit=true}}else if(displayObject.containsPoint){if(displayObject.containsPoint(point)){hit=true}}}if(displayObject.interactive){if(hit&&!interactionEvent.target){interactionEvent.target=displayObject}if(func){func(interactionEvent,displayObject,!!hit)}}}return hit};InteractionManager.prototype.onPointerDown=function onPointerDown(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(originalEvent);if(this.autoPreventDefault&&events[0].isNormalized){originalEvent.preventDefault()}var eventLen=events.length;for(var i=0;i<eventLen;i++){var event=events[i];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerDown,true);this.emit("pointerdown",interactionEvent);if(event.pointerType==="touch"){this.emit("touchstart",interactionEvent)}else if(event.pointerType==="mouse"||event.pointerType==="pen"){var isRightButton=event.button===2;this.emit(isRightButton?"rightdown":"mousedown",this.eventData)}}};InteractionManager.prototype.processPointerDown=function processPointerDown(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;if(hit){if(!displayObject.trackedPointers[id]){displayObject.trackedPointers[id]=new _InteractionTrackingData2.default(id)}this.dispatchEvent(displayObject,"pointerdown",interactionEvent);if(data.pointerType==="touch"){this.dispatchEvent(displayObject,"touchstart",interactionEvent)}else if(data.pointerType==="mouse"||data.pointerType==="pen"){var isRightButton=data.button===2;if(isRightButton){displayObject.trackedPointers[id].rightDown=true}else{displayObject.trackedPointers[id].leftDown=true}this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",interactionEvent)}}};InteractionManager.prototype.onPointerComplete=function onPointerComplete(originalEvent,cancelled,func){var events=this.normalizeToPointerData(originalEvent);var eventLen=events.length;var eventAppend=originalEvent.target!==this.interactionDOMElement?"outside":"";for(var i=0;i<eventLen;i++){var event=events[i];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,func,cancelled||!eventAppend);this.emit(cancelled?"pointercancel":"pointerup"+eventAppend,interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen"){var isRightButton=event.button===2;this.emit(isRightButton?"rightup"+eventAppend:"mouseup"+eventAppend,interactionEvent)}else if(event.pointerType==="touch"){this.emit(cancelled?"touchcancel":"touchend"+eventAppend,interactionEvent);this.releaseInteractionDataForPointerId(event.pointerId,interactionData)}}};InteractionManager.prototype.onPointerCancel=function onPointerCancel(event){if(this.supportsTouchEvents&&event.pointerType==="touch")return;this.onPointerComplete(event,true,this.processPointerCancel)};InteractionManager.prototype.processPointerCancel=function processPointerCancel(interactionEvent,displayObject){var data=interactionEvent.data;var id=interactionEvent.data.identifier;if(displayObject.trackedPointers[id]!==undefined){delete displayObject.trackedPointers[id];this.dispatchEvent(displayObject,"pointercancel",interactionEvent);if(data.pointerType==="touch"){this.dispatchEvent(displayObject,"touchcancel",interactionEvent)}}};InteractionManager.prototype.onPointerUp=function onPointerUp(event){if(this.supportsTouchEvents&&event.pointerType==="touch")return;this.onPointerComplete(event,false,this.processPointerUp)};InteractionManager.prototype.processPointerUp=function processPointerUp(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;var trackingData=displayObject.trackedPointers[id];var isTouch=data.pointerType==="touch";var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";if(isMouse){var isRightButton=data.button===2;var flags=_InteractionTrackingData2.default.FLAGS;var test=isRightButton?flags.RIGHT_DOWN:flags.LEFT_DOWN;var isDown=trackingData!==undefined&&trackingData.flags&test;if(hit){this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",interactionEvent);if(isDown){this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",interactionEvent)}}else if(isDown){this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",interactionEvent)}if(trackingData){if(isRightButton){trackingData.rightDown=false}else{trackingData.leftDown=false}}}if(hit){this.dispatchEvent(displayObject,"pointerup",interactionEvent);if(isTouch)this.dispatchEvent(displayObject,"touchend",interactionEvent);if(trackingData){this.dispatchEvent(displayObject,"pointertap",interactionEvent);if(isTouch){this.dispatchEvent(displayObject,"tap",interactionEvent);trackingData.over=false}}}else if(trackingData){this.dispatchEvent(displayObject,"pointerupoutside",interactionEvent);if(isTouch)this.dispatchEvent(displayObject,"touchendoutside",interactionEvent)}if(trackingData&&trackingData.none){delete displayObject.trackedPointers[id]}};InteractionManager.prototype.onPointerMove=function onPointerMove(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(originalEvent);if(events[0].pointerType==="mouse"){this.didMove=true;this.cursor=null}var eventLen=events.length;for(var i=0;i<eventLen;i++){var event=events[i];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;var interactive=event.pointerType==="touch"?this.moveWhenInside:true;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerMove,interactive);this.emit("pointermove",interactionEvent);if(event.pointerType==="touch")this.emit("touchmove",interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen")this.emit("mousemove",interactionEvent)}if(events[0].pointerType==="mouse"){this.setCursorMode(this.cursor)}};InteractionManager.prototype.processPointerMove=function processPointerMove(interactionEvent,displayObject,hit){var data=interactionEvent.data;var isTouch=data.pointerType==="touch";var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";if(isMouse){this.processPointerOverOut(interactionEvent,displayObject,hit)}if(!this.moveWhenInside||hit){this.dispatchEvent(displayObject,"pointermove",interactionEvent);if(isTouch)this.dispatchEvent(displayObject,"touchmove",interactionEvent);if(isMouse)this.dispatchEvent(displayObject,"mousemove",interactionEvent)}};InteractionManager.prototype.onPointerOut=function onPointerOut(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch")return;var events=this.normalizeToPointerData(originalEvent);var event=events[0];if(event.pointerType==="mouse"){this.mouseOverRenderer=false;this.setCursorMode(null)}var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,false);this.emit("pointerout",interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen"){this.emit("mouseout",interactionEvent)}else{this.releaseInteractionDataForPointerId(interactionData.identifier)}};InteractionManager.prototype.processPointerOverOut=function processPointerOverOut(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";var trackingData=displayObject.trackedPointers[id];if(hit&&!trackingData){trackingData=displayObject.trackedPointers[id]=new _InteractionTrackingData2.default(id)}if(trackingData===undefined)return;if(hit&&this.mouseOverRenderer){if(!trackingData.over){trackingData.over=true;this.dispatchEvent(displayObject,"pointerover",interactionEvent);if(isMouse){this.dispatchEvent(displayObject,"mouseover",interactionEvent)}}if(isMouse&&this.cursor===null){this.cursor=displayObject.cursor}}else if(trackingData.over){trackingData.over=false;this.dispatchEvent(displayObject,"pointerout",this.eventData);if(isMouse){this.dispatchEvent(displayObject,"mouseout",interactionEvent)}if(trackingData.none){delete displayObject.trackedPointers[id]}}};InteractionManager.prototype.onPointerOver=function onPointerOver(originalEvent){var events=this.normalizeToPointerData(originalEvent);var event=events[0];var interactionData=this.getInteractionDataForPointerId(event);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event;if(event.pointerType==="mouse"){this.mouseOverRenderer=true}this.emit("pointerover",interactionEvent);if(event.pointerType==="mouse"||event.pointerType==="pen"){this.emit("mouseover",interactionEvent)}};InteractionManager.prototype.getInteractionDataForPointerId=function getInteractionDataForPointerId(event){var pointerId=event.pointerId;var interactionData=void 0;if(pointerId===MOUSE_POINTER_ID||event.pointerType==="mouse"){interactionData=this.mouse}else if(this.activeInteractionData[pointerId]){interactionData=this.activeInteractionData[pointerId]}else{interactionData=this.interactionDataPool.pop()||new _InteractionData2.default;interactionData.identifier=pointerId;this.activeInteractionData[pointerId]=interactionData}interactionData._copyEvent(event);return interactionData};InteractionManager.prototype.releaseInteractionDataForPointerId=function releaseInteractionDataForPointerId(pointerId){var interactionData=this.activeInteractionData[pointerId];if(interactionData){delete this.activeInteractionData[pointerId];interactionData._reset();this.interactionDataPool.push(interactionData)}};InteractionManager.prototype.configureInteractionEventForDOMEvent=function configureInteractionEventForDOMEvent(interactionEvent,pointerEvent,interactionData){interactionEvent.data=interactionData;this.mapPositionToPoint(interactionData.global,pointerEvent.clientX,pointerEvent.clientY);if(navigator.isCocoonJS&&pointerEvent.pointerType==="touch"){interactionData.global.x=interactionData.global.x/this.resolution;interactionData.global.y=interactionData.global.y/this.resolution}if(pointerEvent.pointerType==="touch"){pointerEvent.globalX=interactionData.global.x;pointerEvent.globalY=interactionData.global.y}interactionData.originalEvent=pointerEvent;interactionEvent._reset();return interactionEvent};InteractionManager.prototype.normalizeToPointerData=function normalizeToPointerData(event){var normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent){for(var i=0,li=event.changedTouches.length;i<li;i++){var touch=event.changedTouches[i];if(typeof touch.button==="undefined")touch.button=event.touches.length?1:0;if(typeof touch.buttons==="undefined")touch.buttons=event.touches.length?1:0;if(typeof touch.isPrimary==="undefined"){touch.isPrimary=event.touches.length===1&&event.type==="touchstart"}if(typeof touch.width==="undefined")touch.width=touch.radiusX||1;if(typeof touch.height==="undefined")touch.height=touch.radiusY||1;if(typeof touch.tiltX==="undefined")touch.tiltX=0;if(typeof touch.tiltY==="undefined")touch.tiltY=0;if(typeof touch.pointerType==="undefined")touch.pointerType="touch";if(typeof touch.pointerId==="undefined")touch.pointerId=touch.identifier||0;if(typeof touch.pressure==="undefined")touch.pressure=touch.force||.5;touch.twist=0;touch.tangentialPressure=0;if(typeof touch.layerX==="undefined")touch.layerX=touch.offsetX=touch.clientX;if(typeof touch.layerY==="undefined")touch.layerY=touch.offsetY=touch.clientY;touch.isNormalized=true;normalizedEvents.push(touch)}}else if(event instanceof MouseEvent&&(!this.supportsPointerEvents||!(event instanceof window.PointerEvent))){if(typeof event.isPrimary==="undefined")event.isPrimary=true;if(typeof event.width==="undefined")event.width=1;if(typeof event.height==="undefined")event.height=1;if(typeof event.tiltX==="undefined")event.tiltX=0;if(typeof event.tiltY==="undefined")event.tiltY=0;if(typeof event.pointerType==="undefined")event.pointerType="mouse";if(typeof event.pointerId==="undefined")event.pointerId=MOUSE_POINTER_ID;if(typeof event.pressure==="undefined")event.pressure=.5;event.twist=0;event.tangentialPressure=0;event.isNormalized=true;normalizedEvents.push(event)}else{normalizedEvents.push(event)}return normalizedEvents};InteractionManager.prototype.destroy=function destroy(){this.removeEvents();this.removeAllListeners();this.renderer=null;this.mouse=null;this.eventData=null;this.interactionDOMElement=null;this.onPointerDown=null;this.processPointerDown=null;this.onPointerUp=null;this.processPointerUp=null;this.onPointerCancel=null;this.processPointerCancel=null;this.onPointerMove=null;this.processPointerMove=null;this.onPointerOut=null;this.processPointerOverOut=null;this.onPointerOver=null;this._tempPoint=null};return InteractionManager}(_eventemitter2.default);exports.default=InteractionManager;core.WebGLRenderer.registerPlugin("interaction",InteractionManager);core.CanvasRenderer.registerPlugin("interaction",InteractionManager)},{"../core":297,"./InteractionData":388,"./InteractionEvent":389,"./InteractionTrackingData":391,"./interactiveTarget":393,eventemitter3:172}],391:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var InteractionTrackingData=function(){function InteractionTrackingData(pointerId){_classCallCheck(this,InteractionTrackingData);this._pointerId=pointerId;this._flags=InteractionTrackingData.FLAGS.NONE}InteractionTrackingData.prototype._doSet=function _doSet(flag,yn){if(yn){this._flags=this._flags|flag}else{this._flags=this._flags&~flag}};_createClass(InteractionTrackingData,[{key:"pointerId",get:function get(){return this._pointerId}},{key:"flags",get:function get(){return this._flags},set:function set(flags){this._flags=flags}},{key:"none",get:function get(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function get(){return(this._flags&this.constructor.FLAGS.OVER)!==0},set:function set(yn){this._doSet(this.constructor.FLAGS.OVER,yn)}},{key:"rightDown",get:function get(){return(this._flags&this.constructor.FLAGS.RIGHT_DOWN)!==0},set:function set(yn){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,yn)}},{key:"leftDown",get:function get(){return(this._flags&this.constructor.FLAGS.LEFT_DOWN)!==0},set:function set(yn){this._doSet(this.constructor.FLAGS.LEFT_DOWN,yn)}}]);return InteractionTrackingData}();exports.default=InteractionTrackingData;InteractionTrackingData.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2})},{}],392:[function(require,module,exports){"use strict";exports.__esModule=true;var _InteractionData=require("./InteractionData");Object.defineProperty(exports,"InteractionData",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionData).default}});var _InteractionManager=require("./InteractionManager");Object.defineProperty(exports,"InteractionManager",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionManager).default}});var _interactiveTarget=require("./interactiveTarget");Object.defineProperty(exports,"interactiveTarget",{enumerable:true,get:function get(){return _interopRequireDefault(_interactiveTarget).default}});var _InteractionTrackingData=require("./InteractionTrackingData");Object.defineProperty(exports,"InteractionTrackingData",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionTrackingData).default}});var _InteractionEvent=require("./InteractionEvent");Object.defineProperty(exports,"InteractionEvent",{enumerable:true,get:function get(){return _interopRequireDefault(_InteractionEvent).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./InteractionData":388,"./InteractionEvent":389,"./InteractionManager":390,"./InteractionTrackingData":391,"./interactiveTarget":393}],393:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default={interactive:false,interactiveChildren:true,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(value){if(value){this.cursor="pointer"}else if(this.cursor==="pointer"){this.cursor=null}},cursor:null,get trackedPointers(){if(this._trackedPointers===undefined)this._trackedPointers={};return this._trackedPointers},_trackedPointers:undefined}},{}],394:[function(require,module,exports){"use strict";exports.__esModule=true;exports.parse=parse;exports.default=function(){return function bitmapFontParser(resource,next){if(!resource.data||resource.type!==_resourceLoader.Resource.TYPE.XML){next();return}if(resource.data.getElementsByTagName("page").length===0||resource.data.getElementsByTagName("info").length===0||resource.data.getElementsByTagName("info")[0].getAttribute("face")===null){next();return}var xmlUrl=!resource.isDataUrl?path.dirname(resource.url):"";if(resource.isDataUrl){if(xmlUrl==="."){xmlUrl=""}if(this.baseUrl&&xmlUrl){if(this.baseUrl.charAt(this.baseUrl.length-1)==="/"){xmlUrl+="/"}}}xmlUrl=xmlUrl.replace(this.baseUrl,"");if(xmlUrl&&xmlUrl.charAt(xmlUrl.length-1)!=="/"){xmlUrl+="/"}var textureUrl=xmlUrl+resource.data.getElementsByTagName("page")[0].getAttribute("file");if(_core.utils.TextureCache[textureUrl]){parse(resource,_core.utils.TextureCache[textureUrl]);next()}else{var loadOptions={crossOrigin:resource.crossOrigin,loadType:_resourceLoader.Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata,parentResource:resource};this.add(resource.name+"_image",textureUrl,loadOptions,function(res){parse(resource,res.texture);next()})}}};var _path=require("path");var path=_interopRequireWildcard(_path);var _core=require("../core");var _resourceLoader=require("resource-loader");var _extras=require("../extras");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function parse(resource,texture){resource.bitmapFont=_extras.BitmapText.registerFont(resource.data,texture)}},{"../core":297,"../extras":373,path:254,"resource-loader":439}],395:[function(require,module,exports){"use strict";exports.__esModule=true;exports.shared=exports.Resource=exports.textureParser=exports.getResourcePath=exports.spritesheetParser=exports.parseBitmapFontData=exports.bitmapFontParser=exports.Loader=undefined;var _bitmapFontParser=require("./bitmapFontParser");Object.defineProperty(exports,"bitmapFontParser",{enumerable:true,get:function get(){return _interopRequireDefault(_bitmapFontParser).default}});Object.defineProperty(exports,"parseBitmapFontData",{enumerable:true,get:function get(){return _bitmapFontParser.parse}});var _spritesheetParser=require("./spritesheetParser");Object.defineProperty(exports,"spritesheetParser",{enumerable:true,get:function get(){return _interopRequireDefault(_spritesheetParser).default}});Object.defineProperty(exports,"getResourcePath",{enumerable:true,get:function get(){return _spritesheetParser.getResourcePath}});var _textureParser=require("./textureParser");Object.defineProperty(exports,"textureParser",{enumerable:true,get:function get(){return _interopRequireDefault(_textureParser).default}});var _resourceLoader=require("resource-loader");Object.defineProperty(exports,"Resource",{enumerable:true,get:function get(){return _resourceLoader.Resource}});var _Application=require("../core/Application");var _Application2=_interopRequireDefault(_Application);var _loader=require("./loader");var _loader2=_interopRequireDefault(_loader);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.Loader=_loader2.default;var shared=new _loader2.default;shared.destroy=function(){};exports.shared=shared;var AppPrototype=_Application2.default.prototype;AppPrototype._loader=null;Object.defineProperty(AppPrototype,"loader",{get:function get(){if(!this._loader){var sharedLoader=this._options.sharedLoader;this._loader=sharedLoader?shared:new _loader2.default}return this._loader}});AppPrototype._parentDestroy=AppPrototype.destroy;AppPrototype.destroy=function destroy(removeView){if(this._loader){this._loader.destroy();this._loader=null}this._parentDestroy(removeView)}},{"../core/Application":275,"./bitmapFontParser":394,"./loader":396,"./spritesheetParser":397,"./textureParser":398,"resource-loader":439}],396:[function(require,module,exports){"use strict";exports.__esModule=true;var _resourceLoader=require("resource-loader");var _resourceLoader2=_interopRequireDefault(_resourceLoader);var _blob=require("resource-loader/lib/middlewares/parsing/blob");var _eventemitter=require("eventemitter3");var _eventemitter2=_interopRequireDefault(_eventemitter);var _textureParser=require("./textureParser");var _textureParser2=_interopRequireDefault(_textureParser);var _spritesheetParser=require("./spritesheetParser");var _spritesheetParser2=_interopRequireDefault(_spritesheetParser);var _bitmapFontParser=require("./bitmapFontParser");var _bitmapFontParser2=_interopRequireDefault(_bitmapFontParser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Loader=function(_ResourceLoader){_inherits(Loader,_ResourceLoader);function Loader(baseUrl,concurrency){_classCallCheck(this,Loader);var _this=_possibleConstructorReturn(this,_ResourceLoader.call(this,baseUrl,concurrency));_eventemitter2.default.call(_this);for(var i=0;i<Loader._pixiMiddleware.length;++i){_this.use(Loader._pixiMiddleware[i]())}_this.onStart.add(function(l){return _this.emit("start",l)});_this.onProgress.add(function(l,r){return _this.emit("progress",l,r)});_this.onError.add(function(e,l,r){return _this.emit("error",e,l,r)});_this.onLoad.add(function(l,r){return _this.emit("load",l,r)});_this.onComplete.add(function(l,r){return _this.emit("complete",l,r)});return _this}Loader.addPixiMiddleware=function addPixiMiddleware(fn){Loader._pixiMiddleware.push(fn)};Loader.prototype.destroy=function destroy(){this.removeAllListeners();this.reset()};return Loader}(_resourceLoader2.default);exports.default=Loader;for(var k in _eventemitter2.default.prototype){Loader.prototype[k]=_eventemitter2.default.prototype[k]}Loader._pixiMiddleware=[_blob.blobMiddlewareFactory,_textureParser2.default,_spritesheetParser2.default,_bitmapFontParser2.default];var Resource=_resourceLoader2.default.Resource;Resource.setExtensionXhrType("fnt",Resource.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":394,"./spritesheetParser":397,"./textureParser":398,eventemitter3:172,"resource-loader":439,"resource-loader/lib/middlewares/parsing/blob":440}],397:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(){return function spritesheetParser(resource,next){var imageResourceName=resource.name+"_image";if(!resource.data||resource.type!==_resourceLoader.Resource.TYPE.JSON||!resource.data.frames||this.resources[imageResourceName]){next();return}var loadOptions={crossOrigin:resource.crossOrigin,loadType:_resourceLoader.Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata,parentResource:resource};var resourcePath=getResourcePath(resource,this.baseUrl);this.add(imageResourceName,resourcePath,loadOptions,function onImageLoad(res){var spritesheet=new _core.Spritesheet(res.texture.baseTexture,resource.data,resource.url);spritesheet.parse(function(){resource.spritesheet=spritesheet;resource.textures=spritesheet.textures;next()})})}};exports.getResourcePath=getResourcePath;var _resourceLoader=require("resource-loader");var _url=require("url");var _url2=_interopRequireDefault(_url);var _core=require("../core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getResourcePath(resource,baseUrl){if(resource.isDataUrl){return resource.data.meta.image}return _url2.default.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)}},{"../core":297,"resource-loader":439,url:544}],398:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=function(){return function textureParser(resource,next){if(resource.data&&resource.type===_resourceLoader.Resource.TYPE.IMAGE){resource.texture=_Texture2.default.fromLoader(resource.data,resource.url,resource.name)}next()}};var _resourceLoader=require("resource-loader");var _Texture=require("../core/textures/Texture");var _Texture2=_interopRequireDefault(_Texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"../core/textures/Texture":347,"resource-loader":439}],399:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _Texture=require("../core/textures/Texture");var _Texture2=_interopRequireDefault(_Texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var tempPoint=new core.Point;var tempPolygon=new core.Polygon;var Mesh=function(_core$Container){_inherits(Mesh,_core$Container);function Mesh(texture,vertices,uvs,indices,drawMode){_classCallCheck(this,Mesh);var _this=_possibleConstructorReturn(this,_core$Container.call(this));_this._texture=texture||_Texture2.default.EMPTY;_this.uvs=uvs||new Float32Array([0,0,1,0,1,1,0,1]);_this.vertices=vertices||new Float32Array([0,0,100,0,100,100,0,100]);_this.indices=indices||new Uint16Array([0,1,3,2]);_this.dirty=0;_this.indexDirty=0;_this.blendMode=core.BLEND_MODES.NORMAL;_this.canvasPadding=0;_this.drawMode=drawMode||Mesh.DRAW_MODES.TRIANGLE_MESH;_this.shader=null;_this.tintRgb=new Float32Array([1,1,1]);_this._glDatas={};_this._uvTransform=new core.TextureMatrix(_this._texture);_this.uploadUvTransform=false;_this.pluginName="mesh";return _this}Mesh.prototype._renderWebGL=function _renderWebGL(renderer){this.refresh();renderer.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};Mesh.prototype._renderCanvas=function _renderCanvas(renderer){this.refresh();renderer.plugins[this.pluginName].render(this)};Mesh.prototype._onTextureUpdate=function _onTextureUpdate(){this._uvTransform.texture=this._texture;this.refresh()};Mesh.prototype.multiplyUvs=function multiplyUvs(){if(!this.uploadUvTransform){this._uvTransform.multiplyUvs(this.uvs)}};Mesh.prototype.refresh=function refresh(forceUpdate){if(this._uvTransform.update(forceUpdate)){this._refresh()}};Mesh.prototype._refresh=function _refresh(){};Mesh.prototype._calculateBounds=function _calculateBounds(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)};Mesh.prototype.containsPoint=function containsPoint(point){if(!this.getBounds().contains(point.x,point.y)){return false}this.worldTransform.applyInverse(point,tempPoint);var vertices=this.vertices;var points=tempPolygon.points;var indices=this.indices;var len=this.indices.length;var step=this.drawMode===Mesh.DRAW_MODES.TRIANGLES?3:1;for(var i=0;i+2<len;i+=step){var ind0=indices[i]*2;var ind1=indices[i+1]*2;var ind2=indices[i+2]*2;points[0]=vertices[ind0];points[1]=vertices[ind0+1];points[2]=vertices[ind1];points[3]=vertices[ind1+1];points[4]=vertices[ind2];points[5]=vertices[ind2+1];if(tempPolygon.contains(tempPoint.x,tempPoint.y)){return true}}return false};_createClass(Mesh,[{key:"texture",get:function get(){return this._texture},set:function set(value){if(this._texture===value){return}this._texture=value;if(value){if(value.baseTexture.hasLoaded){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}}},{key:"tint",get:function get(){return core.utils.rgb2hex(this.tintRgb)},set:function set(value){this.tintRgb=core.utils.hex2rgb(value,this.tintRgb)}}]);return Mesh}(core.Container);exports.default=Mesh;Mesh.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":297,"../core/textures/Texture":347}],400:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Plane2=require("./Plane");var _Plane3=_interopRequireDefault(_Plane2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_BORDER_SIZE=10;var NineSlicePlane=function(_Plane){_inherits(NineSlicePlane,_Plane);function NineSlicePlane(texture,leftWidth,topHeight,rightWidth,bottomHeight){_classCallCheck(this,NineSlicePlane);var _this=_possibleConstructorReturn(this,_Plane.call(this,texture,4,4));_this._origWidth=texture.orig.width;_this._origHeight=texture.orig.height;_this._width=_this._origWidth;_this._height=_this._origHeight;_this.leftWidth=typeof leftWidth!=="undefined"?leftWidth:DEFAULT_BORDER_SIZE;_this.rightWidth=typeof rightWidth!=="undefined"?rightWidth:DEFAULT_BORDER_SIZE;_this.topHeight=typeof topHeight!=="undefined"?topHeight:DEFAULT_BORDER_SIZE;_this.bottomHeight=typeof bottomHeight!=="undefined"?bottomHeight:DEFAULT_BORDER_SIZE;_this.refresh(true);return _this}NineSlicePlane.prototype.updateHorizontalVertices=function updateHorizontalVertices(){var vertices=this.vertices;vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight;vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight;vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height};NineSlicePlane.prototype.updateVerticalVertices=function updateVerticalVertices(){var vertices=this.vertices;vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth;vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth;vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width};NineSlicePlane.prototype._renderCanvas=function _renderCanvas(renderer){var context=renderer.context;context.globalAlpha=this.worldAlpha;var transform=this.worldTransform;var res=renderer.resolution;if(renderer.roundPixels){context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0)}else{context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res)}var base=this._texture.baseTexture;var textureSource=base.source;var w=base.width*base.resolution;var h=base.height*base.resolution;this.drawSegment(context,textureSource,w,h,0,1,10,11);this.drawSegment(context,textureSource,w,h,2,3,12,13);this.drawSegment(context,textureSource,w,h,4,5,14,15);this.drawSegment(context,textureSource,w,h,8,9,18,19);this.drawSegment(context,textureSource,w,h,10,11,20,21);this.drawSegment(context,textureSource,w,h,12,13,22,23);this.drawSegment(context,textureSource,w,h,16,17,26,27);this.drawSegment(context,textureSource,w,h,18,19,28,29);this.drawSegment(context,textureSource,w,h,20,21,30,31)};NineSlicePlane.prototype.drawSegment=function drawSegment(context,textureSource,w,h,x1,y1,x2,y2){var uvs=this.uvs;var vertices=this.vertices;var sw=(uvs[x2]-uvs[x1])*w;var sh=(uvs[y2]-uvs[y1])*h;var dw=vertices[x2]-vertices[x1];var dh=vertices[y2]-vertices[y1];if(sw<1){sw=1}if(sh<1){sh=1}if(dw<1){dw=1}if(dh<1){dh=1}context.drawImage(textureSource,uvs[x1]*w,uvs[y1]*h,sw,sh,vertices[x1],vertices[y1],dw,dh)};NineSlicePlane.prototype._refresh=function _refresh(){_Plane.prototype._refresh.call(this);var uvs=this.uvs;var texture=this._texture;this._origWidth=texture.orig.width;this._origHeight=texture.orig.height;var _uvw=1/this._origWidth;var _uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0;uvs[1]=uvs[3]=uvs[5]=uvs[7]=0;uvs[6]=uvs[14]=uvs[22]=uvs[30]=1;uvs[25]=uvs[27]=uvs[29]=uvs[31]=1;uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth;uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth;uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight;uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight;this.updateHorizontalVertices();this.updateVerticalVertices();this.dirty++;this.multiplyUvs()};_createClass(NineSlicePlane,[{key:"width",get:function get(){return this._width},set:function set(value){this._width=value;this._refresh()}},{key:"height",get:function get(){return this._height},set:function set(value){this._height=value;this._refresh()}},{key:"leftWidth",get:function get(){return this._leftWidth},set:function set(value){this._leftWidth=value;this._refresh()}},{key:"rightWidth",get:function get(){return this._rightWidth},set:function set(value){this._rightWidth=value;this._refresh()}},{key:"topHeight",get:function get(){return this._topHeight},set:function set(value){this._topHeight=value;this._refresh()}},{key:"bottomHeight",get:function get(){return this._bottomHeight},set:function set(value){this._bottomHeight=value;this._refresh()}}]);return NineSlicePlane}(_Plane3.default);exports.default=NineSlicePlane},{"./Plane":401}],401:[function(require,module,exports){"use strict";exports.__esModule=true;var _Mesh2=require("./Mesh");var _Mesh3=_interopRequireDefault(_Mesh2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plane=function(_Mesh){_inherits(Plane,_Mesh);function Plane(texture,verticesX,verticesY){_classCallCheck(this,Plane);var _this=_possibleConstructorReturn(this,_Mesh.call(this,texture));_this._ready=true;_this.verticesX=verticesX||10;_this.verticesY=verticesY||10;_this.drawMode=_Mesh3.default.DRAW_MODES.TRIANGLES;_this.refresh();return _this}Plane.prototype._refresh=function _refresh(){var texture=this._texture;var total=this.verticesX*this.verticesY;var verts=[];var colors=[];var uvs=[];var indices=[];var segmentsX=this.verticesX-1;var segmentsY=this.verticesY-1;var sizeX=texture.width/segmentsX;var sizeY=texture.height/segmentsY;for(var i=0;i<total;i++){var x=i%this.verticesX;var y=i/this.verticesX|0;verts.push(x*sizeX,y*sizeY);uvs.push(x/segmentsX,y/segmentsY)}var totalSub=segmentsX*segmentsY;for(var _i=0;_i<totalSub;_i++){var xpos=_i%segmentsX;var ypos=_i/segmentsX|0;var value=ypos*this.verticesX+xpos;var value2=ypos*this.verticesX+xpos+1;var value3=(ypos+1)*this.verticesX+xpos;var value4=(ypos+1)*this.verticesX+xpos+1;indices.push(value,value2,value3);indices.push(value2,value4,value3)}this.vertices=new Float32Array(verts);this.uvs=new Float32Array(uvs);this.colors=new Float32Array(colors);this.indices=new Uint16Array(indices);this.dirty++;this.indexDirty++;this.multiplyUvs()};Plane.prototype._onTextureUpdate=function _onTextureUpdate(){_Mesh3.default.prototype._onTextureUpdate.call(this);if(this._ready){this.refresh()}};return Plane}(_Mesh3.default);exports.default=Plane},{"./Mesh":399}],402:[function(require,module,exports){"use strict";exports.__esModule=true;var _Mesh2=require("./Mesh");var _Mesh3=_interopRequireDefault(_Mesh2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Rope=function(_Mesh){_inherits(Rope,_Mesh);function Rope(texture,points){_classCallCheck(this,Rope);var _this=_possibleConstructorReturn(this,_Mesh.call(this,texture));_this.points=points;_this.vertices=new Float32Array(points.length*4);_this.uvs=new Float32Array(points.length*4);_this.colors=new Float32Array(points.length*2);_this.indices=new Uint16Array(points.length*2);_this.autoUpdate=true;_this.refresh();return _this}Rope.prototype._refresh=function _refresh(){var points=this.points;if(points.length<1||!this._texture._uvs){return}if(this.vertices.length/4!==points.length){this.vertices=new Float32Array(points.length*4);this.uvs=new Float32Array(points.length*4);this.colors=new Float32Array(points.length*2);this.indices=new Uint16Array(points.length*2)}var uvs=this.uvs;var indices=this.indices;var colors=this.colors;uvs[0]=0;uvs[1]=0;uvs[2]=0;uvs[3]=1;colors[0]=1;colors[1]=1;indices[0]=0;indices[1]=1;var total=points.length;for(var i=1;i<total;i++){var index=i*4;var amount=i/(total-1);uvs[index]=amount;uvs[index+1]=0;uvs[index+2]=amount;uvs[index+3]=1;index=i*2;colors[index]=1;colors[index+1]=1;index=i*2;indices[index]=index;indices[index+1]=index+1}this.dirty++;this.indexDirty++;this.multiplyUvs();this.refreshVertices()};Rope.prototype.refreshVertices=function refreshVertices(){var points=this.points;if(points.length<1){return}var lastPoint=points[0];var nextPoint=void 0;var perpX=0;var perpY=0;var vertices=this.vertices;var total=points.length;for(var i=0;i<total;i++){var point=points[i];var index=i*4;if(i<points.length-1){nextPoint=points[i+1]}else{nextPoint=point}perpY=-(nextPoint.x-lastPoint.x);perpX=nextPoint.y-lastPoint.y;var ratio=(1-i/(total-1))*10;if(ratio>1){ratio=1}var perpLength=Math.sqrt(perpX*perpX+perpY*perpY);var num=this._texture.height/2;perpX/=perpLength;perpY/=perpLength;perpX*=num;perpY*=num;vertices[index]=point.x+perpX;vertices[index+1]=point.y+perpY;vertices[index+2]=point.x-perpX;vertices[index+3]=point.y-perpY;lastPoint=point}};Rope.prototype.updateTransform=function updateTransform(){if(this.autoUpdate){this.refreshVertices()}this.containerUpdateTransform()};return Rope}(_Mesh3.default);exports.default=Rope},{"./Mesh":399}],403:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _Mesh=require("../Mesh");var _Mesh2=_interopRequireDefault(_Mesh);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MeshSpriteRenderer=function(){function MeshSpriteRenderer(renderer){_classCallCheck(this,MeshSpriteRenderer);this.renderer=renderer}MeshSpriteRenderer.prototype.render=function render(mesh){var renderer=this.renderer;var context=renderer.context;var transform=mesh.worldTransform;var res=renderer.resolution;if(renderer.roundPixels){context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0)}else{context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res)}renderer.setBlendMode(mesh.blendMode);if(mesh.drawMode===_Mesh2.default.DRAW_MODES.TRIANGLE_MESH){this._renderTriangleMesh(mesh)}else{this._renderTriangles(mesh)}};MeshSpriteRenderer.prototype._renderTriangleMesh=function _renderTriangleMesh(mesh){var length=mesh.vertices.length/2;for(var i=0;i<length-2;i++){var index=i*2;this._renderDrawTriangle(mesh,index,index+2,index+4)}};MeshSpriteRenderer.prototype._renderTriangles=function _renderTriangles(mesh){var indices=mesh.indices;var length=indices.length;for(var i=0;i<length;i+=3){var index0=indices[i]*2;var index1=indices[i+1]*2;var index2=indices[i+2]*2;this._renderDrawTriangle(mesh,index0,index1,index2)}};MeshSpriteRenderer.prototype._renderDrawTriangle=function _renderDrawTriangle(mesh,index0,index1,index2){var context=this.renderer.context;var uvs=mesh.uvs;var vertices=mesh.vertices;var texture=mesh._texture;if(!texture.valid){return}var base=texture.baseTexture;var textureSource=base.source;var textureWidth=base.width;var textureHeight=base.height;var u0=void 0;var u1=void 0;var u2=void 0;var v0=void 0;var v1=void 0;var v2=void 0;if(mesh.uploadUvTransform){var ut=mesh._uvTransform.mapCoord;u0=(uvs[index0]*ut.a+uvs[index0+1]*ut.c+ut.tx)*base.width;u1=(uvs[index1]*ut.a+uvs[index1+1]*ut.c+ut.tx)*base.width;u2=(uvs[index2]*ut.a+uvs[index2+1]*ut.c+ut.tx)*base.width;v0=(uvs[index0]*ut.b+uvs[index0+1]*ut.d+ut.ty)*base.height;v1=(uvs[index1]*ut.b+uvs[index1+1]*ut.d+ut.ty)*base.height;v2=(uvs[index2]*ut.b+uvs[index2+1]*ut.d+ut.ty)*base.height}else{u0=uvs[index0]*base.width;u1=uvs[index1]*base.width;u2=uvs[index2]*base.width;v0=uvs[index0+1]*base.height;v1=uvs[index1+1]*base.height;v2=uvs[index2+1]*base.height}var x0=vertices[index0];var x1=vertices[index1];var x2=vertices[index2];var y0=vertices[index0+1];var y1=vertices[index1+1];var y2=vertices[index2+1];if(mesh.canvasPadding>0){var paddingX=mesh.canvasPadding/mesh.worldTransform.a;var paddingY=mesh.canvasPadding/mesh.worldTransform.d;var centerX=(x0+x1+x2)/3;var centerY=(y0+y1+y2)/3;var normX=x0-centerX;var normY=y0-centerY;var dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX);y0=centerY+normY/dist*(dist+paddingY);normX=x1-centerX;normY=y1-centerY;dist=Math.sqrt(normX*normX+normY*normY);x1=centerX+normX/dist*(dist+paddingX);y1=centerY+normY/dist*(dist+paddingY);normX=x2-centerX;normY=y2-centerY;dist=Math.sqrt(normX*normX+normY*normY);x2=centerX+normX/dist*(dist+paddingX);y2=centerY+normY/dist*(dist+paddingY)}context.save();context.beginPath();context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.closePath();context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2;var deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2;var deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2;var deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2;var deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2;var deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2;var deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta);context.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight);context.restore();this.renderer.invalidateBlendMode()};MeshSpriteRenderer.prototype.renderMeshFlat=function renderMeshFlat(mesh){var context=this.renderer.context;var vertices=mesh.vertices;var length=vertices.length/2;context.beginPath();for(var i=1;i<length-2;++i){var index=i*2;var x0=vertices[index];var y0=vertices[index+1];var x1=vertices[index+2];var y1=vertices[index+3];var x2=vertices[index+4];var y2=vertices[index+5];context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2)}context.fillStyle="#FF0000";context.fill();context.closePath()};MeshSpriteRenderer.prototype.destroy=function destroy(){this.renderer=null};return MeshSpriteRenderer}();exports.default=MeshSpriteRenderer;core.CanvasRenderer.registerPlugin("mesh",MeshSpriteRenderer)},{"../../core":297,"../Mesh":399}],404:[function(require,module,exports){"use strict";exports.__esModule=true;var _Mesh=require("./Mesh");Object.defineProperty(exports,"Mesh",{enumerable:true,get:function get(){return _interopRequireDefault(_Mesh).default}});var _MeshRenderer=require("./webgl/MeshRenderer");Object.defineProperty(exports,"MeshRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_MeshRenderer).default}});var _CanvasMeshRenderer=require("./canvas/CanvasMeshRenderer");Object.defineProperty(exports,"CanvasMeshRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasMeshRenderer).default}});var _Plane=require("./Plane");Object.defineProperty(exports,"Plane",{enumerable:true,get:function get(){return _interopRequireDefault(_Plane).default}});var _NineSlicePlane=require("./NineSlicePlane");Object.defineProperty(exports,"NineSlicePlane",{enumerable:true,get:function get(){return _interopRequireDefault(_NineSlicePlane).default}});var _Rope=require("./Rope");Object.defineProperty(exports,"Rope",{enumerable:true,get:function get(){return _interopRequireDefault(_Rope).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./Mesh":399,"./NineSlicePlane":400,"./Plane":401,"./Rope":402,"./canvas/CanvasMeshRenderer":403,"./webgl/MeshRenderer":405}],405:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _Mesh=require("../Mesh");var _Mesh2=_interopRequireDefault(_Mesh);var _path=require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var matrixIdentity=core.Matrix.IDENTITY;var MeshRenderer=function(_core$ObjectRenderer){_inherits(MeshRenderer,_core$ObjectRenderer);function MeshRenderer(renderer){_classCallCheck(this,MeshRenderer);var _this=_possibleConstructorReturn(this,_core$ObjectRenderer.call(this,renderer));_this.shader=null;return _this}MeshRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;this.shader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")};MeshRenderer.prototype.render=function render(mesh){var renderer=this.renderer;var gl=renderer.gl;var texture=mesh._texture;if(!texture.valid){return}var glData=mesh._glDatas[renderer.CONTEXT_UID];if(!glData){renderer.bindVao(null);glData={shader:this.shader,vertexBuffer:_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,mesh.vertices,gl.STREAM_DRAW),uvBuffer:_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,mesh.uvs,gl.STREAM_DRAW),indexBuffer:_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,mesh.indices,gl.STATIC_DRAW),vao:null,dirty:mesh.dirty,indexDirty:mesh.indexDirty};glData.vao=new _pixiGlCore2.default.VertexArrayObject(gl).addIndex(glData.indexBuffer).addAttribute(glData.vertexBuffer,glData.shader.attributes.aVertexPosition,gl.FLOAT,false,2*4,0).addAttribute(glData.uvBuffer,glData.shader.attributes.aTextureCoord,gl.FLOAT,false,2*4,0);mesh._glDatas[renderer.CONTEXT_UID]=glData}renderer.bindVao(glData.vao);if(mesh.dirty!==glData.dirty){glData.dirty=mesh.dirty;glData.uvBuffer.upload(mesh.uvs)}if(mesh.indexDirty!==glData.indexDirty){glData.indexDirty=mesh.indexDirty;glData.indexBuffer.upload(mesh.indices)}glData.vertexBuffer.upload(mesh.vertices);renderer.bindShader(glData.shader);glData.shader.uniforms.uSampler=renderer.bindTexture(texture);renderer.state.setBlendMode(core.utils.correctBlendMode(mesh.blendMode,texture.baseTexture.premultipliedAlpha));if(glData.shader.uniforms.uTransform){if(mesh.uploadUvTransform){glData.shader.uniforms.uTransform=mesh._uvTransform.mapCoord.toArray(true)}else{glData.shader.uniforms.uTransform=matrixIdentity.toArray(true)}}glData.shader.uniforms.translationMatrix=mesh.worldTransform.toArray(true);glData.shader.uniforms.uColor=core.utils.premultiplyRgba(mesh.tintRgb,mesh.worldAlpha,glData.shader.uniforms.uColor,texture.baseTexture.premultipliedAlpha);var drawMode=mesh.drawMode===_Mesh2.default.DRAW_MODES.TRIANGLE_MESH?gl.TRIANGLE_STRIP:gl.TRIANGLES;glData.vao.draw(drawMode,mesh.indices.length,0)};return MeshRenderer}(core.ObjectRenderer);exports.default=MeshRenderer;core.WebGLRenderer.registerPlugin("mesh",MeshRenderer)},{"../../core":297,"../Mesh":399,path:254,"pixi-gl-core":261}],406:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _core=require("../core");var core=_interopRequireWildcard(_core);var _utils=require("../core/utils");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ParticleContainer=function(_core$Container){_inherits(ParticleContainer,_core$Container);function ParticleContainer(){var maxSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1500;var properties=arguments[1];var batchSize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:16384;var autoResize=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,ParticleContainer);var _this=_possibleConstructorReturn(this,_core$Container.call(this));var maxBatchSize=16384;if(batchSize>maxBatchSize){batchSize=maxBatchSize}if(batchSize>maxSize){batchSize=maxSize}_this._properties=[false,true,false,false,false];_this._maxSize=maxSize;_this._batchSize=batchSize;_this._glBuffers={};_this._bufferToUpdate=0;_this.interactiveChildren=false;_this.blendMode=core.BLEND_MODES.NORMAL;_this.autoResize=autoResize;_this.roundPixels=true;_this.baseTexture=null;_this.setProperties(properties);_this._tint=0;_this.tintRgb=new Float32Array(4);_this.tint=16777215;return _this}ParticleContainer.prototype.setProperties=function setProperties(properties){if(properties){this._properties[0]="scale"in properties?!!properties.scale:this._properties[0];this._properties[1]="position"in properties?!!properties.position:this._properties[1];this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2];this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3];this._properties[4]="alpha"in properties||"tint"in properties?!!properties.alpha||!!properties.tint:this._properties[4]}};ParticleContainer.prototype.updateTransform=function updateTransform(){this.displayObjectUpdateTransform()};ParticleContainer.prototype.renderWebGL=function renderWebGL(renderer){var _this2=this;if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}if(!this.baseTexture){this.baseTexture=this.children[0]._texture.baseTexture;if(!this.baseTexture.hasLoaded){this.baseTexture.once("update",function(){return _this2.onChildrenChange(0)})}}renderer.setObjectRenderer(renderer.plugins.particle);renderer.plugins.particle.render(this)};ParticleContainer.prototype.onChildrenChange=function onChildrenChange(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);if(bufferIndex<this._bufferToUpdate){this._bufferToUpdate=bufferIndex}};ParticleContainer.prototype.renderCanvas=function renderCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}var context=renderer.context;var transform=this.worldTransform;var isRotated=true;var positionX=0;var positionY=0;var finalWidth=0;var finalHeight=0;renderer.setBlendMode(this.blendMode);context.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(!child.visible){continue}var frame=child._texture.frame;context.globalAlpha=this.worldAlpha*child.alpha;if(child.rotation%(Math.PI*2)===0){if(isRotated){context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx*renderer.resolution,transform.ty*renderer.resolution);isRotated=false}positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5;positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5;finalWidth=frame.width*child.scale.x;finalHeight=frame.height*child.scale.y}else{if(!isRotated){isRotated=true}child.displayObjectUpdateTransform();var childTransform=child.worldTransform;if(renderer.roundPixels){context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx*renderer.resolution|0,childTransform.ty*renderer.resolution|0)}else{context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx*renderer.resolution,childTransform.ty*renderer.resolution)}positionX=child.anchor.x*-frame.width+.5;positionY=child.anchor.y*-frame.height+.5;finalWidth=frame.width;finalHeight=frame.height}var resolution=child._texture.baseTexture.resolution;context.drawImage(child._texture.baseTexture.source,frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*renderer.resolution,positionY*renderer.resolution,finalWidth*renderer.resolution,finalHeight*renderer.resolution)}};ParticleContainer.prototype.destroy=function destroy(options){_core$Container.prototype.destroy.call(this,options);if(this._buffers){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy()}}this._properties=null;this._buffers=null};_createClass(ParticleContainer,[{key:"tint",get:function get(){return this._tint},set:function set(value){this._tint=value;(0,_utils.hex2rgb)(value,this.tintRgb)}}]);return ParticleContainer}(core.Container);exports.default=ParticleContainer},{"../core":297,"../core/utils":357}],407:[function(require,module,exports){"use strict";exports.__esModule=true;var _ParticleContainer=require("./ParticleContainer");Object.defineProperty(exports,"ParticleContainer",{enumerable:true,get:function get(){return _interopRequireDefault(_ParticleContainer).default}});var _ParticleRenderer=require("./webgl/ParticleRenderer");Object.defineProperty(exports,"ParticleRenderer",{enumerable:true,get:function get(){return _interopRequireDefault(_ParticleRenderer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./ParticleContainer":406,"./webgl/ParticleRenderer":409}],408:[function(require,module,exports){"use strict";exports.__esModule=true;var _pixiGlCore=require("pixi-gl-core");var _pixiGlCore2=_interopRequireDefault(_pixiGlCore);var _createIndicesForQuads=require("../../core/utils/createIndicesForQuads");var _createIndicesForQuads2=_interopRequireDefault(_createIndicesForQuads);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ParticleBuffer=function(){function ParticleBuffer(gl,properties,dynamicPropertyFlags,size){_classCallCheck(this,ParticleBuffer);this.gl=gl;this.size=size;this.dynamicProperties=[];this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attribute:property.attribute,size:property.size,uploadFunction:property.uploadFunction,unsignedByte:property.unsignedByte,offset:property.offset};if(dynamicPropertyFlags[i]){this.dynamicProperties.push(property)}else{this.staticProperties.push(property)}}this.staticStride=0;this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null;this.dynamicStride=0;this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this.initBuffers()}ParticleBuffer.prototype.initBuffers=function initBuffers(){var gl=this.gl;var dynamicOffset=0;this.indices=(0,_createIndicesForQuads2.default)(this.size);this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW);this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];property.offset=dynamicOffset;dynamicOffset+=property.size;this.dynamicStride+=property.size}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer);this.dynamicDataUint32=new Uint32Array(dynBuffer);this.dynamicBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,dynBuffer,gl.STREAM_DRAW);var staticOffset=0;this.staticStride=0;for(var _i=0;_i<this.staticProperties.length;++_i){var _property=this.staticProperties[_i];_property.offset=staticOffset;staticOffset+=_property.size;this.staticStride+=_property.size}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer);this.staticDataUint32=new Uint32Array(statBuffer);this.staticBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,statBuffer,gl.STATIC_DRAW);this.vao=new _pixiGlCore2.default.VertexArrayObject(gl).addIndex(this.indexBuffer);for(var _i2=0;_i2<this.dynamicProperties.length;++_i2){var _property2=this.dynamicProperties[_i2];if(_property2.unsignedByte){this.vao.addAttribute(this.dynamicBuffer,_property2.attribute,gl.UNSIGNED_BYTE,true,this.dynamicStride*4,_property2.offset*4)}else{this.vao.addAttribute(this.dynamicBuffer,_property2.attribute,gl.FLOAT,false,this.dynamicStride*4,_property2.offset*4)}}for(var _i3=0;_i3<this.staticProperties.length;++_i3){var _property3=this.staticProperties[_i3];if(_property3.unsignedByte){this.vao.addAttribute(this.staticBuffer,_property3.attribute,gl.UNSIGNED_BYTE,true,this.staticStride*4,_property3.offset*4)}else{this.vao.addAttribute(this.staticBuffer,_property3.attribute,gl.FLOAT,false,this.staticStride*4,_property3.offset*4)}}};ParticleBuffer.prototype.uploadDynamic=function uploadDynamic(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer.upload()};ParticleBuffer.prototype.uploadStatic=function uploadStatic(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer.upload()};ParticleBuffer.prototype.destroy=function destroy(){this.dynamicProperties=null;this.dynamicData=null;this.dynamicBuffer.destroy();this.staticProperties=null;this.staticData=null;this.staticBuffer.destroy()};return ParticleBuffer}();exports.default=ParticleBuffer},{"../../core/utils/createIndicesForQuads":355,"pixi-gl-core":261}],409:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _ParticleShader=require("./ParticleShader");var _ParticleShader2=_interopRequireDefault(_ParticleShader);var _ParticleBuffer=require("./ParticleBuffer");var _ParticleBuffer2=_interopRequireDefault(_ParticleBuffer);var _utils=require("../../core/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ParticleRenderer=function(_core$ObjectRenderer){_inherits(ParticleRenderer,_core$ObjectRenderer);function ParticleRenderer(renderer){_classCallCheck(this,ParticleRenderer);var _this=_possibleConstructorReturn(this,_core$ObjectRenderer.call(this,renderer));_this.shader=null;_this.indexBuffer=null;_this.properties=null;_this.tempMatrix=new core.Matrix;_this.CONTEXT_UID=0;return _this}ParticleRenderer.prototype.onContextChange=function onContextChange(){var gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.shader=new _ParticleShader2.default(gl);this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:true,uploadFunction:this.uploadTint,offset:0}]};ParticleRenderer.prototype.start=function start(){this.renderer.bindShader(this.shader)};ParticleRenderer.prototype.render=function render(container){var children=container.children;var maxSize=container._maxSize;var batchSize=container._batchSize;var renderer=this.renderer;var totalChildren=children.length;if(totalChildren===0){return}else if(totalChildren>maxSize){totalChildren=maxSize}var buffers=container._glBuffers[renderer.CONTEXT_UID];if(!buffers){buffers=container._glBuffers[renderer.CONTEXT_UID]=this.generateBuffers(container)}var baseTexture=children[0]._texture.baseTexture;this.renderer.setBlendMode(core.utils.correctBlendMode(container.blendMode,baseTexture.premultipliedAlpha));var gl=renderer.gl;var m=container.worldTransform.copy(this.tempMatrix);m.prepend(renderer._activeRenderTarget.projectionMatrix);this.shader.uniforms.projectionMatrix=m.toArray(true);this.shader.uniforms.uColor=core.utils.premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,baseTexture.premultipliedAlpha);this.shader.uniforms.uSampler=renderer.bindTexture(baseTexture);for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;if(amount>batchSize){amount=batchSize}if(j>=buffers.length){if(!container.autoResize){break}buffers.push(this._generateOneMoreBuffer(container))}var buffer=buffers[j];buffer.uploadDynamic(children,i,amount);if(container._bufferToUpdate===j){buffer.uploadStatic(children,i,amount);container._bufferToUpdate=j+1}renderer.bindVao(buffer.vao);buffer.vao.draw(gl.TRIANGLES,amount*6)}};ParticleRenderer.prototype.generateBuffers=function generateBuffers(container){var gl=this.renderer.gl;var buffers=[];var size=container._maxSize;var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;for(var i=0;i<size;i+=batchSize){buffers.push(new _ParticleBuffer2.default(gl,this.properties,dynamicPropertyFlags,batchSize))}return buffers};ParticleRenderer.prototype._generateOneMoreBuffer=function _generateOneMoreBuffer(container){var gl=this.renderer.gl;var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;return new _ParticleBuffer2.default(gl,this.properties,dynamicPropertyFlags,batchSize)};ParticleRenderer.prototype.uploadVertices=function uploadVertices(children,startIndex,amount,array,stride,offset){var w0=0;var w1=0;var h0=0;var h1=0;for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var texture=sprite._texture;var sx=sprite.scale.x;var sy=sprite.scale.y;var trim=texture.trim;var orig=texture.orig;if(trim){w1=trim.x-sprite.anchor.x*orig.width;w0=w1+trim.width;h1=trim.y-sprite.anchor.y*orig.height;h0=h1+trim.height}else{w0=orig.width*(1-sprite.anchor.x);w1=orig.width*-sprite.anchor.x;h0=orig.height*(1-sprite.anchor.y);h1=orig.height*-sprite.anchor.y}array[offset]=w1*sx;array[offset+1]=h1*sy;array[offset+stride]=w0*sx;array[offset+stride+1]=h1*sy;array[offset+stride*2]=w0*sx;array[offset+stride*2+1]=h0*sy;array[offset+stride*3]=w1*sx;array[offset+stride*3+1]=h0*sy;offset+=stride*4}};ParticleRenderer.prototype.uploadPosition=function uploadPosition(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x;array[offset+1]=spritePosition.y;array[offset+stride]=spritePosition.x;array[offset+stride+1]=spritePosition.y;array[offset+stride*2]=spritePosition.x;array[offset+stride*2+1]=spritePosition.y;array[offset+stride*3]=spritePosition.x;array[offset+stride*3+1]=spritePosition.y;offset+=stride*4}};ParticleRenderer.prototype.uploadRotation=function uploadRotation(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation;array[offset+stride]=spriteRotation;array[offset+stride*2]=spriteRotation;array[offset+stride*3]=spriteRotation;offset+=stride*4}};ParticleRenderer.prototype.uploadUvs=function uploadUvs(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;if(textureUvs){array[offset]=textureUvs.x0;array[offset+1]=textureUvs.y0;array[offset+stride]=textureUvs.x1;array[offset+stride+1]=textureUvs.y1;array[offset+stride*2]=textureUvs.x2;array[offset+stride*2+1]=textureUvs.y2;array[offset+stride*3]=textureUvs.x3;array[offset+stride*3+1]=textureUvs.y3;offset+=stride*4}else{array[offset]=0;array[offset+1]=0;array[offset+stride]=0;array[offset+stride+1]=0;array[offset+stride*2]=0;array[offset+stride*2+1]=0;array[offset+stride*3]=0;array[offset+stride*3+1]=0;offset+=stride*4}}};ParticleRenderer.prototype.uploadTint=function uploadTint(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var premultiplied=sprite._texture.baseTexture.premultipliedAlpha;var alpha=sprite.alpha;var argb=alpha<1&&premultiplied?(0,_utils.premultiplyTint)(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);array[offset]=argb;array[offset+stride]=argb;array[offset+stride*2]=argb;array[offset+stride*3]=argb;offset+=stride*4}};ParticleRenderer.prototype.destroy=function destroy(){if(this.renderer.gl){this.renderer.gl.deleteBuffer(this.indexBuffer)}_core$ObjectRenderer.prototype.destroy.call(this);this.shader.destroy();this.indices=null;this.tempMatrix=null};return ParticleRenderer}(core.ObjectRenderer);exports.default=ParticleRenderer;core.WebGLRenderer.registerPlugin("particle",ParticleRenderer)},{"../../core":297,"../../core/utils":357,"./ParticleBuffer":408,"./ParticleShader":410}],410:[function(require,module,exports){"use strict";exports.__esModule=true;var _Shader2=require("../../core/Shader");var _Shader3=_interopRequireDefault(_Shader2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ParticleShader=function(_Shader){_inherits(ParticleShader,_Shader);function ParticleShader(gl){_classCallCheck(this,ParticleShader);return _possibleConstructorReturn(this,_Shader.call(this,gl,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n")))}return ParticleShader}(_Shader3.default);exports.default=ParticleShader},{"../../core/Shader":276}],411:[function(require,module,exports){"use strict";if(!Math.sign){Math.sign=function mathSign(x){x=Number(x);if(x===0||isNaN(x)){return x}return x>0?1:-1}}},{}],412:[function(require,module,exports){"use strict";var _objectAssign=require("object-assign");var _objectAssign2=_interopRequireDefault(_objectAssign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}if(!Object.assign){Object.assign=_objectAssign2.default}},{"object-assign":244}],413:[function(require,module,exports){"use strict";require("./Object.assign");require("./requestAnimationFrame");require("./Math.sign");if(!window.ArrayBuffer){window.ArrayBuffer=Array}if(!window.Float32Array){window.Float32Array=Array}if(!window.Uint32Array){window.Uint32Array=Array}if(!window.Uint16Array){window.Uint16Array=Array}},{"./Math.sign":411,"./Object.assign":412,"./requestAnimationFrame":414}],414:[function(require,module,exports){(function(global){"use strict";var ONE_FRAME_TIME=16;if(!(Date.now&&Date.prototype.getTime)){Date.now=function now(){return(new Date).getTime()}}if(!(global.performance&&global.performance.now)){var startTime=Date.now();if(!global.performance){global.performance={}}global.performance.now=function(){return Date.now()-startTime}}var lastTime=Date.now();var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!global.requestAnimationFrame;++x){var p=vendors[x];global.requestAnimationFrame=global[p+"RequestAnimationFrame"];global.cancelAnimationFrame=global[p+"CancelAnimationFrame"]||global[p+"CancelRequestAnimationFrame"]}if(!global.requestAnimationFrame){global.requestAnimationFrame=function(callback){if(typeof callback!=="function"){throw new TypeError(callback+"is not a function")}var currentTime=Date.now();var delay=ONE_FRAME_TIME+lastTime-currentTime;if(delay<0){delay=0}lastTime=currentTime;return setTimeout(function(){lastTime=Date.now();callback(performance.now())},delay)}}if(!global.cancelAnimationFrame){global.cancelAnimationFrame=function(id){return clearTimeout(id)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],415:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../core");var core=_interopRequireWildcard(_core);var _CountLimiter=require("./limiters/CountLimiter");var _CountLimiter2=_interopRequireDefault(_CountLimiter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SharedTicker=core.ticker.shared;core.settings.UPLOADS_PER_FRAME=4;var BasePrepare=function(){function BasePrepare(renderer){var _this=this;_classCallCheck(this,BasePrepare);this.limiter=new _CountLimiter2.default(core.settings.UPLOADS_PER_FRAME);this.renderer=renderer;this.uploadHookHelper=null;this.queue=[];this.addHooks=[];this.uploadHooks=[];this.completes=[];this.ticking=false;this.delayedTick=function(){if(!_this.queue){return}_this.prepareItems()};this.registerFindHook(findText);this.registerFindHook(findTextStyle);this.registerFindHook(findMultipleBaseTextures);this.registerFindHook(findBaseTexture);this.registerFindHook(findTexture);this.registerUploadHook(drawText);this.registerUploadHook(calculateTextStyle)}BasePrepare.prototype.upload=function upload(item,done){if(typeof item==="function"){done=item;item=null}if(item){this.add(item)}if(this.queue.length){if(done){this.completes.push(done)}if(!this.ticking){this.ticking=true;SharedTicker.addOnce(this.tick,this,core.UPDATE_PRIORITY.UTILITY)}}else if(done){done()}};BasePrepare.prototype.tick=function tick(){setTimeout(this.delayedTick,0)};BasePrepare.prototype.prepareItems=function prepareItems(){this.limiter.beginFrame();while(this.queue.length&&this.limiter.allowedToUpload()){var item=this.queue[0];var uploaded=false;if(item&&!item._destroyed){for(var i=0,len=this.uploadHooks.length;i<len;i++){if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift();uploaded=true;break}}}if(!uploaded){this.queue.shift()}}if(!this.queue.length){this.ticking=false;var completes=this.completes.slice(0);this.completes.length=0;for(var _i=0,_len=completes.length;_i<_len;_i++){completes[_i]()}}else{SharedTicker.addOnce(this.tick,this,core.UPDATE_PRIORITY.UTILITY)}};BasePrepare.prototype.registerFindHook=function registerFindHook(addHook){if(addHook){this.addHooks.push(addHook)}return this};BasePrepare.prototype.registerUploadHook=function registerUploadHook(uploadHook){if(uploadHook){this.uploadHooks.push(uploadHook)}return this};BasePrepare.prototype.add=function add(item){for(var i=0,len=this.addHooks.length;i<len;i++){if(this.addHooks[i](item,this.queue)){break}}if(item instanceof core.Container){for(var _i2=item.children.length-1;_i2>=0;_i2--){this.add(item.children[_i2])}}return this};BasePrepare.prototype.destroy=function destroy(){if(this.ticking){SharedTicker.remove(this.tick,this)}this.ticking=false;this.addHooks=null;this.uploadHooks=null;this.renderer=null;this.completes=null;this.queue=null;this.limiter=null;this.uploadHookHelper=null};return BasePrepare}();exports.default=BasePrepare;function findMultipleBaseTextures(item,queue){var result=false;if(item&&item._textures&&item._textures.length){for(var i=0;i<item._textures.length;i++){if(item._textures[i]instanceof core.Texture){var baseTexture=item._textures[i].baseTexture;if(queue.indexOf(baseTexture)===-1){queue.push(baseTexture);result=true}}}}return result}function findBaseTexture(item,queue){if(item instanceof core.BaseTexture){if(queue.indexOf(item)===-1){queue.push(item)}return true}return false}function findTexture(item,queue){if(item._texture&&item._texture instanceof core.Texture){var texture=item._texture.baseTexture;if(queue.indexOf(texture)===-1){queue.push(texture)}return true}return false}function drawText(helper,item){if(item instanceof core.Text){item.updateText(true);return true}return false}function calculateTextStyle(helper,item){if(item instanceof core.TextStyle){var font=item.toFontString();core.TextMetrics.measureFont(font);return true}return false}function findText(item,queue){if(item instanceof core.Text){if(queue.indexOf(item.style)===-1){queue.push(item.style)}if(queue.indexOf(item)===-1){queue.push(item)}var texture=item._texture.baseTexture;if(queue.indexOf(texture)===-1){queue.push(texture)}return true}return false}function findTextStyle(item,queue){if(item instanceof core.TextStyle){if(queue.indexOf(item)===-1){queue.push(item)}return true}return false}},{"../core":297,"./limiters/CountLimiter":418}],416:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _BasePrepare2=require("../BasePrepare");var _BasePrepare3=_interopRequireDefault(_BasePrepare2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CANVAS_START_SIZE=16;var CanvasPrepare=function(_BasePrepare){_inherits(CanvasPrepare,_BasePrepare);function CanvasPrepare(renderer){_classCallCheck(this,CanvasPrepare);var _this=_possibleConstructorReturn(this,_BasePrepare.call(this,renderer));_this.uploadHookHelper=_this;_this.canvas=document.createElement("canvas");_this.canvas.width=CANVAS_START_SIZE;_this.canvas.height=CANVAS_START_SIZE;_this.ctx=_this.canvas.getContext("2d");_this.registerUploadHook(uploadBaseTextures);return _this}CanvasPrepare.prototype.destroy=function destroy(){_BasePrepare.prototype.destroy.call(this);this.ctx=null;this.canvas=null};return CanvasPrepare}(_BasePrepare3.default);exports.default=CanvasPrepare;function uploadBaseTextures(prepare,item){if(item instanceof core.BaseTexture){var image=item.source;var imageWidth=image.width===0?prepare.canvas.width:Math.min(prepare.canvas.width,image.width);var imageHeight=image.height===0?prepare.canvas.height:Math.min(prepare.canvas.height,image.height);prepare.ctx.drawImage(image,0,0,imageWidth,imageHeight,0,0,prepare.canvas.width,prepare.canvas.height);return true}return false}core.CanvasRenderer.registerPlugin("prepare",CanvasPrepare)},{"../../core":297,"../BasePrepare":415}],417:[function(require,module,exports){"use strict";exports.__esModule=true;var _WebGLPrepare=require("./webgl/WebGLPrepare");Object.defineProperty(exports,"webgl",{enumerable:true,get:function get(){return _interopRequireDefault(_WebGLPrepare).default}});var _CanvasPrepare=require("./canvas/CanvasPrepare");Object.defineProperty(exports,"canvas",{enumerable:true,get:function get(){return _interopRequireDefault(_CanvasPrepare).default}});var _BasePrepare=require("./BasePrepare");Object.defineProperty(exports,"BasePrepare",{enumerable:true,get:function get(){return _interopRequireDefault(_BasePrepare).default}});var _CountLimiter=require("./limiters/CountLimiter");Object.defineProperty(exports,"CountLimiter",{enumerable:true,get:function get(){return _interopRequireDefault(_CountLimiter).default}});var _TimeLimiter=require("./limiters/TimeLimiter");Object.defineProperty(exports,"TimeLimiter",{enumerable:true,get:function get(){return _interopRequireDefault(_TimeLimiter).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./BasePrepare":415,"./canvas/CanvasPrepare":416,"./limiters/CountLimiter":418,"./limiters/TimeLimiter":419,"./webgl/WebGLPrepare":420}],418:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CountLimiter=function(){function CountLimiter(maxItemsPerFrame){_classCallCheck(this,CountLimiter);this.maxItemsPerFrame=maxItemsPerFrame;this.itemsLeft=0}CountLimiter.prototype.beginFrame=function beginFrame(){this.itemsLeft=this.maxItemsPerFrame};CountLimiter.prototype.allowedToUpload=function allowedToUpload(){return this.itemsLeft-- >0};return CountLimiter}();exports.default=CountLimiter},{}],419:[function(require,module,exports){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TimeLimiter=function(){function TimeLimiter(maxMilliseconds){_classCallCheck(this,TimeLimiter);this.maxMilliseconds=maxMilliseconds;this.frameStart=0}TimeLimiter.prototype.beginFrame=function beginFrame(){this.frameStart=Date.now()};TimeLimiter.prototype.allowedToUpload=function allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds};return TimeLimiter}();exports.default=TimeLimiter},{}],420:[function(require,module,exports){"use strict";exports.__esModule=true;var _core=require("../../core");var core=_interopRequireWildcard(_core);var _BasePrepare2=require("../BasePrepare");var _BasePrepare3=_interopRequireDefault(_BasePrepare2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WebGLPrepare=function(_BasePrepare){_inherits(WebGLPrepare,_BasePrepare);function WebGLPrepare(renderer){_classCallCheck(this,WebGLPrepare);var _this=_possibleConstructorReturn(this,_BasePrepare.call(this,renderer));_this.uploadHookHelper=_this.renderer;_this.registerFindHook(findGraphics);_this.registerUploadHook(uploadBaseTextures);_this.registerUploadHook(uploadGraphics);return _this}return WebGLPrepare}(_BasePrepare3.default);exports.default=WebGLPrepare;function uploadBaseTextures(renderer,item){if(item instanceof core.BaseTexture){if(!item._glTextures[renderer.CONTEXT_UID]){renderer.textureManager.updateTexture(item)}return true}return false}function uploadGraphics(renderer,item){if(item instanceof core.Graphics){if(item.dirty||item.clearDirty||!item._webGL[renderer.plugins.graphics.CONTEXT_UID]){renderer.plugins.graphics.updateGraphics(item)}return true}return false}function findGraphics(item,queue){if(item instanceof core.Graphics){queue.push(item);return true}return false}core.WebGLRenderer.registerPlugin("prepare",WebGLPrepare)},{"../../core":297,"../BasePrepare":415}],421:[function(require,module,exports){module.exports=plucker;function plucker(path,object){return arguments.length>=2?pluck(path)(object):pluck(path)}function pluck(path){path=typeof path==="string"?String(path).trim().split("."):path;if(path.length<2){path=path[0];return pluckSingle}else{var l=path.length;return pluckPath}function pluckSingle(object){return object[path]}function pluckPath(object){for(var i=0;i<l;i++){if(typeof object==="undefined")break;object=object[path[i]]}return object}}},{}],422:[function(require,module,exports){module.exports=prettierBytes;function prettierBytes(num){if(typeof num!=="number"||isNaN(num)){throw new TypeError("Expected a number, got "+typeof num)}var neg=num<0;var units=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(neg){num=-num}if(num<1){return(neg?"-":"")+num+" B"}var exponent=Math.min(Math.floor(Math.log(num)/Math.log(1e3)),units.length-1);num=Number(num/Math.pow(1e3,exponent));var unit=units[exponent];if(num>=10||num%1===0){return(neg?"-":"")+num.toFixed(0)+" "+unit}else{return(neg?"-":"")+num.toFixed(1)+" "+unit}}},{}],423:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],424:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.observable=factory()})(this,function(){"use strict";class PubSub{constructor(){this.fns={any:[]}}has(e){return e in this.fns&&this.fns[e].length>0||this.fns.any.length>0}on(e,fn){if(e in this.fns===false){this.fns[e]=[]}this.fns[e].push(fn);return fn}fire(e,value,prev){this.fns.any.concat(e in this.fns?this.fns[e]:[]).forEach(fn=>fn(value,prev,e));return this}off(fn){for(const e in this.fns){const fns=this.fns[e];for(let i=0;i<fns.length;i++){if(fns[i]===fn){fns.splice(i,1);return true}}}return false}once(e,fn){const method=(value,prev,prop)=>{fn(value,prev,prop);this.off(method)};this.on(e,method);return fn}}var observable=target=>{if(target.on&&target.off){return target}const pub=new PubSub;const observable=new Proxy(target,{get:(target,prop)=>{if(prop in target){if(target.constructor===Array){let v=observable;if(prop==="pop"){v=target[target.length-1]}else if(prop==="shift"){v=target[0]}if(prop!=="push"&&prop!=="length"){pub.fire(prop,v)}}return target[prop]}else if(prop==="on"){return pub.on.bind(pub)}else if(prop==="once"){return pub.once.bind(pub)}else if(prop==="off"){return pub.off.bind(pub)}return undefined},set:(target,prop,v)=>{if(target.constructor===Array){if(prop!=="length"){pub.fire("change",v)}}else if(pub.has(prop)){pub.fire(prop,v,target[prop])}target[prop]=v;return true}});return observable};return observable})},{}],425:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=="object"&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],426:[function(require,module,exports){"use strict";var strictUriEncode=require("strict-uri-encode");var objectAssign=require("object-assign");var decodeComponent=require("decode-uri-component");function encoderForArrayFormat(opts){switch(opts.arrayFormat){case"index":return function(key,value,index){return value===null?[encode(key,opts),"[",index,"]"].join(""):[encode(key,opts),"[",encode(index,opts),"]=",encode(value,opts)].join("")};case"bracket":return function(key,value){return value===null?encode(key,opts):[encode(key,opts),"[]=",encode(value,opts)].join("")};default:return function(key,value){return value===null?encode(key,opts):[encode(key,opts),"=",encode(value,opts)].join("")}}}function parserForArrayFormat(opts){var result;switch(opts.arrayFormat){case"index":return function(key,value,accumulator){result=/\[(\d*)\]$/.exec(key);key=key.replace(/\[\d*\]$/,"");if(!result){accumulator[key]=value;return}if(accumulator[key]===undefined){accumulator[key]={}}accumulator[key][result[1]]=value};case"bracket":return function(key,value,accumulator){result=/(\[\])$/.exec(key);key=key.replace(/\[\]$/,"");if(!result){accumulator[key]=value;return}else if(accumulator[key]===undefined){accumulator[key]=[value];return}accumulator[key]=[].concat(accumulator[key],value)};default:return function(key,value,accumulator){if(accumulator[key]===undefined){accumulator[key]=value;return}accumulator[key]=[].concat(accumulator[key],value)}}}function encode(value,opts){if(opts.encode){return opts.strict?strictUriEncode(value):encodeURIComponent(value)}return value}function keysSorter(input){if(Array.isArray(input)){return input.sort()}else if(typeof input==="object"){return keysSorter(Object.keys(input)).sort(function(a,b){return Number(a)-Number(b)}).map(function(key){return input[key]})}return input}exports.extract=function(str){var queryStart=str.indexOf("?");if(queryStart===-1){return""}return str.slice(queryStart+1)};exports.parse=function(str,opts){opts=objectAssign({arrayFormat:"none"},opts);var formatter=parserForArrayFormat(opts);var ret=Object.create(null);if(typeof str!=="string"){return ret}str=str.trim().replace(/^[?#&]/,"");if(!str){return ret}str.split("&").forEach(function(param){var parts=param.replace(/\+/g," ").split("=");var key=parts.shift();var val=parts.length>0?parts.join("="):undefined;val=val===undefined?null:decodeComponent(val);formatter(decodeComponent(key),val,ret)});return Object.keys(ret).sort().reduce(function(result,key){var val=ret[key];if(Boolean(val)&&typeof val==="object"&&!Array.isArray(val)){result[key]=keysSorter(val)}else{result[key]=val}return result},Object.create(null))};exports.stringify=function(obj,opts){var defaults={encode:true,strict:true,arrayFormat:"none"};opts=objectAssign(defaults,opts);var formatter=encoderForArrayFormat(opts);return obj?Object.keys(obj).sort().map(function(key){var val=obj[key];if(val===undefined){return""}if(val===null){return encode(key,opts)}if(Array.isArray(val)){var result=[];val.slice().forEach(function(val2){if(val2===undefined){return}result.push(formatter(key,val2,result.length))});return result.join("&")}return encode(key,opts)+"="+encode(val,opts)}).filter(function(x){return x.length>0}).join("&"):""}},{"decode-uri-component":154,"object-assign":244,"strict-uri-encode":541}],427:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],428:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],429:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":427,"./encode":428}],430:[function(require,module,exports){var inherits=require("inherits");var EventEmitter=require("events").EventEmitter;var now=require("right-now");var raf=require("raf");module.exports=Engine;function Engine(fn){if(!(this instanceof Engine))return new Engine(fn);this.running=false;this.last=now();this._frame=0;this._tick=this.tick.bind(this);if(fn)this.on("tick",fn)}inherits(Engine,EventEmitter);Engine.prototype.start=function(){if(this.running)return;this.running=true;this.last=now();this._frame=raf(this._tick);return this};Engine.prototype.stop=function(){this.running=false;if(this._frame!==0)raf.cancel(this._frame);this._frame=0;return this};Engine.prototype.tick=function(){this._frame=raf(this._tick);var time=now();var dt=time-this.last;this.emit("tick",dt);this.last=time}},{events:173,inherits:218,raf:431,"right-now":441}],431:[function(require,module,exports){(function(global){var now=require("performance-now"),root=typeof window==="undefined"?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf&&i<vendors.length;i++){raf=root[vendors[i]+"Request"+suffix];caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix]}if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(callback){if(queue.length===0){var _now=now(),next=Math.max(0,frameDuration-(_now-last));last=next+_now;setTimeout(function(){var cp=queue.slice(0);queue.length=0;for(var i=0;i<cp.length;i++){if(!cp[i].cancelled){try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}}}},Math.round(next))}queue.push({handle:++id,callback:callback,cancelled:false});return id};caf=function(handle){for(var i=0;i<queue.length;i++){if(queue[i].handle===handle){queue[i].cancelled=true}}}}module.exports=function(fn){return raf.call(root,fn)};module.exports.cancel=function(){caf.apply(root,arguments)};module.exports.polyfill=function(object){if(!object){object=root}object.requestAnimationFrame=raf;object.cancelAnimationFrame=caf}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"performance-now":432}],432:[function(require,module,exports){(function(process){(function(){var getNanoSeconds,hrtime,loadTime,moduleLoadTime,nodeLoadTime,upTime;if(typeof performance!=="undefined"&&performance!==null&&performance.now){module.exports=function(){return performance.now()}}else if(typeof process!=="undefined"&&process!==null&&process.hrtime){module.exports=function(){return(getNanoSeconds()-nodeLoadTime)/1e6};hrtime=process.hrtime;getNanoSeconds=function(){var hr;hr=hrtime();return hr[0]*1e9+hr[1]};moduleLoadTime=getNanoSeconds();upTime=process.uptime()*1e9;nodeLoadTime=moduleLoadTime-upTime}else if(Date.now){module.exports=function(){return Date.now()-loadTime};loadTime=Date.now()}else{module.exports=function(){return(new Date).getTime()-loadTime};loadTime=(new Date).getTime()}}).call(this)}).call(this,require("_process"))},{_process:423}],433:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.createREGL=factory()})(this,function(){"use strict";var arrayTypes={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};var isTypedArray=function(x){return Object.prototype.toString.call(x)in arrayTypes};var extend=function(base,opts){var keys=Object.keys(opts);for(var i=0;i<keys.length;++i){base[keys[i]]=opts[keys[i]]}return base};function decodeB64(str){if(typeof btoa!=="undefined"){return btoa(str)}return"base64:"+str}function raise(message){var error=new Error("(regl) "+message);console.error(error);throw error}function check(pred,message){if(!pred){raise(message)}}function encolon(message){if(message){return": "+message}return""}function checkParameter(param,possibilities,message){if(!(param in possibilities)){raise("unknown parameter ("+param+")"+encolon(message)+". possible values: "+Object.keys(possibilities).join())}}function checkIsTypedArray(data,message){if(!isTypedArray(data)){raise("invalid parameter type"+encolon(message)+". must be a typed array")}}function checkTypeOf(value,type,message){if(typeof value!==type){raise("invalid parameter type"+encolon(message)+". expected "+type+", got "+typeof value)}}function checkNonNegativeInt(value,message){if(!(value>=0&&(value|0)===value)){raise("invalid parameter type, ("+value+")"+encolon(message)+". must be a nonnegative integer")}}function checkOneOf(value,list,message){if(list.indexOf(value)<0){raise("invalid value"+encolon(message)+". must be one of: "+list)}}var constructorKeys=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function checkConstructor(obj){Object.keys(obj).forEach(function(key){if(constructorKeys.indexOf(key)<0){raise('invalid regl constructor argument "'+key+'". must be one of '+constructorKeys)}})}function leftPad(str,n){str=str+"";while(str.length<n){str=" "+str}return str}function ShaderFile(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=false}function ShaderLine(number,line){this.number=number;this.line=line;this.errors=[]}function ShaderError(fileNumber,lineNumber,message){this.file=fileNumber;this.line=lineNumber;this.message=message}function guessCommand(){var error=new Error;var stack=(error.stack||error).toString();var pat=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(stack);if(pat){return pat[1]}var pat2=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(stack);if(pat2){return pat2[1]}return"unknown"}function guessCallSite(){var error=new Error;var stack=(error.stack||error).toString();var pat=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(stack);if(pat){return pat[1]}var pat2=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(stack);if(pat2){return pat2[1]}return"unknown"}function parseSource(source,command){var lines=source.split("\n");var lineNumber=1;var fileNumber=0;var files={unknown:new ShaderFile,0:new ShaderFile};files.unknown.name=files[0].name=command||guessCommand();files.unknown.lines.push(new ShaderLine(0,""));for(var i=0;i<lines.length;++i){var line=lines[i];var parts=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(line);if(parts){switch(parts[1]){case"line":var lineNumberInfo=/(\d+)(\s+\d+)?/.exec(parts[2]);if(lineNumberInfo){lineNumber=lineNumberInfo[1]|0;if(lineNumberInfo[2]){fileNumber=lineNumberInfo[2]|0;if(!(fileNumber in files)){files[fileNumber]=new ShaderFile}}}break;case"define":var nameInfo=/SHADER_NAME(_B64)?\s+(.*)$/.exec(parts[2]);if(nameInfo){files[fileNumber].name=nameInfo[1]?decodeB64(nameInfo[2]):nameInfo[2]}break}}files[fileNumber].lines.push(new ShaderLine(lineNumber++,line))}Object.keys(files).forEach(function(fileNumber){var file=files[fileNumber];file.lines.forEach(function(line){file.index[line.number]=line})});return files}function parseErrorLog(errLog){var result=[];errLog.split("\n").forEach(function(errMsg){if(errMsg.length<5){return}var parts=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(errMsg);if(parts){result.push(new ShaderError(parts[1]|0,parts[2]|0,parts[3].trim()))}else if(errMsg.length>0){result.push(new ShaderError("unknown",0,errMsg))}});return result}function annotateFiles(files,errors){errors.forEach(function(error){var file=files[error.file];if(file){var line=file.index[error.line];if(line){line.errors.push(error);file.hasErrors=true;return}}files.unknown.hasErrors=true;files.unknown.lines[0].errors.push(error)})}function checkShaderError(gl,shader,source,type,command){if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var errLog=gl.getShaderInfoLog(shader);var typeName=type===gl.FRAGMENT_SHADER?"fragment":"vertex";checkCommandType(source,"string",typeName+" shader source must be a string",command);var files=parseSource(source,command);var errors=parseErrorLog(errLog);annotateFiles(files,errors);Object.keys(files).forEach(function(fileNumber){var file=files[fileNumber];if(!file.hasErrors){return}var strings=[""];var styles=[""];function push(str,style){strings.push(str);styles.push(style||"")}push("file number "+fileNumber+": "+file.name+"\n","color:red;text-decoration:underline;font-weight:bold");file.lines.forEach(function(line){if(line.errors.length>0){push(leftPad(line.number,4)+"|  ","background-color:yellow; font-weight:bold");push(line.line+"\n","color:red; background-color:yellow; font-weight:bold");var offset=0;line.errors.forEach(function(error){var message=error.message;var token=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(message);if(token){var tokenPat=token[1];message=token[2];switch(tokenPat){case"assign":tokenPat="=";break}offset=Math.max(line.line.indexOf(tokenPat,offset),0)}else{offset=0}push(leftPad("| ",6));push(leftPad("^^^",offset+3)+"\n","font-weight:bold");push(leftPad("| ",6));push(message+"\n","font-weight:bold")});push(leftPad("| ",6)+"\n")}else{push(leftPad(line.number,4)+"|  ");push(line.line+"\n","color:red")}});if(typeof document!=="undefined"){styles[0]=strings.join("%c");console.log.apply(console,styles)}else{console.log(strings.join(""))}});check.raise("Error compiling "+typeName+" shader, "+files[0].name)}}function checkLinkError(gl,program,fragShader,vertShader,command){if(!gl.getProgramParameter(program,gl.LINK_STATUS)){var errLog=gl.getProgramInfoLog(program);var fragParse=parseSource(fragShader,command);var vertParse=parseSource(vertShader,command);var header='Error linking program with vertex shader, "'+vertParse[0].name+'", and fragment shader "'+fragParse[0].name+'"';if(typeof document!=="undefined"){console.log("%c"+header+"\n%c"+errLog,"color:red;text-decoration:underline;font-weight:bold","color:red")}else{console.log(header+"\n"+errLog)}check.raise(header)}}function saveCommandRef(object){object._commandRef=guessCommand()}function saveDrawCommandInfo(opts,uniforms,attributes,stringStore){saveCommandRef(opts);function id(str){if(str){return stringStore.id(str)}return 0}opts._fragId=id(opts.static.frag);opts._vertId=id(opts.static.vert);function addProps(dict,set){Object.keys(set).forEach(function(u){dict[stringStore.id(u)]=true})}var uniformSet=opts._uniformSet={};addProps(uniformSet,uniforms.static);addProps(uniformSet,uniforms.dynamic);var attributeSet=opts._attributeSet={};addProps(attributeSet,attributes.static);addProps(attributeSet,attributes.dynamic);opts._hasCount="count"in opts.static||"count"in opts.dynamic||"elements"in opts.static||"elements"in opts.dynamic}function commandRaise(message,command){var callSite=guessCallSite();raise(message+" in command "+(command||guessCommand())+(callSite==="unknown"?"":" called from "+callSite))}function checkCommand(pred,message,command){if(!pred){commandRaise(message,command||guessCommand())}}function checkParameterCommand(param,possibilities,message,command){if(!(param in possibilities)){commandRaise("unknown parameter ("+param+")"+encolon(message)+". possible values: "+Object.keys(possibilities).join(),command||guessCommand())}}function checkCommandType(value,type,message,command){if(typeof value!==type){commandRaise("invalid parameter type"+encolon(message)+". expected "+type+", got "+typeof value,command||guessCommand())}}function checkOptional(block){block()}function checkFramebufferFormat(attachment,texFormats,rbFormats){if(attachment.texture){checkOneOf(attachment.texture._texture.internalformat,texFormats,"unsupported texture format for attachment")}else{checkOneOf(attachment.renderbuffer._renderbuffer.format,rbFormats,"unsupported renderbuffer format for attachment")}}var GL_CLAMP_TO_EDGE=33071;var GL_NEAREST=9728;var GL_NEAREST_MIPMAP_NEAREST=9984;var GL_LINEAR_MIPMAP_NEAREST=9985;var GL_NEAREST_MIPMAP_LINEAR=9986;var GL_LINEAR_MIPMAP_LINEAR=9987;var GL_BYTE=5120;var GL_UNSIGNED_BYTE=5121;var GL_SHORT=5122;var GL_UNSIGNED_SHORT=5123;var GL_INT=5124;var GL_UNSIGNED_INT=5125;var GL_FLOAT=5126;var GL_UNSIGNED_SHORT_4_4_4_4=32819;var GL_UNSIGNED_SHORT_5_5_5_1=32820;var GL_UNSIGNED_SHORT_5_6_5=33635;var GL_UNSIGNED_INT_24_8_WEBGL=34042;var GL_HALF_FLOAT_OES=36193;var TYPE_SIZE={};TYPE_SIZE[GL_BYTE]=TYPE_SIZE[GL_UNSIGNED_BYTE]=1;TYPE_SIZE[GL_SHORT]=TYPE_SIZE[GL_UNSIGNED_SHORT]=TYPE_SIZE[GL_HALF_FLOAT_OES]=TYPE_SIZE[GL_UNSIGNED_SHORT_5_6_5]=TYPE_SIZE[GL_UNSIGNED_SHORT_4_4_4_4]=TYPE_SIZE[GL_UNSIGNED_SHORT_5_5_5_1]=2;TYPE_SIZE[GL_INT]=TYPE_SIZE[GL_UNSIGNED_INT]=TYPE_SIZE[GL_FLOAT]=TYPE_SIZE[GL_UNSIGNED_INT_24_8_WEBGL]=4;function pixelSize(type,channels){if(type===GL_UNSIGNED_SHORT_5_5_5_1||type===GL_UNSIGNED_SHORT_4_4_4_4||type===GL_UNSIGNED_SHORT_5_6_5){return 2}else if(type===GL_UNSIGNED_INT_24_8_WEBGL){return 4}else{return TYPE_SIZE[type]*channels}}function isPow2(v){return!(v&v-1)&&!!v}function checkTexture2D(info,mipData,limits){var i;var w=mipData.width;var h=mipData.height;var c=mipData.channels;check(w>0&&w<=limits.maxTextureSize&&h>0&&h<=limits.maxTextureSize,"invalid texture shape");if(info.wrapS!==GL_CLAMP_TO_EDGE||info.wrapT!==GL_CLAMP_TO_EDGE){check(isPow2(w)&&isPow2(h),"incompatible wrap mode for texture, both width and height must be power of 2")}if(mipData.mipmask===1){if(w!==1&&h!==1){check(info.minFilter!==GL_NEAREST_MIPMAP_NEAREST&&info.minFilter!==GL_NEAREST_MIPMAP_LINEAR&&info.minFilter!==GL_LINEAR_MIPMAP_NEAREST&&info.minFilter!==GL_LINEAR_MIPMAP_LINEAR,"min filter requires mipmap")}}else{check(isPow2(w)&&isPow2(h),"texture must be a square power of 2 to support mipmapping");check(mipData.mipmask===(w<<1)-1,"missing or incomplete mipmap data")}if(mipData.type===GL_FLOAT){if(limits.extensions.indexOf("oes_texture_float_linear")<0){check(info.minFilter===GL_NEAREST&&info.magFilter===GL_NEAREST,"filter not supported, must enable oes_texture_float_linear")}check(!info.genMipmaps,"mipmap generation not supported with float textures")}var mipimages=mipData.images;for(i=0;i<16;++i){if(mipimages[i]){var mw=w>>i;var mh=h>>i;check(mipData.mipmask&1<<i,"missing mipmap data");var img=mipimages[i];check(img.width===mw&&img.height===mh,"invalid shape for mip images");check(img.format===mipData.format&&img.internalformat===mipData.internalformat&&img.type===mipData.type,"incompatible type for mip image");if(img.compressed){}else if(img.data){var rowSize=Math.ceil(pixelSize(img.type,c)*mw/img.unpackAlignment)*img.unpackAlignment;check(img.data.byteLength===rowSize*mh,"invalid data for image, buffer size is inconsistent with image format")}else if(img.element){}else if(img.copy){}}else if(!info.genMipmaps){check((mipData.mipmask&1<<i)===0,"extra mipmap data")}}if(mipData.compressed){check(!info.genMipmaps,"mipmap generation for compressed images not supported")}}function checkTextureCube(texture,info,faces,limits){var w=texture.width;var h=texture.height;var c=texture.channels;check(w>0&&w<=limits.maxTextureSize&&h>0&&h<=limits.maxTextureSize,"invalid texture shape");check(w===h,"cube map must be square");check(info.wrapS===GL_CLAMP_TO_EDGE&&info.wrapT===GL_CLAMP_TO_EDGE,"wrap mode not supported by cube map");for(var i=0;i<faces.length;++i){var face=faces[i];check(face.width===w&&face.height===h,"inconsistent cube map face shape");if(info.genMipmaps){check(!face.compressed,"can not generate mipmap for compressed textures");check(face.mipmask===1,"can not specify mipmaps and generate mipmaps")}else{}var mipmaps=face.images;for(var j=0;j<16;++j){var img=mipmaps[j];if(img){var mw=w>>j;var mh=h>>j;check(face.mipmask&1<<j,"missing mipmap data");check(img.width===mw&&img.height===mh,"invalid shape for mip images");check(img.format===texture.format&&img.internalformat===texture.internalformat&&img.type===texture.type,"incompatible type for mip image");if(img.compressed){}else if(img.data){check(img.data.byteLength===mw*mh*Math.max(pixelSize(img.type,c),img.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else if(img.element){}else if(img.copy){}}}}}var check$1=extend(check,{optional:checkOptional,raise:raise,commandRaise:commandRaise,command:checkCommand,parameter:checkParameter,commandParameter:checkParameterCommand,constructor:checkConstructor,type:checkTypeOf,commandType:checkCommandType,isTypedArray:checkIsTypedArray,nni:checkNonNegativeInt,oneOf:checkOneOf,shaderError:checkShaderError,linkError:checkLinkError,callSite:guessCallSite,saveCommandRef:saveCommandRef,saveDrawInfo:saveDrawCommandInfo,framebufferFormat:checkFramebufferFormat,guessCommand:guessCommand,texture2D:checkTexture2D,textureCube:checkTextureCube});var VARIABLE_COUNTER=0;var DYN_FUNC=0;function DynamicVariable(type,data){this.id=VARIABLE_COUNTER++;this.type=type;this.data=data}function escapeStr(str){return str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function splitParts(str){if(str.length===0){return[]}var firstChar=str.charAt(0);var lastChar=str.charAt(str.length-1);if(str.length>1&&firstChar===lastChar&&(firstChar==='"'||firstChar==="'")){return['"'+escapeStr(str.substr(1,str.length-2))+'"']}var parts=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(str);if(parts){return splitParts(str.substr(0,parts.index)).concat(splitParts(parts[1])).concat(splitParts(str.substr(parts.index+parts[0].length)))}var subparts=str.split(".");if(subparts.length===1){return['"'+escapeStr(str)+'"']}var result=[];for(var i=0;i<subparts.length;++i){result=result.concat(splitParts(subparts[i]))}return result}function toAccessorString(str){return"["+splitParts(str).join("][")+"]"}function defineDynamic(type,data){return new DynamicVariable(type,toAccessorString(data+""))}function isDynamic(x){return typeof x==="function"&&!x._reglType||x instanceof DynamicVariable}function unbox(x,path){if(typeof x==="function"){return new DynamicVariable(DYN_FUNC,x)}return x}var dynamic={DynamicVariable:DynamicVariable,define:defineDynamic,isDynamic:isDynamic,unbox:unbox,accessor:toAccessorString};var raf={next:typeof requestAnimationFrame==="function"?function(cb){return requestAnimationFrame(cb)}:function(cb){return setTimeout(cb,16)},cancel:typeof cancelAnimationFrame==="function"?function(raf){return cancelAnimationFrame(raf)}:clearTimeout};var clock=typeof performance!=="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function createStringStore(){var stringIds={"":0};var stringValues=[""];return{id:function(str){var result=stringIds[str];if(result){return result}result=stringIds[str]=stringValues.length;stringValues.push(str);return result},str:function(id){return stringValues[id]}}}function createCanvas(element,onDone,pixelRatio){var canvas=document.createElement("canvas");extend(canvas.style,{border:0,margin:0,padding:0,top:0,left:0});element.appendChild(canvas);if(element===document.body){canvas.style.position="absolute";extend(element.style,{margin:0,padding:0})}function resize(){var w=window.innerWidth;var h=window.innerHeight;if(element!==document.body){var bounds=element.getBoundingClientRect();w=bounds.right-bounds.left;h=bounds.bottom-bounds.top}canvas.width=pixelRatio*w;canvas.height=pixelRatio*h;extend(canvas.style,{width:w+"px",height:h+"px"})}window.addEventListener("resize",resize,false);function onDestroy(){window.removeEventListener("resize",resize);element.removeChild(canvas)}resize();return{canvas:canvas,onDestroy:onDestroy}}function createContext(canvas,contexAttributes){function get(name){try{return canvas.getContext(name,contexAttributes)}catch(e){return null}}return get("webgl")||get("experimental-webgl")||get("webgl-experimental")}function isHTMLElement(obj){return typeof obj.nodeName==="string"&&typeof obj.appendChild==="function"&&typeof obj.getBoundingClientRect==="function"}function isWebGLContext(obj){return typeof obj.drawArrays==="function"||typeof obj.drawElements==="function"}function parseExtensions(input){if(typeof input==="string"){return input.split()}check$1(Array.isArray(input),"invalid extension array");return input}function getElement(desc){if(typeof desc==="string"){check$1(typeof document!=="undefined","not supported outside of DOM");return document.querySelector(desc)}return desc}function parseArgs(args_){var args=args_||{};var element,container,canvas,gl;var contextAttributes={};var extensions=[];var optionalExtensions=[];var pixelRatio=typeof window==="undefined"?1:window.devicePixelRatio;var profile=false;var onDone=function(err){if(err){check$1.raise(err)}};var onDestroy=function(){};if(typeof args==="string"){check$1(typeof document!=="undefined","selector queries only supported in DOM enviroments");element=document.querySelector(args);check$1(element,"invalid query string for element")}else if(typeof args==="object"){if(isHTMLElement(args)){element=args}else if(isWebGLContext(args)){gl=args;canvas=gl.canvas}else{check$1.constructor(args);if("gl"in args){gl=args.gl}else if("canvas"in args){canvas=getElement(args.canvas)}else if("container"in args){container=getElement(args.container)}if("attributes"in args){contextAttributes=args.attributes;check$1.type(contextAttributes,"object","invalid context attributes")}if("extensions"in args){extensions=parseExtensions(args.extensions)}if("optionalExtensions"in args){optionalExtensions=parseExtensions(args.optionalExtensions)}if("onDone"in args){check$1.type(args.onDone,"function","invalid or missing onDone callback");onDone=args.onDone}if("profile"in args){profile=!!args.profile}if("pixelRatio"in args){pixelRatio=+args.pixelRatio;check$1(pixelRatio>0,"invalid pixel ratio")}}}else{check$1.raise("invalid arguments to regl")}if(element){if(element.nodeName.toLowerCase()==="canvas"){canvas=element}else{container=element}}if(!gl){if(!canvas){check$1(typeof document!=="undefined","must manually specify webgl context outside of DOM environments");var result=createCanvas(container||document.body,onDone,pixelRatio);if(!result){return null}canvas=result.canvas;onDestroy=result.onDestroy}gl=createContext(canvas,contextAttributes)}if(!gl){onDestroy();onDone("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org");return null}return{gl:gl,canvas:canvas,container:container,extensions:extensions,optionalExtensions:optionalExtensions,pixelRatio:pixelRatio,profile:profile,onDone:onDone,onDestroy:onDestroy}}function createExtensionCache(gl,config){var extensions={};function tryLoadExtension(name_){check$1.type(name_,"string","extension name must be string");var name=name_.toLowerCase();var ext;try{ext=extensions[name]=gl.getExtension(name)}catch(e){}return!!ext}for(var i=0;i<config.extensions.length;++i){var name=config.extensions[i];if(!tryLoadExtension(name)){config.onDestroy();config.onDone('"'+name+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser');return null}}config.optionalExtensions.forEach(tryLoadExtension);return{extensions:extensions,restore:function(){Object.keys(extensions).forEach(function(name){if(!tryLoadExtension(name)){throw new Error("(regl): error restoring extension "+name)}})}}}var GL_SUBPIXEL_BITS=3408;var GL_RED_BITS=3410;var GL_GREEN_BITS=3411;var GL_BLUE_BITS=3412;var GL_ALPHA_BITS=3413;var GL_DEPTH_BITS=3414;var GL_STENCIL_BITS=3415;var GL_ALIASED_POINT_SIZE_RANGE=33901;var GL_ALIASED_LINE_WIDTH_RANGE=33902;var GL_MAX_TEXTURE_SIZE=3379;var GL_MAX_VIEWPORT_DIMS=3386;var GL_MAX_VERTEX_ATTRIBS=34921;var GL_MAX_VERTEX_UNIFORM_VECTORS=36347;var GL_MAX_VARYING_VECTORS=36348;var GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;var GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;var GL_MAX_TEXTURE_IMAGE_UNITS=34930;var GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349;var GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076;var GL_MAX_RENDERBUFFER_SIZE=34024;var GL_VENDOR=7936;var GL_RENDERER=7937;var GL_VERSION=7938;var GL_SHADING_LANGUAGE_VERSION=35724;var GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047;var GL_MAX_COLOR_ATTACHMENTS_WEBGL=36063;var GL_MAX_DRAW_BUFFERS_WEBGL=34852;var wrapLimits=function(gl,extensions){var maxAnisotropic=1;if(extensions.ext_texture_filter_anisotropic){maxAnisotropic=gl.getParameter(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT)}var maxDrawbuffers=1;var maxColorAttachments=1;if(extensions.webgl_draw_buffers){maxDrawbuffers=gl.getParameter(GL_MAX_DRAW_BUFFERS_WEBGL);maxColorAttachments=gl.getParameter(GL_MAX_COLOR_ATTACHMENTS_WEBGL)}return{colorBits:[gl.getParameter(GL_RED_BITS),gl.getParameter(GL_GREEN_BITS),gl.getParameter(GL_BLUE_BITS),gl.getParameter(GL_ALPHA_BITS)],depthBits:gl.getParameter(GL_DEPTH_BITS),stencilBits:gl.getParameter(GL_STENCIL_BITS),subpixelBits:gl.getParameter(GL_SUBPIXEL_BITS),extensions:Object.keys(extensions).filter(function(ext){return!!extensions[ext]}),maxAnisotropic:maxAnisotropic,maxDrawbuffers:maxDrawbuffers,maxColorAttachments:maxColorAttachments,pointSizeDims:gl.getParameter(GL_ALIASED_POINT_SIZE_RANGE),lineWidthDims:gl.getParameter(GL_ALIASED_LINE_WIDTH_RANGE),maxViewportDims:gl.getParameter(GL_MAX_VIEWPORT_DIMS),maxCombinedTextureUnits:gl.getParameter(GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxCubeMapSize:gl.getParameter(GL_MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:gl.getParameter(GL_MAX_RENDERBUFFER_SIZE),maxTextureUnits:gl.getParameter(GL_MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:gl.getParameter(GL_MAX_TEXTURE_SIZE),maxAttributes:gl.getParameter(GL_MAX_VERTEX_ATTRIBS),maxVertexUniforms:gl.getParameter(GL_MAX_VERTEX_UNIFORM_VECTORS),maxVertexTextureUnits:gl.getParameter(GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVaryingVectors:gl.getParameter(GL_MAX_VARYING_VECTORS),maxFragmentUniforms:gl.getParameter(GL_MAX_FRAGMENT_UNIFORM_VECTORS),glsl:gl.getParameter(GL_SHADING_LANGUAGE_VERSION),renderer:gl.getParameter(GL_RENDERER),vendor:gl.getParameter(GL_VENDOR),version:gl.getParameter(GL_VERSION)}};function isNDArrayLike(obj){return!!obj&&typeof obj==="object"&&Array.isArray(obj.shape)&&Array.isArray(obj.stride)&&typeof obj.offset==="number"&&obj.shape.length===obj.stride.length&&(Array.isArray(obj.data)||isTypedArray(obj.data))}var values=function(obj){return Object.keys(obj).map(function(key){return obj[key]})};function loop(n,f){var result=Array(n);for(var i=0;i<n;++i){result[i]=f(i)}return result}var GL_BYTE$1=5120;var GL_UNSIGNED_BYTE$2=5121;var GL_SHORT$1=5122;var GL_UNSIGNED_SHORT$1=5123;var GL_INT$1=5124;var GL_UNSIGNED_INT$1=5125;var GL_FLOAT$2=5126;var bufferPool=loop(8,function(){return[]});function nextPow16(v){for(var i=16;i<=1<<28;i*=16){if(v<=i){return i}}return 0}function log2(v){var r,shift;r=(v>65535)<<4;v>>>=r;shift=(v>255)<<3;v>>>=shift;r|=shift;shift=(v>15)<<2;v>>>=shift;r|=shift;shift=(v>3)<<1;v>>>=shift;r|=shift;return r|v>>1}function alloc(n){var sz=nextPow16(n);var bin=bufferPool[log2(sz)>>2];if(bin.length>0){return bin.pop()}return new ArrayBuffer(sz)}function free(buf){bufferPool[log2(buf.byteLength)>>2].push(buf)}function allocType(type,n){var result=null;switch(type){case GL_BYTE$1:result=new Int8Array(alloc(n),0,n);break;case GL_UNSIGNED_BYTE$2:result=new Uint8Array(alloc(n),0,n);break;case GL_SHORT$1:result=new Int16Array(alloc(2*n),0,n);break;case GL_UNSIGNED_SHORT$1:result=new Uint16Array(alloc(2*n),0,n);break;case GL_INT$1:result=new Int32Array(alloc(4*n),0,n);break;case GL_UNSIGNED_INT$1:result=new Uint32Array(alloc(4*n),0,n);break;case GL_FLOAT$2:result=new Float32Array(alloc(4*n),0,n);break;default:return null}if(result.length!==n){return result.subarray(0,n)}return result}function freeType(array){free(array.buffer)}var pool={alloc:alloc,free:free,allocType:allocType,freeType:freeType};var flattenUtils={shape:arrayShape$1,flatten:flattenArray};function flatten1D(array,nx,out){for(var i=0;i<nx;++i){out[i]=array[i]}}function flatten2D(array,nx,ny,out){var ptr=0;for(var i=0;i<nx;++i){var row=array[i];for(var j=0;j<ny;++j){out[ptr++]=row[j]}}}function flatten3D(array,nx,ny,nz,out,ptr_){var ptr=ptr_;for(var i=0;i<nx;++i){var row=array[i];for(var j=0;j<ny;++j){var col=row[j];for(var k=0;k<nz;++k){out[ptr++]=col[k]}}}}function flattenRec(array,shape,level,out,ptr){var stride=1;for(var i=level+1;i<shape.length;++i){stride*=shape[i]}var n=shape[level];if(shape.length-level===4){var nx=shape[level+1];var ny=shape[level+2];var nz=shape[level+3];for(i=0;i<n;++i){flatten3D(array[i],nx,ny,nz,out,ptr);ptr+=stride}}else{for(i=0;i<n;++i){flattenRec(array[i],shape,level+1,out,ptr);ptr+=stride}}}function flattenArray(array,shape,type,out_){var sz=1;if(shape.length){for(var i=0;i<shape.length;++i){sz*=shape[i]}}else{sz=0}var out=out_||pool.allocType(type,sz);switch(shape.length){case 0:break;case 1:flatten1D(array,shape[0],out);break;case 2:flatten2D(array,shape[0],shape[1],out);break;case 3:flatten3D(array,shape[0],shape[1],shape[2],out,0);break;default:flattenRec(array,shape,0,out,0)}return out}function arrayShape$1(array_){var shape=[];for(var array=array_;array.length;array=array[0]){shape.push(array.length)}return shape}var int8=5120;var int16=5122;var int32=5124;var uint8=5121;var uint16=5123;var uint32=5125;var float=5126;var float32=5126;var glTypes={int8:int8,int16:int16,int32:int32,uint8:uint8,uint16:uint16,uint32:uint32,float:float,float32:float32};var dynamic$1=35048;var stream=35040;var usageTypes={dynamic:dynamic$1,stream:stream,static:35044};var arrayFlatten=flattenUtils.flatten;var arrayShape=flattenUtils.shape;var GL_STATIC_DRAW=35044;var GL_STREAM_DRAW=35040;var GL_UNSIGNED_BYTE$1=5121;var GL_FLOAT$1=5126;var DTYPES_SIZES=[];DTYPES_SIZES[5120]=1;DTYPES_SIZES[5122]=2;DTYPES_SIZES[5124]=4;DTYPES_SIZES[5121]=1;DTYPES_SIZES[5123]=2;DTYPES_SIZES[5125]=4;DTYPES_SIZES[5126]=4;function typedArrayCode(data){return arrayTypes[Object.prototype.toString.call(data)]|0}function copyArray(out,inp){for(var i=0;i<inp.length;++i){out[i]=inp[i]}}function transpose(result,data,shapeX,shapeY,strideX,strideY,offset){var ptr=0;for(var i=0;i<shapeX;++i){for(var j=0;j<shapeY;++j){result[ptr++]=data[strideX*i+strideY*j+offset]}}}function wrapBufferState(gl,stats,config){var bufferCount=0;var bufferSet={};function REGLBuffer(type){this.id=bufferCount++;this.buffer=gl.createBuffer();this.type=type;this.usage=GL_STATIC_DRAW;this.byteLength=0;this.dimension=1;this.dtype=GL_UNSIGNED_BYTE$1;this.persistentData=null;if(config.profile){this.stats={size:0}}}REGLBuffer.prototype.bind=function(){gl.bindBuffer(this.type,this.buffer)};REGLBuffer.prototype.destroy=function(){destroy(this)};var streamPool=[];function createStream(type,data){var buffer=streamPool.pop();if(!buffer){buffer=new REGLBuffer(type)}buffer.bind();initBufferFromData(buffer,data,GL_STREAM_DRAW,0,1,false);return buffer}function destroyStream(stream$$1){streamPool.push(stream$$1)}function initBufferFromTypedArray(buffer,data,usage){buffer.byteLength=data.byteLength;gl.bufferData(buffer.type,data,usage)}function initBufferFromData(buffer,data,usage,dtype,dimension,persist){var shape;buffer.usage=usage;if(Array.isArray(data)){buffer.dtype=dtype||GL_FLOAT$1;if(data.length>0){var flatData;if(Array.isArray(data[0])){shape=arrayShape(data);var dim=1;for(var i=1;i<shape.length;++i){dim*=shape[i]}buffer.dimension=dim;flatData=arrayFlatten(data,shape,buffer.dtype);initBufferFromTypedArray(buffer,flatData,usage);if(persist){buffer.persistentData=flatData}else{pool.freeType(flatData)}}else if(typeof data[0]==="number"){buffer.dimension=dimension;var typedData=pool.allocType(buffer.dtype,data.length);copyArray(typedData,data);initBufferFromTypedArray(buffer,typedData,usage);if(persist){buffer.persistentData=typedData}else{pool.freeType(typedData)}}else if(isTypedArray(data[0])){buffer.dimension=data[0].length;buffer.dtype=dtype||typedArrayCode(data[0])||GL_FLOAT$1;flatData=arrayFlatten(data,[data.length,data[0].length],buffer.dtype);initBufferFromTypedArray(buffer,flatData,usage);if(persist){buffer.persistentData=flatData}else{pool.freeType(flatData)}}else{check$1.raise("invalid buffer data")}}}else if(isTypedArray(data)){buffer.dtype=dtype||typedArrayCode(data);buffer.dimension=dimension;initBufferFromTypedArray(buffer,data,usage);if(persist){buffer.persistentData=new Uint8Array(new Uint8Array(data.buffer))}}else if(isNDArrayLike(data)){shape=data.shape;var stride=data.stride;var offset=data.offset;var shapeX=0;var shapeY=0;var strideX=0;var strideY=0;if(shape.length===1){shapeX=shape[0];shapeY=1;strideX=stride[0];strideY=0}else if(shape.length===2){shapeX=shape[0];shapeY=shape[1];strideX=stride[0];strideY=stride[1]}else{check$1.raise("invalid shape")}buffer.dtype=dtype||typedArrayCode(data.data)||GL_FLOAT$1;buffer.dimension=shapeY;var transposeData=pool.allocType(buffer.dtype,shapeX*shapeY);transpose(transposeData,data.data,shapeX,shapeY,strideX,strideY,offset);initBufferFromTypedArray(buffer,transposeData,usage);if(persist){buffer.persistentData=transposeData}else{pool.freeType(transposeData)}}else{check$1.raise("invalid buffer data")}}function destroy(buffer){stats.bufferCount--;var handle=buffer.buffer;check$1(handle,"buffer must not be deleted already");gl.deleteBuffer(handle);buffer.buffer=null;delete bufferSet[buffer.id]}function createBuffer(options,type,deferInit,persistent){stats.bufferCount++;var buffer=new REGLBuffer(type);bufferSet[buffer.id]=buffer;function reglBuffer(options){var usage=GL_STATIC_DRAW;var data=null;var byteLength=0;var dtype=0;var dimension=1;if(Array.isArray(options)||isTypedArray(options)||isNDArrayLike(options)){data=options}else if(typeof options==="number"){byteLength=options|0}else if(options){check$1.type(options,"object","buffer arguments must be an object, a number or an array");if("data"in options){check$1(data===null||Array.isArray(data)||isTypedArray(data)||isNDArrayLike(data),"invalid data for buffer");data=options.data}if("usage"in options){check$1.parameter(options.usage,usageTypes,"invalid buffer usage");usage=usageTypes[options.usage]}if("type"in options){check$1.parameter(options.type,glTypes,"invalid buffer type");dtype=glTypes[options.type]}if("dimension"in options){check$1.type(options.dimension,"number","invalid dimension");dimension=options.dimension|0}if("length"in options){check$1.nni(byteLength,"buffer length must be a nonnegative integer");byteLength=options.length|0}}buffer.bind();if(!data){gl.bufferData(buffer.type,byteLength,usage);buffer.dtype=dtype||GL_UNSIGNED_BYTE$1;buffer.usage=usage;buffer.dimension=dimension;buffer.byteLength=byteLength}else{initBufferFromData(buffer,data,usage,dtype,dimension,persistent)}if(config.profile){buffer.stats.size=buffer.byteLength*DTYPES_SIZES[buffer.dtype]}return reglBuffer}function setSubData(data,offset){check$1(offset+data.byteLength<=buffer.byteLength,"invalid buffer subdata call, buffer is too small. "+" Can't write data of size "+data.byteLength+" starting from offset "+offset+" to a buffer of size "+buffer.byteLength);gl.bufferSubData(buffer.type,offset,data)}function subdata(data,offset_){var offset=(offset_||0)|0;var shape;buffer.bind();if(Array.isArray(data)){if(data.length>0){if(typeof data[0]==="number"){var converted=pool.allocType(buffer.dtype,data.length);copyArray(converted,data);setSubData(converted,offset);pool.freeType(converted)}else if(Array.isArray(data[0])||isTypedArray(data[0])){shape=arrayShape(data);var flatData=arrayFlatten(data,shape,buffer.dtype);setSubData(flatData,offset);pool.freeType(flatData)}else{check$1.raise("invalid buffer data")}}}else if(isTypedArray(data)){setSubData(data,offset)}else if(isNDArrayLike(data)){shape=data.shape;var stride=data.stride;var shapeX=0;var shapeY=0;var strideX=0;var strideY=0;if(shape.length===1){shapeX=shape[0];shapeY=1;strideX=stride[0];strideY=0}else if(shape.length===2){shapeX=shape[0];shapeY=shape[1];strideX=stride[0];strideY=stride[1]}else{check$1.raise("invalid shape")}var dtype=Array.isArray(data.data)?buffer.dtype:typedArrayCode(data.data);var transposeData=pool.allocType(dtype,shapeX*shapeY);transpose(transposeData,data.data,shapeX,shapeY,strideX,strideY,data.offset);setSubData(transposeData,offset);pool.freeType(transposeData)}else{check$1.raise("invalid data for buffer subdata")}return reglBuffer}if(!deferInit){reglBuffer(options)}reglBuffer._reglType="buffer";reglBuffer._buffer=buffer;reglBuffer.subdata=subdata;if(config.profile){reglBuffer.stats=buffer.stats}reglBuffer.destroy=function(){destroy(buffer)};return reglBuffer}function restoreBuffers(){values(bufferSet).forEach(function(buffer){buffer.buffer=gl.createBuffer();gl.bindBuffer(buffer.type,buffer.buffer);gl.bufferData(buffer.type,buffer.persistentData||buffer.byteLength,buffer.usage)})}if(config.profile){stats.getTotalBufferSize=function(){var total=0;Object.keys(bufferSet).forEach(function(key){total+=bufferSet[key].stats.size});return total}}return{create:createBuffer,createStream:createStream,destroyStream:destroyStream,clear:function(){values(bufferSet).forEach(destroy);streamPool.forEach(destroy)},getBuffer:function(wrapper){if(wrapper&&wrapper._buffer instanceof REGLBuffer){return wrapper._buffer}return null},restore:restoreBuffers,_initBuffer:initBufferFromData}}var points=0;var point=0;var lines=1;var line=1;var triangles=4;var triangle=4;var primTypes={points:points,point:point,lines:lines,line:line,triangles:triangles,triangle:triangle,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6};var GL_POINTS=0;var GL_LINES=1;var GL_TRIANGLES=4;var GL_BYTE$2=5120;var GL_UNSIGNED_BYTE$3=5121;var GL_SHORT$2=5122;var GL_UNSIGNED_SHORT$2=5123;var GL_INT$2=5124;var GL_UNSIGNED_INT$2=5125;var GL_ELEMENT_ARRAY_BUFFER=34963;var GL_STREAM_DRAW$1=35040;var GL_STATIC_DRAW$1=35044;function wrapElementsState(gl,extensions,bufferState,stats){var elementSet={};var elementCount=0;var elementTypes={uint8:GL_UNSIGNED_BYTE$3,uint16:GL_UNSIGNED_SHORT$2};if(extensions.oes_element_index_uint){elementTypes.uint32=GL_UNSIGNED_INT$2}function REGLElementBuffer(buffer){this.id=elementCount++;elementSet[this.id]=this;this.buffer=buffer;this.primType=GL_TRIANGLES;this.vertCount=0;this.type=0}REGLElementBuffer.prototype.bind=function(){this.buffer.bind()};var bufferPool=[];function createElementStream(data){var result=bufferPool.pop();if(!result){result=new REGLElementBuffer(bufferState.create(null,GL_ELEMENT_ARRAY_BUFFER,true,false)._buffer)}initElements(result,data,GL_STREAM_DRAW$1,-1,-1,0,0);return result}function destroyElementStream(elements){bufferPool.push(elements)}function initElements(elements,data,usage,prim,count,byteLength,type){elements.buffer.bind();if(data){var predictedType=type;if(!type&&(!isTypedArray(data)||isNDArrayLike(data)&&!isTypedArray(data.data))){predictedType=extensions.oes_element_index_uint?GL_UNSIGNED_INT$2:GL_UNSIGNED_SHORT$2}bufferState._initBuffer(elements.buffer,data,usage,predictedType,3)}else{gl.bufferData(GL_ELEMENT_ARRAY_BUFFER,byteLength,usage);elements.buffer.dtype=dtype||GL_UNSIGNED_BYTE$3;elements.buffer.usage=usage;elements.buffer.dimension=3;elements.buffer.byteLength=byteLength}var dtype=type;if(!type){switch(elements.buffer.dtype){case GL_UNSIGNED_BYTE$3:case GL_BYTE$2:dtype=GL_UNSIGNED_BYTE$3;break;case GL_UNSIGNED_SHORT$2:case GL_SHORT$2:dtype=GL_UNSIGNED_SHORT$2;break;case GL_UNSIGNED_INT$2:case GL_INT$2:dtype=GL_UNSIGNED_INT$2;break;default:check$1.raise("unsupported type for element array")}elements.buffer.dtype=dtype}elements.type=dtype;check$1(dtype!==GL_UNSIGNED_INT$2||!!extensions.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var vertCount=count;if(vertCount<0){vertCount=elements.buffer.byteLength;if(dtype===GL_UNSIGNED_SHORT$2){vertCount>>=1}else if(dtype===GL_UNSIGNED_INT$2){vertCount>>=2}}elements.vertCount=vertCount;var primType=prim;if(prim<0){primType=GL_TRIANGLES;var dimension=elements.buffer.dimension;if(dimension===1)primType=GL_POINTS;if(dimension===2)primType=GL_LINES;if(dimension===3)primType=GL_TRIANGLES}elements.primType=primType}function destroyElements(elements){stats.elementsCount--;check$1(elements.buffer!==null,"must not double destroy elements");delete elementSet[elements.id];elements.buffer.destroy();elements.buffer=null}function createElements(options,persistent){var buffer=bufferState.create(null,GL_ELEMENT_ARRAY_BUFFER,true);var elements=new REGLElementBuffer(buffer._buffer);stats.elementsCount++;function reglElements(options){if(!options){buffer();elements.primType=GL_TRIANGLES;elements.vertCount=0;elements.type=GL_UNSIGNED_BYTE$3}else if(typeof options==="number"){buffer(options);elements.primType=GL_TRIANGLES;elements.vertCount=options|0;elements.type=GL_UNSIGNED_BYTE$3}else{var data=null;var usage=GL_STATIC_DRAW$1;var primType=-1;var vertCount=-1;var byteLength=0;var dtype=0;if(Array.isArray(options)||isTypedArray(options)||isNDArrayLike(options)){data=options}else{check$1.type(options,"object","invalid arguments for elements");if("data"in options){data=options.data;check$1(Array.isArray(data)||isTypedArray(data)||isNDArrayLike(data),"invalid data for element buffer")}if("usage"in options){check$1.parameter(options.usage,usageTypes,"invalid element buffer usage");usage=usageTypes[options.usage]}if("primitive"in options){check$1.parameter(options.primitive,primTypes,"invalid element buffer primitive");primType=primTypes[options.primitive]}if("count"in options){check$1(typeof options.count==="number"&&options.count>=0,"invalid vertex count for elements");vertCount=options.count|0}if("type"in options){check$1.parameter(options.type,elementTypes,"invalid buffer type");dtype=elementTypes[options.type]}if("length"in options){byteLength=options.length|0}else{byteLength=vertCount;if(dtype===GL_UNSIGNED_SHORT$2||dtype===GL_SHORT$2){byteLength*=2}else if(dtype===GL_UNSIGNED_INT$2||dtype===GL_INT$2){byteLength*=4}}}initElements(elements,data,usage,primType,vertCount,byteLength,dtype)}return reglElements}reglElements(options);reglElements._reglType="elements";reglElements._elements=elements;reglElements.subdata=function(data,offset){buffer.subdata(data,offset);return reglElements};reglElements.destroy=function(){destroyElements(elements)};return reglElements}return{create:createElements,createStream:createElementStream,destroyStream:destroyElementStream,getElements:function(elements){if(typeof elements==="function"&&elements._elements instanceof REGLElementBuffer){return elements._elements}return null},clear:function(){values(elementSet).forEach(destroyElements)}}}var FLOAT=new Float32Array(1);var INT=new Uint32Array(FLOAT.buffer);var GL_UNSIGNED_SHORT$4=5123;function convertToHalfFloat(array){var ushorts=pool.allocType(GL_UNSIGNED_SHORT$4,array.length);for(var i=0;i<array.length;++i){if(isNaN(array[i])){ushorts[i]=65535}else if(array[i]===Infinity){ushorts[i]=31744}else if(array[i]===-Infinity){ushorts[i]=64512}else{FLOAT[0]=array[i];var x=INT[0];var sgn=x>>>31<<15;var exp=(x<<1>>>24)-127;var frac=x>>13&(1<<10)-1;if(exp<-24){ushorts[i]=sgn}else if(exp<-14){var s=-14-exp;ushorts[i]=sgn+(frac+(1<<10)>>s)}else if(exp>15){ushorts[i]=sgn+31744}else{ushorts[i]=sgn+(exp+15<<10)+frac}}}return ushorts}function isArrayLike(s){return Array.isArray(s)||isTypedArray(s)}var GL_COMPRESSED_TEXTURE_FORMATS=34467;var GL_TEXTURE_2D=3553;var GL_TEXTURE_CUBE_MAP=34067;var GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069;var GL_RGBA=6408;var GL_ALPHA=6406;var GL_RGB=6407;var GL_LUMINANCE=6409;var GL_LUMINANCE_ALPHA=6410;var GL_RGBA4=32854;var GL_RGB5_A1=32855;var GL_RGB565=36194;var GL_UNSIGNED_SHORT_4_4_4_4$1=32819;var GL_UNSIGNED_SHORT_5_5_5_1$1=32820;var GL_UNSIGNED_SHORT_5_6_5$1=33635;var GL_UNSIGNED_INT_24_8_WEBGL$1=34042;var GL_DEPTH_COMPONENT=6402;var GL_DEPTH_STENCIL=34041;var GL_SRGB_EXT=35904;var GL_SRGB_ALPHA_EXT=35906;var GL_HALF_FLOAT_OES$1=36193;var GL_COMPRESSED_RGB_S3TC_DXT1_EXT=33776;var GL_COMPRESSED_RGBA_S3TC_DXT1_EXT=33777;var GL_COMPRESSED_RGBA_S3TC_DXT3_EXT=33778;var GL_COMPRESSED_RGBA_S3TC_DXT5_EXT=33779;var GL_COMPRESSED_RGB_ATC_WEBGL=35986;var GL_COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987;var GL_COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798;var GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840;var GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841;var GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842;var GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843;var GL_COMPRESSED_RGB_ETC1_WEBGL=36196;var GL_UNSIGNED_BYTE$4=5121;var GL_UNSIGNED_SHORT$3=5123;var GL_UNSIGNED_INT$3=5125;var GL_FLOAT$3=5126;var GL_TEXTURE_WRAP_S=10242;var GL_TEXTURE_WRAP_T=10243;var GL_REPEAT=10497;var GL_CLAMP_TO_EDGE$1=33071;var GL_MIRRORED_REPEAT=33648;var GL_TEXTURE_MAG_FILTER=10240;var GL_TEXTURE_MIN_FILTER=10241;var GL_NEAREST$1=9728;var GL_LINEAR=9729;var GL_NEAREST_MIPMAP_NEAREST$1=9984;var GL_LINEAR_MIPMAP_NEAREST$1=9985;var GL_NEAREST_MIPMAP_LINEAR$1=9986;var GL_LINEAR_MIPMAP_LINEAR$1=9987;var GL_GENERATE_MIPMAP_HINT=33170;var GL_DONT_CARE=4352;var GL_FASTEST=4353;var GL_NICEST=4354;var GL_TEXTURE_MAX_ANISOTROPY_EXT=34046;var GL_UNPACK_ALIGNMENT=3317;var GL_UNPACK_FLIP_Y_WEBGL=37440;var GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;var GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;var GL_BROWSER_DEFAULT_WEBGL=37444;var GL_TEXTURE0=33984;var MIPMAP_FILTERS=[GL_NEAREST_MIPMAP_NEAREST$1,GL_NEAREST_MIPMAP_LINEAR$1,GL_LINEAR_MIPMAP_NEAREST$1,GL_LINEAR_MIPMAP_LINEAR$1];var CHANNELS_FORMAT=[0,GL_LUMINANCE,GL_LUMINANCE_ALPHA,GL_RGB,GL_RGBA];var FORMAT_CHANNELS={};FORMAT_CHANNELS[GL_LUMINANCE]=FORMAT_CHANNELS[GL_ALPHA]=FORMAT_CHANNELS[GL_DEPTH_COMPONENT]=1;FORMAT_CHANNELS[GL_DEPTH_STENCIL]=FORMAT_CHANNELS[GL_LUMINANCE_ALPHA]=2;FORMAT_CHANNELS[GL_RGB]=FORMAT_CHANNELS[GL_SRGB_EXT]=3;FORMAT_CHANNELS[GL_RGBA]=FORMAT_CHANNELS[GL_SRGB_ALPHA_EXT]=4;function objectName(str){return"[object "+str+"]"}var CANVAS_CLASS=objectName("HTMLCanvasElement");var CONTEXT2D_CLASS=objectName("CanvasRenderingContext2D");var IMAGE_CLASS=objectName("HTMLImageElement");var VIDEO_CLASS=objectName("HTMLVideoElement");var PIXEL_CLASSES=Object.keys(arrayTypes).concat([CANVAS_CLASS,CONTEXT2D_CLASS,IMAGE_CLASS,VIDEO_CLASS]);var TYPE_SIZES=[];TYPE_SIZES[GL_UNSIGNED_BYTE$4]=1;TYPE_SIZES[GL_FLOAT$3]=4;TYPE_SIZES[GL_HALF_FLOAT_OES$1]=2;TYPE_SIZES[GL_UNSIGNED_SHORT$3]=2;TYPE_SIZES[GL_UNSIGNED_INT$3]=4;var FORMAT_SIZES_SPECIAL=[];FORMAT_SIZES_SPECIAL[GL_RGBA4]=2;FORMAT_SIZES_SPECIAL[GL_RGB5_A1]=2;FORMAT_SIZES_SPECIAL[GL_RGB565]=2;FORMAT_SIZES_SPECIAL[GL_DEPTH_STENCIL]=4;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGB_S3TC_DXT1_EXT]=.5;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_S3TC_DXT3_EXT]=1;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_S3TC_DXT5_EXT]=1;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGB_ATC_WEBGL]=.5;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25;FORMAT_SIZES_SPECIAL[GL_COMPRESSED_RGB_ETC1_WEBGL]=.5;function isNumericArray(arr){return Array.isArray(arr)&&(arr.length===0||typeof arr[0]==="number")}function isRectArray(arr){if(!Array.isArray(arr)){return false}var width=arr.length;if(width===0||!isArrayLike(arr[0])){return false}return true}function classString(x){return Object.prototype.toString.call(x)}function isCanvasElement(object){return classString(object)===CANVAS_CLASS}function isContext2D(object){return classString(object)===CONTEXT2D_CLASS}function isImageElement(object){return classString(object)===IMAGE_CLASS}function isVideoElement(object){return classString(object)===VIDEO_CLASS}function isPixelData(object){if(!object){return false}var className=classString(object);if(PIXEL_CLASSES.indexOf(className)>=0){return true}return isNumericArray(object)||isRectArray(object)||isNDArrayLike(object)}function typedArrayCode$1(data){return arrayTypes[Object.prototype.toString.call(data)]|0}function convertData(result,data){var n=data.length;switch(result.type){case GL_UNSIGNED_BYTE$4:case GL_UNSIGNED_SHORT$3:case GL_UNSIGNED_INT$3:case GL_FLOAT$3:var converted=pool.allocType(result.type,n);converted.set(data);result.data=converted;break;case GL_HALF_FLOAT_OES$1:result.data=convertToHalfFloat(data);break;default:check$1.raise("unsupported texture type, must specify a typed array")}}function preConvert(image,n){return pool.allocType(image.type===GL_HALF_FLOAT_OES$1?GL_FLOAT$3:image.type,n)}function postConvert(image,data){if(image.type===GL_HALF_FLOAT_OES$1){image.data=convertToHalfFloat(data);pool.freeType(data)}else{image.data=data}}function transposeData(image,array,strideX,strideY,strideC,offset){var w=image.width;var h=image.height;var c=image.channels;var n=w*h*c;var data=preConvert(image,n);var p=0;for(var i=0;i<h;++i){for(var j=0;j<w;++j){for(var k=0;k<c;++k){data[p++]=array[strideX*j+strideY*i+strideC*k+offset]}}}postConvert(image,data)}function getTextureSize(format,type,width,height,isMipmap,isCube){var s;if(typeof FORMAT_SIZES_SPECIAL[format]!=="undefined"){s=FORMAT_SIZES_SPECIAL[format]}else{s=FORMAT_CHANNELS[format]*TYPE_SIZES[type]}if(isCube){s*=6}if(isMipmap){var total=0;var w=width;while(w>=1){total+=s*w*w;w/=2}return total}else{return s*width*height}}function createTextureSet(gl,extensions,limits,reglPoll,contextState,stats,config){var mipmapHint={"don't care":GL_DONT_CARE,"dont care":GL_DONT_CARE,nice:GL_NICEST,fast:GL_FASTEST};var wrapModes={repeat:GL_REPEAT,clamp:GL_CLAMP_TO_EDGE$1,mirror:GL_MIRRORED_REPEAT};var magFilters={nearest:GL_NEAREST$1,linear:GL_LINEAR};var minFilters=extend({mipmap:GL_LINEAR_MIPMAP_LINEAR$1,"nearest mipmap nearest":GL_NEAREST_MIPMAP_NEAREST$1,"linear mipmap nearest":GL_LINEAR_MIPMAP_NEAREST$1,"nearest mipmap linear":GL_NEAREST_MIPMAP_LINEAR$1,"linear mipmap linear":GL_LINEAR_MIPMAP_LINEAR$1},magFilters);var colorSpace={none:0,browser:GL_BROWSER_DEFAULT_WEBGL};var textureTypes={uint8:GL_UNSIGNED_BYTE$4,rgba4:GL_UNSIGNED_SHORT_4_4_4_4$1,rgb565:GL_UNSIGNED_SHORT_5_6_5$1,"rgb5 a1":GL_UNSIGNED_SHORT_5_5_5_1$1};var textureFormats={alpha:GL_ALPHA,luminance:GL_LUMINANCE,"luminance alpha":GL_LUMINANCE_ALPHA,rgb:GL_RGB,rgba:GL_RGBA,rgba4:GL_RGBA4,"rgb5 a1":GL_RGB5_A1,rgb565:GL_RGB565};var compressedTextureFormats={};if(extensions.ext_srgb){textureFormats.srgb=GL_SRGB_EXT;textureFormats.srgba=GL_SRGB_ALPHA_EXT}if(extensions.oes_texture_float){textureTypes.float32=textureTypes.float=GL_FLOAT$3}if(extensions.oes_texture_half_float){textureTypes["float16"]=textureTypes["half float"]=GL_HALF_FLOAT_OES$1}if(extensions.webgl_depth_texture){extend(textureFormats,{depth:GL_DEPTH_COMPONENT,"depth stencil":GL_DEPTH_STENCIL});extend(textureTypes,{uint16:GL_UNSIGNED_SHORT$3,uint32:GL_UNSIGNED_INT$3,"depth stencil":GL_UNSIGNED_INT_24_8_WEBGL$1})}if(extensions.webgl_compressed_texture_s3tc){extend(compressedTextureFormats,{"rgb s3tc dxt1":GL_COMPRESSED_RGB_S3TC_DXT1_EXT,"rgba s3tc dxt1":GL_COMPRESSED_RGBA_S3TC_DXT1_EXT,"rgba s3tc dxt3":GL_COMPRESSED_RGBA_S3TC_DXT3_EXT,"rgba s3tc dxt5":GL_COMPRESSED_RGBA_S3TC_DXT5_EXT})}if(extensions.webgl_compressed_texture_atc){extend(compressedTextureFormats,{"rgb atc":GL_COMPRESSED_RGB_ATC_WEBGL,"rgba atc explicit alpha":GL_COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,"rgba atc interpolated alpha":GL_COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL})}if(extensions.webgl_compressed_texture_pvrtc){extend(compressedTextureFormats,{"rgb pvrtc 4bppv1":GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG,"rgb pvrtc 2bppv1":GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG,"rgba pvrtc 4bppv1":GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,"rgba pvrtc 2bppv1":GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG})}if(extensions.webgl_compressed_texture_etc1){compressedTextureFormats["rgb etc1"]=GL_COMPRESSED_RGB_ETC1_WEBGL}var supportedCompressedFormats=Array.prototype.slice.call(gl.getParameter(GL_COMPRESSED_TEXTURE_FORMATS));Object.keys(compressedTextureFormats).forEach(function(name){var format=compressedTextureFormats[name];if(supportedCompressedFormats.indexOf(format)>=0){textureFormats[name]=format}});var supportedFormats=Object.keys(textureFormats);limits.textureFormats=supportedFormats;var textureFormatsInvert=[];Object.keys(textureFormats).forEach(function(key){var val=textureFormats[key];textureFormatsInvert[val]=key});var textureTypesInvert=[];Object.keys(textureTypes).forEach(function(key){var val=textureTypes[key];textureTypesInvert[val]=key});var magFiltersInvert=[];Object.keys(magFilters).forEach(function(key){var val=magFilters[key];magFiltersInvert[val]=key});var minFiltersInvert=[];Object.keys(minFilters).forEach(function(key){var val=minFilters[key];minFiltersInvert[val]=key});var wrapModesInvert=[];Object.keys(wrapModes).forEach(function(key){var val=wrapModes[key];wrapModesInvert[val]=key});var colorFormats=supportedFormats.reduce(function(color,key){var glenum=textureFormats[key];if(glenum===GL_LUMINANCE||glenum===GL_ALPHA||glenum===GL_LUMINANCE||glenum===GL_LUMINANCE_ALPHA||glenum===GL_DEPTH_COMPONENT||glenum===GL_DEPTH_STENCIL){color[glenum]=glenum}else if(glenum===GL_RGB5_A1||key.indexOf("rgba")>=0){color[glenum]=GL_RGBA}else{color[glenum]=GL_RGB}return color},{});function TexFlags(){this.internalformat=GL_RGBA;this.format=GL_RGBA;this.type=GL_UNSIGNED_BYTE$4;this.compressed=false;this.premultiplyAlpha=false;this.flipY=false;this.unpackAlignment=1;this.colorSpace=0;this.width=0;this.height=0;this.channels=0}function copyFlags(result,other){result.internalformat=other.internalformat;result.format=other.format;result.type=other.type;result.compressed=other.compressed;result.premultiplyAlpha=other.premultiplyAlpha;result.flipY=other.flipY;result.unpackAlignment=other.unpackAlignment;result.colorSpace=other.colorSpace;result.width=other.width;result.height=other.height;result.channels=other.channels}function parseFlags(flags,options){if(typeof options!=="object"||!options){return}if("premultiplyAlpha"in options){check$1.type(options.premultiplyAlpha,"boolean","invalid premultiplyAlpha");flags.premultiplyAlpha=options.premultiplyAlpha}if("flipY"in options){check$1.type(options.flipY,"boolean","invalid texture flip");flags.flipY=options.flipY}if("alignment"in options){check$1.oneOf(options.alignment,[1,2,4,8],"invalid texture unpack alignment");flags.unpackAlignment=options.alignment}if("colorSpace"in options){check$1.parameter(options.colorSpace,colorSpace,"invalid colorSpace");flags.colorSpace=colorSpace[options.colorSpace]}if("type"in options){var type=options.type;check$1(extensions.oes_texture_float||!(type==="float"||type==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures.");check$1(extensions.oes_texture_half_float||!(type==="half float"||type==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");check$1(extensions.webgl_depth_texture||!(type==="uint16"||type==="uint32"||type==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");check$1.parameter(type,textureTypes,"invalid texture type");flags.type=textureTypes[type]}var w=flags.width;var h=flags.height;var c=flags.channels;var hasChannels=false;if("shape"in options){check$1(Array.isArray(options.shape)&&options.shape.length>=2,"shape must be an array");w=options.shape[0];h=options.shape[1];if(options.shape.length===3){c=options.shape[2];check$1(c>0&&c<=4,"invalid number of channels");hasChannels=true}check$1(w>=0&&w<=limits.maxTextureSize,"invalid width");check$1(h>=0&&h<=limits.maxTextureSize,"invalid height")}else{if("radius"in options){w=h=options.radius;check$1(w>=0&&w<=limits.maxTextureSize,"invalid radius")}if("width"in options){w=options.width;check$1(w>=0&&w<=limits.maxTextureSize,"invalid width")}if("height"in options){h=options.height;check$1(h>=0&&h<=limits.maxTextureSize,"invalid height")}if("channels"in options){c=options.channels;check$1(c>0&&c<=4,"invalid number of channels");hasChannels=true}}flags.width=w|0;flags.height=h|0;flags.channels=c|0;var hasFormat=false;if("format"in options){var formatStr=options.format;check$1(extensions.webgl_depth_texture||!(formatStr==="depth"||formatStr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");check$1.parameter(formatStr,textureFormats,"invalid texture format");var internalformat=flags.internalformat=textureFormats[formatStr];flags.format=colorFormats[internalformat];if(formatStr in textureTypes){if(!("type"in options)){flags.type=textureTypes[formatStr]}}if(formatStr in compressedTextureFormats){flags.compressed=true}hasFormat=true}if(!hasChannels&&hasFormat){flags.channels=FORMAT_CHANNELS[flags.format]}else if(hasChannels&&!hasFormat){if(flags.channels!==CHANNELS_FORMAT[flags.format]){flags.format=flags.internalformat=CHANNELS_FORMAT[flags.channels]}}else if(hasFormat&&hasChannels){check$1(flags.channels===FORMAT_CHANNELS[flags.format],"number of channels inconsistent with specified format")}}function setFlags(flags){gl.pixelStorei(GL_UNPACK_FLIP_Y_WEBGL,flags.flipY);gl.pixelStorei(GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL,flags.premultiplyAlpha);gl.pixelStorei(GL_UNPACK_COLORSPACE_CONVERSION_WEBGL,flags.colorSpace);gl.pixelStorei(GL_UNPACK_ALIGNMENT,flags.unpackAlignment)}function TexImage(){TexFlags.call(this);this.xOffset=0;this.yOffset=0;this.data=null;this.needsFree=false;this.element=null;this.needsCopy=false}function parseImage(image,options){var data=null;if(isPixelData(options)){data=options}else if(options){check$1.type(options,"object","invalid pixel data type");parseFlags(image,options);if("x"in options){image.xOffset=options.x|0}if("y"in options){image.yOffset=options.y|0}if(isPixelData(options.data)){data=options.data}}check$1(!image.compressed||data instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(options.copy){check$1(!data,"can not specify copy and data field for the same texture");var viewW=contextState.viewportWidth;var viewH=contextState.viewportHeight;image.width=image.width||viewW-image.xOffset;image.height=image.height||viewH-image.yOffset;image.needsCopy=true;check$1(image.xOffset>=0&&image.xOffset<viewW&&image.yOffset>=0&&image.yOffset<viewH&&image.width>0&&image.width<=viewW&&image.height>0&&image.height<=viewH,"copy texture read out of bounds")}else if(!data){image.width=image.width||1;image.height=image.height||1;image.channels=image.channels||4}else if(isTypedArray(data)){image.channels=image.channels||4;image.data=data;if(!("type"in options)&&image.type===GL_UNSIGNED_BYTE$4){image.type=typedArrayCode$1(data)}}else if(isNumericArray(data)){image.channels=image.channels||4;convertData(image,data);image.alignment=1;image.needsFree=true}else if(isNDArrayLike(data)){var array=data.data;if(!Array.isArray(array)&&image.type===GL_UNSIGNED_BYTE$4){image.type=typedArrayCode$1(array)}var shape=data.shape;var stride=data.stride;var shapeX,shapeY,shapeC,strideX,strideY,strideC;if(shape.length===3){shapeC=shape[2];strideC=stride[2]}else{check$1(shape.length===2,"invalid ndarray pixel data, must be 2 or 3D");shapeC=1;strideC=1}shapeX=shape[0];shapeY=shape[1];strideX=stride[0];strideY=stride[1];image.alignment=1;image.width=shapeX;image.height=shapeY;image.channels=shapeC;image.format=image.internalformat=CHANNELS_FORMAT[shapeC];image.needsFree=true;transposeData(image,array,strideX,strideY,strideC,data.offset)}else if(isCanvasElement(data)||isContext2D(data)){if(isCanvasElement(data)){image.element=data}else{image.element=data.canvas}image.width=image.element.width;image.height=image.element.height;image.channels=4}else if(isImageElement(data)){image.element=data;image.width=data.naturalWidth;image.height=data.naturalHeight;image.channels=4}else if(isVideoElement(data)){image.element=data;image.width=data.videoWidth;image.height=data.videoHeight;image.channels=4}else if(isRectArray(data)){var w=image.width||data[0].length;var h=image.height||data.length;var c=image.channels;if(isArrayLike(data[0][0])){c=c||data[0][0].length}else{c=c||1}var arrayShape=flattenUtils.shape(data);var n=1;for(var dd=0;dd<arrayShape.length;++dd){n*=arrayShape[dd]}var allocData=preConvert(image,n);flattenUtils.flatten(data,arrayShape,"",allocData);postConvert(image,allocData);image.alignment=1;image.width=w;image.height=h;image.channels=c;image.format=image.internalformat=CHANNELS_FORMAT[c];image.needsFree=true}if(image.type===GL_FLOAT$3){check$1(limits.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled")}else if(image.type===GL_HALF_FLOAT_OES$1){check$1(limits.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}}function setImage(info,target,miplevel){var element=info.element;var data=info.data;var internalformat=info.internalformat;var format=info.format;var type=info.type;var width=info.width;var height=info.height;setFlags(info);if(element){gl.texImage2D(target,miplevel,format,format,type,element)}else if(info.compressed){gl.compressedTexImage2D(target,miplevel,internalformat,width,height,0,data)}else if(info.needsCopy){reglPoll();gl.copyTexImage2D(target,miplevel,format,info.xOffset,info.yOffset,width,height,0)}else{gl.texImage2D(target,miplevel,format,width,height,0,format,type,data)}}function setSubImage(info,target,x,y,miplevel){var element=info.element;var data=info.data;var internalformat=info.internalformat;var format=info.format;var type=info.type;var width=info.width;var height=info.height;setFlags(info);if(element){gl.texSubImage2D(target,miplevel,x,y,format,type,element)}else if(info.compressed){gl.compressedTexSubImage2D(target,miplevel,x,y,internalformat,width,height,data)}else if(info.needsCopy){reglPoll();gl.copyTexSubImage2D(target,miplevel,x,y,info.xOffset,info.yOffset,width,height)}else{gl.texSubImage2D(target,miplevel,x,y,width,height,format,type,data)}}var imagePool=[];function allocImage(){return imagePool.pop()||new TexImage}function freeImage(image){if(image.needsFree){pool.freeType(image.data)}TexImage.call(image);imagePool.push(image)}function MipMap(){TexFlags.call(this);this.genMipmaps=false;this.mipmapHint=GL_DONT_CARE;this.mipmask=0;this.images=Array(16)}function parseMipMapFromShape(mipmap,width,height){var img=mipmap.images[0]=allocImage();mipmap.mipmask=1;img.width=mipmap.width=width;img.height=mipmap.height=height;img.channels=mipmap.channels=4}function parseMipMapFromObject(mipmap,options){var imgData=null;if(isPixelData(options)){imgData=mipmap.images[0]=allocImage();copyFlags(imgData,mipmap);parseImage(imgData,options);mipmap.mipmask=1}else{parseFlags(mipmap,options);if(Array.isArray(options.mipmap)){var mipData=options.mipmap;for(var i=0;i<mipData.length;++i){imgData=mipmap.images[i]=allocImage();copyFlags(imgData,mipmap);imgData.width>>=i;imgData.height>>=i;parseImage(imgData,mipData[i]);mipmap.mipmask|=1<<i}}else{imgData=mipmap.images[0]=allocImage();copyFlags(imgData,mipmap);parseImage(imgData,options);mipmap.mipmask=1}}copyFlags(mipmap,mipmap.images[0]);if(mipmap.compressed&&mipmap.internalformat===GL_COMPRESSED_RGB_S3TC_DXT1_EXT||mipmap.internalformat===GL_COMPRESSED_RGBA_S3TC_DXT1_EXT||mipmap.internalformat===GL_COMPRESSED_RGBA_S3TC_DXT3_EXT||mipmap.internalformat===GL_COMPRESSED_RGBA_S3TC_DXT5_EXT){check$1(mipmap.width%4===0&&mipmap.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}}function setMipMap(mipmap,target){var images=mipmap.images;for(var i=0;i<images.length;++i){if(!images[i]){return}setImage(images[i],target,i)}}var mipPool=[];function allocMipMap(){var result=mipPool.pop()||new MipMap;TexFlags.call(result);result.mipmask=0;for(var i=0;i<16;++i){result.images[i]=null}return result}function freeMipMap(mipmap){var images=mipmap.images;for(var i=0;i<images.length;++i){if(images[i]){freeImage(images[i])}images[i]=null}mipPool.push(mipmap)}function TexInfo(){this.minFilter=GL_NEAREST$1;this.magFilter=GL_NEAREST$1;this.wrapS=GL_CLAMP_TO_EDGE$1;this.wrapT=GL_CLAMP_TO_EDGE$1;this.anisotropic=1;this.genMipmaps=false;this.mipmapHint=GL_DONT_CARE}function parseTexInfo(info,options){if("min"in options){var minFilter=options.min;check$1.parameter(minFilter,minFilters);info.minFilter=minFilters[minFilter];if(MIPMAP_FILTERS.indexOf(info.minFilter)>=0){info.genMipmaps=true}}if("mag"in options){var magFilter=options.mag;check$1.parameter(magFilter,magFilters);info.magFilter=magFilters[magFilter]}var wrapS=info.wrapS;var wrapT=info.wrapT;if("wrap"in options){var wrap=options.wrap;if(typeof wrap==="string"){check$1.parameter(wrap,wrapModes);wrapS=wrapT=wrapModes[wrap]}else if(Array.isArray(wrap)){check$1.parameter(wrap[0],wrapModes);check$1.parameter(wrap[1],wrapModes);wrapS=wrapModes[wrap[0]];wrapT=wrapModes[wrap[1]]}}else{if("wrapS"in options){var optWrapS=options.wrapS;check$1.parameter(optWrapS,wrapModes);wrapS=wrapModes[optWrapS]}if("wrapT"in options){var optWrapT=options.wrapT;check$1.parameter(optWrapT,wrapModes);wrapT=wrapModes[optWrapT]}}info.wrapS=wrapS;info.wrapT=wrapT;if("anisotropic"in options){var anisotropic=options.anisotropic;check$1(typeof anisotropic==="number"&&anisotropic>=1&&anisotropic<=limits.maxAnisotropic,"aniso samples must be between 1 and ");info.anisotropic=options.anisotropic}if("mipmap"in options){var hasMipMap=false;switch(typeof options.mipmap){case"string":check$1.parameter(options.mipmap,mipmapHint,"invalid mipmap hint");info.mipmapHint=mipmapHint[options.mipmap];info.genMipmaps=true;hasMipMap=true;break;case"boolean":hasMipMap=info.genMipmaps=options.mipmap;break;case"object":check$1(Array.isArray(options.mipmap),"invalid mipmap type");info.genMipmaps=false;hasMipMap=true;break;default:check$1.raise("invalid mipmap type")}if(hasMipMap&&!("min"in options)){info.minFilter=GL_NEAREST_MIPMAP_NEAREST$1}}}function setTexInfo(info,target){gl.texParameteri(target,GL_TEXTURE_MIN_FILTER,info.minFilter);gl.texParameteri(target,GL_TEXTURE_MAG_FILTER,info.magFilter);gl.texParameteri(target,GL_TEXTURE_WRAP_S,info.wrapS);gl.texParameteri(target,GL_TEXTURE_WRAP_T,info.wrapT);if(extensions.ext_texture_filter_anisotropic){gl.texParameteri(target,GL_TEXTURE_MAX_ANISOTROPY_EXT,info.anisotropic)}if(info.genMipmaps){gl.hint(GL_GENERATE_MIPMAP_HINT,info.mipmapHint);gl.generateMipmap(target)}}var textureCount=0;var textureSet={};var numTexUnits=limits.maxTextureUnits;var textureUnits=Array(numTexUnits).map(function(){return null});function REGLTexture(target){TexFlags.call(this);this.mipmask=0;this.internalformat=GL_RGBA;this.id=textureCount++;this.refCount=1;this.target=target;this.texture=gl.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new TexInfo;if(config.profile){this.stats={size:0}}}function tempBind(texture){gl.activeTexture(GL_TEXTURE0);gl.bindTexture(texture.target,texture.texture)}function tempRestore(){var prev=textureUnits[0];if(prev){gl.bindTexture(prev.target,prev.texture)}else{gl.bindTexture(GL_TEXTURE_2D,null)}}function destroy(texture){var handle=texture.texture;check$1(handle,"must not double destroy texture");var unit=texture.unit;var target=texture.target;if(unit>=0){gl.activeTexture(GL_TEXTURE0+unit);gl.bindTexture(target,null);textureUnits[unit]=null}gl.deleteTexture(handle);texture.texture=null;texture.params=null;texture.pixels=null;texture.refCount=0;delete textureSet[texture.id];stats.textureCount--}extend(REGLTexture.prototype,{bind:function(){var texture=this;texture.bindCount+=1;var unit=texture.unit;if(unit<0){for(var i=0;i<numTexUnits;++i){var other=textureUnits[i];if(other){if(other.bindCount>0){continue}other.unit=-1}textureUnits[i]=texture;unit=i;break}if(unit>=numTexUnits){check$1.raise("insufficient number of texture units")}if(config.profile&&stats.maxTextureUnits<unit+1){stats.maxTextureUnits=unit+1}texture.unit=unit;gl.activeTexture(GL_TEXTURE0+unit);gl.bindTexture(texture.target,texture.texture)}return unit},unbind:function(){this.bindCount-=1},decRef:function(){if(--this.refCount<=0){destroy(this)}}});function createTexture2D(a,b){var texture=new REGLTexture(GL_TEXTURE_2D);textureSet[texture.id]=texture;stats.textureCount++;function reglTexture2D(a,b){var texInfo=texture.texInfo;TexInfo.call(texInfo);var mipData=allocMipMap();if(typeof a==="number"){if(typeof b==="number"){parseMipMapFromShape(mipData,a|0,b|0)}else{parseMipMapFromShape(mipData,a|0,a|0)}}else if(a){check$1.type(a,"object","invalid arguments to regl.texture");parseTexInfo(texInfo,a);parseMipMapFromObject(mipData,a)}else{parseMipMapFromShape(mipData,1,1)}if(texInfo.genMipmaps){mipData.mipmask=(mipData.width<<1)-1}texture.mipmask=mipData.mipmask;copyFlags(texture,mipData);check$1.texture2D(texInfo,mipData,limits);texture.internalformat=mipData.internalformat;reglTexture2D.width=mipData.width;reglTexture2D.height=mipData.height;tempBind(texture);setMipMap(mipData,GL_TEXTURE_2D);setTexInfo(texInfo,GL_TEXTURE_2D);tempRestore();freeMipMap(mipData);if(config.profile){texture.stats.size=getTextureSize(texture.internalformat,texture.type,mipData.width,mipData.height,texInfo.genMipmaps,false)}reglTexture2D.format=textureFormatsInvert[texture.internalformat];reglTexture2D.type=textureTypesInvert[texture.type];reglTexture2D.mag=magFiltersInvert[texInfo.magFilter];reglTexture2D.min=minFiltersInvert[texInfo.minFilter];reglTexture2D.wrapS=wrapModesInvert[texInfo.wrapS];reglTexture2D.wrapT=wrapModesInvert[texInfo.wrapT];return reglTexture2D}function subimage(image,x_,y_,level_){check$1(!!image,"must specify image data");var x=x_|0;var y=y_|0;var level=level_|0;var imageData=allocImage();copyFlags(imageData,texture);imageData.width=0;imageData.height=0;parseImage(imageData,image);imageData.width=imageData.width||(texture.width>>level)-x;imageData.height=imageData.height||(texture.height>>level)-y;check$1(texture.type===imageData.type&&texture.format===imageData.format&&texture.internalformat===imageData.internalformat,"incompatible format for texture.subimage");check$1(x>=0&&y>=0&&x+imageData.width<=texture.width&&y+imageData.height<=texture.height,"texture.subimage write out of bounds");check$1(texture.mipmask&1<<level,"missing mipmap data");check$1(imageData.data||imageData.element||imageData.needsCopy,"missing image data");tempBind(texture);setSubImage(imageData,GL_TEXTURE_2D,x,y,level);tempRestore();freeImage(imageData);return reglTexture2D}function resize(w_,h_){var w=w_|0;var h=h_|0||w;if(w===texture.width&&h===texture.height){return reglTexture2D}reglTexture2D.width=texture.width=w;reglTexture2D.height=texture.height=h;tempBind(texture);for(var i=0;texture.mipmask>>i;++i){gl.texImage2D(GL_TEXTURE_2D,i,texture.format,w>>i,h>>i,0,texture.format,texture.type,null)}tempRestore();if(config.profile){texture.stats.size=getTextureSize(texture.internalformat,texture.type,w,h,false,false)}return reglTexture2D}reglTexture2D(a,b);reglTexture2D.subimage=subimage;reglTexture2D.resize=resize;reglTexture2D._reglType="texture2d";reglTexture2D._texture=texture;if(config.profile){reglTexture2D.stats=texture.stats}reglTexture2D.destroy=function(){texture.decRef()};return reglTexture2D}function createTextureCube(a0,a1,a2,a3,a4,a5){var texture=new REGLTexture(GL_TEXTURE_CUBE_MAP);textureSet[texture.id]=texture;stats.cubeCount++;var faces=new Array(6);function reglTextureCube(a0,a1,a2,a3,a4,a5){var i;var texInfo=texture.texInfo;TexInfo.call(texInfo);for(i=0;i<6;++i){faces[i]=allocMipMap()}if(typeof a0==="number"||!a0){var s=a0|0||1;for(i=0;i<6;++i){parseMipMapFromShape(faces[i],s,s)}}else if(typeof a0==="object"){if(a1){parseMipMapFromObject(faces[0],a0);parseMipMapFromObject(faces[1],a1);parseMipMapFromObject(faces[2],a2);parseMipMapFromObject(faces[3],a3);parseMipMapFromObject(faces[4],a4);parseMipMapFromObject(faces[5],a5)}else{parseTexInfo(texInfo,a0);parseFlags(texture,a0);if("faces"in a0){var face_input=a0.faces;check$1(Array.isArray(face_input)&&face_input.length===6,"cube faces must be a length 6 array");for(i=0;i<6;++i){check$1(typeof face_input[i]==="object"&&!!face_input[i],"invalid input for cube map face");copyFlags(faces[i],texture);parseMipMapFromObject(faces[i],face_input[i])}}else{for(i=0;i<6;++i){parseMipMapFromObject(faces[i],a0)}}}}else{check$1.raise("invalid arguments to cube map")}copyFlags(texture,faces[0]);if(texInfo.genMipmaps){texture.mipmask=(faces[0].width<<1)-1}else{texture.mipmask=faces[0].mipmask}check$1.textureCube(texture,texInfo,faces,limits);texture.internalformat=faces[0].internalformat;reglTextureCube.width=faces[0].width;reglTextureCube.height=faces[0].height;tempBind(texture);for(i=0;i<6;++i){setMipMap(faces[i],GL_TEXTURE_CUBE_MAP_POSITIVE_X+i)}setTexInfo(texInfo,GL_TEXTURE_CUBE_MAP);tempRestore();if(config.profile){texture.stats.size=getTextureSize(texture.internalformat,texture.type,reglTextureCube.width,reglTextureCube.height,texInfo.genMipmaps,true)}reglTextureCube.format=textureFormatsInvert[texture.internalformat];reglTextureCube.type=textureTypesInvert[texture.type];reglTextureCube.mag=magFiltersInvert[texInfo.magFilter];reglTextureCube.min=minFiltersInvert[texInfo.minFilter];reglTextureCube.wrapS=wrapModesInvert[texInfo.wrapS];reglTextureCube.wrapT=wrapModesInvert[texInfo.wrapT];for(i=0;i<6;++i){freeMipMap(faces[i])}return reglTextureCube}function subimage(face,image,x_,y_,level_){check$1(!!image,"must specify image data");check$1(typeof face==="number"&&face===(face|0)&&face>=0&&face<6,"invalid face");var x=x_|0;var y=y_|0;var level=level_|0;var imageData=allocImage();copyFlags(imageData,texture);imageData.width=0;imageData.height=0;parseImage(imageData,image);imageData.width=imageData.width||(texture.width>>level)-x;imageData.height=imageData.height||(texture.height>>level)-y;check$1(texture.type===imageData.type&&texture.format===imageData.format&&texture.internalformat===imageData.internalformat,"incompatible format for texture.subimage");check$1(x>=0&&y>=0&&x+imageData.width<=texture.width&&y+imageData.height<=texture.height,"texture.subimage write out of bounds");check$1(texture.mipmask&1<<level,"missing mipmap data");check$1(imageData.data||imageData.element||imageData.needsCopy,"missing image data");tempBind(texture);setSubImage(imageData,GL_TEXTURE_CUBE_MAP_POSITIVE_X+face,x,y,level);tempRestore();freeImage(imageData);return reglTextureCube}function resize(radius_){var radius=radius_|0;if(radius===texture.width){return}reglTextureCube.width=texture.width=radius;reglTextureCube.height=texture.height=radius;tempBind(texture);for(var i=0;i<6;++i){for(var j=0;texture.mipmask>>j;++j){gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X+i,j,texture.format,radius>>j,radius>>j,0,texture.format,texture.type,null)}}tempRestore();if(config.profile){texture.stats.size=getTextureSize(texture.internalformat,texture.type,reglTextureCube.width,reglTextureCube.height,false,true)}return reglTextureCube}reglTextureCube(a0,a1,a2,a3,a4,a5);reglTextureCube.subimage=subimage;reglTextureCube.resize=resize;reglTextureCube._reglType="textureCube";reglTextureCube._texture=texture;if(config.profile){reglTextureCube.stats=texture.stats}reglTextureCube.destroy=function(){texture.decRef()};return reglTextureCube}function destroyTextures(){for(var i=0;i<numTexUnits;++i){gl.activeTexture(GL_TEXTURE0+i);gl.bindTexture(GL_TEXTURE_2D,null);textureUnits[i]=null}values(textureSet).forEach(destroy);stats.cubeCount=0;stats.textureCount=0}if(config.profile){stats.getTotalTextureSize=function(){var total=0;Object.keys(textureSet).forEach(function(key){total+=textureSet[key].stats.size});return total}}function restoreTextures(){values(textureSet).forEach(function(texture){texture.texture=gl.createTexture();gl.bindTexture(texture.target,texture.texture);for(var i=0;i<32;++i){if((texture.mipmask&1<<i)===0){continue}if(texture.target===GL_TEXTURE_2D){gl.texImage2D(GL_TEXTURE_2D,i,texture.internalformat,texture.width>>i,texture.height>>i,0,texture.internalformat,texture.type,null)}else{for(var j=0;j<6;++j){gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X+j,i,texture.internalformat,texture.width>>i,texture.height>>i,0,texture.internalformat,texture.type,null)}}}setTexInfo(texture.texInfo,texture.target)})}return{create2D:createTexture2D,createCube:createTextureCube,clear:destroyTextures,getTexture:function(wrapper){return null},restore:restoreTextures}}var GL_RENDERBUFFER=36161;var GL_RGBA4$1=32854;var GL_RGB5_A1$1=32855;var GL_RGB565$1=36194;var GL_DEPTH_COMPONENT16=33189;var GL_STENCIL_INDEX8=36168;var GL_DEPTH_STENCIL$1=34041;var GL_SRGB8_ALPHA8_EXT=35907;var GL_RGBA32F_EXT=34836;var GL_RGBA16F_EXT=34842;var GL_RGB16F_EXT=34843;var FORMAT_SIZES=[];FORMAT_SIZES[GL_RGBA4$1]=2;FORMAT_SIZES[GL_RGB5_A1$1]=2;FORMAT_SIZES[GL_RGB565$1]=2;FORMAT_SIZES[GL_DEPTH_COMPONENT16]=2;FORMAT_SIZES[GL_STENCIL_INDEX8]=1;FORMAT_SIZES[GL_DEPTH_STENCIL$1]=4;FORMAT_SIZES[GL_SRGB8_ALPHA8_EXT]=4;FORMAT_SIZES[GL_RGBA32F_EXT]=16;FORMAT_SIZES[GL_RGBA16F_EXT]=8;FORMAT_SIZES[GL_RGB16F_EXT]=6;function getRenderbufferSize(format,width,height){return FORMAT_SIZES[format]*width*height}var wrapRenderbuffers=function(gl,extensions,limits,stats,config){var formatTypes={rgba4:GL_RGBA4$1,rgb565:GL_RGB565$1,"rgb5 a1":GL_RGB5_A1$1,depth:GL_DEPTH_COMPONENT16,stencil:GL_STENCIL_INDEX8,"depth stencil":GL_DEPTH_STENCIL$1};if(extensions.ext_srgb){formatTypes["srgba"]=GL_SRGB8_ALPHA8_EXT}if(extensions.ext_color_buffer_half_float){formatTypes["rgba16f"]=GL_RGBA16F_EXT;formatTypes["rgb16f"]=GL_RGB16F_EXT}if(extensions.webgl_color_buffer_float){formatTypes["rgba32f"]=GL_RGBA32F_EXT}var formatTypesInvert=[];Object.keys(formatTypes).forEach(function(key){var val=formatTypes[key];formatTypesInvert[val]=key});var renderbufferCount=0;var renderbufferSet={};function REGLRenderbuffer(renderbuffer){this.id=renderbufferCount++;this.refCount=1;this.renderbuffer=renderbuffer;this.format=GL_RGBA4$1;this.width=0;this.height=0;if(config.profile){this.stats={size:0}}}REGLRenderbuffer.prototype.decRef=function(){if(--this.refCount<=0){destroy(this)}};function destroy(rb){var handle=rb.renderbuffer;check$1(handle,"must not double destroy renderbuffer");gl.bindRenderbuffer(GL_RENDERBUFFER,null);gl.deleteRenderbuffer(handle);rb.renderbuffer=null;rb.refCount=0;delete renderbufferSet[rb.id];stats.renderbufferCount--}function createRenderbuffer(a,b){var renderbuffer=new REGLRenderbuffer(gl.createRenderbuffer());renderbufferSet[renderbuffer.id]=renderbuffer;stats.renderbufferCount++;function reglRenderbuffer(a,b){var w=0;var h=0;var format=GL_RGBA4$1;if(typeof a==="object"&&a){var options=a;if("shape"in options){var shape=options.shape;check$1(Array.isArray(shape)&&shape.length>=2,"invalid renderbuffer shape");w=shape[0]|0;h=shape[1]|0}else{if("radius"in options){w=h=options.radius|0}if("width"in options){w=options.width|0}if("height"in options){h=options.height|0}}if("format"in options){check$1.parameter(options.format,formatTypes,"invalid renderbuffer format");format=formatTypes[options.format]}}else if(typeof a==="number"){w=a|0;if(typeof b==="number"){h=b|0}else{h=w}}else if(!a){w=h=1}else{check$1.raise("invalid arguments to renderbuffer constructor")}check$1(w>0&&h>0&&w<=limits.maxRenderbufferSize&&h<=limits.maxRenderbufferSize,"invalid renderbuffer size");if(w===renderbuffer.width&&h===renderbuffer.height&&format===renderbuffer.format){return}reglRenderbuffer.width=renderbuffer.width=w;reglRenderbuffer.height=renderbuffer.height=h;renderbuffer.format=format;gl.bindRenderbuffer(GL_RENDERBUFFER,renderbuffer.renderbuffer);gl.renderbufferStorage(GL_RENDERBUFFER,format,w,h);if(config.profile){renderbuffer.stats.size=getRenderbufferSize(renderbuffer.format,renderbuffer.width,renderbuffer.height)}reglRenderbuffer.format=formatTypesInvert[renderbuffer.format];return reglRenderbuffer}function resize(w_,h_){var w=w_|0;var h=h_|0||w;if(w===renderbuffer.width&&h===renderbuffer.height){return reglRenderbuffer}check$1(w>0&&h>0&&w<=limits.maxRenderbufferSize&&h<=limits.maxRenderbufferSize,"invalid renderbuffer size");reglRenderbuffer.width=renderbuffer.width=w;reglRenderbuffer.height=renderbuffer.height=h;gl.bindRenderbuffer(GL_RENDERBUFFER,renderbuffer.renderbuffer);gl.renderbufferStorage(GL_RENDERBUFFER,renderbuffer.format,w,h);if(config.profile){renderbuffer.stats.size=getRenderbufferSize(renderbuffer.format,renderbuffer.width,renderbuffer.height)}return reglRenderbuffer}reglRenderbuffer(a,b);reglRenderbuffer.resize=resize;reglRenderbuffer._reglType="renderbuffer";reglRenderbuffer._renderbuffer=renderbuffer;if(config.profile){reglRenderbuffer.stats=renderbuffer.stats}reglRenderbuffer.destroy=function(){renderbuffer.decRef()};return reglRenderbuffer}if(config.profile){stats.getTotalRenderbufferSize=function(){var total=0;Object.keys(renderbufferSet).forEach(function(key){total+=renderbufferSet[key].stats.size});return total}}function restoreRenderbuffers(){values(renderbufferSet).forEach(function(rb){rb.renderbuffer=gl.createRenderbuffer();gl.bindRenderbuffer(GL_RENDERBUFFER,rb.renderbuffer);gl.renderbufferStorage(GL_RENDERBUFFER,rb.format,rb.width,rb.height)});gl.bindRenderbuffer(GL_RENDERBUFFER,null)}return{create:createRenderbuffer,clear:function(){values(renderbufferSet).forEach(destroy)},restore:restoreRenderbuffers}};var GL_FRAMEBUFFER=36160;var GL_RENDERBUFFER$1=36161;var GL_TEXTURE_2D$1=3553;var GL_TEXTURE_CUBE_MAP_POSITIVE_X$1=34069;var GL_COLOR_ATTACHMENT0=36064;var GL_DEPTH_ATTACHMENT=36096;var GL_STENCIL_ATTACHMENT=36128;var GL_DEPTH_STENCIL_ATTACHMENT=33306;var GL_FRAMEBUFFER_COMPLETE=36053;var GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;var GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;var GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;var GL_FRAMEBUFFER_UNSUPPORTED=36061;var GL_HALF_FLOAT_OES$2=36193;var GL_UNSIGNED_BYTE$5=5121;var GL_FLOAT$4=5126;var GL_RGBA$1=6408;var GL_DEPTH_COMPONENT$1=6402;var colorTextureFormatEnums=[GL_RGBA$1];var textureFormatChannels=[];textureFormatChannels[GL_RGBA$1]=4;var textureTypeSizes=[];textureTypeSizes[GL_UNSIGNED_BYTE$5]=1;textureTypeSizes[GL_FLOAT$4]=4;textureTypeSizes[GL_HALF_FLOAT_OES$2]=2;var GL_RGBA4$2=32854;var GL_RGB5_A1$2=32855;var GL_RGB565$2=36194;var GL_DEPTH_COMPONENT16$1=33189;var GL_STENCIL_INDEX8$1=36168;var GL_DEPTH_STENCIL$2=34041;var GL_SRGB8_ALPHA8_EXT$1=35907;var GL_RGBA32F_EXT$1=34836;var GL_RGBA16F_EXT$1=34842;var GL_RGB16F_EXT$1=34843;var colorRenderbufferFormatEnums=[GL_RGBA4$2,GL_RGB5_A1$2,GL_RGB565$2,GL_SRGB8_ALPHA8_EXT$1,GL_RGBA16F_EXT$1,GL_RGB16F_EXT$1,GL_RGBA32F_EXT$1];var statusCode={};statusCode[GL_FRAMEBUFFER_COMPLETE]="complete";statusCode[GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT]="incomplete attachment";statusCode[GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS]="incomplete dimensions";statusCode[GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]="incomplete, missing attachment";statusCode[GL_FRAMEBUFFER_UNSUPPORTED]="unsupported";function wrapFBOState(gl,extensions,limits,textureState,renderbufferState,stats){var framebufferState={cur:null,next:null,dirty:false,setFBO:null};var colorTextureFormats=["rgba"];var colorRenderbufferFormats=["rgba4","rgb565","rgb5 a1"];if(extensions.ext_srgb){colorRenderbufferFormats.push("srgba")}if(extensions.ext_color_buffer_half_float){colorRenderbufferFormats.push("rgba16f","rgb16f")}if(extensions.webgl_color_buffer_float){colorRenderbufferFormats.push("rgba32f")}var colorTypes=["uint8"];if(extensions.oes_texture_half_float){colorTypes.push("half float","float16")}if(extensions.oes_texture_float){colorTypes.push("float","float32")}function FramebufferAttachment(target,texture,renderbuffer){this.target=target;this.texture=texture;this.renderbuffer=renderbuffer;var w=0;var h=0;if(texture){w=texture.width;h=texture.height}else if(renderbuffer){w=renderbuffer.width;h=renderbuffer.height}this.width=w;this.height=h}function decRef(attachment){if(attachment){if(attachment.texture){attachment.texture._texture.decRef()}if(attachment.renderbuffer){attachment.renderbuffer._renderbuffer.decRef()}}}function incRefAndCheckShape(attachment,width,height){if(!attachment){return}if(attachment.texture){var texture=attachment.texture._texture;var tw=Math.max(1,texture.width);var th=Math.max(1,texture.height);check$1(tw===width&&th===height,"inconsistent width/height for supplied texture");texture.refCount+=1}else{var renderbuffer=attachment.renderbuffer._renderbuffer;check$1(renderbuffer.width===width&&renderbuffer.height===height,"inconsistent width/height for renderbuffer");renderbuffer.refCount+=1}}function attach(location,attachment){if(attachment){if(attachment.texture){gl.framebufferTexture2D(GL_FRAMEBUFFER,location,attachment.target,attachment.texture._texture.texture,0)}else{gl.framebufferRenderbuffer(GL_FRAMEBUFFER,location,GL_RENDERBUFFER$1,attachment.renderbuffer._renderbuffer.renderbuffer)}}}function parseAttachment(attachment){var target=GL_TEXTURE_2D$1;var texture=null;var renderbuffer=null;var data=attachment;if(typeof attachment==="object"){data=attachment.data;if("target"in attachment){target=attachment.target|0}}check$1.type(data,"function","invalid attachment data");var type=data._reglType;if(type==="texture2d"){texture=data;check$1(target===GL_TEXTURE_2D$1)}else if(type==="textureCube"){texture=data;check$1(target>=GL_TEXTURE_CUBE_MAP_POSITIVE_X$1&&target<GL_TEXTURE_CUBE_MAP_POSITIVE_X$1+6,"invalid cube map target")}else if(type==="renderbuffer"){renderbuffer=data;target=GL_RENDERBUFFER$1}else{check$1.raise("invalid regl object for attachment")}return new FramebufferAttachment(target,texture,renderbuffer)}function allocAttachment(width,height,isTexture,format,type){if(isTexture){var texture=textureState.create2D({width:width,height:height,format:format,type:type});texture._texture.refCount=0;return new FramebufferAttachment(GL_TEXTURE_2D$1,texture,null)}else{var rb=renderbufferState.create({width:width,height:height,format:format});rb._renderbuffer.refCount=0;return new FramebufferAttachment(GL_RENDERBUFFER$1,null,rb)}}function unwrapAttachment(attachment){return attachment&&(attachment.texture||attachment.renderbuffer)}function resizeAttachment(attachment,w,h){if(attachment){if(attachment.texture){attachment.texture.resize(w,h)}else if(attachment.renderbuffer){attachment.renderbuffer.resize(w,h)}}}var framebufferCount=0;var framebufferSet={};function REGLFramebuffer(){this.id=framebufferCount++;framebufferSet[this.id]=this;this.framebuffer=gl.createFramebuffer();this.width=0;this.height=0;this.colorAttachments=[];this.depthAttachment=null;this.stencilAttachment=null;this.depthStencilAttachment=null}function decFBORefs(framebuffer){framebuffer.colorAttachments.forEach(decRef);decRef(framebuffer.depthAttachment);decRef(framebuffer.stencilAttachment);decRef(framebuffer.depthStencilAttachment)}function destroy(framebuffer){var handle=framebuffer.framebuffer;check$1(handle,"must not double destroy framebuffer");gl.deleteFramebuffer(handle);framebuffer.framebuffer=null;stats.framebufferCount--;delete framebufferSet[framebuffer.id]}function updateFramebuffer(framebuffer){var i;gl.bindFramebuffer(GL_FRAMEBUFFER,framebuffer.framebuffer);var colorAttachments=framebuffer.colorAttachments;for(i=0;i<colorAttachments.length;++i){attach(GL_COLOR_ATTACHMENT0+i,colorAttachments[i])}for(i=colorAttachments.length;i<limits.maxColorAttachments;++i){gl.framebufferTexture2D(GL_FRAMEBUFFER,GL_COLOR_ATTACHMENT0+i,GL_TEXTURE_2D$1,null,0)}gl.framebufferTexture2D(GL_FRAMEBUFFER,GL_DEPTH_STENCIL_ATTACHMENT,GL_TEXTURE_2D$1,null,0);gl.framebufferTexture2D(GL_FRAMEBUFFER,GL_DEPTH_ATTACHMENT,GL_TEXTURE_2D$1,null,0);gl.framebufferTexture2D(GL_FRAMEBUFFER,GL_STENCIL_ATTACHMENT,GL_TEXTURE_2D$1,null,0);attach(GL_DEPTH_ATTACHMENT,framebuffer.depthAttachment);attach(GL_STENCIL_ATTACHMENT,framebuffer.stencilAttachment);attach(GL_DEPTH_STENCIL_ATTACHMENT,framebuffer.depthStencilAttachment);var status=gl.checkFramebufferStatus(GL_FRAMEBUFFER);if(status!==GL_FRAMEBUFFER_COMPLETE){check$1.raise("framebuffer configuration not supported, status = "+statusCode[status])}gl.bindFramebuffer(GL_FRAMEBUFFER,framebufferState.next);framebufferState.cur=framebufferState.next;gl.getError()}function createFBO(a0,a1){var framebuffer=new REGLFramebuffer;stats.framebufferCount++;function reglFramebuffer(a,b){var i;check$1(framebufferState.next!==framebuffer,"can not update framebuffer which is currently in use");var extDrawBuffers=extensions.webgl_draw_buffers;var width=0;var height=0;var needsDepth=true;var needsStencil=true;var colorBuffer=null;var colorTexture=true;var colorFormat="rgba";var colorType="uint8";var colorCount=1;var depthBuffer=null;var stencilBuffer=null;var depthStencilBuffer=null;var depthStencilTexture=false;if(typeof a==="number"){width=a|0;height=b|0||width}else if(!a){width=height=1}else{check$1.type(a,"object","invalid arguments for framebuffer");var options=a;if("shape"in options){var shape=options.shape;check$1(Array.isArray(shape)&&shape.length>=2,"invalid shape for framebuffer");width=shape[0];height=shape[1]}else{if("radius"in options){width=height=options.radius}if("width"in options){width=options.width}if("height"in options){height=options.height}}if("color"in options||"colors"in options){colorBuffer=options.color||options.colors;if(Array.isArray(colorBuffer)){check$1(colorBuffer.length===1||extDrawBuffers,"multiple render targets not supported")}}if(!colorBuffer){if("colorCount"in options){colorCount=options.colorCount|0;check$1(colorCount>0,"invalid color buffer count")}if("colorTexture"in options){colorTexture=!!options.colorTexture;colorFormat="rgba4"}if("colorType"in options){colorType=options.colorType;if(!colorTexture){if(colorType==="half float"||colorType==="float16"){check$1(extensions.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers");colorFormat="rgba16f"}else if(colorType==="float"||colorType==="float32"){check$1(extensions.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers");colorFormat="rgba32f"}}else{check$1(extensions.oes_texture_float||!(colorType==="float"||colorType==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects");check$1(extensions.oes_texture_half_float||!(colorType==="half float"||colorType==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")}check$1.oneOf(colorType,colorTypes,"invalid color type")}if("colorFormat"in options){colorFormat=options.colorFormat;if(colorTextureFormats.indexOf(colorFormat)>=0){colorTexture=true}else if(colorRenderbufferFormats.indexOf(colorFormat)>=0){colorTexture=false}else{if(colorTexture){check$1.oneOf(options.colorFormat,colorTextureFormats,"invalid color format for texture")}else{check$1.oneOf(options.colorFormat,colorRenderbufferFormats,"invalid color format for renderbuffer")}}}}if("depthTexture"in options||"depthStencilTexture"in options){depthStencilTexture=!!(options.depthTexture||options.depthStencilTexture);check$1(!depthStencilTexture||extensions.webgl_depth_texture,"webgl_depth_texture extension not supported")}if("depth"in options){if(typeof options.depth==="boolean"){needsDepth=options.depth}else{depthBuffer=options.depth;needsStencil=false}}if("stencil"in options){if(typeof options.stencil==="boolean"){needsStencil=options.stencil}else{stencilBuffer=options.stencil;needsDepth=false}}if("depthStencil"in options){if(typeof options.depthStencil==="boolean"){needsDepth=needsStencil=options.depthStencil}else{depthStencilBuffer=options.depthStencil;needsDepth=false;needsStencil=false}}}var colorAttachments=null;var depthAttachment=null;var stencilAttachment=null;var depthStencilAttachment=null;if(Array.isArray(colorBuffer)){colorAttachments=colorBuffer.map(parseAttachment)}else if(colorBuffer){colorAttachments=[parseAttachment(colorBuffer)]}else{colorAttachments=new Array(colorCount);for(i=0;i<colorCount;++i){colorAttachments[i]=allocAttachment(width,height,colorTexture,colorFormat,colorType)}}check$1(extensions.webgl_draw_buffers||colorAttachments.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");check$1(colorAttachments.length<=limits.maxColorAttachments,"too many color attachments, not supported");width=width||colorAttachments[0].width;height=height||colorAttachments[0].height;if(depthBuffer){depthAttachment=parseAttachment(depthBuffer)}else if(needsDepth&&!needsStencil){depthAttachment=allocAttachment(width,height,depthStencilTexture,"depth","uint32")}if(stencilBuffer){stencilAttachment=parseAttachment(stencilBuffer)}else if(needsStencil&&!needsDepth){stencilAttachment=allocAttachment(width,height,false,"stencil","uint8")}if(depthStencilBuffer){depthStencilAttachment=parseAttachment(depthStencilBuffer)}else if(!depthBuffer&&!stencilBuffer&&needsStencil&&needsDepth){depthStencilAttachment=allocAttachment(width,height,depthStencilTexture,"depth stencil","depth stencil")}check$1(!!depthBuffer+!!stencilBuffer+!!depthStencilBuffer<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var commonColorAttachmentSize=null;for(i=0;i<colorAttachments.length;++i){incRefAndCheckShape(colorAttachments[i],width,height);check$1(!colorAttachments[i]||colorAttachments[i].texture&&colorTextureFormatEnums.indexOf(colorAttachments[i].texture._texture.format)>=0||colorAttachments[i].renderbuffer&&colorRenderbufferFormatEnums.indexOf(colorAttachments[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid");if(colorAttachments[i]&&colorAttachments[i].texture){var colorAttachmentSize=textureFormatChannels[colorAttachments[i].texture._texture.format]*textureTypeSizes[colorAttachments[i].texture._texture.type];if(commonColorAttachmentSize===null){commonColorAttachmentSize=colorAttachmentSize}else{check$1(commonColorAttachmentSize===colorAttachmentSize,"all color attachments much have the same number of bits per pixel.")}}}incRefAndCheckShape(depthAttachment,width,height);check$1(!depthAttachment||depthAttachment.texture&&depthAttachment.texture._texture.format===GL_DEPTH_COMPONENT$1||depthAttachment.renderbuffer&&depthAttachment.renderbuffer._renderbuffer.format===GL_DEPTH_COMPONENT16$1,"invalid depth attachment for framebuffer object");incRefAndCheckShape(stencilAttachment,width,height);check$1(!stencilAttachment||stencilAttachment.renderbuffer&&stencilAttachment.renderbuffer._renderbuffer.format===GL_STENCIL_INDEX8$1,"invalid stencil attachment for framebuffer object");incRefAndCheckShape(depthStencilAttachment,width,height);check$1(!depthStencilAttachment||depthStencilAttachment.texture&&depthStencilAttachment.texture._texture.format===GL_DEPTH_STENCIL$2||depthStencilAttachment.renderbuffer&&depthStencilAttachment.renderbuffer._renderbuffer.format===GL_DEPTH_STENCIL$2,"invalid depth-stencil attachment for framebuffer object");decFBORefs(framebuffer);framebuffer.width=width;framebuffer.height=height;framebuffer.colorAttachments=colorAttachments;framebuffer.depthAttachment=depthAttachment;framebuffer.stencilAttachment=stencilAttachment;framebuffer.depthStencilAttachment=depthStencilAttachment;reglFramebuffer.color=colorAttachments.map(unwrapAttachment);reglFramebuffer.depth=unwrapAttachment(depthAttachment);reglFramebuffer.stencil=unwrapAttachment(stencilAttachment);reglFramebuffer.depthStencil=unwrapAttachment(depthStencilAttachment);reglFramebuffer.width=framebuffer.width;reglFramebuffer.height=framebuffer.height;updateFramebuffer(framebuffer);return reglFramebuffer}function resize(w_,h_){check$1(framebufferState.next!==framebuffer,"can not resize a framebuffer which is currently in use");var w=w_|0;var h=h_|0||w;if(w===framebuffer.width&&h===framebuffer.height){return reglFramebuffer}var colorAttachments=framebuffer.colorAttachments;for(var i=0;i<colorAttachments.length;++i){resizeAttachment(colorAttachments[i],w,h)}resizeAttachment(framebuffer.depthAttachment,w,h);resizeAttachment(framebuffer.stencilAttachment,w,h);resizeAttachment(framebuffer.depthStencilAttachment,w,h);framebuffer.width=reglFramebuffer.width=w;framebuffer.height=reglFramebuffer.height=h;updateFramebuffer(framebuffer);return reglFramebuffer}reglFramebuffer(a0,a1);return extend(reglFramebuffer,{resize:resize,_reglType:"framebuffer",_framebuffer:framebuffer,destroy:function(){destroy(framebuffer);decFBORefs(framebuffer)},use:function(block){framebufferState.setFBO({framebuffer:reglFramebuffer},block)}})}function createCubeFBO(options){var faces=Array(6);function reglFramebufferCube(a){var i;check$1(faces.indexOf(framebufferState.next)<0,"can not update framebuffer which is currently in use");var extDrawBuffers=extensions.webgl_draw_buffers;var params={color:null};var radius=0;var colorBuffer=null;var colorFormat="rgba";var colorType="uint8";var colorCount=1;if(typeof a==="number"){radius=a|0}else if(!a){radius=1}else{check$1.type(a,"object","invalid arguments for framebuffer");var options=a;if("shape"in options){var shape=options.shape;check$1(Array.isArray(shape)&&shape.length>=2,"invalid shape for framebuffer");check$1(shape[0]===shape[1],"cube framebuffer must be square");radius=shape[0]}else{if("radius"in options){radius=options.radius|0}if("width"in options){radius=options.width|0;if("height"in options){check$1(options.height===radius,"must be square")}}else if("height"in options){radius=options.height|0}}if("color"in options||"colors"in options){colorBuffer=options.color||options.colors;if(Array.isArray(colorBuffer)){check$1(colorBuffer.length===1||extDrawBuffers,"multiple render targets not supported")}}if(!colorBuffer){if("colorCount"in options){colorCount=options.colorCount|0;check$1(colorCount>0,"invalid color buffer count")}if("colorType"in options){check$1.oneOf(options.colorType,colorTypes,"invalid color type");colorType=options.colorType}if("colorFormat"in options){colorFormat=options.colorFormat;check$1.oneOf(options.colorFormat,colorTextureFormats,"invalid color format for texture")}}if("depth"in options){params.depth=options.depth}if("stencil"in options){params.stencil=options.stencil}if("depthStencil"in options){params.depthStencil=options.depthStencil}}var colorCubes;if(colorBuffer){if(Array.isArray(colorBuffer)){colorCubes=[];for(i=0;i<colorBuffer.length;++i){colorCubes[i]=colorBuffer[i]}}else{colorCubes=[colorBuffer]}}else{colorCubes=Array(colorCount);var cubeMapParams={radius:radius,format:colorFormat,type:colorType};for(i=0;i<colorCount;++i){colorCubes[i]=textureState.createCube(cubeMapParams)}}params.color=Array(colorCubes.length);for(i=0;i<colorCubes.length;++i){var cube=colorCubes[i];check$1(typeof cube==="function"&&cube._reglType==="textureCube","invalid cube map");radius=radius||cube.width;check$1(cube.width===radius&&cube.height===radius,"invalid cube map shape");params.color[i]={target:GL_TEXTURE_CUBE_MAP_POSITIVE_X$1,data:colorCubes[i]}}for(i=0;i<6;++i){for(var j=0;j<colorCubes.length;++j){params.color[j].target=GL_TEXTURE_CUBE_MAP_POSITIVE_X$1+i}if(i>0){params.depth=faces[0].depth;params.stencil=faces[0].stencil;params.depthStencil=faces[0].depthStencil}if(faces[i]){faces[i](params)}else{faces[i]=createFBO(params)}}return extend(reglFramebufferCube,{width:radius,height:radius,color:colorCubes})}function resize(radius_){var i;var radius=radius_|0;check$1(radius>0&&radius<=limits.maxCubeMapSize,"invalid radius for cube fbo");if(radius===reglFramebufferCube.width){return reglFramebufferCube}var colors=reglFramebufferCube.color;for(i=0;i<colors.length;++i){colors[i].resize(radius)}for(i=0;i<6;++i){faces[i].resize(radius)}reglFramebufferCube.width=reglFramebufferCube.height=radius;return reglFramebufferCube}reglFramebufferCube(options);return extend(reglFramebufferCube,{faces:faces,resize:resize,_reglType:"framebufferCube",destroy:function(){faces.forEach(function(f){f.destroy()})}})}function restoreFramebuffers(){values(framebufferSet).forEach(function(fb){fb.framebuffer=gl.createFramebuffer();updateFramebuffer(fb)})}return extend(framebufferState,{getFramebuffer:function(object){if(typeof object==="function"&&object._reglType==="framebuffer"){var fbo=object._framebuffer;if(fbo instanceof REGLFramebuffer){return fbo}}return null},create:createFBO,createCube:createCubeFBO,clear:function(){values(framebufferSet).forEach(destroy)},restore:restoreFramebuffers})}var GL_FLOAT$5=5126;function AttributeRecord(){this.state=0;this.x=0;this.y=0;this.z=0;this.w=0;this.buffer=null;this.size=0;this.normalized=false;this.type=GL_FLOAT$5;this.offset=0;this.stride=0;this.divisor=0}function wrapAttributeState(gl,extensions,limits,bufferState,stringStore){var NUM_ATTRIBUTES=limits.maxAttributes;var attributeBindings=new Array(NUM_ATTRIBUTES);for(var i=0;i<NUM_ATTRIBUTES;++i){attributeBindings[i]=new AttributeRecord}return{Record:AttributeRecord,scope:{},state:attributeBindings}}var GL_FRAGMENT_SHADER=35632;var GL_VERTEX_SHADER=35633;var GL_ACTIVE_UNIFORMS=35718;var GL_ACTIVE_ATTRIBUTES=35721;function wrapShaderState(gl,stringStore,stats,config){var fragShaders={};var vertShaders={};function ActiveInfo(name,id,location,info){this.name=name;this.id=id;this.location=location;this.info=info}function insertActiveInfo(list,info){for(var i=0;i<list.length;++i){if(list[i].id===info.id){list[i].location=info.location;return}}list.push(info)}function getShader(type,id,command){var cache=type===GL_FRAGMENT_SHADER?fragShaders:vertShaders;var shader=cache[id];if(!shader){var source=stringStore.str(id);shader=gl.createShader(type);gl.shaderSource(shader,source);gl.compileShader(shader);check$1.shaderError(gl,shader,source,type,command);cache[id]=shader}return shader}var programCache={};var programList=[];var PROGRAM_COUNTER=0;function REGLProgram(fragId,vertId){this.id=PROGRAM_COUNTER++;this.fragId=fragId;this.vertId=vertId;this.program=null;this.uniforms=[];this.attributes=[];if(config.profile){this.stats={uniformsCount:0,attributesCount:0}}}function linkProgram(desc,command){var i,info;var fragShader=getShader(GL_FRAGMENT_SHADER,desc.fragId);var vertShader=getShader(GL_VERTEX_SHADER,desc.vertId);var program=desc.program=gl.createProgram();gl.attachShader(program,fragShader);gl.attachShader(program,vertShader);gl.linkProgram(program);check$1.linkError(gl,program,stringStore.str(desc.fragId),stringStore.str(desc.vertId),command);var numUniforms=gl.getProgramParameter(program,GL_ACTIVE_UNIFORMS);if(config.profile){desc.stats.uniformsCount=numUniforms}var uniforms=desc.uniforms;for(i=0;i<numUniforms;++i){info=gl.getActiveUniform(program,i);if(info){if(info.size>1){for(var j=0;j<info.size;++j){var name=info.name.replace("[0]","["+j+"]");insertActiveInfo(uniforms,new ActiveInfo(name,stringStore.id(name),gl.getUniformLocation(program,name),info))}}else{insertActiveInfo(uniforms,new ActiveInfo(info.name,stringStore.id(info.name),gl.getUniformLocation(program,info.name),info))}}}var numAttributes=gl.getProgramParameter(program,GL_ACTIVE_ATTRIBUTES);if(config.profile){desc.stats.attributesCount=numAttributes}var attributes=desc.attributes;for(i=0;i<numAttributes;++i){info=gl.getActiveAttrib(program,i);if(info){insertActiveInfo(attributes,new ActiveInfo(info.name,stringStore.id(info.name),gl.getAttribLocation(program,info.name),info))}}}if(config.profile){stats.getMaxUniformsCount=function(){var m=0;programList.forEach(function(desc){if(desc.stats.uniformsCount>m){m=desc.stats.uniformsCount}});return m};stats.getMaxAttributesCount=function(){var m=0;programList.forEach(function(desc){if(desc.stats.attributesCount>m){m=desc.stats.attributesCount}});return m}}function restoreShaders(){fragShaders={};vertShaders={};for(var i=0;i<programList.length;++i){linkProgram(programList[i])}}return{clear:function(){var deleteShader=gl.deleteShader.bind(gl);values(fragShaders).forEach(deleteShader);fragShaders={};values(vertShaders).forEach(deleteShader);vertShaders={};programList.forEach(function(desc){gl.deleteProgram(desc.program)});programList.length=0;programCache={};stats.shaderCount=0},program:function(vertId,fragId,command){check$1.command(vertId>=0,"missing vertex shader",command);check$1.command(fragId>=0,"missing fragment shader",command);var cache=programCache[fragId];if(!cache){cache=programCache[fragId]={}}var program=cache[vertId];if(!program){program=new REGLProgram(fragId,vertId);stats.shaderCount++;linkProgram(program,command);cache[vertId]=program;programList.push(program)}return program},restore:restoreShaders,shader:getShader,frag:-1,vert:-1}}var GL_RGBA$2=6408;var GL_UNSIGNED_BYTE$6=5121;var GL_PACK_ALIGNMENT=3333;var GL_FLOAT$6=5126;function wrapReadPixels(gl,framebufferState,reglPoll,context,glAttributes,extensions){function readPixelsImpl(input){var type;if(framebufferState.next===null){check$1(glAttributes.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer');type=GL_UNSIGNED_BYTE$6}else{check$1(framebufferState.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer");type=framebufferState.next.colorAttachments[0].texture._texture.type;if(extensions.oes_texture_float){check$1(type===GL_UNSIGNED_BYTE$6||type===GL_FLOAT$6,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'")}else{check$1(type===GL_UNSIGNED_BYTE$6,"Reading from a framebuffer is only allowed for the type 'uint8'")}}var x=0;var y=0;var width=context.framebufferWidth;var height=context.framebufferHeight;var data=null;if(isTypedArray(input)){data=input}else if(input){check$1.type(input,"object","invalid arguments to regl.read()");x=input.x|0;y=input.y|0;check$1(x>=0&&x<context.framebufferWidth,"invalid x offset for regl.read");check$1(y>=0&&y<context.framebufferHeight,"invalid y offset for regl.read");width=(input.width||context.framebufferWidth-x)|0;height=(input.height||context.framebufferHeight-y)|0;data=input.data||null}if(data){if(type===GL_UNSIGNED_BYTE$6){check$1(data instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'")}else if(type===GL_FLOAT$6){check$1(data instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")}}check$1(width>0&&width+x<=context.framebufferWidth,"invalid width for read pixels");check$1(height>0&&height+y<=context.framebufferHeight,"invalid height for read pixels");reglPoll();var size=width*height*4;if(!data){if(type===GL_UNSIGNED_BYTE$6){data=new Uint8Array(size)}else if(type===GL_FLOAT$6){data=data||new Float32Array(size)}}check$1.isTypedArray(data,"data buffer for regl.read() must be a typedarray");check$1(data.byteLength>=size,"data buffer for regl.read() too small");gl.pixelStorei(GL_PACK_ALIGNMENT,4);gl.readPixels(x,y,width,height,GL_RGBA$2,type,data);return data}function readPixelsFBO(options){var result;framebufferState.setFBO({framebuffer:options.framebuffer},function(){result=readPixelsImpl(options)});return result}function readPixels(options){if(!options||!("framebuffer"in options)){return readPixelsImpl(options)}else{return readPixelsFBO(options)}}return readPixels}function slice(x){return Array.prototype.slice.call(x)}function join(x){return slice(x).join("")}function createEnvironment(){var varCounter=0;var linkedNames=[];var linkedValues=[];function link(value){for(var i=0;i<linkedValues.length;++i){if(linkedValues[i]===value){return linkedNames[i]}}var name="g"+varCounter++;linkedNames.push(name);linkedValues.push(value);return name}function block(){var code=[];function push(){code.push.apply(code,slice(arguments))}var vars=[];function def(){var name="v"+varCounter++;vars.push(name);if(arguments.length>0){code.push(name,"=");code.push.apply(code,slice(arguments));code.push(";")}return name}return extend(push,{def:def,toString:function(){return join([vars.length>0?"var "+vars+";":"",join(code)])}})}function scope(){var entry=block();var exit=block();var entryToString=entry.toString;var exitToString=exit.toString;function save(object,prop){exit(object,prop,"=",entry.def(object,prop),";")}return extend(function(){entry.apply(entry,slice(arguments))},{def:entry.def,entry:entry,exit:exit,save:save,set:function(object,prop,value){save(object,prop);entry(object,prop,"=",value,";")},toString:function(){return entryToString()+exitToString()}})}function conditional(){var pred=join(arguments);var thenBlock=scope();var elseBlock=scope();var thenToString=thenBlock.toString;var elseToString=elseBlock.toString;return extend(thenBlock,{then:function(){thenBlock.apply(thenBlock,slice(arguments));return this},else:function(){elseBlock.apply(elseBlock,slice(arguments));return this},toString:function(){var elseClause=elseToString();if(elseClause){elseClause="else{"+elseClause+"}"}return join(["if(",pred,"){",thenToString(),"}",elseClause])}})}var globalBlock=block();var procedures={};function proc(name,count){var args=[];function arg(){var name="a"+args.length;args.push(name);return name}count=count||0;for(var i=0;i<count;++i){arg()}var body=scope();var bodyToString=body.toString;var result=procedures[name]=extend(body,{arg:arg,toString:function(){return join(["function(",args.join(),"){",bodyToString(),"}"])}});return result}function compile(){var code=['"use strict";',globalBlock,"return {"];Object.keys(procedures).forEach(function(name){code.push('"',name,'":',procedures[name].toString(),",")});code.push("}");var src=join(code).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");var proc=Function.apply(null,linkedNames.concat(src));return proc.apply(null,linkedValues)}return{global:globalBlock,link:link,block:block,proc:proc,scope:scope,cond:conditional,compile:compile}}var CUTE_COMPONENTS="xyzw".split("");var GL_UNSIGNED_BYTE$7=5121;var ATTRIB_STATE_POINTER=1;var ATTRIB_STATE_CONSTANT=2;var DYN_FUNC$1=0;var DYN_PROP$1=1;var DYN_CONTEXT$1=2;var DYN_STATE$1=3;var DYN_THUNK=4;var S_DITHER="dither";var S_BLEND_ENABLE="blend.enable";var S_BLEND_COLOR="blend.color";var S_BLEND_EQUATION="blend.equation";var S_BLEND_FUNC="blend.func";var S_DEPTH_ENABLE="depth.enable";var S_DEPTH_FUNC="depth.func";var S_DEPTH_RANGE="depth.range";var S_DEPTH_MASK="depth.mask";var S_COLOR_MASK="colorMask";var S_CULL_ENABLE="cull.enable";var S_CULL_FACE="cull.face";var S_FRONT_FACE="frontFace";var S_LINE_WIDTH="lineWidth";var S_POLYGON_OFFSET_ENABLE="polygonOffset.enable";var S_POLYGON_OFFSET_OFFSET="polygonOffset.offset";var S_SAMPLE_ALPHA="sample.alpha";var S_SAMPLE_ENABLE="sample.enable";var S_SAMPLE_COVERAGE="sample.coverage";var S_STENCIL_ENABLE="stencil.enable";var S_STENCIL_MASK="stencil.mask";var S_STENCIL_FUNC="stencil.func";var S_STENCIL_OPFRONT="stencil.opFront";var S_STENCIL_OPBACK="stencil.opBack";var S_SCISSOR_ENABLE="scissor.enable";var S_SCISSOR_BOX="scissor.box";var S_VIEWPORT="viewport";var S_PROFILE="profile";var S_FRAMEBUFFER="framebuffer";var S_VERT="vert";var S_FRAG="frag";var S_ELEMENTS="elements";var S_PRIMITIVE="primitive";var S_COUNT="count";var S_OFFSET="offset";var S_INSTANCES="instances";var SUFFIX_WIDTH="Width";var SUFFIX_HEIGHT="Height";var S_FRAMEBUFFER_WIDTH=S_FRAMEBUFFER+SUFFIX_WIDTH;var S_FRAMEBUFFER_HEIGHT=S_FRAMEBUFFER+SUFFIX_HEIGHT;var S_VIEWPORT_WIDTH=S_VIEWPORT+SUFFIX_WIDTH;var S_VIEWPORT_HEIGHT=S_VIEWPORT+SUFFIX_HEIGHT;var S_DRAWINGBUFFER="drawingBuffer";var S_DRAWINGBUFFER_WIDTH=S_DRAWINGBUFFER+SUFFIX_WIDTH;var S_DRAWINGBUFFER_HEIGHT=S_DRAWINGBUFFER+SUFFIX_HEIGHT;var NESTED_OPTIONS=[S_BLEND_FUNC,S_BLEND_EQUATION,S_STENCIL_FUNC,S_STENCIL_OPFRONT,S_STENCIL_OPBACK,S_SAMPLE_COVERAGE,S_VIEWPORT,S_SCISSOR_BOX,S_POLYGON_OFFSET_OFFSET];var GL_ARRAY_BUFFER$1=34962;var GL_ELEMENT_ARRAY_BUFFER$1=34963;var GL_FRAGMENT_SHADER$1=35632;var GL_VERTEX_SHADER$1=35633;var GL_TEXTURE_2D$2=3553;var GL_TEXTURE_CUBE_MAP$1=34067;var GL_CULL_FACE=2884;var GL_BLEND=3042;var GL_DITHER=3024;var GL_STENCIL_TEST=2960;var GL_DEPTH_TEST=2929;var GL_SCISSOR_TEST=3089;var GL_POLYGON_OFFSET_FILL=32823;var GL_SAMPLE_ALPHA_TO_COVERAGE=32926;var GL_SAMPLE_COVERAGE=32928;var GL_FLOAT$7=5126;var GL_FLOAT_VEC2=35664;var GL_FLOAT_VEC3=35665;var GL_FLOAT_VEC4=35666;var GL_INT$3=5124;var GL_INT_VEC2=35667;var GL_INT_VEC3=35668;var GL_INT_VEC4=35669;var GL_BOOL=35670;var GL_BOOL_VEC2=35671;var GL_BOOL_VEC3=35672;var GL_BOOL_VEC4=35673;var GL_FLOAT_MAT2=35674;var GL_FLOAT_MAT3=35675;var GL_FLOAT_MAT4=35676;var GL_SAMPLER_2D=35678;var GL_SAMPLER_CUBE=35680;var GL_TRIANGLES$1=4;var GL_FRONT=1028;var GL_BACK=1029;var GL_CW=2304;var GL_CCW=2305;var GL_MIN_EXT=32775;var GL_MAX_EXT=32776;var GL_ALWAYS=519;var GL_KEEP=7680;var GL_ZERO=0;var GL_ONE=1;var GL_FUNC_ADD=32774;var GL_LESS=513;var GL_FRAMEBUFFER$1=36160;var GL_COLOR_ATTACHMENT0$1=36064;var blendFuncs={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776};var invalidBlendCombinations=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"];var compareFuncs={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519};var stencilOps={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};var shaderType={frag:GL_FRAGMENT_SHADER$1,vert:GL_VERTEX_SHADER$1};var orientationType={cw:GL_CW,ccw:GL_CCW};function isBufferArgs(x){return Array.isArray(x)||isTypedArray(x)||isNDArrayLike(x)}function sortState(state){return state.sort(function(a,b){if(a===S_VIEWPORT){return-1}else if(b===S_VIEWPORT){return 1}return a<b?-1:1})}function Declaration(thisDep,contextDep,propDep,append){this.thisDep=thisDep;this.contextDep=contextDep;this.propDep=propDep;this.append=append}function isStatic(decl){return decl&&!(decl.thisDep||decl.contextDep||decl.propDep)}function createStaticDecl(append){return new Declaration(false,false,false,append)}function createDynamicDecl(dyn,append){var type=dyn.type;if(type===DYN_FUNC$1){var numArgs=dyn.data.length;return new Declaration(true,numArgs>=1,numArgs>=2,append)}else if(type===DYN_THUNK){var data=dyn.data;return new Declaration(data.thisDep,data.contextDep,data.propDep,append)}else{return new Declaration(type===DYN_STATE$1,type===DYN_CONTEXT$1,type===DYN_PROP$1,append)}}var SCOPE_DECL=new Declaration(false,false,false,function(){});function reglCore(gl,stringStore,extensions,limits,bufferState,elementState,textureState,framebufferState,uniformState,attributeState,shaderState,drawState,contextState,timer,config){var AttributeRecord=attributeState.Record;var blendEquations={add:32774,subtract:32778,"reverse subtract":32779};if(extensions.ext_blend_minmax){blendEquations.min=GL_MIN_EXT;blendEquations.max=GL_MAX_EXT}var extInstancing=extensions.angle_instanced_arrays;var extDrawBuffers=extensions.webgl_draw_buffers;var currentState={dirty:true,profile:config.profile};var nextState={};var GL_STATE_NAMES=[];var GL_FLAGS={};var GL_VARIABLES={};function propName(name){return name.replace(".","_")}function stateFlag(sname,cap,init){var name=propName(sname);GL_STATE_NAMES.push(sname);nextState[name]=currentState[name]=!!init;GL_FLAGS[name]=cap}function stateVariable(sname,func,init){var name=propName(sname);GL_STATE_NAMES.push(sname);if(Array.isArray(init)){currentState[name]=init.slice();nextState[name]=init.slice()}else{currentState[name]=nextState[name]=init}GL_VARIABLES[name]=func}stateFlag(S_DITHER,GL_DITHER);stateFlag(S_BLEND_ENABLE,GL_BLEND);stateVariable(S_BLEND_COLOR,"blendColor",[0,0,0,0]);stateVariable(S_BLEND_EQUATION,"blendEquationSeparate",[GL_FUNC_ADD,GL_FUNC_ADD]);stateVariable(S_BLEND_FUNC,"blendFuncSeparate",[GL_ONE,GL_ZERO,GL_ONE,GL_ZERO]);stateFlag(S_DEPTH_ENABLE,GL_DEPTH_TEST,true);stateVariable(S_DEPTH_FUNC,"depthFunc",GL_LESS);stateVariable(S_DEPTH_RANGE,"depthRange",[0,1]);stateVariable(S_DEPTH_MASK,"depthMask",true);stateVariable(S_COLOR_MASK,S_COLOR_MASK,[true,true,true,true]);stateFlag(S_CULL_ENABLE,GL_CULL_FACE);stateVariable(S_CULL_FACE,"cullFace",GL_BACK);stateVariable(S_FRONT_FACE,S_FRONT_FACE,GL_CCW);stateVariable(S_LINE_WIDTH,S_LINE_WIDTH,1);stateFlag(S_POLYGON_OFFSET_ENABLE,GL_POLYGON_OFFSET_FILL);stateVariable(S_POLYGON_OFFSET_OFFSET,"polygonOffset",[0,0]);stateFlag(S_SAMPLE_ALPHA,GL_SAMPLE_ALPHA_TO_COVERAGE);stateFlag(S_SAMPLE_ENABLE,GL_SAMPLE_COVERAGE);stateVariable(S_SAMPLE_COVERAGE,"sampleCoverage",[1,false]);stateFlag(S_STENCIL_ENABLE,GL_STENCIL_TEST);stateVariable(S_STENCIL_MASK,"stencilMask",-1);stateVariable(S_STENCIL_FUNC,"stencilFunc",[GL_ALWAYS,0,-1]);stateVariable(S_STENCIL_OPFRONT,"stencilOpSeparate",[GL_FRONT,GL_KEEP,GL_KEEP,GL_KEEP]);stateVariable(S_STENCIL_OPBACK,"stencilOpSeparate",[GL_BACK,GL_KEEP,GL_KEEP,GL_KEEP]);stateFlag(S_SCISSOR_ENABLE,GL_SCISSOR_TEST);stateVariable(S_SCISSOR_BOX,"scissor",[0,0,gl.drawingBufferWidth,gl.drawingBufferHeight]);stateVariable(S_VIEWPORT,S_VIEWPORT,[0,0,gl.drawingBufferWidth,gl.drawingBufferHeight]);var sharedState={gl:gl,context:contextState,strings:stringStore,next:nextState,current:currentState,draw:drawState,elements:elementState,buffer:bufferState,shader:shaderState,attributes:attributeState.state,uniforms:uniformState,framebuffer:framebufferState,extensions:extensions,timer:timer,isBufferArgs:isBufferArgs};var sharedConstants={primTypes:primTypes,compareFuncs:compareFuncs,blendFuncs:blendFuncs,blendEquations:blendEquations,stencilOps:stencilOps,glTypes:glTypes,orientationType:orientationType};check$1.optional(function(){sharedState.isArrayLike=isArrayLike});if(extDrawBuffers){sharedConstants.backBuffer=[GL_BACK];sharedConstants.drawBuffer=loop(limits.maxDrawbuffers,function(i){if(i===0){return[0]}return loop(i,function(j){return GL_COLOR_ATTACHMENT0$1+j})})}var drawCallCounter=0;function createREGLEnvironment(){var env=createEnvironment();var link=env.link;var global=env.global;env.id=drawCallCounter++;env.batchId="0";var SHARED=link(sharedState);var shared=env.shared={props:"a0"};Object.keys(sharedState).forEach(function(prop){shared[prop]=global.def(SHARED,".",prop)});check$1.optional(function(){env.CHECK=link(check$1);env.commandStr=check$1.guessCommand();env.command=link(env.commandStr);env.assert=function(block,pred,message){block("if(!(",pred,"))",this.CHECK,".commandRaise(",link(message),",",this.command,");")};sharedConstants.invalidBlendCombinations=invalidBlendCombinations});var nextVars=env.next={};var currentVars=env.current={};Object.keys(GL_VARIABLES).forEach(function(variable){if(Array.isArray(currentState[variable])){nextVars[variable]=global.def(shared.next,".",variable);currentVars[variable]=global.def(shared.current,".",variable)}});var constants=env.constants={};Object.keys(sharedConstants).forEach(function(name){constants[name]=global.def(JSON.stringify(sharedConstants[name]))});env.invoke=function(block,x){switch(x.type){case DYN_FUNC$1:var argList=["this",shared.context,shared.props,env.batchId];return block.def(link(x.data),".call(",argList.slice(0,Math.max(x.data.length+1,4)),")");case DYN_PROP$1:return block.def(shared.props,x.data);case DYN_CONTEXT$1:return block.def(shared.context,x.data);case DYN_STATE$1:return block.def("this",x.data);case DYN_THUNK:x.data.append(env,block);return x.data.ref}};env.attribCache={};var scopeAttribs={};env.scopeAttrib=function(name){var id=stringStore.id(name);if(id in scopeAttribs){return scopeAttribs[id]}var binding=attributeState.scope[id];if(!binding){binding=attributeState.scope[id]=new AttributeRecord}var result=scopeAttribs[id]=link(binding);return result};return env}function parseProfile(options){var staticOptions=options.static;var dynamicOptions=options.dynamic;var profileEnable;if(S_PROFILE in staticOptions){var value=!!staticOptions[S_PROFILE];profileEnable=createStaticDecl(function(env,scope){return value});profileEnable.enable=value}else if(S_PROFILE in dynamicOptions){var dyn=dynamicOptions[S_PROFILE];profileEnable=createDynamicDecl(dyn,function(env,scope){return env.invoke(scope,dyn)})}return profileEnable}function parseFramebuffer(options,env){var staticOptions=options.static;var dynamicOptions=options.dynamic;if(S_FRAMEBUFFER in staticOptions){var framebuffer=staticOptions[S_FRAMEBUFFER];if(framebuffer){framebuffer=framebufferState.getFramebuffer(framebuffer);check$1.command(framebuffer,"invalid framebuffer object");return createStaticDecl(function(env,block){var FRAMEBUFFER=env.link(framebuffer);var shared=env.shared;block.set(shared.framebuffer,".next",FRAMEBUFFER);var CONTEXT=shared.context;block.set(CONTEXT,"."+S_FRAMEBUFFER_WIDTH,FRAMEBUFFER+".width");block.set(CONTEXT,"."+S_FRAMEBUFFER_HEIGHT,FRAMEBUFFER+".height");return FRAMEBUFFER})}else{return createStaticDecl(function(env,scope){var shared=env.shared;scope.set(shared.framebuffer,".next","null");var CONTEXT=shared.context;scope.set(CONTEXT,"."+S_FRAMEBUFFER_WIDTH,CONTEXT+"."+S_DRAWINGBUFFER_WIDTH);scope.set(CONTEXT,"."+S_FRAMEBUFFER_HEIGHT,CONTEXT+"."+S_DRAWINGBUFFER_HEIGHT);return"null"})}}else if(S_FRAMEBUFFER in dynamicOptions){var dyn=dynamicOptions[S_FRAMEBUFFER];return createDynamicDecl(dyn,function(env,scope){var FRAMEBUFFER_FUNC=env.invoke(scope,dyn);var shared=env.shared;var FRAMEBUFFER_STATE=shared.framebuffer;var FRAMEBUFFER=scope.def(FRAMEBUFFER_STATE,".getFramebuffer(",FRAMEBUFFER_FUNC,")");check$1.optional(function(){env.assert(scope,"!"+FRAMEBUFFER_FUNC+"||"+FRAMEBUFFER,"invalid framebuffer object")});scope.set(FRAMEBUFFER_STATE,".next",FRAMEBUFFER);var CONTEXT=shared.context;scope.set(CONTEXT,"."+S_FRAMEBUFFER_WIDTH,FRAMEBUFFER+"?"+FRAMEBUFFER+".width:"+CONTEXT+"."+S_DRAWINGBUFFER_WIDTH);scope.set(CONTEXT,"."+S_FRAMEBUFFER_HEIGHT,FRAMEBUFFER+"?"+FRAMEBUFFER+".height:"+CONTEXT+"."+S_DRAWINGBUFFER_HEIGHT);return FRAMEBUFFER})}else{return null}}function parseViewportScissor(options,framebuffer,env){var staticOptions=options.static;var dynamicOptions=options.dynamic;function parseBox(param){if(param in staticOptions){var box=staticOptions[param];check$1.commandType(box,"object","invalid "+param,env.commandStr);var isStatic=true;var x=box.x|0;var y=box.y|0;var w,h;if("width"in box){w=box.width|0;check$1.command(w>=0,"invalid "+param,env.commandStr)}else{isStatic=false}if("height"in box){h=box.height|0;check$1.command(h>=0,"invalid "+param,env.commandStr)}else{isStatic=false}return new Declaration(!isStatic&&framebuffer&&framebuffer.thisDep,!isStatic&&framebuffer&&framebuffer.contextDep,!isStatic&&framebuffer&&framebuffer.propDep,function(env,scope){var CONTEXT=env.shared.context;var BOX_W=w;if(!("width"in box)){BOX_W=scope.def(CONTEXT,".",S_FRAMEBUFFER_WIDTH,"-",x)}var BOX_H=h;if(!("height"in box)){BOX_H=scope.def(CONTEXT,".",S_FRAMEBUFFER_HEIGHT,"-",y)}return[x,y,BOX_W,BOX_H]})}else if(param in dynamicOptions){var dynBox=dynamicOptions[param];var result=createDynamicDecl(dynBox,function(env,scope){var BOX=env.invoke(scope,dynBox);check$1.optional(function(){env.assert(scope,BOX+"&&typeof "+BOX+'==="object"',"invalid "+param)});var CONTEXT=env.shared.context;var BOX_X=scope.def(BOX,".x|0");var BOX_Y=scope.def(BOX,".y|0");var BOX_W=scope.def('"width" in ',BOX,"?",BOX,".width|0:","(",CONTEXT,".",S_FRAMEBUFFER_WIDTH,"-",BOX_X,")");var BOX_H=scope.def('"height" in ',BOX,"?",BOX,".height|0:","(",CONTEXT,".",S_FRAMEBUFFER_HEIGHT,"-",BOX_Y,")");check$1.optional(function(){env.assert(scope,BOX_W+">=0&&"+BOX_H+">=0","invalid "+param)});return[BOX_X,BOX_Y,BOX_W,BOX_H]});if(framebuffer){result.thisDep=result.thisDep||framebuffer.thisDep;result.contextDep=result.contextDep||framebuffer.contextDep;result.propDep=result.propDep||framebuffer.propDep}return result}else if(framebuffer){return new Declaration(framebuffer.thisDep,framebuffer.contextDep,framebuffer.propDep,function(env,scope){var CONTEXT=env.shared.context;return[0,0,scope.def(CONTEXT,".",S_FRAMEBUFFER_WIDTH),scope.def(CONTEXT,".",S_FRAMEBUFFER_HEIGHT)]})}else{return null}}var viewport=parseBox(S_VIEWPORT);if(viewport){var prevViewport=viewport;viewport=new Declaration(viewport.thisDep,viewport.contextDep,viewport.propDep,function(env,scope){var VIEWPORT=prevViewport.append(env,scope);var CONTEXT=env.shared.context;scope.set(CONTEXT,"."+S_VIEWPORT_WIDTH,VIEWPORT[2]);scope.set(CONTEXT,"."+S_VIEWPORT_HEIGHT,VIEWPORT[3]);return VIEWPORT})}return{viewport:viewport,scissor_box:parseBox(S_SCISSOR_BOX)}}function parseProgram(options){var staticOptions=options.static;var dynamicOptions=options.dynamic;function parseShader(name){if(name in staticOptions){var id=stringStore.id(staticOptions[name]);check$1.optional(function(){shaderState.shader(shaderType[name],id,check$1.guessCommand())});var result=createStaticDecl(function(){return id});result.id=id;return result}else if(name in dynamicOptions){var dyn=dynamicOptions[name];return createDynamicDecl(dyn,function(env,scope){var str=env.invoke(scope,dyn);var id=scope.def(env.shared.strings,".id(",str,")");check$1.optional(function(){scope(env.shared.shader,".shader(",shaderType[name],",",id,",",env.command,");")});return id})}return null}var frag=parseShader(S_FRAG);var vert=parseShader(S_VERT);var program=null;var progVar;if(isStatic(frag)&&isStatic(vert)){program=shaderState.program(vert.id,frag.id);progVar=createStaticDecl(function(env,scope){return env.link(program)})}else{progVar=new Declaration(frag&&frag.thisDep||vert&&vert.thisDep,frag&&frag.contextDep||vert&&vert.contextDep,frag&&frag.propDep||vert&&vert.propDep,function(env,scope){var SHADER_STATE=env.shared.shader;var fragId;if(frag){fragId=frag.append(env,scope)}else{fragId=scope.def(SHADER_STATE,".",S_FRAG)}var vertId;if(vert){vertId=vert.append(env,scope)}else{vertId=scope.def(SHADER_STATE,".",S_VERT)}var progDef=SHADER_STATE+".program("+vertId+","+fragId;check$1.optional(function(){progDef+=","+env.command});return scope.def(progDef+")")})}return{frag:frag,vert:vert,progVar:progVar,program:program}}function parseDraw(options,env){var staticOptions=options.static;var dynamicOptions=options.dynamic;function parseElements(){if(S_ELEMENTS in staticOptions){var elements=staticOptions[S_ELEMENTS];if(isBufferArgs(elements)){elements=elementState.getElements(elementState.create(elements,true))}else if(elements){elements=elementState.getElements(elements);check$1.command(elements,"invalid elements",env.commandStr)}var result=createStaticDecl(function(env,scope){if(elements){var result=env.link(elements);env.ELEMENTS=result;return result}env.ELEMENTS=null;return null});result.value=elements;return result}else if(S_ELEMENTS in dynamicOptions){var dyn=dynamicOptions[S_ELEMENTS];return createDynamicDecl(dyn,function(env,scope){var shared=env.shared;var IS_BUFFER_ARGS=shared.isBufferArgs;var ELEMENT_STATE=shared.elements;var elementDefn=env.invoke(scope,dyn);var elements=scope.def("null");var elementStream=scope.def(IS_BUFFER_ARGS,"(",elementDefn,")");var ifte=env.cond(elementStream).then(elements,"=",ELEMENT_STATE,".createStream(",elementDefn,");").else(elements,"=",ELEMENT_STATE,".getElements(",elementDefn,");");check$1.optional(function(){env.assert(ifte.else,"!"+elementDefn+"||"+elements,"invalid elements")});scope.entry(ifte);scope.exit(env.cond(elementStream).then(ELEMENT_STATE,".destroyStream(",elements,");"));env.ELEMENTS=elements;return elements})}return null}var elements=parseElements();function parsePrimitive(){if(S_PRIMITIVE in staticOptions){var primitive=staticOptions[S_PRIMITIVE];check$1.commandParameter(primitive,primTypes,"invalid primitve",env.commandStr);return createStaticDecl(function(env,scope){return primTypes[primitive]})}else if(S_PRIMITIVE in dynamicOptions){var dynPrimitive=dynamicOptions[S_PRIMITIVE];return createDynamicDecl(dynPrimitive,function(env,scope){var PRIM_TYPES=env.constants.primTypes;var prim=env.invoke(scope,dynPrimitive);check$1.optional(function(){env.assert(scope,prim+" in "+PRIM_TYPES,"invalid primitive, must be one of "+Object.keys(primTypes))});return scope.def(PRIM_TYPES,"[",prim,"]")})}else if(elements){if(isStatic(elements)){if(elements.value){return createStaticDecl(function(env,scope){return scope.def(env.ELEMENTS,".primType")})}else{return createStaticDecl(function(){return GL_TRIANGLES$1})}}else{return new Declaration(elements.thisDep,elements.contextDep,elements.propDep,function(env,scope){var elements=env.ELEMENTS;return scope.def(elements,"?",elements,".primType:",GL_TRIANGLES$1)})}}return null}function parseParam(param,isOffset){if(param in staticOptions){var value=staticOptions[param]|0;check$1.command(!isOffset||value>=0,"invalid "+param,env.commandStr);return createStaticDecl(function(env,scope){if(isOffset){env.OFFSET=value}return value})}else if(param in dynamicOptions){var dynValue=dynamicOptions[param];return createDynamicDecl(dynValue,function(env,scope){var result=env.invoke(scope,dynValue);if(isOffset){env.OFFSET=result;check$1.optional(function(){env.assert(scope,result+">=0","invalid "+param)})}return result})}else if(isOffset&&elements){return createStaticDecl(function(env,scope){env.OFFSET="0";return 0})}return null}var OFFSET=parseParam(S_OFFSET,true);function parseVertCount(){if(S_COUNT in staticOptions){var count=staticOptions[S_COUNT]|0;check$1.command(typeof count==="number"&&count>=0,"invalid vertex count",env.commandStr);return createStaticDecl(function(){return count})}else if(S_COUNT in dynamicOptions){var dynCount=dynamicOptions[S_COUNT];return createDynamicDecl(dynCount,function(env,scope){var result=env.invoke(scope,dynCount);check$1.optional(function(){env.assert(scope,"typeof "+result+'==="number"&&'+result+">=0&&"+result+"===("+result+"|0)","invalid vertex count")});return result})}else if(elements){if(isStatic(elements)){if(elements){if(OFFSET){return new Declaration(OFFSET.thisDep,OFFSET.contextDep,OFFSET.propDep,function(env,scope){var result=scope.def(env.ELEMENTS,".vertCount-",env.OFFSET);check$1.optional(function(){env.assert(scope,result+">=0","invalid vertex offset/element buffer too small")});return result})}else{return createStaticDecl(function(env,scope){return scope.def(env.ELEMENTS,".vertCount")})}}else{var result=createStaticDecl(function(){return-1});check$1.optional(function(){result.MISSING=true});return result}}else{var variable=new Declaration(elements.thisDep||OFFSET.thisDep,elements.contextDep||OFFSET.contextDep,elements.propDep||OFFSET.propDep,function(env,scope){var elements=env.ELEMENTS;if(env.OFFSET){return scope.def(elements,"?",elements,".vertCount-",env.OFFSET,":-1")}return scope.def(elements,"?",elements,".vertCount:-1")});check$1.optional(function(){variable.DYNAMIC=true});return variable}}return null}return{elements:elements,primitive:parsePrimitive(),count:parseVertCount(),instances:parseParam(S_INSTANCES,false),offset:OFFSET}}function parseGLState(options,env){var staticOptions=options.static;var dynamicOptions=options.dynamic;var STATE={};GL_STATE_NAMES.forEach(function(prop){var param=propName(prop);function parseParam(parseStatic,parseDynamic){if(prop in staticOptions){var value=parseStatic(staticOptions[prop]);STATE[param]=createStaticDecl(function(){return value})}else if(prop in dynamicOptions){var dyn=dynamicOptions[prop];STATE[param]=createDynamicDecl(dyn,function(env,scope){return parseDynamic(env,scope,env.invoke(scope,dyn))})}}switch(prop){case S_CULL_ENABLE:case S_BLEND_ENABLE:case S_DITHER:case S_STENCIL_ENABLE:case S_DEPTH_ENABLE:case S_SCISSOR_ENABLE:case S_POLYGON_OFFSET_ENABLE:case S_SAMPLE_ALPHA:case S_SAMPLE_ENABLE:case S_DEPTH_MASK:return parseParam(function(value){check$1.commandType(value,"boolean",prop,env.commandStr);return value},function(env,scope,value){check$1.optional(function(){env.assert(scope,"typeof "+value+'==="boolean"',"invalid flag "+prop,env.commandStr)});return value});case S_DEPTH_FUNC:return parseParam(function(value){check$1.commandParameter(value,compareFuncs,"invalid "+prop,env.commandStr);return compareFuncs[value]},function(env,scope,value){var COMPARE_FUNCS=env.constants.compareFuncs;check$1.optional(function(){env.assert(scope,value+" in "+COMPARE_FUNCS,"invalid "+prop+", must be one of "+Object.keys(compareFuncs))});return scope.def(COMPARE_FUNCS,"[",value,"]")});case S_DEPTH_RANGE:return parseParam(function(value){check$1.command(isArrayLike(value)&&value.length===2&&typeof value[0]==="number"&&typeof value[1]==="number"&&value[0]<=value[1],"depth range is 2d array",env.commandStr);return value},function(env,scope,value){check$1.optional(function(){env.assert(scope,env.shared.isArrayLike+"("+value+")&&"+value+".length===2&&"+"typeof "+value+'[0]==="number"&&'+"typeof "+value+'[1]==="number"&&'+value+"[0]<="+value+"[1]","depth range must be a 2d array")});var Z_NEAR=scope.def("+",value,"[0]");var Z_FAR=scope.def("+",value,"[1]");return[Z_NEAR,Z_FAR]});case S_BLEND_FUNC:return parseParam(function(value){check$1.commandType(value,"object","blend.func",env.commandStr);var srcRGB="srcRGB"in value?value.srcRGB:value.src;var srcAlpha="srcAlpha"in value?value.srcAlpha:value.src;var dstRGB="dstRGB"in value?value.dstRGB:value.dst;var dstAlpha="dstAlpha"in value?value.dstAlpha:value.dst;check$1.commandParameter(srcRGB,blendFuncs,param+".srcRGB",env.commandStr);check$1.commandParameter(srcAlpha,blendFuncs,param+".srcAlpha",env.commandStr);check$1.commandParameter(dstRGB,blendFuncs,param+".dstRGB",env.commandStr);check$1.commandParameter(dstAlpha,blendFuncs,param+".dstAlpha",env.commandStr);check$1.command(invalidBlendCombinations.indexOf(srcRGB+", "+dstRGB)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+srcRGB+", "+dstRGB+")",env.commandStr);return[blendFuncs[srcRGB],blendFuncs[dstRGB],blendFuncs[srcAlpha],blendFuncs[dstAlpha]]},function(env,scope,value){var BLEND_FUNCS=env.constants.blendFuncs;check$1.optional(function(){env.assert(scope,value+"&&typeof "+value+'==="object"',"invalid blend func, must be an object")});function read(prefix,suffix){var func=scope.def('"',prefix,suffix,'" in ',value,"?",value,".",prefix,suffix,":",value,".",prefix);check$1.optional(function(){env.assert(scope,func+" in "+BLEND_FUNCS,"invalid "+prop+"."+prefix+suffix+", must be one of "+Object.keys(blendFuncs))});return func}var srcRGB=read("src","RGB");var dstRGB=read("dst","RGB");check$1.optional(function(){var INVALID_BLEND_COMBINATIONS=env.constants.invalidBlendCombinations;env.assert(scope,INVALID_BLEND_COMBINATIONS+".indexOf("+srcRGB+'+", "+'+dstRGB+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var SRC_RGB=scope.def(BLEND_FUNCS,"[",srcRGB,"]");var SRC_ALPHA=scope.def(BLEND_FUNCS,"[",read("src","Alpha"),"]");var DST_RGB=scope.def(BLEND_FUNCS,"[",dstRGB,"]");var DST_ALPHA=scope.def(BLEND_FUNCS,"[",read("dst","Alpha"),"]");return[SRC_RGB,DST_RGB,SRC_ALPHA,DST_ALPHA]});case S_BLEND_EQUATION:return parseParam(function(value){if(typeof value==="string"){check$1.commandParameter(value,blendEquations,"invalid "+prop,env.commandStr);return[blendEquations[value],blendEquations[value]]}else if(typeof value==="object"){check$1.commandParameter(value.rgb,blendEquations,prop+".rgb",env.commandStr);check$1.commandParameter(value.alpha,blendEquations,prop+".alpha",env.commandStr);return[blendEquations[value.rgb],blendEquations[value.alpha]]}else{check$1.commandRaise("invalid blend.equation",env.commandStr)}},function(env,scope,value){var BLEND_EQUATIONS=env.constants.blendEquations;var RGB=scope.def();var ALPHA=scope.def();var ifte=env.cond("typeof ",value,'==="string"');check$1.optional(function(){function checkProp(block,name,value){env.assert(block,value+" in "+BLEND_EQUATIONS,"invalid "+name+", must be one of "+Object.keys(blendEquations))}checkProp(ifte.then,prop,value);env.assert(ifte.else,value+"&&typeof "+value+'==="object"',"invalid "+prop);checkProp(ifte.else,prop+".rgb",value+".rgb");checkProp(ifte.else,prop+".alpha",value+".alpha")});ifte.then(RGB,"=",ALPHA,"=",BLEND_EQUATIONS,"[",value,"];");ifte.else(RGB,"=",BLEND_EQUATIONS,"[",value,".rgb];",ALPHA,"=",BLEND_EQUATIONS,"[",value,".alpha];");scope(ifte);return[RGB,ALPHA]});case S_BLEND_COLOR:return parseParam(function(value){check$1.command(isArrayLike(value)&&value.length===4,"blend.color must be a 4d array",env.commandStr);return loop(4,function(i){return+value[i]})},function(env,scope,value){check$1.optional(function(){env.assert(scope,env.shared.isArrayLike+"("+value+")&&"+value+".length===4","blend.color must be a 4d array")});return loop(4,function(i){return scope.def("+",value,"[",i,"]")})});case S_STENCIL_MASK:return parseParam(function(value){check$1.commandType(value,"number",param,env.commandStr);return value|0},function(env,scope,value){check$1.optional(function(){env.assert(scope,"typeof "+value+'==="number"',"invalid stencil.mask")});return scope.def(value,"|0")});case S_STENCIL_FUNC:return parseParam(function(value){check$1.commandType(value,"object",param,env.commandStr);var cmp=value.cmp||"keep";var ref=value.ref||0;var mask="mask"in value?value.mask:-1;check$1.commandParameter(cmp,compareFuncs,prop+".cmp",env.commandStr);check$1.commandType(ref,"number",prop+".ref",env.commandStr);check$1.commandType(mask,"number",prop+".mask",env.commandStr);return[compareFuncs[cmp],ref,mask]},function(env,scope,value){var COMPARE_FUNCS=env.constants.compareFuncs;check$1.optional(function(){function assert(){env.assert(scope,Array.prototype.join.call(arguments,""),"invalid stencil.func")}assert(value+"&&typeof ",value,'==="object"');assert('!("cmp" in ',value,")||(",value,".cmp in ",COMPARE_FUNCS,")")});var cmp=scope.def('"cmp" in ',value,"?",COMPARE_FUNCS,"[",value,".cmp]",":",GL_KEEP);var ref=scope.def(value,".ref|0");var mask=scope.def('"mask" in ',value,"?",value,".mask|0:-1");return[cmp,ref,mask]});case S_STENCIL_OPFRONT:case S_STENCIL_OPBACK:return parseParam(function(value){check$1.commandType(value,"object",param,env.commandStr);var fail=value.fail||"keep";var zfail=value.zfail||"keep";var zpass=value.zpass||"keep";check$1.commandParameter(fail,stencilOps,prop+".fail",env.commandStr);check$1.commandParameter(zfail,stencilOps,prop+".zfail",env.commandStr);check$1.commandParameter(zpass,stencilOps,prop+".zpass",env.commandStr);return[prop===S_STENCIL_OPBACK?GL_BACK:GL_FRONT,stencilOps[fail],stencilOps[zfail],stencilOps[zpass]]},function(env,scope,value){var STENCIL_OPS=env.constants.stencilOps;check$1.optional(function(){env.assert(scope,value+"&&typeof "+value+'==="object"',"invalid "+prop)});function read(name){check$1.optional(function(){env.assert(scope,'!("'+name+'" in '+value+")||"+"("+value+"."+name+" in "+STENCIL_OPS+")","invalid "+prop+"."+name+", must be one of "+Object.keys(stencilOps))});return scope.def('"',name,'" in ',value,"?",STENCIL_OPS,"[",value,".",name,"]:",GL_KEEP)}return[prop===S_STENCIL_OPBACK?GL_BACK:GL_FRONT,read("fail"),read("zfail"),read("zpass")]});case S_POLYGON_OFFSET_OFFSET:return parseParam(function(value){check$1.commandType(value,"object",param,env.commandStr);var factor=value.factor|0;var units=value.units|0;check$1.commandType(factor,"number",param+".factor",env.commandStr);check$1.commandType(units,"number",param+".units",env.commandStr);return[factor,units]},function(env,scope,value){check$1.optional(function(){env.assert(scope,value+"&&typeof "+value+'==="object"',"invalid "+prop)});var FACTOR=scope.def(value,".factor|0");var UNITS=scope.def(value,".units|0");return[FACTOR,UNITS]});case S_CULL_FACE:return parseParam(function(value){var face=0;if(value==="front"){face=GL_FRONT}else if(value==="back"){face=GL_BACK}check$1.command(!!face,param,env.commandStr);return face},function(env,scope,value){check$1.optional(function(){env.assert(scope,value+'==="front"||'+value+'==="back"',"invalid cull.face")});return scope.def(value,'==="front"?',GL_FRONT,":",GL_BACK)});case S_LINE_WIDTH:return parseParam(function(value){check$1.command(typeof value==="number"&&value>=limits.lineWidthDims[0]&&value<=limits.lineWidthDims[1],"invalid line width, must positive number between "+limits.lineWidthDims[0]+" and "+limits.lineWidthDims[1],env.commandStr);return value},function(env,scope,value){check$1.optional(function(){env.assert(scope,"typeof "+value+'==="number"&&'+value+">="+limits.lineWidthDims[0]+"&&"+value+"<="+limits.lineWidthDims[1],"invalid line width")});return value});case S_FRONT_FACE:return parseParam(function(value){check$1.commandParameter(value,orientationType,param,env.commandStr);return orientationType[value]},function(env,scope,value){check$1.optional(function(){env.assert(scope,value+'==="cw"||'+value+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return scope.def(value+'==="cw"?'+GL_CW+":"+GL_CCW)});case S_COLOR_MASK:return parseParam(function(value){check$1.command(isArrayLike(value)&&value.length===4,"color.mask must be length 4 array",env.commandStr);return value.map(function(v){return!!v})},function(env,scope,value){check$1.optional(function(){env.assert(scope,env.shared.isArrayLike+"("+value+")&&"+value+".length===4","invalid color.mask")});return loop(4,function(i){return"!!"+value+"["+i+"]"})});case S_SAMPLE_COVERAGE:return parseParam(function(value){check$1.command(typeof value==="object"&&value,param,env.commandStr);var sampleValue="value"in value?value.value:1;var sampleInvert=!!value.invert;check$1.command(typeof sampleValue==="number"&&sampleValue>=0&&sampleValue<=1,"sample.coverage.value must be a number between 0 and 1",env.commandStr);return[sampleValue,sampleInvert]},function(env,scope,value){check$1.optional(function(){env.assert(scope,value+"&&typeof "+value+'==="object"',"invalid sample.coverage")});var VALUE=scope.def('"value" in ',value,"?+",value,".value:1");var INVERT=scope.def("!!",value,".invert");return[VALUE,INVERT]})}});return STATE}function parseUniforms(uniforms,env){var staticUniforms=uniforms.static;var dynamicUniforms=uniforms.dynamic;var UNIFORMS={};Object.keys(staticUniforms).forEach(function(name){var value=staticUniforms[name];var result;if(typeof value==="number"||typeof value==="boolean"){result=createStaticDecl(function(){return value})}else if(typeof value==="function"){var reglType=value._reglType;if(reglType==="texture2d"||reglType==="textureCube"){result=createStaticDecl(function(env){return env.link(value)})}else if(reglType==="framebuffer"||reglType==="framebufferCube"){check$1.command(value.color.length>0,'missing color attachment for framebuffer sent to uniform "'+name+'"',env.commandStr);result=createStaticDecl(function(env){return env.link(value.color[0])})}else{check$1.commandRaise('invalid data for uniform "'+name+'"',env.commandStr)}}else if(isArrayLike(value)){result=createStaticDecl(function(env){var ITEM=env.global.def("[",loop(value.length,function(i){check$1.command(typeof value[i]==="number"||typeof value[i]==="boolean","invalid uniform "+name,env.commandStr);return value[i]}),"]");return ITEM})}else{check$1.commandRaise('invalid or missing data for uniform "'+name+'"',env.commandStr)}result.value=value;UNIFORMS[name]=result});Object.keys(dynamicUniforms).forEach(function(key){var dyn=dynamicUniforms[key];UNIFORMS[key]=createDynamicDecl(dyn,function(env,scope){return env.invoke(scope,dyn)})});return UNIFORMS}function parseAttributes(attributes,env){var staticAttributes=attributes.static;var dynamicAttributes=attributes.dynamic;var attributeDefs={};Object.keys(staticAttributes).forEach(function(attribute){var value=staticAttributes[attribute];var id=stringStore.id(attribute);var record=new AttributeRecord;if(isBufferArgs(value)){record.state=ATTRIB_STATE_POINTER;record.buffer=bufferState.getBuffer(bufferState.create(value,GL_ARRAY_BUFFER$1,false,true));record.type=0}else{var buffer=bufferState.getBuffer(value);if(buffer){record.state=ATTRIB_STATE_POINTER;record.buffer=buffer;record.type=0}else{check$1.command(typeof value==="object"&&value,"invalid data for attribute "+attribute,env.commandStr);if(value.constant){var constant=value.constant;record.buffer="null";record.state=ATTRIB_STATE_CONSTANT;if(typeof constant==="number"){record.x=constant}else{check$1.command(isArrayLike(constant)&&constant.length>0&&constant.length<=4,"invalid constant for attribute "+attribute,env.commandStr);CUTE_COMPONENTS.forEach(function(c,i){if(i<constant.length){record[c]=constant[i]}})}}else{if(isBufferArgs(value.buffer)){buffer=bufferState.getBuffer(bufferState.create(value.buffer,GL_ARRAY_BUFFER$1,false,true))}else{buffer=bufferState.getBuffer(value.buffer)}check$1.command(!!buffer,'missing buffer for attribute "'+attribute+'"',env.commandStr);var offset=value.offset|0;check$1.command(offset>=0,'invalid offset for attribute "'+attribute+'"',env.commandStr);var stride=value.stride|0;check$1.command(stride>=0&&stride<256,'invalid stride for attribute "'+attribute+'", must be integer betweeen [0, 255]',env.commandStr);var size=value.size|0;check$1.command(!("size"in value)||size>0&&size<=4,'invalid size for attribute "'+attribute+'", must be 1,2,3,4',env.commandStr);var normalized=!!value.normalized;var type=0;if("type"in value){check$1.commandParameter(value.type,glTypes,"invalid type for attribute "+attribute,env.commandStr);type=glTypes[value.type]}var divisor=value.divisor|0;if("divisor"in value){check$1.command(divisor===0||extInstancing,'cannot specify divisor for attribute "'+attribute+'", instancing not supported',env.commandStr);check$1.command(divisor>=0,'invalid divisor for attribute "'+attribute+'"',env.commandStr)}check$1.optional(function(){var command=env.commandStr;var VALID_KEYS=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(value).forEach(function(prop){check$1.command(VALID_KEYS.indexOf(prop)>=0,'unknown parameter "'+prop+'" for attribute pointer "'+attribute+'" (valid parameters are '+VALID_KEYS+")",command)})});record.buffer=buffer;record.state=ATTRIB_STATE_POINTER;record.size=size;record.normalized=normalized;record.type=type||buffer.dtype;record.offset=offset;record.stride=stride;record.divisor=divisor}}}attributeDefs[attribute]=createStaticDecl(function(env,scope){var cache=env.attribCache;if(id in cache){return cache[id]}var result={isStream:false};Object.keys(record).forEach(function(key){result[key]=record[key]});if(record.buffer){result.buffer=env.link(record.buffer);result.type=result.type||result.buffer+".dtype"}cache[id]=result;return result})});Object.keys(dynamicAttributes).forEach(function(attribute){var dyn=dynamicAttributes[attribute];function appendAttributeCode(env,block){var VALUE=env.invoke(block,dyn);var shared=env.shared;var IS_BUFFER_ARGS=shared.isBufferArgs;var BUFFER_STATE=shared.buffer;check$1.optional(function(){env.assert(block,VALUE+"&&(typeof "+VALUE+'==="object"||typeof '+VALUE+'==="function")&&('+IS_BUFFER_ARGS+"("+VALUE+")||"+BUFFER_STATE+".getBuffer("+VALUE+")||"+BUFFER_STATE+".getBuffer("+VALUE+".buffer)||"+IS_BUFFER_ARGS+"("+VALUE+".buffer)||"+'("constant" in '+VALUE+"&&(typeof "+VALUE+'.constant==="number"||'+shared.isArrayLike+"("+VALUE+".constant))))",'invalid dynamic attribute "'+attribute+'"')});var result={isStream:block.def(false)};var defaultRecord=new AttributeRecord;defaultRecord.state=ATTRIB_STATE_POINTER;Object.keys(defaultRecord).forEach(function(key){result[key]=block.def(""+defaultRecord[key])});var BUFFER=result.buffer;var TYPE=result.type;block("if(",IS_BUFFER_ARGS,"(",VALUE,")){",result.isStream,"=true;",BUFFER,"=",BUFFER_STATE,".createStream(",GL_ARRAY_BUFFER$1,",",VALUE,");",TYPE,"=",BUFFER,".dtype;","}else{",BUFFER,"=",BUFFER_STATE,".getBuffer(",VALUE,");","if(",BUFFER,"){",TYPE,"=",BUFFER,".dtype;",'}else if("constant" in ',VALUE,"){",result.state,"=",ATTRIB_STATE_CONSTANT,";","if(typeof "+VALUE+'.constant === "number"){',result[CUTE_COMPONENTS[0]],"=",VALUE,".constant;",CUTE_COMPONENTS.slice(1).map(function(n){return result[n]}).join("="),"=0;","}else{",CUTE_COMPONENTS.map(function(name,i){return result[name]+"="+VALUE+".constant.length>="+i+"?"+VALUE+".constant["+i+"]:0;"}).join(""),"}}else{","if(",IS_BUFFER_ARGS,"(",VALUE,".buffer)){",BUFFER,"=",BUFFER_STATE,".createStream(",GL_ARRAY_BUFFER$1,",",VALUE,".buffer);","}else{",BUFFER,"=",BUFFER_STATE,".getBuffer(",VALUE,".buffer);","}",TYPE,'="type" in ',VALUE,"?",shared.glTypes,"[",VALUE,".type]:",BUFFER,".dtype;",result.normalized,"=!!",VALUE,".normalized;");function emitReadRecord(name){block(result[name],"=",VALUE,".",name,"|0;")}emitReadRecord("size");emitReadRecord("offset");emitReadRecord("stride");emitReadRecord("divisor");block("}}");block.exit("if(",result.isStream,"){",BUFFER_STATE,".destroyStream(",BUFFER,");","}");return result}attributeDefs[attribute]=createDynamicDecl(dyn,appendAttributeCode)});return attributeDefs}function parseContext(context){var staticContext=context.static;var dynamicContext=context.dynamic;var result={};Object.keys(staticContext).forEach(function(name){var value=staticContext[name];result[name]=createStaticDecl(function(env,scope){if(typeof value==="number"||typeof value==="boolean"){return""+value}else{return env.link(value)}})});Object.keys(dynamicContext).forEach(function(name){var dyn=dynamicContext[name];result[name]=createDynamicDecl(dyn,function(env,scope){return env.invoke(scope,dyn)})});return result}function parseArguments(options,attributes,uniforms,context,env){var staticOptions=options.static;var dynamicOptions=options.dynamic;check$1.optional(function(){var KEY_NAMES=[S_FRAMEBUFFER,S_VERT,S_FRAG,S_ELEMENTS,S_PRIMITIVE,S_OFFSET,S_COUNT,S_INSTANCES,S_PROFILE].concat(GL_STATE_NAMES);function checkKeys(dict){Object.keys(dict).forEach(function(key){check$1.command(KEY_NAMES.indexOf(key)>=0,'unknown parameter "'+key+'"',env.commandStr)})}checkKeys(staticOptions);checkKeys(dynamicOptions)});var framebuffer=parseFramebuffer(options,env);var viewportAndScissor=parseViewportScissor(options,framebuffer,env);var draw=parseDraw(options,env);var state=parseGLState(options,env);var shader=parseProgram(options,env);function copyBox(name){var defn=viewportAndScissor[name];if(defn){state[name]=defn}}copyBox(S_VIEWPORT);copyBox(propName(S_SCISSOR_BOX));var dirty=Object.keys(state).length>0;var result={framebuffer:framebuffer,draw:draw,shader:shader,state:state,dirty:dirty};result.profile=parseProfile(options,env);result.uniforms=parseUniforms(uniforms,env);result.attributes=parseAttributes(attributes,env);result.context=parseContext(context,env);return result}function emitContext(env,scope,context){var shared=env.shared;var CONTEXT=shared.context;var contextEnter=env.scope();Object.keys(context).forEach(function(name){scope.save(CONTEXT,"."+name);var defn=context[name];contextEnter(CONTEXT,".",name,"=",defn.append(env,scope),";")});scope(contextEnter)}function emitPollFramebuffer(env,scope,framebuffer,skipCheck){var shared=env.shared;var GL=shared.gl;var FRAMEBUFFER_STATE=shared.framebuffer;var EXT_DRAW_BUFFERS;if(extDrawBuffers){EXT_DRAW_BUFFERS=scope.def(shared.extensions,".webgl_draw_buffers")}var constants=env.constants;var DRAW_BUFFERS=constants.drawBuffer;var BACK_BUFFER=constants.backBuffer;var NEXT;if(framebuffer){NEXT=framebuffer.append(env,scope)}else{NEXT=scope.def(FRAMEBUFFER_STATE,".next")}if(!skipCheck){scope("if(",NEXT,"!==",FRAMEBUFFER_STATE,".cur){")}scope("if(",NEXT,"){",GL,".bindFramebuffer(",GL_FRAMEBUFFER$1,",",NEXT,".framebuffer);");if(extDrawBuffers){scope(EXT_DRAW_BUFFERS,".drawBuffersWEBGL(",DRAW_BUFFERS,"[",NEXT,".colorAttachments.length]);")}scope("}else{",GL,".bindFramebuffer(",GL_FRAMEBUFFER$1,",null);");if(extDrawBuffers){scope(EXT_DRAW_BUFFERS,".drawBuffersWEBGL(",BACK_BUFFER,");")}scope("}",FRAMEBUFFER_STATE,".cur=",NEXT,";");if(!skipCheck){scope("}")}}function emitPollState(env,scope,args){var shared=env.shared;var GL=shared.gl;var CURRENT_VARS=env.current;var NEXT_VARS=env.next;var CURRENT_STATE=shared.current;var NEXT_STATE=shared.next;var block=env.cond(CURRENT_STATE,".dirty");GL_STATE_NAMES.forEach(function(prop){var param=propName(prop);if(param in args.state){return}var NEXT,CURRENT;if(param in NEXT_VARS){NEXT=NEXT_VARS[param];CURRENT=CURRENT_VARS[param];var parts=loop(currentState[param].length,function(i){return block.def(NEXT,"[",i,"]")});block(env.cond(parts.map(function(p,i){return p+"!=="+CURRENT+"["+i+"]"}).join("||")).then(GL,".",GL_VARIABLES[param],"(",parts,");",parts.map(function(p,i){return CURRENT+"["+i+"]="+p}).join(";"),";"))}else{NEXT=block.def(NEXT_STATE,".",param);var ifte=env.cond(NEXT,"!==",CURRENT_STATE,".",param);block(ifte);if(param in GL_FLAGS){ifte(env.cond(NEXT).then(GL,".enable(",GL_FLAGS[param],");").else(GL,".disable(",GL_FLAGS[param],");"),CURRENT_STATE,".",param,"=",NEXT,";")}else{ifte(GL,".",GL_VARIABLES[param],"(",NEXT,");",CURRENT_STATE,".",param,"=",NEXT,";")}}});if(Object.keys(args.state).length===0){block(CURRENT_STATE,".dirty=false;")}scope(block)}function emitSetOptions(env,scope,options,filter){var shared=env.shared;var CURRENT_VARS=env.current;var CURRENT_STATE=shared.current;var GL=shared.gl;sortState(Object.keys(options)).forEach(function(param){var defn=options[param];if(filter&&!filter(defn)){return}var variable=defn.append(env,scope);if(GL_FLAGS[param]){var flag=GL_FLAGS[param];if(isStatic(defn)){if(variable){scope(GL,".enable(",flag,");")}else{scope(GL,".disable(",flag,");")}}else{scope(env.cond(variable).then(GL,".enable(",flag,");").else(GL,".disable(",flag,");"))}scope(CURRENT_STATE,".",param,"=",variable,";")}else if(isArrayLike(variable)){var CURRENT=CURRENT_VARS[param];scope(GL,".",GL_VARIABLES[param],"(",variable,");",variable.map(function(v,i){return CURRENT+"["+i+"]="+v}).join(";"),";")}else{scope(GL,".",GL_VARIABLES[param],"(",variable,");",CURRENT_STATE,".",param,"=",variable,";")}})}function injectExtensions(env,scope){if(extInstancing){env.instancing=scope.def(env.shared.extensions,".angle_instanced_arrays")}}function emitProfile(env,scope,args,useScope,incrementCounter){var shared=env.shared;var STATS=env.stats;var CURRENT_STATE=shared.current;var TIMER=shared.timer;var profileArg=args.profile;function perfCounter(){if(typeof performance==="undefined"){return"Date.now()"}else{return"performance.now()"}}var CPU_START,QUERY_COUNTER;function emitProfileStart(block){CPU_START=scope.def();block(CPU_START,"=",perfCounter(),";");if(typeof incrementCounter==="string"){block(STATS,".count+=",incrementCounter,";")}else{block(STATS,".count++;")}if(timer){if(useScope){QUERY_COUNTER=scope.def();block(QUERY_COUNTER,"=",TIMER,".getNumPendingQueries();")}else{block(TIMER,".beginQuery(",STATS,");")}}}function emitProfileEnd(block){block(STATS,".cpuTime+=",perfCounter(),"-",CPU_START,";");if(timer){if(useScope){block(TIMER,".pushScopeStats(",QUERY_COUNTER,",",TIMER,".getNumPendingQueries(),",STATS,");")}else{block(TIMER,".endQuery();")}}}function scopeProfile(value){var prev=scope.def(CURRENT_STATE,".profile");scope(CURRENT_STATE,".profile=",value,";");scope.exit(CURRENT_STATE,".profile=",prev,";")}var USE_PROFILE;if(profileArg){if(isStatic(profileArg)){if(profileArg.enable){emitProfileStart(scope);emitProfileEnd(scope.exit);scopeProfile("true")}else{scopeProfile("false")}return}USE_PROFILE=profileArg.append(env,scope);scopeProfile(USE_PROFILE)}else{USE_PROFILE=scope.def(CURRENT_STATE,".profile")}var start=env.block();emitProfileStart(start);scope("if(",USE_PROFILE,"){",start,"}");var end=env.block();emitProfileEnd(end);scope.exit("if(",USE_PROFILE,"){",end,"}")}function emitAttributes(env,scope,args,attributes,filter){var shared=env.shared;function typeLength(x){switch(x){case GL_FLOAT_VEC2:case GL_INT_VEC2:case GL_BOOL_VEC2:return 2;case GL_FLOAT_VEC3:case GL_INT_VEC3:case GL_BOOL_VEC3:return 3;case GL_FLOAT_VEC4:case GL_INT_VEC4:case GL_BOOL_VEC4:return 4;default:return 1}}function emitBindAttribute(ATTRIBUTE,size,record){var GL=shared.gl;var LOCATION=scope.def(ATTRIBUTE,".location");var BINDING=scope.def(shared.attributes,"[",LOCATION,"]");var STATE=record.state;var BUFFER=record.buffer;var CONST_COMPONENTS=[record.x,record.y,record.z,record.w];var COMMON_KEYS=["buffer","normalized","offset","stride"];function emitBuffer(){scope("if(!",BINDING,".buffer){",GL,".enableVertexAttribArray(",LOCATION,");}");var TYPE=record.type;var SIZE;if(!record.size){SIZE=size}else{SIZE=scope.def(record.size,"||",size)}scope("if(",BINDING,".type!==",TYPE,"||",BINDING,".size!==",SIZE,"||",COMMON_KEYS.map(function(key){return BINDING+"."+key+"!=="+record[key]}).join("||"),"){",GL,".bindBuffer(",GL_ARRAY_BUFFER$1,",",BUFFER,".buffer);",GL,".vertexAttribPointer(",[LOCATION,SIZE,TYPE,record.normalized,record.stride,record.offset],");",BINDING,".type=",TYPE,";",BINDING,".size=",SIZE,";",COMMON_KEYS.map(function(key){return BINDING+"."+key+"="+record[key]+";"}).join(""),"}");if(extInstancing){var DIVISOR=record.divisor;scope("if(",BINDING,".divisor!==",DIVISOR,"){",env.instancing,".vertexAttribDivisorANGLE(",[LOCATION,DIVISOR],");",BINDING,".divisor=",DIVISOR,";}")}}function emitConstant(){scope("if(",BINDING,".buffer){",GL,".disableVertexAttribArray(",LOCATION,");","}if(",CUTE_COMPONENTS.map(function(c,i){return BINDING+"."+c+"!=="+CONST_COMPONENTS[i]}).join("||"),"){",GL,".vertexAttrib4f(",LOCATION,",",CONST_COMPONENTS,");",CUTE_COMPONENTS.map(function(c,i){return BINDING+"."+c+"="+CONST_COMPONENTS[i]+";"}).join(""),"}")}if(STATE===ATTRIB_STATE_POINTER){emitBuffer()}else if(STATE===ATTRIB_STATE_CONSTANT){emitConstant()}else{scope("if(",STATE,"===",ATTRIB_STATE_POINTER,"){");emitBuffer();scope("}else{");emitConstant();scope("}")}}attributes.forEach(function(attribute){var name=attribute.name;var arg=args.attributes[name];var record;if(arg){if(!filter(arg)){return}record=arg.append(env,scope)}else{if(!filter(SCOPE_DECL)){return}var scopeAttrib=env.scopeAttrib(name);check$1.optional(function(){env.assert(scope,scopeAttrib+".state","missing attribute "+name)});record={};Object.keys(new AttributeRecord).forEach(function(key){record[key]=scope.def(scopeAttrib,".",key)})}emitBindAttribute(env.link(attribute),typeLength(attribute.info.type),record)})}function emitUniforms(env,scope,args,uniforms,filter){var shared=env.shared;var GL=shared.gl;var infix;for(var i=0;i<uniforms.length;++i){var uniform=uniforms[i];var name=uniform.name;var type=uniform.info.type;var arg=args.uniforms[name];var UNIFORM=env.link(uniform);var LOCATION=UNIFORM+".location";var VALUE;if(arg){if(!filter(arg)){continue}if(isStatic(arg)){var value=arg.value;check$1.command(value!==null&&typeof value!=="undefined",'missing uniform "'+name+'"',env.commandStr);if(type===GL_SAMPLER_2D||type===GL_SAMPLER_CUBE){check$1.command(typeof value==="function"&&(type===GL_SAMPLER_2D&&(value._reglType==="texture2d"||value._reglType==="framebuffer")||type===GL_SAMPLER_CUBE&&(value._reglType==="textureCube"||value._reglType==="framebufferCube")),"invalid texture for uniform "+name,env.commandStr);var TEX_VALUE=env.link(value._texture||value.color[0]._texture);scope(GL,".uniform1i(",LOCATION,",",TEX_VALUE+".bind());");scope.exit(TEX_VALUE,".unbind();")}else if(type===GL_FLOAT_MAT2||type===GL_FLOAT_MAT3||type===GL_FLOAT_MAT4){check$1.optional(function(){check$1.command(isArrayLike(value),"invalid matrix for uniform "+name,env.commandStr);check$1.command(type===GL_FLOAT_MAT2&&value.length===4||type===GL_FLOAT_MAT3&&value.length===9||type===GL_FLOAT_MAT4&&value.length===16,"invalid length for matrix uniform "+name,env.commandStr)});var MAT_VALUE=env.global.def("new Float32Array(["+Array.prototype.slice.call(value)+"])");var dim=2;if(type===GL_FLOAT_MAT3){dim=3}else if(type===GL_FLOAT_MAT4){dim=4}scope(GL,".uniformMatrix",dim,"fv(",LOCATION,",false,",MAT_VALUE,");")}else{switch(type){case GL_FLOAT$7:check$1.commandType(value,"number","uniform "+name,env.commandStr);infix="1f";break;case GL_FLOAT_VEC2:check$1.command(isArrayLike(value)&&value.length===2,"uniform "+name,env.commandStr);infix="2f";break;case GL_FLOAT_VEC3:check$1.command(isArrayLike(value)&&value.length===3,"uniform "+name,env.commandStr);infix="3f";break;case GL_FLOAT_VEC4:check$1.command(isArrayLike(value)&&value.length===4,"uniform "+name,env.commandStr);infix="4f";break;case GL_BOOL:check$1.commandType(value,"boolean","uniform "+name,env.commandStr);infix="1i";break;case GL_INT$3:check$1.commandType(value,"number","uniform "+name,env.commandStr);infix="1i";break;case GL_BOOL_VEC2:check$1.command(isArrayLike(value)&&value.length===2,"uniform "+name,env.commandStr);infix="2i";break;case GL_INT_VEC2:check$1.command(isArrayLike(value)&&value.length===2,"uniform "+name,env.commandStr);infix="2i";break;case GL_BOOL_VEC3:check$1.command(isArrayLike(value)&&value.length===3,"uniform "+name,env.commandStr);infix="3i";break;case GL_INT_VEC3:check$1.command(isArrayLike(value)&&value.length===3,"uniform "+name,env.commandStr);infix="3i";break;case GL_BOOL_VEC4:check$1.command(isArrayLike(value)&&value.length===4,"uniform "+name,env.commandStr);infix="4i";break;case GL_INT_VEC4:check$1.command(isArrayLike(value)&&value.length===4,"uniform "+name,env.commandStr);infix="4i";break}scope(GL,".uniform",infix,"(",LOCATION,",",isArrayLike(value)?Array.prototype.slice.call(value):value,");")}continue}else{VALUE=arg.append(env,scope)}}else{if(!filter(SCOPE_DECL)){continue}VALUE=scope.def(shared.uniforms,"[",stringStore.id(name),"]")}if(type===GL_SAMPLER_2D){scope("if(",VALUE,"&&",VALUE,'._reglType==="framebuffer"){',VALUE,"=",VALUE,".color[0];","}")}else if(type===GL_SAMPLER_CUBE){scope("if(",VALUE,"&&",VALUE,'._reglType==="framebufferCube"){',VALUE,"=",VALUE,".color[0];","}")}check$1.optional(function(){function check(pred,message){env.assert(scope,pred,'bad data or missing for uniform "'+name+'".  '+message)}function checkType(type){check("typeof "+VALUE+'==="'+type+'"',"invalid type, expected "+type)}function checkVector(n,type){check(shared.isArrayLike+"("+VALUE+")&&"+VALUE+".length==="+n,"invalid vector, should have length "+n,env.commandStr)}function checkTexture(target){check("typeof "+VALUE+'==="function"&&'+VALUE+'._reglType==="texture'+(target===GL_TEXTURE_2D$2?"2d":"Cube")+'"',"invalid texture type",env.commandStr)}switch(type){case GL_INT$3:checkType("number");break;case GL_INT_VEC2:checkVector(2,"number");break;case GL_INT_VEC3:checkVector(3,"number");break;case GL_INT_VEC4:checkVector(4,"number");break;case GL_FLOAT$7:checkType("number");break;case GL_FLOAT_VEC2:checkVector(2,"number");break;case GL_FLOAT_VEC3:checkVector(3,"number");break;case GL_FLOAT_VEC4:checkVector(4,"number");break;case GL_BOOL:checkType("boolean");break;case GL_BOOL_VEC2:checkVector(2,"boolean");break;case GL_BOOL_VEC3:checkVector(3,"boolean");break;case GL_BOOL_VEC4:checkVector(4,"boolean");break;case GL_FLOAT_MAT2:checkVector(4,"number");break;case GL_FLOAT_MAT3:checkVector(9,"number");break;case GL_FLOAT_MAT4:checkVector(16,"number");break;case GL_SAMPLER_2D:checkTexture(GL_TEXTURE_2D$2);break;case GL_SAMPLER_CUBE:checkTexture(GL_TEXTURE_CUBE_MAP$1);break}});var unroll=1;switch(type){case GL_SAMPLER_2D:case GL_SAMPLER_CUBE:var TEX=scope.def(VALUE,"._texture");scope(GL,".uniform1i(",LOCATION,",",TEX,".bind());");scope.exit(TEX,".unbind();");continue;case GL_INT$3:case GL_BOOL:infix="1i";break;case GL_INT_VEC2:case GL_BOOL_VEC2:infix="2i";unroll=2;break;case GL_INT_VEC3:case GL_BOOL_VEC3:infix="3i";unroll=3;break;case GL_INT_VEC4:case GL_BOOL_VEC4:infix="4i";unroll=4;break;case GL_FLOAT$7:infix="1f";break;case GL_FLOAT_VEC2:infix="2f";unroll=2;break;case GL_FLOAT_VEC3:infix="3f";unroll=3;break;case GL_FLOAT_VEC4:infix="4f";unroll=4;break;case GL_FLOAT_MAT2:infix="Matrix2fv";break;case GL_FLOAT_MAT3:infix="Matrix3fv";break;case GL_FLOAT_MAT4:infix="Matrix4fv";break}scope(GL,".uniform",infix,"(",LOCATION,",");if(infix.charAt(0)==="M"){var matSize=Math.pow(type-GL_FLOAT_MAT2+2,2);var STORAGE=env.global.def("new Float32Array(",matSize,")");scope("false,(Array.isArray(",VALUE,")||",VALUE," instanceof Float32Array)?",VALUE,":(",loop(matSize,function(i){return STORAGE+"["+i+"]="+VALUE+"["+i+"]"}),",",STORAGE,")")}else if(unroll>1){scope(loop(unroll,function(i){return VALUE+"["+i+"]"}))}else{scope(VALUE)}scope(");")}}function emitDraw(env,outer,inner,args){var shared=env.shared;var GL=shared.gl;var DRAW_STATE=shared.draw;var drawOptions=args.draw;function emitElements(){var defn=drawOptions.elements;var ELEMENTS;var scope=outer;if(defn){if(defn.contextDep&&args.contextDynamic||defn.propDep){scope=inner}ELEMENTS=defn.append(env,scope)}else{ELEMENTS=scope.def(DRAW_STATE,".",S_ELEMENTS)}if(ELEMENTS){scope("if("+ELEMENTS+")"+GL+".bindBuffer("+GL_ELEMENT_ARRAY_BUFFER$1+","+ELEMENTS+".buffer.buffer);")}return ELEMENTS}function emitCount(){var defn=drawOptions.count;var COUNT;var scope=outer;if(defn){if(defn.contextDep&&args.contextDynamic||defn.propDep){scope=inner}COUNT=defn.append(env,scope);check$1.optional(function(){if(defn.MISSING){env.assert(outer,"false","missing vertex count")}if(defn.DYNAMIC){env.assert(scope,COUNT+">=0","missing vertex count")}})}else{COUNT=scope.def(DRAW_STATE,".",S_COUNT);check$1.optional(function(){env.assert(scope,COUNT+">=0","missing vertex count")})}return COUNT}var ELEMENTS=emitElements();function emitValue(name){var defn=drawOptions[name];if(defn){if(defn.contextDep&&args.contextDynamic||defn.propDep){return defn.append(env,inner)}else{return defn.append(env,outer)}}else{return outer.def(DRAW_STATE,".",name)}}var PRIMITIVE=emitValue(S_PRIMITIVE);var OFFSET=emitValue(S_OFFSET);var COUNT=emitCount();if(typeof COUNT==="number"){if(COUNT===0){return}}else{inner("if(",COUNT,"){");inner.exit("}")}var INSTANCES,EXT_INSTANCING;if(extInstancing){INSTANCES=emitValue(S_INSTANCES);EXT_INSTANCING=env.instancing}var ELEMENT_TYPE=ELEMENTS+".type";var elementsStatic=drawOptions.elements&&isStatic(drawOptions.elements);function emitInstancing(){function drawElements(){inner(EXT_INSTANCING,".drawElementsInstancedANGLE(",[PRIMITIVE,COUNT,ELEMENT_TYPE,OFFSET+"<<(("+ELEMENT_TYPE+"-"+GL_UNSIGNED_BYTE$7+")>>1)",INSTANCES],");")}function drawArrays(){inner(EXT_INSTANCING,".drawArraysInstancedANGLE(",[PRIMITIVE,OFFSET,COUNT,INSTANCES],");")}if(ELEMENTS){if(!elementsStatic){inner("if(",ELEMENTS,"){");drawElements();inner("}else{");drawArrays();inner("}")}else{drawElements()}}else{drawArrays()}}function emitRegular(){function drawElements(){inner(GL+".drawElements("+[PRIMITIVE,COUNT,ELEMENT_TYPE,OFFSET+"<<(("+ELEMENT_TYPE+"-"+GL_UNSIGNED_BYTE$7+")>>1)"]+");")}function drawArrays(){inner(GL+".drawArrays("+[PRIMITIVE,OFFSET,COUNT]+");")}if(ELEMENTS){if(!elementsStatic){inner("if(",ELEMENTS,"){");drawElements();inner("}else{");drawArrays();inner("}")}else{drawElements()}}else{drawArrays()}}if(extInstancing&&(typeof INSTANCES!=="number"||INSTANCES>=0)){if(typeof INSTANCES==="string"){inner("if(",INSTANCES,">0){");emitInstancing();inner("}else if(",INSTANCES,"<0){");emitRegular();inner("}")}else{emitInstancing()}}else{emitRegular()}}function createBody(emitBody,parentEnv,args,program,count){var env=createREGLEnvironment();var scope=env.proc("body",count);check$1.optional(function(){env.commandStr=parentEnv.commandStr;env.command=env.link(parentEnv.commandStr)});if(extInstancing){env.instancing=scope.def(env.shared.extensions,".angle_instanced_arrays")}emitBody(env,scope,args,program);return env.compile().body}function emitDrawBody(env,draw,args,program){injectExtensions(env,draw);emitAttributes(env,draw,args,program.attributes,function(){return true});emitUniforms(env,draw,args,program.uniforms,function(){return true});emitDraw(env,draw,draw,args)}function emitDrawProc(env,args){var draw=env.proc("draw",1);injectExtensions(env,draw);emitContext(env,draw,args.context);emitPollFramebuffer(env,draw,args.framebuffer);emitPollState(env,draw,args);emitSetOptions(env,draw,args.state);emitProfile(env,draw,args,false,true);var program=args.shader.progVar.append(env,draw);draw(env.shared.gl,".useProgram(",program,".program);");if(args.shader.program){emitDrawBody(env,draw,args,args.shader.program)}else{var drawCache=env.global.def("{}");var PROG_ID=draw.def(program,".id");var CACHED_PROC=draw.def(drawCache,"[",PROG_ID,"]");draw(env.cond(CACHED_PROC).then(CACHED_PROC,".call(this,a0);").else(CACHED_PROC,"=",drawCache,"[",PROG_ID,"]=",env.link(function(program){return createBody(emitDrawBody,env,args,program,1)}),"(",program,");",CACHED_PROC,".call(this,a0);"))}if(Object.keys(args.state).length>0){draw(env.shared.current,".dirty=true;")}}function emitBatchDynamicShaderBody(env,scope,args,program){env.batchId="a1";injectExtensions(env,scope);function all(){return true}emitAttributes(env,scope,args,program.attributes,all);emitUniforms(env,scope,args,program.uniforms,all);emitDraw(env,scope,scope,args)}function emitBatchBody(env,scope,args,program){injectExtensions(env,scope);var contextDynamic=args.contextDep;var BATCH_ID=scope.def();var PROP_LIST="a0";var NUM_PROPS="a1";var PROPS=scope.def();env.shared.props=PROPS;env.batchId=BATCH_ID;var outer=env.scope();var inner=env.scope();scope(outer.entry,"for(",BATCH_ID,"=0;",BATCH_ID,"<",NUM_PROPS,";++",BATCH_ID,"){",PROPS,"=",PROP_LIST,"[",BATCH_ID,"];",inner,"}",outer.exit);function isInnerDefn(defn){return defn.contextDep&&contextDynamic||defn.propDep}function isOuterDefn(defn){return!isInnerDefn(defn)}if(args.needsContext){emitContext(env,inner,args.context)}if(args.needsFramebuffer){emitPollFramebuffer(env,inner,args.framebuffer)}emitSetOptions(env,inner,args.state,isInnerDefn);if(args.profile&&isInnerDefn(args.profile)){emitProfile(env,inner,args,false,true)}if(!program){var progCache=env.global.def("{}");var PROGRAM=args.shader.progVar.append(env,inner);var PROG_ID=inner.def(PROGRAM,".id");var CACHED_PROC=inner.def(progCache,"[",PROG_ID,"]");inner(env.shared.gl,".useProgram(",PROGRAM,".program);","if(!",CACHED_PROC,"){",CACHED_PROC,"=",progCache,"[",PROG_ID,"]=",env.link(function(program){return createBody(emitBatchDynamicShaderBody,env,args,program,2)}),"(",PROGRAM,");}",CACHED_PROC,".call(this,a0[",BATCH_ID,"],",BATCH_ID,");")}else{emitAttributes(env,outer,args,program.attributes,isOuterDefn);emitAttributes(env,inner,args,program.attributes,isInnerDefn);emitUniforms(env,outer,args,program.uniforms,isOuterDefn);emitUniforms(env,inner,args,program.uniforms,isInnerDefn);emitDraw(env,outer,inner,args)}}function emitBatchProc(env,args){var batch=env.proc("batch",2);env.batchId="0";injectExtensions(env,batch);var contextDynamic=false;var needsContext=true;Object.keys(args.context).forEach(function(name){contextDynamic=contextDynamic||args.context[name].propDep});if(!contextDynamic){emitContext(env,batch,args.context);needsContext=false}var framebuffer=args.framebuffer;var needsFramebuffer=false;if(framebuffer){if(framebuffer.propDep){contextDynamic=needsFramebuffer=true}else if(framebuffer.contextDep&&contextDynamic){needsFramebuffer=true}if(!needsFramebuffer){emitPollFramebuffer(env,batch,framebuffer)}}else{emitPollFramebuffer(env,batch,null)}if(args.state.viewport&&args.state.viewport.propDep){contextDynamic=true}function isInnerDefn(defn){return defn.contextDep&&contextDynamic||defn.propDep}emitPollState(env,batch,args);emitSetOptions(env,batch,args.state,function(defn){return!isInnerDefn(defn)});if(!args.profile||!isInnerDefn(args.profile)){emitProfile(env,batch,args,false,"a1")}args.contextDep=contextDynamic;args.needsContext=needsContext;args.needsFramebuffer=needsFramebuffer;var progDefn=args.shader.progVar;if(progDefn.contextDep&&contextDynamic||progDefn.propDep){emitBatchBody(env,batch,args,null)}else{var PROGRAM=progDefn.append(env,batch);batch(env.shared.gl,".useProgram(",PROGRAM,".program);");if(args.shader.program){emitBatchBody(env,batch,args,args.shader.program)}else{var batchCache=env.global.def("{}");var PROG_ID=batch.def(PROGRAM,".id");var CACHED_PROC=batch.def(batchCache,"[",PROG_ID,"]");batch(env.cond(CACHED_PROC).then(CACHED_PROC,".call(this,a0,a1);").else(CACHED_PROC,"=",batchCache,"[",PROG_ID,"]=",env.link(function(program){return createBody(emitBatchBody,env,args,program,2)}),"(",PROGRAM,");",CACHED_PROC,".call(this,a0,a1);"))}}if(Object.keys(args.state).length>0){batch(env.shared.current,".dirty=true;")}}function emitScopeProc(env,args){var scope=env.proc("scope",3);env.batchId="a2";var shared=env.shared;var CURRENT_STATE=shared.current;emitContext(env,scope,args.context);if(args.framebuffer){args.framebuffer.append(env,scope)}sortState(Object.keys(args.state)).forEach(function(name){var defn=args.state[name];var value=defn.append(env,scope);if(isArrayLike(value)){value.forEach(function(v,i){scope.set(env.next[name],"["+i+"]",v)})}else{scope.set(shared.next,"."+name,value)}});emitProfile(env,scope,args,true,true);[S_ELEMENTS,S_OFFSET,S_COUNT,S_INSTANCES,S_PRIMITIVE].forEach(function(opt){var variable=args.draw[opt];if(!variable){return}scope.set(shared.draw,"."+opt,""+variable.append(env,scope))});Object.keys(args.uniforms).forEach(function(opt){scope.set(shared.uniforms,"["+stringStore.id(opt)+"]",args.uniforms[opt].append(env,scope))});Object.keys(args.attributes).forEach(function(name){var record=args.attributes[name].append(env,scope);var scopeAttrib=env.scopeAttrib(name);Object.keys(new AttributeRecord).forEach(function(prop){scope.set(scopeAttrib,"."+prop,record[prop])})});function saveShader(name){var shader=args.shader[name];if(shader){scope.set(shared.shader,"."+name,shader.append(env,scope))}}saveShader(S_VERT);saveShader(S_FRAG);if(Object.keys(args.state).length>0){scope(CURRENT_STATE,".dirty=true;");scope.exit(CURRENT_STATE,".dirty=true;")}scope("a1(",env.shared.context,",a0,",env.batchId,");")}function isDynamicObject(object){if(typeof object!=="object"||isArrayLike(object)){return}var props=Object.keys(object);for(var i=0;i<props.length;++i){if(dynamic.isDynamic(object[props[i]])){return true}}return false}function splatObject(env,options,name){var object=options.static[name];if(!object||!isDynamicObject(object)){return}var globals=env.global;var keys=Object.keys(object);var thisDep=false;var contextDep=false;var propDep=false;var objectRef=env.global.def("{}");keys.forEach(function(key){var value=object[key];if(dynamic.isDynamic(value)){if(typeof value==="function"){value=object[key]=dynamic.unbox(value)}var deps=createDynamicDecl(value,null);thisDep=thisDep||deps.thisDep;propDep=propDep||deps.propDep;contextDep=contextDep||deps.contextDep}else{globals(objectRef,".",key,"=");switch(typeof value){case"number":globals(value);break;case"string":globals('"',value,'"');break;case"object":if(Array.isArray(value)){globals("[",value.join(),"]")}break;default:globals(env.link(value));break}globals(";")}});function appendBlock(env,block){keys.forEach(function(key){var value=object[key];if(!dynamic.isDynamic(value)){return}var ref=env.invoke(block,value);block(objectRef,".",key,"=",ref,";")})}options.dynamic[name]=new dynamic.DynamicVariable(DYN_THUNK,{thisDep:thisDep,contextDep:contextDep,propDep:propDep,ref:objectRef,append:appendBlock});delete options.static[name]}function compileCommand(options,attributes,uniforms,context,stats){var env=createREGLEnvironment();env.stats=env.link(stats);Object.keys(attributes.static).forEach(function(key){splatObject(env,attributes,key)});NESTED_OPTIONS.forEach(function(name){splatObject(env,options,name)});var args=parseArguments(options,attributes,uniforms,context,env);emitDrawProc(env,args);emitScopeProc(env,args);emitBatchProc(env,args);return env.compile()}return{next:nextState,current:currentState,procs:function(){var env=createREGLEnvironment();var poll=env.proc("poll");var refresh=env.proc("refresh");var common=env.block();poll(common);refresh(common);var shared=env.shared;var GL=shared.gl;var NEXT_STATE=shared.next;var CURRENT_STATE=shared.current;common(CURRENT_STATE,".dirty=false;");emitPollFramebuffer(env,poll);emitPollFramebuffer(env,refresh,null,true);var extInstancing=gl.getExtension("angle_instanced_arrays");var INSTANCING;if(extInstancing){INSTANCING=env.link(extInstancing)}for(var i=0;i<limits.maxAttributes;++i){var BINDING=refresh.def(shared.attributes,"[",i,"]");var ifte=env.cond(BINDING,".buffer");ifte.then(GL,".enableVertexAttribArray(",i,");",GL,".bindBuffer(",GL_ARRAY_BUFFER$1,",",BINDING,".buffer.buffer);",GL,".vertexAttribPointer(",i,",",BINDING,".size,",BINDING,".type,",BINDING,".normalized,",BINDING,".stride,",BINDING,".offset);").else(GL,".disableVertexAttribArray(",i,");",GL,".vertexAttrib4f(",i,",",BINDING,".x,",BINDING,".y,",BINDING,".z,",BINDING,".w);",BINDING,".buffer=null;");refresh(ifte);if(extInstancing){refresh(INSTANCING,".vertexAttribDivisorANGLE(",i,",",BINDING,".divisor);")}}Object.keys(GL_FLAGS).forEach(function(flag){var cap=GL_FLAGS[flag];var NEXT=common.def(NEXT_STATE,".",flag);var block=env.block();block("if(",NEXT,"){",GL,".enable(",cap,")}else{",GL,".disable(",cap,")}",CURRENT_STATE,".",flag,"=",NEXT,";");refresh(block);poll("if(",NEXT,"!==",CURRENT_STATE,".",flag,"){",block,"}")});Object.keys(GL_VARIABLES).forEach(function(name){var func=GL_VARIABLES[name];var init=currentState[name];var NEXT,CURRENT;var block=env.block();block(GL,".",func,"(");if(isArrayLike(init)){var n=init.length;NEXT=env.global.def(NEXT_STATE,".",name);CURRENT=env.global.def(CURRENT_STATE,".",name);block(loop(n,function(i){return NEXT+"["+i+"]"}),");",loop(n,function(i){return CURRENT+"["+i+"]="+NEXT+"["+i+"];"}).join(""));poll("if(",loop(n,function(i){return NEXT+"["+i+"]!=="+CURRENT+"["+i+"]"}).join("||"),"){",block,"}")}else{NEXT=common.def(NEXT_STATE,".",name);CURRENT=common.def(CURRENT_STATE,".",name);block(NEXT,");",CURRENT_STATE,".",name,"=",NEXT,";");poll("if(",NEXT,"!==",CURRENT,"){",block,"}")}refresh(block)});return env.compile()}(),compile:compileCommand}}function stats(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var GL_QUERY_RESULT_EXT=34918;var GL_QUERY_RESULT_AVAILABLE_EXT=34919;var GL_TIME_ELAPSED_EXT=35007;var createTimer=function(gl,extensions){var extTimer=extensions.ext_disjoint_timer_query;if(!extTimer){return null}var queryPool=[];function allocQuery(){return queryPool.pop()||extTimer.createQueryEXT()}function freeQuery(query){queryPool.push(query)}var pendingQueries=[];function beginQuery(stats){var query=allocQuery();extTimer.beginQueryEXT(GL_TIME_ELAPSED_EXT,query);pendingQueries.push(query);pushScopeStats(pendingQueries.length-1,pendingQueries.length,stats)}function endQuery(){extTimer.endQueryEXT(GL_TIME_ELAPSED_EXT)}function PendingStats(){this.startQueryIndex=-1;this.endQueryIndex=-1;this.sum=0;this.stats=null}var pendingStatsPool=[];function allocPendingStats(){return pendingStatsPool.pop()||new PendingStats}function freePendingStats(pendingStats){pendingStatsPool.push(pendingStats)}var pendingStats=[];function pushScopeStats(start,end,stats){var ps=allocPendingStats();ps.startQueryIndex=start;ps.endQueryIndex=end;ps.sum=0;ps.stats=stats;pendingStats.push(ps)}var timeSum=[];var queryPtr=[];function update(){var ptr,i;var n=pendingQueries.length;if(n===0){return}queryPtr.length=Math.max(queryPtr.length,n+1);timeSum.length=Math.max(timeSum.length,n+1);timeSum[0]=0;queryPtr[0]=0;var queryTime=0;ptr=0;for(i=0;i<pendingQueries.length;++i){var query=pendingQueries[i];if(extTimer.getQueryObjectEXT(query,GL_QUERY_RESULT_AVAILABLE_EXT)){queryTime+=extTimer.getQueryObjectEXT(query,GL_QUERY_RESULT_EXT);freeQuery(query)}else{pendingQueries[ptr++]=query}timeSum[i+1]=queryTime;queryPtr[i+1]=ptr}pendingQueries.length=ptr;ptr=0;for(i=0;i<pendingStats.length;++i){var stats=pendingStats[i];var start=stats.startQueryIndex;var end=stats.endQueryIndex;stats.sum+=timeSum[end]-timeSum[start];var startPtr=queryPtr[start];var endPtr=queryPtr[end];if(endPtr===startPtr){stats.stats.gpuTime+=stats.sum/1e6;freePendingStats(stats)}else{stats.startQueryIndex=startPtr;stats.endQueryIndex=endPtr;pendingStats[ptr++]=stats}}pendingStats.length=ptr}return{beginQuery:beginQuery,endQuery:endQuery,pushScopeStats:pushScopeStats,update:update,getNumPendingQueries:function(){return pendingQueries.length},clear:function(){queryPool.push.apply(queryPool,pendingQueries);for(var i=0;i<queryPool.length;i++){extTimer.deleteQueryEXT(queryPool[i])}pendingQueries.length=0;queryPool.length=0},restore:function(){pendingQueries.length=0;queryPool.length=0}}};var GL_COLOR_BUFFER_BIT=16384;var GL_DEPTH_BUFFER_BIT=256;var GL_STENCIL_BUFFER_BIT=1024;var GL_ARRAY_BUFFER=34962;var CONTEXT_LOST_EVENT="webglcontextlost";var CONTEXT_RESTORED_EVENT="webglcontextrestored";var DYN_PROP=1;var DYN_CONTEXT=2;var DYN_STATE=3;function find(haystack,needle){for(var i=0;i<haystack.length;++i){if(haystack[i]===needle){return i}}return-1}function wrapREGL(args){var config=parseArgs(args);if(!config){return null}var gl=config.gl;var glAttributes=gl.getContextAttributes();var contextLost=gl.isContextLost();var extensionState=createExtensionCache(gl,config);if(!extensionState){return null}var stringStore=createStringStore();var stats$$1=stats();var extensions=extensionState.extensions;var timer=createTimer(gl,extensions);var START_TIME=clock();var WIDTH=gl.drawingBufferWidth;var HEIGHT=gl.drawingBufferHeight;var contextState={tick:0,time:0,viewportWidth:WIDTH,viewportHeight:HEIGHT,framebufferWidth:WIDTH,framebufferHeight:HEIGHT,drawingBufferWidth:WIDTH,drawingBufferHeight:HEIGHT,pixelRatio:config.pixelRatio};var uniformState={};var drawState={elements:null,primitive:4,count:-1,offset:0,instances:-1};var limits=wrapLimits(gl,extensions);var bufferState=wrapBufferState(gl,stats$$1,config);var elementState=wrapElementsState(gl,extensions,bufferState,stats$$1);var attributeState=wrapAttributeState(gl,extensions,limits,bufferState,stringStore);var shaderState=wrapShaderState(gl,stringStore,stats$$1,config);var textureState=createTextureSet(gl,extensions,limits,function(){core.procs.poll()},contextState,stats$$1,config);var renderbufferState=wrapRenderbuffers(gl,extensions,limits,stats$$1,config);var framebufferState=wrapFBOState(gl,extensions,limits,textureState,renderbufferState,stats$$1);var core=reglCore(gl,stringStore,extensions,limits,bufferState,elementState,textureState,framebufferState,uniformState,attributeState,shaderState,drawState,contextState,timer,config);var readPixels=wrapReadPixels(gl,framebufferState,core.procs.poll,contextState,glAttributes,extensions);var nextState=core.next;var canvas=gl.canvas;var rafCallbacks=[];var lossCallbacks=[];var restoreCallbacks=[];var destroyCallbacks=[config.onDestroy];var activeRAF=null;function handleRAF(){if(rafCallbacks.length===0){if(timer){timer.update()}activeRAF=null;return}activeRAF=raf.next(handleRAF);poll();for(var i=rafCallbacks.length-1;i>=0;--i){var cb=rafCallbacks[i];if(cb){cb(contextState,null,0)}}gl.flush();if(timer){timer.update()}}function startRAF(){if(!activeRAF&&rafCallbacks.length>0){activeRAF=raf.next(handleRAF)}}function stopRAF(){if(activeRAF){raf.cancel(handleRAF);activeRAF=null}}function handleContextLoss(event){event.preventDefault();contextLost=true;stopRAF();lossCallbacks.forEach(function(cb){cb()})}function handleContextRestored(event){gl.getError();contextLost=false;extensionState.restore();shaderState.restore();bufferState.restore();textureState.restore();renderbufferState.restore();framebufferState.restore();if(timer){timer.restore()}core.procs.refresh();startRAF();restoreCallbacks.forEach(function(cb){cb()})}if(canvas){canvas.addEventListener(CONTEXT_LOST_EVENT,handleContextLoss,false);canvas.addEventListener(CONTEXT_RESTORED_EVENT,handleContextRestored,false)}function destroy(){rafCallbacks.length=0;stopRAF();if(canvas){canvas.removeEventListener(CONTEXT_LOST_EVENT,handleContextLoss);canvas.removeEventListener(CONTEXT_RESTORED_EVENT,handleContextRestored)}shaderState.clear();framebufferState.clear();renderbufferState.clear();textureState.clear();elementState.clear();bufferState.clear();if(timer){timer.clear()}destroyCallbacks.forEach(function(cb){cb()})}function compileProcedure(options){check$1(!!options,"invalid args to regl({...})");check$1.type(options,"object","invalid args to regl({...})");function flattenNestedOptions(options){var result=extend({},options);delete result.uniforms;delete result.attributes;delete result.context;if("stencil"in result&&result.stencil.op){result.stencil.opBack=result.stencil.opFront=result.stencil.op;delete result.stencil.op}function merge(name){if(name in result){var child=result[name];delete result[name];Object.keys(child).forEach(function(prop){result[name+"."+prop]=child[prop]})}}merge("blend");merge("depth");merge("cull");merge("stencil");merge("polygonOffset");merge("scissor");merge("sample");return result}function separateDynamic(object){var staticItems={};var dynamicItems={};Object.keys(object).forEach(function(option){var value=object[option];if(dynamic.isDynamic(value)){dynamicItems[option]=dynamic.unbox(value,option)}else{staticItems[option]=value}});return{dynamic:dynamicItems,static:staticItems}}var context=separateDynamic(options.context||{});var uniforms=separateDynamic(options.uniforms||{});var attributes=separateDynamic(options.attributes||{});var opts=separateDynamic(flattenNestedOptions(options));var stats$$1={gpuTime:0,cpuTime:0,count:0};var compiled=core.compile(opts,attributes,uniforms,context,stats$$1);var draw=compiled.draw;var batch=compiled.batch;var scope=compiled.scope;var EMPTY_ARRAY=[];function reserve(count){while(EMPTY_ARRAY.length<count){EMPTY_ARRAY.push(null)}return EMPTY_ARRAY}function REGLCommand(args,body){var i;if(contextLost){check$1.raise("context lost")}if(typeof args==="function"){return scope.call(this,null,args,0)}else if(typeof body==="function"){if(typeof args==="number"){for(i=0;i<args;++i){scope.call(this,null,body,i)}return}else if(Array.isArray(args)){for(i=0;i<args.length;++i){scope.call(this,args[i],body,i)}return}else{return scope.call(this,args,body,0)}}else if(typeof args==="number"){if(args>0){return batch.call(this,reserve(args|0),args|0)}}else if(Array.isArray(args)){if(args.length){return batch.call(this,args,args.length)}}else{return draw.call(this,args)}}return extend(REGLCommand,{stats:stats$$1})}var setFBO=framebufferState.setFBO=compileProcedure({framebuffer:dynamic.define.call(null,DYN_PROP,"framebuffer")});function clearImpl(_,options){var clearFlags=0;core.procs.poll();var c=options.color;if(c){gl.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0);clearFlags|=GL_COLOR_BUFFER_BIT}if("depth"in options){gl.clearDepth(+options.depth);clearFlags|=GL_DEPTH_BUFFER_BIT}if("stencil"in options){gl.clearStencil(options.stencil|0);clearFlags|=GL_STENCIL_BUFFER_BIT}check$1(!!clearFlags,"called regl.clear with no buffer specified");gl.clear(clearFlags)}function clear(options){check$1(typeof options==="object"&&options,"regl.clear() takes an object as input");if("framebuffer"in options){if(options.framebuffer&&options.framebuffer_reglType==="framebufferCube"){for(var i=0;i<6;++i){setFBO(extend({framebuffer:options.framebuffer.faces[i]},options),clearImpl)}}else{setFBO(options,clearImpl)}}else{clearImpl(null,options)}}function frame(cb){check$1.type(cb,"function","regl.frame() callback must be a function");rafCallbacks.push(cb);function cancel(){var i=find(rafCallbacks,cb);check$1(i>=0,"cannot cancel a frame twice");function pendingCancel(){var index=find(rafCallbacks,pendingCancel);rafCallbacks[index]=rafCallbacks[rafCallbacks.length-1];rafCallbacks.length-=1;if(rafCallbacks.length<=0){stopRAF()}}rafCallbacks[i]=pendingCancel}startRAF();return{cancel:cancel}}function pollViewport(){var viewport=nextState.viewport;var scissorBox=nextState.scissor_box;viewport[0]=viewport[1]=scissorBox[0]=scissorBox[1]=0;contextState.viewportWidth=contextState.framebufferWidth=contextState.drawingBufferWidth=viewport[2]=scissorBox[2]=gl.drawingBufferWidth;contextState.viewportHeight=contextState.framebufferHeight=contextState.drawingBufferHeight=viewport[3]=scissorBox[3]=gl.drawingBufferHeight}function poll(){contextState.tick+=1;contextState.time=now();pollViewport();core.procs.poll()}function refresh(){pollViewport();core.procs.refresh();if(timer){timer.update()}}function now(){return(clock()-START_TIME)/1e3}refresh();function addListener(event,callback){check$1.type(callback,"function","listener callback must be a function");var callbacks;switch(event){case"frame":return frame(callback);case"lost":callbacks=lossCallbacks;break;case"restore":callbacks=restoreCallbacks;break;case"destroy":callbacks=destroyCallbacks;break;default:check$1.raise("invalid event, must be one of frame,lost,restore,destroy")}callbacks.push(callback);return{cancel:function(){for(var i=0;i<callbacks.length;++i){if(callbacks[i]===callback){callbacks[i]=callbacks[callbacks.length-1];callbacks.pop();return}}}}}var regl=extend(compileProcedure,{clear:clear,prop:dynamic.define.bind(null,DYN_PROP),context:dynamic.define.bind(null,DYN_CONTEXT),this:dynamic.define.bind(null,DYN_STATE),draw:compileProcedure({}),buffer:function(options){return bufferState.create(options,GL_ARRAY_BUFFER,false,false)},elements:function(options){return elementState.create(options,false)},texture:textureState.create2D,cube:textureState.createCube,renderbuffer:renderbufferState.create,framebuffer:framebufferState.create,framebufferCube:framebufferState.createCube,attributes:glAttributes,frame:frame,on:addListener,limits:limits,hasExtension:function(name){return limits.extensions.indexOf(name.toLowerCase())>=0},read:readPixels,destroy:destroy,_gl:gl,_refresh:refresh,poll:function(){poll();if(timer){timer.update()}},now:now,stats:stats$$1});config.onDone(null,regl);return regl}return wrapREGL})},{}],434:[function(require,module,exports){"use strict";module.exports=function removeItems(arr,startIdx,removeCount){var i,length=arr.length;if(startIdx>=length||removeCount===0){return}removeCount=startIdx+removeCount>length?length-startIdx:removeCount;var len=length-removeCount;for(i=startIdx;i<len;++i){arr[i]=arr[i+removeCount]}arr.length=len}},{}],435:[function(require,module,exports){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _miniSignals=require("mini-signals");var _miniSignals2=_interopRequireDefault(_miniSignals);var _parseUri=require("parse-uri");var _parseUri2=_interopRequireDefault(_parseUri);var _async=require("./async");var async=_interopRequireWildcard(_async);var _Resource=require("./Resource");var _Resource2=_interopRequireDefault(_Resource);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MAX_PROGRESS=100;var rgxExtractUrlHash=/(#[\w-]+)?$/;var Loader=function(){function Loader(){var _this=this;var baseUrl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var concurrency=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;_classCallCheck(this,Loader);this.baseUrl=baseUrl;this.progress=0;this.loading=false;this.defaultQueryString="";this._beforeMiddleware=[];this._afterMiddleware=[];this._resourcesParsing=[];this._boundLoadResource=function(r,d){return _this._loadResource(r,d)};this._queue=async.queue(this._boundLoadResource,concurrency);this._queue.pause();this.resources={};this.onProgress=new _miniSignals2.default;this.onError=new _miniSignals2.default;this.onLoad=new _miniSignals2.default;this.onStart=new _miniSignals2.default;this.onComplete=new _miniSignals2.default}Loader.prototype.add=function add(name,url,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i){this.add(name[i])}return this}if((typeof name==="undefined"?"undefined":_typeof(name))==="object"){cb=url||name.callback||name.onComplete;options=name;url=name.url;name=name.name||name.key||name.url}if(typeof url!=="string"){cb=options;options=url;url=name}if(typeof url!=="string"){throw new Error("No url passed to add resource to loader.")}if(typeof options==="function"){cb=options;options=null}if(this.loading&&(!options||!options.parentResource)){throw new Error("Cannot add resources while the loader is running.")}if(this.resources[name]){throw new Error('Resource named "'+name+'" already exists.')}url=this._prepareUrl(url);this.resources[name]=new _Resource2.default(name,url,options);if(typeof cb==="function"){this.resources[name].onAfterMiddleware.once(cb)}if(this.loading){var parent=options.parentResource;var incompleteChildren=[];for(var _i=0;_i<parent.children.length;++_i){if(!parent.children[_i].isComplete){incompleteChildren.push(parent.children[_i])}}var fullChunk=parent.progressChunk*(incompleteChildren.length+1);var eachChunk=fullChunk/(incompleteChildren.length+2);parent.children.push(this.resources[name]);parent.progressChunk=eachChunk;for(var _i2=0;_i2<incompleteChildren.length;++_i2){incompleteChildren[_i2].progressChunk=eachChunk}this.resources[name].progressChunk=eachChunk}this._queue.push(this.resources[name]);return this};Loader.prototype.pre=function pre(fn){this._beforeMiddleware.push(fn);return this};Loader.prototype.use=function use(fn){this._afterMiddleware.push(fn);return this};Loader.prototype.reset=function reset(){this.progress=0;this.loading=false;this._queue.kill();this._queue.pause();for(var k in this.resources){var res=this.resources[k];if(res._onLoadBinding){res._onLoadBinding.detach()}if(res.isLoading){res.abort()}}this.resources={};return this};Loader.prototype.load=function load(cb){if(typeof cb==="function"){this.onComplete.once(cb)}if(this.loading){return this}var chunk=100/this._queue._tasks.length;for(var i=0;i<this._queue._tasks.length;++i){this._queue._tasks[i].data.progressChunk=chunk}this.loading=true;this.onStart.dispatch(this);this._queue.resume();return this};Loader.prototype._prepareUrl=function _prepareUrl(url){var parsedUrl=(0,_parseUri2.default)(url,{strictMode:true});var result=void 0;if(parsedUrl.protocol||!parsedUrl.path||url.indexOf("//")===0){result=url}else if(this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&url.charAt(0)!=="/"){result=this.baseUrl+"/"+url}else{result=this.baseUrl+url}if(this.defaultQueryString){var hash=rgxExtractUrlHash.exec(result)[0];result=result.substr(0,result.length-hash.length);if(result.indexOf("?")!==-1){result+="&"+this.defaultQueryString}else{result+="?"+this.defaultQueryString}result+=hash}return result};Loader.prototype._loadResource=function _loadResource(resource,dequeue){var _this2=this;resource._dequeue=dequeue;async.eachSeries(this._beforeMiddleware,function(fn,next){fn.call(_this2,resource,function(){next(resource.isComplete?{}:null)})},function(){if(resource.isComplete){_this2._onLoad(resource)}else{resource._onLoadBinding=resource.onComplete.once(_this2._onLoad,_this2);resource.load()}},true)};Loader.prototype._onComplete=function _onComplete(){this.loading=false;this.onComplete.dispatch(this,this.resources)};Loader.prototype._onLoad=function _onLoad(resource){var _this3=this;resource._onLoadBinding=null;this._resourcesParsing.push(resource);resource._dequeue();async.eachSeries(this._afterMiddleware,function(fn,next){fn.call(_this3,resource,next)},function(){resource.onAfterMiddleware.dispatch(resource);_this3.progress+=resource.progressChunk;_this3.onProgress.dispatch(_this3,resource);if(resource.error){_this3.onError.dispatch(resource.error,_this3,resource)}else{_this3.onLoad.dispatch(_this3,resource)}_this3._resourcesParsing.splice(_this3._resourcesParsing.indexOf(resource),1);if(_this3._queue.idle()&&_this3._resourcesParsing.length===0){_this3.progress=MAX_PROGRESS;_this3._onComplete()}},true)};return Loader}();exports.default=Loader},{"./Resource":436,"./async":437,"mini-signals":225,"parse-uri":250}],436:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _parseUri=require("parse-uri");var _parseUri2=_interopRequireDefault(_parseUri);var _miniSignals=require("mini-signals");var _miniSignals2=_interopRequireDefault(_miniSignals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var useXdr=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest));var tempAnchor=null;var STATUS_NONE=0;var STATUS_OK=200;var STATUS_EMPTY=204;var STATUS_IE_BUG_EMPTY=1223;var STATUS_TYPE_OK=2;function _noop(){}var Resource=function(){Resource.setExtensionLoadType=function setExtensionLoadType(extname,loadType){setExtMap(Resource._loadTypeMap,extname,loadType)};Resource.setExtensionXhrType=function setExtensionXhrType(extname,xhrType){setExtMap(Resource._xhrTypeMap,extname,xhrType)};function Resource(name,url,options){_classCallCheck(this,Resource);if(typeof name!=="string"||typeof url!=="string"){throw new Error("Both name and url are required for constructing a resource.")}options=options||{};this._flags=0;this._setFlag(Resource.STATUS_FLAGS.DATA_URL,url.indexOf("data:")===0);this.name=name;this.url=url;this.extension=this._getExtension();this.data=null;this.crossOrigin=options.crossOrigin===true?"anonymous":options.crossOrigin;this.loadType=options.loadType||this._determineLoadType();this.xhrType=options.xhrType;this.metadata=options.metadata||{};this.error=null;this.xhr=null;this.children=[];this.type=Resource.TYPE.UNKNOWN;this.progressChunk=0;this._dequeue=_noop;this._onLoadBinding=null;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this);this.onStart=new _miniSignals2.default;this.onProgress=new _miniSignals2.default;this.onComplete=new _miniSignals2.default;this.onAfterMiddleware=new _miniSignals2.default}Resource.prototype.complete=function complete(){if(this.data&&this.data.removeEventListener){this.data.removeEventListener("error",this._boundOnError,false);this.data.removeEventListener("load",this._boundComplete,false);this.data.removeEventListener("progress",this._boundOnProgress,false);this.data.removeEventListener("canplaythrough",this._boundComplete,false)}if(this.xhr){if(this.xhr.removeEventListener){this.xhr.removeEventListener("error",this._boundXhrOnError,false);this.xhr.removeEventListener("abort",this._boundXhrOnAbort,false);this.xhr.removeEventListener("progress",this._boundOnProgress,false);this.xhr.removeEventListener("load",this._boundXhrOnLoad,false)}else{this.xhr.onerror=null;this.xhr.ontimeout=null;this.xhr.onprogress=null;this.xhr.onload=null}}if(this.isComplete){throw new Error("Complete called again for an already completed resource.")}this._setFlag(Resource.STATUS_FLAGS.COMPLETE,true);this._setFlag(Resource.STATUS_FLAGS.LOADING,false);this.onComplete.dispatch(this)};Resource.prototype.abort=function abort(message){if(this.error){return}this.error=new Error(message);if(this.xhr){this.xhr.abort()}else if(this.xdr){this.xdr.abort()}else if(this.data){if(this.data.src){this.data.src=Resource.EMPTY_GIF}else{while(this.data.firstChild){this.data.removeChild(this.data.firstChild)}}}this.complete()};Resource.prototype.load=function load(cb){var _this=this;if(this.isLoading){return}if(this.isComplete){if(cb){setTimeout(function(){return cb(_this)},1)}return}else if(cb){this.onComplete.once(cb)}this._setFlag(Resource.STATUS_FLAGS.LOADING,true);this.onStart.dispatch(this);if(this.crossOrigin===false||typeof this.crossOrigin!=="string"){this.crossOrigin=this._determineCrossOrigin(this.url)}switch(this.loadType){case Resource.LOAD_TYPE.IMAGE:this.type=Resource.TYPE.IMAGE;this._loadElement("image");break;case Resource.LOAD_TYPE.AUDIO:this.type=Resource.TYPE.AUDIO;this._loadSourceElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this.type=Resource.TYPE.VIDEO;this._loadSourceElement("video");break;case Resource.LOAD_TYPE.XHR:default:if(useXdr&&this.crossOrigin){this._loadXdr()}else{this._loadXhr()}break}};Resource.prototype._hasFlag=function _hasFlag(flag){return!!(this._flags&flag)};Resource.prototype._setFlag=function _setFlag(flag,value){this._flags=value?this._flags|flag:this._flags&~flag};Resource.prototype._loadElement=function _loadElement(type){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(type==="image"&&typeof window.Image!=="undefined"){this.data=new Image}else{this.data=document.createElement(type)}if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}if(!this.metadata.skipSource){this.data.src=this.url}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false)};Resource.prototype._loadSourceElement=function _loadSourceElement(type){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(type==="audio"&&typeof window.Audio!=="undefined"){this.data=new Audio}else{this.data=document.createElement(type)}if(this.data===null){this.abort("Unsupported element: "+type);return}if(!this.metadata.skipSource){if(navigator.isCocoonJS){this.data.src=Array.isArray(this.url)?this.url[0]:this.url}else if(Array.isArray(this.url)){var mimeTypes=this.metadata.mimeType;for(var i=0;i<this.url.length;++i){this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes))}}else{var _mimeTypes=this.metadata.mimeType;this.data.appendChild(this._createSource(type,this.url,Array.isArray(_mimeTypes)?_mimeTypes[0]:_mimeTypes))}}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);this.data.addEventListener("canplaythrough",this._boundComplete,false);this.data.load()};Resource.prototype._loadXhr=function _loadXhr(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,true);if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT){xhr.responseType=Resource.XHR_RESPONSE_TYPE.TEXT}else{xhr.responseType=this.xhrType}xhr.addEventListener("error",this._boundXhrOnError,false);xhr.addEventListener("abort",this._boundXhrOnAbort,false);xhr.addEventListener("progress",this._boundOnProgress,false);xhr.addEventListener("load",this._boundXhrOnLoad,false);xhr.send()};Resource.prototype._loadXdr=function _loadXdr(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xdr=this.xhr=new XDomainRequest;xdr.timeout=5e3;xdr.onerror=this._boundXhrOnError;xdr.ontimeout=this._boundXdrOnTimeout;xdr.onprogress=this._boundOnProgress;xdr.onload=this._boundXhrOnLoad;xdr.open("GET",this.url,true);setTimeout(function(){return xdr.send()},1)};Resource.prototype._createSource=function _createSource(type,url,mime){if(!mime){mime=type+"/"+this._getExtension(url)}var source=document.createElement("source");source.src=url;source.type=mime;return source};Resource.prototype._onError=function _onError(event){this.abort("Failed to load element using: "+event.target.nodeName)};Resource.prototype._onProgress=function _onProgress(event){if(event&&event.lengthComputable){this.onProgress.dispatch(this,event.loaded/event.total)}};Resource.prototype._xhrOnError=function _xhrOnError(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+', text: "'+xhr.statusText+'"')};Resource.prototype._xhrOnAbort=function _xhrOnAbort(){this.abort(reqType(this.xhr)+" Request was aborted by the user.")};Resource.prototype._xdrOnTimeout=function _xdrOnTimeout(){this.abort(reqType(this.xhr)+" Request timed out.")};Resource.prototype._xhrOnLoad=function _xhrOnLoad(){var xhr=this.xhr;var text="";var status=typeof xhr.status==="undefined"?STATUS_OK:xhr.status;if(xhr.responseType===""||xhr.responseType==="text"||typeof xhr.responseType==="undefined"){text=xhr.responseText}if(status===STATUS_NONE&&text.length>0){status=STATUS_OK}else if(status===STATUS_IE_BUG_EMPTY){status=STATUS_EMPTY}var statusType=status/100|0;if(statusType===STATUS_TYPE_OK){if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT){this.data=text;this.type=Resource.TYPE.TEXT}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON){try{this.data=JSON.parse(text);this.type=Resource.TYPE.JSON}catch(e){this.abort("Error trying to parse loaded json: "+e);return}}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT){try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(text,"text/xml")}else{var div=document.createElement("div");div.innerHTML=text;this.data=div}this.type=Resource.TYPE.XML}catch(e){this.abort("Error trying to parse loaded xml: "+e);return}}else{this.data=xhr.response||text}}else{this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL);return}this.complete()};Resource.prototype._determineCrossOrigin=function _determineCrossOrigin(url,loc){if(url.indexOf("data:")===0){return""}loc=loc||window.location;if(!tempAnchor){tempAnchor=document.createElement("a")}tempAnchor.href=url;url=(0,_parseUri2.default)(tempAnchor.href,{strictMode:true});var samePort=!url.port&&loc.port===""||url.port===loc.port;var protocol=url.protocol?url.protocol+":":"";if(url.host!==loc.hostname||!samePort||protocol!==loc.protocol){return"anonymous"}return""};Resource.prototype._determineXhrType=function _determineXhrType(){return Resource._xhrTypeMap[this.extension]||Resource.XHR_RESPONSE_TYPE.TEXT};Resource.prototype._determineLoadType=function _determineLoadType(){return Resource._loadTypeMap[this.extension]||Resource.LOAD_TYPE.XHR};Resource.prototype._getExtension=function _getExtension(){var url=this.url;var ext="";if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?");var hashStart=url.indexOf("#");var index=Math.min(queryStart>-1?queryStart:url.length,hashStart>-1?hashStart:url.length);url=url.substring(0,index);ext=url.substring(url.lastIndexOf(".")+1)}return ext.toLowerCase()};Resource.prototype._getMimeFromXhrType=function _getMimeFromXhrType(type){switch(type){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource.XHR_RESPONSE_TYPE.DEFAULT:case Resource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}};_createClass(Resource,[{key:"isDataUrl",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.LOADING)}}]);return Resource}();exports.default=Resource;Resource.STATUS_FLAGS={NONE:0,DATA_URL:1<<0,COMPLETE:1<<1,LOADING:1<<2};Resource.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};Resource.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};Resource.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};Resource._loadTypeMap={gif:Resource.LOAD_TYPE.IMAGE,png:Resource.LOAD_TYPE.IMAGE,bmp:Resource.LOAD_TYPE.IMAGE,jpg:Resource.LOAD_TYPE.IMAGE,jpeg:Resource.LOAD_TYPE.IMAGE,tif:Resource.LOAD_TYPE.IMAGE,tiff:Resource.LOAD_TYPE.IMAGE,webp:Resource.LOAD_TYPE.IMAGE,tga:Resource.LOAD_TYPE.IMAGE,svg:Resource.LOAD_TYPE.IMAGE,"svg+xml":Resource.LOAD_TYPE.IMAGE,mp3:Resource.LOAD_TYPE.AUDIO,ogg:Resource.LOAD_TYPE.AUDIO,wav:Resource.LOAD_TYPE.AUDIO,mp4:Resource.LOAD_TYPE.VIDEO,webm:Resource.LOAD_TYPE.VIDEO};Resource._xhrTypeMap={xhtml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource.XHR_RESPONSE_TYPE.BLOB,png:Resource.XHR_RESPONSE_TYPE.BLOB,bmp:Resource.XHR_RESPONSE_TYPE.BLOB,jpg:Resource.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource.XHR_RESPONSE_TYPE.BLOB,tif:Resource.XHR_RESPONSE_TYPE.BLOB,tiff:Resource.XHR_RESPONSE_TYPE.BLOB,webp:Resource.XHR_RESPONSE_TYPE.BLOB,tga:Resource.XHR_RESPONSE_TYPE.BLOB,json:Resource.XHR_RESPONSE_TYPE.JSON,text:Resource.XHR_RESPONSE_TYPE.TEXT,txt:Resource.XHR_RESPONSE_TYPE.TEXT,ttf:Resource.XHR_RESPONSE_TYPE.BUFFER,otf:Resource.XHR_RESPONSE_TYPE.BUFFER};Resource.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function setExtMap(map,extname,val){if(extname&&extname.indexOf(".")===0){extname=extname.substring(1)}if(!extname){return}map[extname]=val}function reqType(xhr){return xhr.toString().replace("object ","")}},{"mini-signals":225,"parse-uri":250}],437:[function(require,module,exports){"use strict";exports.__esModule=true;exports.eachSeries=eachSeries;exports.queue=queue;function _noop(){}function eachSeries(array,iterator,callback,deferNext){var i=0;var len=array.length;(function next(err){if(err||i===len){if(callback){callback(err)}return}if(deferNext){setTimeout(function(){iterator(array[i++],next)},1)}else{iterator(array[i++],next)}})()}function onlyOnce(fn){return function onceWrapper(){if(fn===null){throw new Error("Callback was already called.")}var callFn=fn;fn=null;callFn.apply(this,arguments)}}function queue(worker,concurrency){if(concurrency==null){concurrency=1}else if(concurrency===0){throw new Error("Concurrency must not be zero")}var workers=0;var q={_tasks:[],concurrency:concurrency,saturated:_noop,unsaturated:_noop,buffer:concurrency/4,empty:_noop,drain:_noop,error:_noop,started:false,paused:false,push:function push(data,callback){_insert(data,false,callback)},kill:function kill(){workers=0;q.drain=_noop;q.started=false;q._tasks=[]},unshift:function unshift(data,callback){_insert(data,true,callback)},process:function process(){while(!q.paused&&workers<q.concurrency&&q._tasks.length){var task=q._tasks.shift();if(q._tasks.length===0){q.empty()}workers+=1;if(workers===q.concurrency){q.saturated()}worker(task.data,onlyOnce(_next(task)))}},length:function length(){return q._tasks.length},running:function running(){return workers},idle:function idle(){return q._tasks.length+workers===0},pause:function pause(){if(q.paused===true){return}q.paused=true},resume:function resume(){if(q.paused===false){return}q.paused=false;for(var w=1;w<=q.concurrency;w++){q.process()}}};function _insert(data,insertAtFront,callback){if(callback!=null&&typeof callback!=="function"){throw new Error("task callback must be a function")}q.started=true;if(data==null&&q.idle()){setTimeout(function(){return q.drain()},1);return}var item={data:data,callback:typeof callback==="function"?callback:_noop};if(insertAtFront){q._tasks.unshift(item)}else{q._tasks.push(item)}setTimeout(function(){return q.process()},1)}function _next(task){return function next(){workers-=1;task.callback.apply(task,arguments);if(arguments[0]!=null){q.error(arguments[0],task.data)}if(workers<=q.concurrency-q.buffer){q.unsaturated()}if(q.idle()){q.drain()}q.process()}}return q}},{}],438:[function(require,module,exports){"use strict";exports.__esModule=true;exports.encodeBinary=encodeBinary;var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(input){var output="";var inx=0;while(inx<input.length){var bytebuffer=[0,0,0];var encodedCharIndexes=[0,0,0,0];for(var jnx=0;jnx<bytebuffer.length;++jnx){if(inx<input.length){bytebuffer[jnx]=input.charCodeAt(inx++)&255}else{bytebuffer[jnx]=0}}encodedCharIndexes[0]=bytebuffer[0]>>2;encodedCharIndexes[1]=(bytebuffer[0]&3)<<4|bytebuffer[1]>>4;encodedCharIndexes[2]=(bytebuffer[1]&15)<<2|bytebuffer[2]>>6;encodedCharIndexes[3]=bytebuffer[2]&63;var paddingBytes=inx-(input.length-1);switch(paddingBytes){case 2:encodedCharIndexes[3]=64;encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64;break;default:break}for(var _jnx=0;_jnx<encodedCharIndexes.length;++_jnx){output+=_keyStr.charAt(encodedCharIndexes[_jnx])}}return output}},{}],439:[function(require,module,exports){"use strict";var Loader=require("./Loader").default;var Resource=require("./Resource").default;var async=require("./async");var b64=require("./b64");Loader.Resource=Resource;Loader.async=async;Loader.base64=b64;module.exports=Loader;module.exports.default=Loader},{"./Loader":435,"./Resource":436,"./async":437,"./b64":438}],440:[function(require,module,exports){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.blobMiddlewareFactory=blobMiddlewareFactory;var _Resource=require("../../Resource");var _Resource2=_interopRequireDefault(_Resource);var _b=require("../../b64");var _b2=_interopRequireDefault(_b);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Url=window.URL||window.webkitURL;function blobMiddlewareFactory(){return function blobMiddleware(resource,next){if(!resource.data){next();return}if(resource.xhr&&resource.xhrType===_Resource2.default.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof resource.data==="string"){var type=resource.xhr.getResponseHeader("content-type");if(type&&type.indexOf("image")===0){resource.data=new Image;resource.data.src="data:"+type+";base64,"+_b2.default.encodeBinary(resource.xhr.responseText);resource.type=_Resource2.default.TYPE.IMAGE;resource.data.onload=function(){resource.data.onload=null;next()};return}}else if(resource.data.type.indexOf("image")===0){var _ret=function(){var src=Url.createObjectURL(resource.data);resource.blob=resource.data;resource.data=new Image;resource.data.src=src;resource.type=_Resource2.default.TYPE.IMAGE;resource.data.onload=function(){Url.revokeObjectURL(src);resource.data.onload=null;next()};return{v:void 0}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}}next()}}},{"../../Resource":436,"../../b64":438}],441:[function(require,module,exports){(function(global){module.exports=global.performance&&global.performance.now?function now(){return performance.now()}:Date.now||function now(){return+new Date}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],442:[function(require,module,exports){"use strict";var SDPUtils=require("sdp");function writeMediaSection(transceiver,caps,type,stream,dtlsRole){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters());sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),type==="offer"?"actpass":dtlsRole||"active");sdp+="a=mid:"+transceiver.mid+"\r\n";if(transceiver.direction){sdp+="a="+transceiver.direction+"\r\n"}else if(transceiver.rtpSender&&transceiver.rtpReceiver){sdp+="a=sendrecv\r\n"}else if(transceiver.rtpSender){sdp+="a=sendonly\r\n"}else if(transceiver.rtpReceiver){sdp+="a=recvonly\r\n"}else{sdp+="a=inactive\r\n"}if(transceiver.rtpSender){var msid="msid:"+stream.id+" "+transceiver.rtpSender.track.id+"\r\n";sdp+="a="+msid;sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid;if(transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid;sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n";if(transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"}return sdp}function filterIceServers(iceServers,edgeVersion){var hasTurn=false;iceServers=JSON.parse(JSON.stringify(iceServers));return iceServers.filter(function(server){if(server&&(server.urls||server.url)){var urls=server.urls||server.url;if(server.url&&!server.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var isString=typeof urls==="string";if(isString){urls=[urls]}urls=urls.filter(function(url){var validTurn=url.indexOf("turn:")===0&&url.indexOf("transport=udp")!==-1&&url.indexOf("turn:[")===-1&&!hasTurn;if(validTurn){hasTurn=true;return true}return url.indexOf("stun:")===0&&edgeVersion>=14393&&url.indexOf("?transport=udp")===-1});delete server.url;server.urls=isString?urls[0]:urls;return!!urls.length}return false})}function getCommonCapabilities(localCapabilities,remoteCapabilities){var commonCapabilities={codecs:[],headerExtensions:[],fecMechanisms:[]};var findCodecByPayloadType=function(pt,codecs){pt=parseInt(pt,10);for(var i=0;i<codecs.length;i++){if(codecs[i].payloadType===pt||codecs[i].preferredPayloadType===pt){return codecs[i]}}};var rtxCapabilityMatches=function(lRtx,rRtx,lCodecs,rCodecs){var lCodec=findCodecByPayloadType(lRtx.parameters.apt,lCodecs);var rCodec=findCodecByPayloadType(rRtx.parameters.apt,rCodecs);return lCodec&&rCodec&&lCodec.name.toLowerCase()===rCodec.name.toLowerCase()};localCapabilities.codecs.forEach(function(lCodec){for(var i=0;i<remoteCapabilities.codecs.length;i++){var rCodec=remoteCapabilities.codecs[i];if(lCodec.name.toLowerCase()===rCodec.name.toLowerCase()&&lCodec.clockRate===rCodec.clockRate){if(lCodec.name.toLowerCase()==="rtx"&&lCodec.parameters&&rCodec.parameters.apt){if(!rtxCapabilityMatches(lCodec,rCodec,localCapabilities.codecs,remoteCapabilities.codecs)){continue}}rCodec=JSON.parse(JSON.stringify(rCodec));rCodec.numChannels=Math.min(lCodec.numChannels,rCodec.numChannels);commonCapabilities.codecs.push(rCodec);rCodec.rtcpFeedback=rCodec.rtcpFeedback.filter(function(fb){for(var j=0;j<lCodec.rtcpFeedback.length;j++){if(lCodec.rtcpFeedback[j].type===fb.type&&lCodec.rtcpFeedback[j].parameter===fb.parameter){return true}}return false});break}}});localCapabilities.headerExtensions.forEach(function(lHeaderExtension){for(var i=0;i<remoteCapabilities.headerExtensions.length;i++){var rHeaderExtension=remoteCapabilities.headerExtensions[i];if(lHeaderExtension.uri===rHeaderExtension.uri){commonCapabilities.headerExtensions.push(rHeaderExtension);break}}});return commonCapabilities}function isActionAllowedInSignalingState(action,type,signalingState){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[type][action].indexOf(signalingState)!==-1}function maybeAddCandidate(iceTransport,candidate){var alreadyAdded=iceTransport.getRemoteCandidates().find(function(remoteCandidate){return candidate.foundation===remoteCandidate.foundation&&candidate.ip===remoteCandidate.ip&&candidate.port===remoteCandidate.port&&candidate.priority===remoteCandidate.priority&&candidate.protocol===remoteCandidate.protocol&&candidate.type===remoteCandidate.type});if(!alreadyAdded){iceTransport.addRemoteCandidate(candidate)}return!alreadyAdded}module.exports=function(window,edgeVersion){var RTCPeerConnection=function(config){var self=this;var _eventTarget=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(method){self[method]=_eventTarget[method].bind(_eventTarget)});this.onicecandidate=null;this.onaddstream=null;this.ontrack=null;this.onremovestream=null;this.onsignalingstatechange=null;this.oniceconnectionstatechange=null;this.onicegatheringstatechange=null;this.onnegotiationneeded=null;this.ondatachannel=null;this.canTrickleIceCandidates=null;this.needNegotiation=false;this.localStreams=[];this.remoteStreams=[];this.localDescription=null;this.remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.iceGatheringState="new";config=JSON.parse(JSON.stringify(config||{}));this.usingBundle=config.bundlePolicy==="max-bundle";if(config.rtcpMuxPolicy==="negotiate"){var e=new Error("rtcpMuxPolicy 'negotiate' is not supported");e.name="NotSupportedError";throw e}else if(!config.rtcpMuxPolicy){config.rtcpMuxPolicy="require"}switch(config.iceTransportPolicy){case"all":case"relay":break;default:config.iceTransportPolicy="all";break}switch(config.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:config.bundlePolicy="balanced";break}config.iceServers=filterIceServers(config.iceServers||[],edgeVersion);this._iceGatherers=[];if(config.iceCandidatePoolSize){for(var i=config.iceCandidatePoolSize;i>0;i--){this._iceGatherers=new window.RTCIceGatherer({iceServers:config.iceServers,gatherPolicy:config.iceTransportPolicy})}}else{config.iceCandidatePoolSize=0}this._config=config;this.transceivers=[];this._sdpSessionId=SDPUtils.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined};RTCPeerConnection.prototype._emitGatheringStateChange=function(){var event=new Event("icegatheringstatechange");this.dispatchEvent(event);if(typeof this.onicegatheringstatechange==="function"){this.onicegatheringstatechange(event)}};RTCPeerConnection.prototype.getConfiguration=function(){return this._config};RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams};RTCPeerConnection.prototype._createTransceiver=function(kind){var hasBundleTransport=this.transceivers.length>0;var transceiver={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:kind,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:true};if(this.usingBundle&&hasBundleTransport){transceiver.iceTransport=this.transceivers[0].iceTransport;transceiver.dtlsTransport=this.transceivers[0].dtlsTransport}else{var transports=this._createIceAndDtlsTransports();transceiver.iceTransport=transports.iceTransport;transceiver.dtlsTransport=transports.dtlsTransport}this.transceivers.push(transceiver);return transceiver};RTCPeerConnection.prototype.addTrack=function(track,stream){var transceiver;for(var i=0;i<this.transceivers.length;i++){if(!this.transceivers[i].track&&this.transceivers[i].kind===track.kind){transceiver=this.transceivers[i]}}if(!transceiver){transceiver=this._createTransceiver(track.kind)}this._maybeFireNegotiationNeeded();if(this.localStreams.indexOf(stream)===-1){this.localStreams.push(stream)}transceiver.track=track;transceiver.stream=stream;transceiver.rtpSender=new window.RTCRtpSender(track,transceiver.dtlsTransport);return transceiver.rtpSender};RTCPeerConnection.prototype.addStream=function(stream){var self=this;if(edgeVersion>=15025){stream.getTracks().forEach(function(track){self.addTrack(track,stream)})}else{var clonedStream=stream.clone();stream.getTracks().forEach(function(track,idx){var clonedTrack=clonedStream.getTracks()[idx];track.addEventListener("enabled",function(event){clonedTrack.enabled=event.enabled})});clonedStream.getTracks().forEach(function(track){self.addTrack(track,clonedStream)})}};RTCPeerConnection.prototype.removeStream=function(stream){var idx=this.localStreams.indexOf(stream);if(idx>-1){this.localStreams.splice(idx,1);this._maybeFireNegotiationNeeded()}};RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(transceiver){return!!transceiver.rtpSender}).map(function(transceiver){return transceiver.rtpSender})};RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(transceiver){return!!transceiver.rtpReceiver}).map(function(transceiver){return transceiver.rtpReceiver})};RTCPeerConnection.prototype._createIceGatherer=function(sdpMLineIndex,usingBundle){var self=this;if(usingBundle&&sdpMLineIndex>0){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var iceGatherer=new window.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(iceGatherer,"state",{value:"new",writable:true});this.transceivers[sdpMLineIndex].candidates=[];this.transceivers[sdpMLineIndex].bufferCandidates=function(event){var end=!event.candidate||Object.keys(event.candidate).length===0;iceGatherer.state=end?"completed":"gathering";if(self.transceivers[sdpMLineIndex].candidates!==null){self.transceivers[sdpMLineIndex].candidates.push(event.candidate)}};iceGatherer.addEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates);return iceGatherer};RTCPeerConnection.prototype._gather=function(mid,sdpMLineIndex){var self=this;var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(iceGatherer.onlocalcandidate){return}var candidates=this.transceivers[sdpMLineIndex].candidates;this.transceivers[sdpMLineIndex].candidates=null;iceGatherer.removeEventListener("localcandidate",this.transceivers[sdpMLineIndex].bufferCandidates);iceGatherer.onlocalcandidate=function(evt){if(self.usingBundle&&sdpMLineIndex>0){return}var event=new Event("icecandidate");event.candidate={sdpMid:mid,sdpMLineIndex:sdpMLineIndex};var cand=evt.candidate;var end=!cand||Object.keys(cand).length===0;if(end){if(iceGatherer.state==="new"||iceGatherer.state==="gathering"){iceGatherer.state="completed"}}else{if(iceGatherer.state==="new"){iceGatherer.state="gathering"}cand.component=1;event.candidate.candidate=SDPUtils.writeCandidate(cand)}var sections=SDPUtils.splitSections(self.localDescription.sdp);if(!end){sections[event.candidate.sdpMLineIndex+1]+="a="+event.candidate.candidate+"\r\n"}else{sections[event.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n"}self.localDescription.sdp=sections.join("");var complete=self.transceivers.every(function(transceiver){return transceiver.iceGatherer&&transceiver.iceGatherer.state==="completed"});if(self.iceGatheringState!=="gathering"){self.iceGatheringState="gathering";self._emitGatheringStateChange()}if(!end){self.dispatchEvent(event);if(typeof self.onicecandidate==="function"){self.onicecandidate(event)}}if(complete){self.dispatchEvent(new Event("icecandidate"));if(typeof self.onicecandidate==="function"){self.onicecandidate(new Event("icecandidate"))}self.iceGatheringState="complete";self._emitGatheringStateChange()}};window.setTimeout(function(){candidates.forEach(function(candidate){var e=new Event("RTCIceGatherEvent");e.candidate=candidate;iceGatherer.onlocalcandidate(e)})},0)};RTCPeerConnection.prototype._createIceAndDtlsTransports=function(){var self=this;var iceTransport=new window.RTCIceTransport(null);iceTransport.onicestatechange=function(){self._updateConnectionState()};var dtlsTransport=new window.RTCDtlsTransport(iceTransport);dtlsTransport.ondtlsstatechange=function(){self._updateConnectionState()};dtlsTransport.onerror=function(){Object.defineProperty(dtlsTransport,"state",{value:"failed",writable:true});self._updateConnectionState()};return{iceTransport:iceTransport,dtlsTransport:dtlsTransport}};RTCPeerConnection.prototype._disposeIceAndDtlsTransports=function(sdpMLineIndex){var iceGatherer=this.transceivers[sdpMLineIndex].iceGatherer;if(iceGatherer){delete iceGatherer.onlocalcandidate;delete this.transceivers[sdpMLineIndex].iceGatherer}var iceTransport=this.transceivers[sdpMLineIndex].iceTransport;if(iceTransport){delete iceTransport.onicestatechange;delete this.transceivers[sdpMLineIndex].iceTransport}var dtlsTransport=this.transceivers[sdpMLineIndex].dtlsTransport;if(dtlsTransport){delete dtlsTransport.ondtlsstatechange;delete dtlsTransport.onerror;delete this.transceivers[sdpMLineIndex].dtlsTransport}};RTCPeerConnection.prototype._transceive=function(transceiver,send,recv){var params=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);if(send&&transceiver.rtpSender){params.encodings=transceiver.sendEncodingParameters;params.rtcp={cname:SDPUtils.localCName,compound:transceiver.rtcpParameters.compound};if(transceiver.recvEncodingParameters.length){params.rtcp.ssrc=transceiver.recvEncodingParameters[0].ssrc}transceiver.rtpSender.send(params)}if(recv&&transceiver.rtpReceiver&&params.codecs.length>0){if(transceiver.kind==="video"&&transceiver.recvEncodingParameters&&edgeVersion<15019){transceiver.recvEncodingParameters.forEach(function(p){delete p.rtx})}params.encodings=transceiver.recvEncodingParameters;params.rtcp={cname:transceiver.rtcpParameters.cname,compound:transceiver.rtcpParameters.compound};if(transceiver.sendEncodingParameters.length){params.rtcp.ssrc=transceiver.sendEncodingParameters[0].ssrc}transceiver.rtpReceiver.receive(params)}};RTCPeerConnection.prototype.setLocalDescription=function(description){var self=this;var args=arguments;if(!isActionAllowedInSignalingState("setLocalDescription",description.type,this.signalingState)){return new Promise(function(resolve,reject){var e=new Error("Can not set local "+description.type+" in state "+self.signalingState);e.name="InvalidStateError";if(args.length>2&&typeof args[2]==="function"){args[2].apply(null,[e])}reject(e)})}var sections;var sessionpart;if(description.type==="offer"){sections=SDPUtils.splitSections(description.sdp);sessionpart=sections.shift();sections.forEach(function(mediaSection,sdpMLineIndex){var caps=SDPUtils.parseRtpParameters(mediaSection);self.transceivers[sdpMLineIndex].localCapabilities=caps});this.transceivers.forEach(function(transceiver,sdpMLineIndex){self._gather(transceiver.mid,sdpMLineIndex)})}else if(description.type==="answer"){sections=SDPUtils.splitSections(self.remoteDescription.sdp);sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;sections.forEach(function(mediaSection,sdpMLineIndex){var transceiver=self.transceivers[sdpMLineIndex];var iceGatherer=transceiver.iceGatherer;var iceTransport=transceiver.iceTransport;var dtlsTransport=transceiver.dtlsTransport;var localCapabilities=transceiver.localCapabilities;var remoteCapabilities=transceiver.remoteCapabilities;var rejected=SDPUtils.isRejected(mediaSection)&&!SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length===1;if(!rejected&&!transceiver.isDatachannel){var remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart);var remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);if(isIceLite){remoteDtlsParameters.role="server"}if(!self.usingBundle||sdpMLineIndex===0){self._gather(transceiver.mid,sdpMLineIndex);if(iceTransport.state==="new"){iceTransport.start(iceGatherer,remoteIceParameters,isIceLite?"controlling":"controlled")}if(dtlsTransport.state==="new"){dtlsTransport.start(remoteDtlsParameters)}}var params=getCommonCapabilities(localCapabilities,remoteCapabilities);self._transceive(transceiver,params.codecs.length>0,false)}})}this.localDescription={type:description.type,sdp:description.sdp};switch(description.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+description.type+'"')}var cb=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];return new Promise(function(resolve){if(cb){cb.apply(null)}resolve()})};RTCPeerConnection.prototype.setRemoteDescription=function(description){var self=this;var args=arguments;if(!isActionAllowedInSignalingState("setRemoteDescription",description.type,this.signalingState)){return new Promise(function(resolve,reject){var e=new Error("Can not set remote "+description.type+" in state "+self.signalingState);e.name="InvalidStateError";if(args.length>2&&typeof args[2]==="function"){args[2].apply(null,[e])}reject(e)})}var streams={};this.remoteStreams.forEach(function(stream){streams[stream.id]=stream});var receiverList=[];var sections=SDPUtils.splitSections(description.sdp);var sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,"a=ice-lite").length>0;var usingBundle=SDPUtils.matchPrefix(sessionpart,"a=group:BUNDLE ").length>0;this.usingBundle=usingBundle;var iceOptions=SDPUtils.matchPrefix(sessionpart,"a=ice-options:")[0];if(iceOptions){this.canTrickleIceCandidates=iceOptions.substr(14).split(" ").indexOf("trickle")>=0}else{this.canTrickleIceCandidates=false}sections.forEach(function(mediaSection,sdpMLineIndex){var lines=SDPUtils.splitLines(mediaSection);var kind=SDPUtils.getKind(mediaSection);var rejected=SDPUtils.isRejected(mediaSection)&&!SDPUtils.matchPrefix(mediaSection,"a=bundle-only").length===1;var protocol=lines[0].substr(2).split(" ")[2];var direction=SDPUtils.getDirection(mediaSection,sessionpart);var remoteMsid=SDPUtils.parseMsid(mediaSection);var mid=SDPUtils.getMid(mediaSection)||SDPUtils.generateIdentifier();if(kind==="application"&&protocol==="DTLS/SCTP"){self.transceivers[sdpMLineIndex]={mid:mid,isDatachannel:true};return}var transceiver;var iceGatherer;var iceTransport;var dtlsTransport;var rtpReceiver;var sendEncodingParameters;var recvEncodingParameters;var localCapabilities;var track;var remoteCapabilities=SDPUtils.parseRtpParameters(mediaSection);var remoteIceParameters;var remoteDtlsParameters;if(!rejected){remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart);remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);remoteDtlsParameters.role="client"}recvEncodingParameters=SDPUtils.parseRtpEncodingParameters(mediaSection);var rtcpParameters=SDPUtils.parseRtcpParameters(mediaSection);var isComplete=SDPUtils.matchPrefix(mediaSection,"a=end-of-candidates",sessionpart).length>0;var cands=SDPUtils.matchPrefix(mediaSection,"a=candidate:").map(function(cand){return SDPUtils.parseCandidate(cand)}).filter(function(cand){return cand.component===1});if((description.type==="offer"||description.type==="answer")&&!rejected&&usingBundle&&sdpMLineIndex>0&&self.transceivers[sdpMLineIndex]){self._disposeIceAndDtlsTransports(sdpMLineIndex);self.transceivers[sdpMLineIndex].iceGatherer=self.transceivers[0].iceGatherer;self.transceivers[sdpMLineIndex].iceTransport=self.transceivers[0].iceTransport;self.transceivers[sdpMLineIndex].dtlsTransport=self.transceivers[0].dtlsTransport;if(self.transceivers[sdpMLineIndex].rtpSender){self.transceivers[sdpMLineIndex].rtpSender.setTransport(self.transceivers[0].dtlsTransport)}if(self.transceivers[sdpMLineIndex].rtpReceiver){self.transceivers[sdpMLineIndex].rtpReceiver.setTransport(self.transceivers[0].dtlsTransport)}}if(description.type==="offer"&&!rejected){transceiver=self.transceivers[sdpMLineIndex]||self._createTransceiver(kind);transceiver.mid=mid;if(!transceiver.iceGatherer){transceiver.iceGatherer=self._createIceGatherer(sdpMLineIndex,usingBundle)}if(cands.length&&transceiver.iceTransport.state==="new"){if(isComplete&&(!usingBundle||sdpMLineIndex===0)){transceiver.iceTransport.setRemoteCandidates(cands)}else{cands.forEach(function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})}}localCapabilities=window.RTCRtpReceiver.getCapabilities(kind);if(edgeVersion<15019){localCapabilities.codecs=localCapabilities.codecs.filter(function(codec){return codec.name!=="rtx"})}sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:(2*sdpMLineIndex+2)*1001}];var isNewTrack=false;if(direction==="sendrecv"||direction==="sendonly"){isNewTrack=!transceiver.rtpReceiver;rtpReceiver=transceiver.rtpReceiver||new window.RTCRtpReceiver(transceiver.dtlsTransport,kind);if(isNewTrack){var stream;track=rtpReceiver.track;if(remoteMsid){if(!streams[remoteMsid.stream]){streams[remoteMsid.stream]=new window.MediaStream;Object.defineProperty(streams[remoteMsid.stream],"id",{get:function(){return remoteMsid.stream}})}Object.defineProperty(track,"id",{get:function(){return remoteMsid.track}});stream=streams[remoteMsid.stream]}else{if(!streams.default){streams.default=new window.MediaStream}stream=streams.default}stream.addTrack(track);receiverList.push([track,rtpReceiver,stream])}}transceiver.localCapabilities=localCapabilities;transceiver.remoteCapabilities=remoteCapabilities;transceiver.rtpReceiver=rtpReceiver;transceiver.rtcpParameters=rtcpParameters;transceiver.sendEncodingParameters=sendEncodingParameters;transceiver.recvEncodingParameters=recvEncodingParameters;self._transceive(self.transceivers[sdpMLineIndex],false,isNewTrack)}else if(description.type==="answer"&&!rejected){transceiver=self.transceivers[sdpMLineIndex];iceGatherer=transceiver.iceGatherer;iceTransport=transceiver.iceTransport;dtlsTransport=transceiver.dtlsTransport;rtpReceiver=transceiver.rtpReceiver;sendEncodingParameters=transceiver.sendEncodingParameters;localCapabilities=transceiver.localCapabilities;self.transceivers[sdpMLineIndex].recvEncodingParameters=recvEncodingParameters;self.transceivers[sdpMLineIndex].remoteCapabilities=remoteCapabilities;self.transceivers[sdpMLineIndex].rtcpParameters=rtcpParameters;if(cands.length&&iceTransport.state==="new"){if((isIceLite||isComplete)&&(!usingBundle||sdpMLineIndex===0)){iceTransport.setRemoteCandidates(cands)}else{cands.forEach(function(candidate){maybeAddCandidate(transceiver.iceTransport,candidate)})}}if(!usingBundle||sdpMLineIndex===0){if(iceTransport.state==="new"){iceTransport.start(iceGatherer,remoteIceParameters,"controlling")}if(dtlsTransport.state==="new"){dtlsTransport.start(remoteDtlsParameters)}}self._transceive(transceiver,direction==="sendrecv"||direction==="recvonly",direction==="sendrecv"||direction==="sendonly");if(rtpReceiver&&(direction==="sendrecv"||direction==="sendonly")){track=rtpReceiver.track;if(remoteMsid){if(!streams[remoteMsid.stream]){streams[remoteMsid.stream]=new window.MediaStream}streams[remoteMsid.stream].addTrack(track);receiverList.push([track,rtpReceiver,streams[remoteMsid.stream]])}else{if(!streams.default){streams.default=new window.MediaStream}streams.default.addTrack(track);receiverList.push([track,rtpReceiver,streams.default])}}else{delete transceiver.rtpReceiver}}});if(this._dtlsRole===undefined){this._dtlsRole=description.type==="offer"?"active":"passive"}this.remoteDescription={type:description.type,sdp:description.sdp};switch(description.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+description.type+'"')}Object.keys(streams).forEach(function(sid){var stream=streams[sid];if(stream.getTracks().length){if(self.remoteStreams.indexOf(stream)===-1){self.remoteStreams.push(stream);var event=new Event("addstream");event.stream=stream;window.setTimeout(function(){self.dispatchEvent(event);if(typeof self.onaddstream==="function"){self.onaddstream(event)}})}receiverList.forEach(function(item){var track=item[0];var receiver=item[1];if(stream.id!==item[2].id){return}var trackEvent=new Event("track");trackEvent.track=track;trackEvent.receiver=receiver;trackEvent.transceiver={receiver:receiver};trackEvent.streams=[stream];window.setTimeout(function(){self.dispatchEvent(trackEvent);if(typeof self.ontrack==="function"){self.ontrack(trackEvent)}})})}});window.setTimeout(function(){if(!(self&&self.transceivers)){return}self.transceivers.forEach(function(transceiver){if(transceiver.iceTransport&&transceiver.iceTransport.state==="new"&&transceiver.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");transceiver.iceTransport.addRemoteCandidate({})}})},4e3);return new Promise(function(resolve){if(args.length>1&&typeof args[1]==="function"){args[1].apply(null)}resolve()})};RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(transceiver){if(transceiver.iceTransport){transceiver.iceTransport.stop()}if(transceiver.dtlsTransport){transceiver.dtlsTransport.stop()}if(transceiver.rtpSender){transceiver.rtpSender.stop()}if(transceiver.rtpReceiver){transceiver.rtpReceiver.stop()}});this._updateSignalingState("closed")};RTCPeerConnection.prototype._updateSignalingState=function(newState){this.signalingState=newState;var event=new Event("signalingstatechange");this.dispatchEvent(event);if(typeof this.onsignalingstatechange==="function"){this.onsignalingstatechange(event)}};RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var self=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;window.setTimeout(function(){if(self.needNegotiation===false){return}self.needNegotiation=false;var event=new Event("negotiationneeded");self.dispatchEvent(event);if(typeof self.onnegotiationneeded==="function"){self.onnegotiationneeded(event)}},0)};RTCPeerConnection.prototype._updateConnectionState=function(){var newState;var states={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(transceiver){states[transceiver.iceTransport.state]++;states[transceiver.dtlsTransport.state]++});states.connected+=states.completed;newState="new";if(states.failed>0){newState="failed"}else if(states.connecting>0||states.checking>0){newState="connecting"}else if(states.disconnected>0){newState="disconnected"}else if(states.new>0){newState="new"}else if(states.connected>0||states.completed>0){newState="connected"}if(newState!==this.iceConnectionState){this.iceConnectionState=newState;var event=new Event("iceconnectionstatechange");this.dispatchEvent(event);if(typeof this.oniceconnectionstatechange==="function"){this.oniceconnectionstatechange(event)}}};RTCPeerConnection.prototype.createOffer=function(){var self=this;var args=arguments;var offerOptions;if(arguments.length===1&&typeof arguments[0]!=="function"){offerOptions=arguments[0]}else if(arguments.length===3){offerOptions=arguments[2]}var numAudioTracks=this.transceivers.filter(function(t){return t.kind==="audio"}).length;var numVideoTracks=this.transceivers.filter(function(t){return t.kind==="video"}).length;if(offerOptions){if(offerOptions.mandatory||offerOptions.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(offerOptions.offerToReceiveAudio!==undefined){if(offerOptions.offerToReceiveAudio===true){numAudioTracks=1}else if(offerOptions.offerToReceiveAudio===false){numAudioTracks=0}else{numAudioTracks=offerOptions.offerToReceiveAudio}}if(offerOptions.offerToReceiveVideo!==undefined){if(offerOptions.offerToReceiveVideo===true){numVideoTracks=1}else if(offerOptions.offerToReceiveVideo===false){numVideoTracks=0}else{numVideoTracks=offerOptions.offerToReceiveVideo}}}this.transceivers.forEach(function(transceiver){if(transceiver.kind==="audio"){numAudioTracks--;if(numAudioTracks<0){transceiver.wantReceive=false}}else if(transceiver.kind==="video"){numVideoTracks--;if(numVideoTracks<0){transceiver.wantReceive=false}}});while(numAudioTracks>0||numVideoTracks>0){if(numAudioTracks>0){this._createTransceiver("audio");numAudioTracks--}if(numVideoTracks>0){this._createTransceiver("video");numVideoTracks--}}var sdp=SDPUtils.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(transceiver,sdpMLineIndex){var track=transceiver.track;var kind=transceiver.kind;var mid=SDPUtils.generateIdentifier();transceiver.mid=mid;if(!transceiver.iceGatherer){transceiver.iceGatherer=self._createIceGatherer(sdpMLineIndex,self.usingBundle)}var localCapabilities=window.RTCRtpSender.getCapabilities(kind);if(edgeVersion<15019){localCapabilities.codecs=localCapabilities.codecs.filter(function(codec){return codec.name!=="rtx"})}localCapabilities.codecs.forEach(function(codec){if(codec.name==="H264"&&codec.parameters["level-asymmetry-allowed"]===undefined){codec.parameters["level-asymmetry-allowed"]="1"}});var sendEncodingParameters=transceiver.sendEncodingParameters||[{ssrc:(2*sdpMLineIndex+1)*1001}];if(track){if(edgeVersion>=15019&&kind==="video"&&!sendEncodingParameters[0].rtx){sendEncodingParameters[0].rtx={ssrc:sendEncodingParameters[0].ssrc+1}}}if(transceiver.wantReceive){transceiver.rtpReceiver=new window.RTCRtpReceiver(transceiver.dtlsTransport,kind)}transceiver.localCapabilities=localCapabilities;transceiver.sendEncodingParameters=sendEncodingParameters});if(this._config.bundlePolicy!=="max-compat"){sdp+="a=group:BUNDLE "+this.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"}sdp+="a=ice-options:trickle\r\n";this.transceivers.forEach(function(transceiver,sdpMLineIndex){sdp+=writeMediaSection(transceiver,transceiver.localCapabilities,"offer",transceiver.stream,self._dtlsRole);sdp+="a=rtcp-rsize\r\n";if(transceiver.iceGatherer&&self.iceGatheringState!=="new"&&(sdpMLineIndex===0||!self.usingBundle)){transceiver.iceGatherer.getLocalCandidates().forEach(function(cand){cand.component=1;sdp+="a="+SDPUtils.writeCandidate(cand)+"\r\n"});if(transceiver.iceGatherer.state==="completed"){sdp+="a=end-of-candidates\r\n"}}});var desc=new window.RTCSessionDescription({type:"offer",sdp:sdp});return new Promise(function(resolve){if(args.length>0&&typeof args[0]==="function"){args[0].apply(null,[desc]);resolve();return}resolve(desc)})};RTCPeerConnection.prototype.createAnswer=function(){var self=this;var args=arguments;var sdp=SDPUtils.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);if(this.usingBundle){sdp+="a=group:BUNDLE "+this.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"}var mediaSectionsInOffer=SDPUtils.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(transceiver,sdpMLineIndex){if(sdpMLineIndex+1>mediaSectionsInOffer){return}if(transceiver.isDatachannel){sdp+="m=application 0 DTLS/SCTP 5000\r\n"+"c=IN IP4 0.0.0.0\r\n"+"a=mid:"+transceiver.mid+"\r\n";return}if(transceiver.stream){var localTrack;if(transceiver.kind==="audio"){localTrack=transceiver.stream.getAudioTracks()[0]}else if(transceiver.kind==="video"){localTrack=transceiver.stream.getVideoTracks()[0]}if(localTrack){if(edgeVersion>=15019&&transceiver.kind==="video"&&!transceiver.sendEncodingParameters[0].rtx){transceiver.sendEncodingParameters[0].rtx={ssrc:transceiver.sendEncodingParameters[0].ssrc+1}}}}var commonCapabilities=getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);var hasRtx=commonCapabilities.codecs.filter(function(c){return c.name.toLowerCase()==="rtx"}).length;if(!hasRtx&&transceiver.sendEncodingParameters[0].rtx){delete transceiver.sendEncodingParameters[0].rtx}sdp+=writeMediaSection(transceiver,commonCapabilities,"answer",transceiver.stream,self._dtlsRole);if(transceiver.rtcpParameters&&transceiver.rtcpParameters.reducedSize){sdp+="a=rtcp-rsize\r\n"}});var desc=new window.RTCSessionDescription({type:"answer",sdp:sdp});return new Promise(function(resolve){if(args.length>0&&typeof args[0]==="function"){args[0].apply(null,[desc]);resolve();return}resolve(desc)})};RTCPeerConnection.prototype.addIceCandidate=function(candidate){var err;var sections;if(!candidate||candidate.candidate===""){for(var j=0;j<this.transceivers.length;j++){if(this.transceivers[j].isDatachannel){continue}this.transceivers[j].iceTransport.addRemoteCandidate({});sections=SDPUtils.splitSections(this.remoteDescription.sdp);sections[j+1]+="a=end-of-candidates\r\n";this.remoteDescription.sdp=sections.join("");if(this.usingBundle){break}}}else if(!(candidate.sdpMLineIndex!==undefined||candidate.sdpMid)){throw new TypeError("sdpMLineIndex or sdpMid required")}else if(!this.remoteDescription){err=new Error("Can not add ICE candidate without "+"a remote description");err.name="InvalidStateError"}else{var sdpMLineIndex=candidate.sdpMLineIndex;if(candidate.sdpMid){for(var i=0;i<this.transceivers.length;i++){if(this.transceivers[i].mid===candidate.sdpMid){sdpMLineIndex=i;break}}}var transceiver=this.transceivers[sdpMLineIndex];if(transceiver){if(transceiver.isDatachannel){return Promise.resolve()}var cand=Object.keys(candidate.candidate).length>0?SDPUtils.parseCandidate(candidate.candidate):{};if(cand.protocol==="tcp"&&(cand.port===0||cand.port===9)){return Promise.resolve()}if(cand.component&&cand.component!==1){return Promise.resolve()}if(sdpMLineIndex===0||sdpMLineIndex>0&&transceiver.iceTransport!==this.transceivers[0].iceTransport){if(!maybeAddCandidate(transceiver.iceTransport,cand)){err=new Error("Can not add ICE candidate");err.name="OperationError"}}if(!err){var candidateString=candidate.candidate.trim();if(candidateString.indexOf("a=")===0){candidateString=candidateString.substr(2)}sections=SDPUtils.splitSections(this.remoteDescription.sdp);sections[sdpMLineIndex+1]+="a="+(cand.type?candidateString:"end-of-candidates")+"\r\n";this.remoteDescription.sdp=sections.join("")}}else{err=new Error("Can not add ICE candidate");err.name="OperationError"}}var args=arguments;return new Promise(function(resolve,reject){if(err){if(args.length>2&&typeof args[2]==="function"){args[2].apply(null,[err])}reject(err)}else{if(args.length>1&&typeof args[1]==="function"){args[1].apply(null)}resolve()}})};RTCPeerConnection.prototype.getStats=function(){var promises=[];this.transceivers.forEach(function(transceiver){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(method){if(transceiver[method]){promises.push(transceiver[method].getStats())}})});var cb=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];var fixStatsType=function(stat){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[stat.type]||stat.type};return new Promise(function(resolve){var results=new Map;Promise.all(promises).then(function(res){res.forEach(function(result){Object.keys(result).forEach(function(id){result[id].type=fixStatsType(result[id]);results.set(id,result[id])})});if(cb){cb.apply(null,results)}resolve(results)})})};return RTCPeerConnection}},{sdp:451}],443:[function(require,module,exports){var util=require("util");var SJJ=require("sdp-jingle-json");var WildEmitter=require("wildemitter");var cloneDeep=require("lodash.clonedeep");function PeerConnection(config,constraints){var self=this;var item;WildEmitter.call(this);config=config||{};config.iceServers=config.iceServers||[];this.enableChromeNativeSimulcast=false;if(constraints&&constraints.optional&&window.chrome&&navigator.appVersion.match(/Chromium\//)===null){constraints.optional.forEach(function(constraint){if(constraint.enableChromeNativeSimulcast){self.enableChromeNativeSimulcast=true}})}this.enableMultiStreamHacks=false;if(constraints&&constraints.optional&&window.chrome){constraints.optional.forEach(function(constraint){if(constraint.enableMultiStreamHacks){self.enableMultiStreamHacks=true}})}this.restrictBandwidth=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint){if(constraint.andyetRestrictBandwidth){self.restrictBandwidth=constraint.andyetRestrictBandwidth}})}this.batchIceCandidates=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint){if(constraint.andyetBatchIce){self.batchIceCandidates=constraint.andyetBatchIce}})}this.batchedIceCandidates=[];if(constraints&&constraints.optional&&window.chrome){constraints.optional.forEach(function(constraint){if(constraint.andyetFasterICE){self.eliminateDuplicateCandidates=constraint.andyetFasterICE}})}if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint){if(constraint.andyetDontSignalCandidates){self.dontSignalCandidates=constraint.andyetDontSignalCandidates}})}this.assumeSetLocalSuccess=false;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint){if(constraint.andyetAssumeSetLocalSuccess){self.assumeSetLocalSuccess=constraint.andyetAssumeSetLocalSuccess}})}if(window.navigator.mozGetUserMedia){if(constraints&&constraints.optional){this.wtFirefox=0;constraints.optional.forEach(function(constraint){if(constraint.andyetFirefoxMakesMeSad){self.wtFirefox=constraint.andyetFirefoxMakesMeSad;if(self.wtFirefox>0){self.firefoxcandidatebuffer=[]}}})}}this.pc=new RTCPeerConnection(config,constraints);if(typeof this.pc.getLocalStreams==="function"){this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc)}else{this.getLocalStreams=function(){return[]}}if(typeof this.pc.getRemoteStreams==="function"){this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc)}else{this.getRemoteStreams=function(){return[]}}this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(stream){if(typeof self.pc.removeStream==="function"){self.pc.removeStream.apply(self.pc,arguments)}else if(typeof self.pc.removeTrack==="function"){stream.getTracks().forEach(function(track){self.pc.removeTrack(track)})}};if(typeof this.pc.removeTrack==="function"){this.removeTrack=this.pc.removeTrack.bind(this.pc)}this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:false,sid:"",isInitiator:true,sdpSessionID:Date.now(),useJingle:false};this.iceCredentials={local:{},remote:{}};for(item in config){this.config[item]=config[item]}if(this.config.debug){this.on("*",function(){var logger=config.logger||console;logger.log("PeerConnection event:",arguments)})}this.hadLocalStunCandidate=false;this.hadRemoteStunCandidate=false;this.hadLocalRelayCandidate=false;this.hadRemoteRelayCandidate=false;this.hadLocalIPv6Candidate=false;this.hadRemoteIPv6Candidate=false;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}util.inherits(PeerConnection,WildEmitter);Object.defineProperty(PeerConnection.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(PeerConnection.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});PeerConnection.prototype._role=function(){return this.isInitiator?"initiator":"responder"};PeerConnection.prototype.addStream=function(stream){this.localStream=stream;this.pc.addStream(stream)};PeerConnection.prototype._checkLocalCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadLocalStunCandidate=true}else if(cand.type=="relay"){this.hadLocalRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadLocalIPv6Candidate=true}};PeerConnection.prototype._checkRemoteCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadRemoteStunCandidate=true}else if(cand.type=="relay"){this.hadRemoteRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadRemoteIPv6Candidate=true}};PeerConnection.prototype.processIce=function(update,cb){cb=cb||function(){};var self=this;if(this.pc.signalingState==="closed")return cb();if(update.contents||update.jingle&&update.jingle.contents){var contentNames=this.remoteDescription.contents.map(function(c){return c.name});var contents=update.contents||update.jingle.contents;contents.forEach(function(content){var transport=content.transport||{};var candidates=transport.candidates||[];var mline=contentNames.indexOf(content.name);var mid=content.name;var remoteContent=self.remoteDescription.contents.find(function(c){return c.name===content.name});var processCandidates=function(){candidates.forEach(function(candidate){var iceCandidate=SJJ.toCandidateSDP(candidate);self.pc.addIceCandidate(new RTCIceCandidate({candidate:iceCandidate,sdpMLineIndex:mline,sdpMid:mid}),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(iceCandidate)});cb()};if(self.iceCredentials.remote[content.name]&&transport.ufrag&&self.iceCredentials.remote[content.name].ufrag!==transport.ufrag){if(remoteContent){remoteContent.transport.ufrag=transport.ufrag;remoteContent.transport.pwd=transport.pwd;var offer={type:"offer",jingle:self.remoteDescription};offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.pc.setRemoteDescription(new RTCSessionDescription(offer),function(){processCandidates()},function(err){self.emit("error",err)})}else{self.emit("error","ice restart failed to find matching content")}}else{processCandidates()}})}else{if(update.candidate&&update.candidate.candidate.indexOf("a=")!==0){update.candidate.candidate="a="+update.candidate.candidate}if(this.wtFirefox&&this.firefoxcandidatebuffer!==null){if(this.pc.localDescription&&this.pc.localDescription.type==="offer"){this.firefoxcandidatebuffer.push(update.candidate);return cb()}}self.pc.addIceCandidate(new RTCIceCandidate(update.candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(update.candidate.candidate);cb()}};PeerConnection.prototype.offer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var mediaConstraints=hasConstraints&&constraints?constraints:{offerToReceiveAudio:1,offerToReceiveVideo:1};cb=hasConstraints?cb:constraints;cb=cb||function(){};if(this.pc.signalingState==="closed")return cb("Already closed");this.pc.createOffer(function(offer){var expandedOffer={type:"offer",sdp:offer.sdp};if(self.assumeSetLocalSuccess){self.emit("offer",expandedOffer);cb(null,expandedOffer)}self._candidateBuffer=[];self.pc.setLocalDescription(offer,function(){var jingle;if(self.config.useJingle){jingle=SJJ.toSessionJSON(offer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;jingle.contents.forEach(function(content){var transport=content.transport||{};if(transport.ufrag){self.iceCredentials.local[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}});expandedOffer.jingle=jingle}expandedOffer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});if(!self.assumeSetLocalSuccess){self.emit("offer",expandedOffer);cb(null,expandedOffer)}},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},mediaConstraints)};PeerConnection.prototype.handleOffer=function(offer,cb){cb=cb||function(){};var self=this;offer.type="offer";if(offer.jingle){if(this.enableChromeNativeSimulcast){offer.jingle.contents.forEach(function(content){if(content.name==="video"){content.application.googConferenceFlag=true}})}if(this.enableMultiStreamHacks){offer.jingle.contents.forEach(function(content){if(content.name==="video"){var sources=content.application.sources||[];if(sources.length===0||sources[0].ssrc!=="3735928559"){sources.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]});content.application.sources=sources}}})}if(self.restrictBandwidth>0){if(offer.jingle.contents.length>=2&&offer.jingle.contents[1].name==="video"){var content=offer.jingle.contents[1];var hasBw=content.application&&content.application.bandwidth&&content.application.bandwidth.bandwidth;if(!hasBw){offer.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:self.restrictBandwidth.toString()};offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}offer.jingle.contents.forEach(function(content){var transport=content.transport||{};if(transport.ufrag){self.iceCredentials.remote[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}});offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=offer.jingle}offer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new RTCSessionDescription(offer),function(){cb()},cb)};PeerConnection.prototype.answerAudioOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answerBroadcastOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answer=function(constraints,cb){var hasConstraints=arguments.length===2;var callback=hasConstraints?cb:constraints;var mediaConstraints=hasConstraints&&constraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};this._answer(mediaConstraints,callback)};PeerConnection.prototype.handleAnswer=function(answer,cb){cb=cb||function(){};var self=this;if(answer.jingle){answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=answer.jingle;answer.jingle.contents.forEach(function(content){var transport=content.transport||{};if(transport.ufrag){self.iceCredentials.remote[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}})}answer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new RTCSessionDescription(answer),function(){if(self.wtFirefox){window.setTimeout(function(){self.firefoxcandidatebuffer.forEach(function(candidate){self.pc.addIceCandidate(new RTCIceCandidate(candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(candidate.candidate)});self.firefoxcandidatebuffer=null},self.wtFirefox)}cb(null)},cb)};PeerConnection.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};PeerConnection.prototype._answer=function(constraints,cb){cb=cb||function(){};var self=this;if(!this.pc.remoteDescription){throw new Error("remoteDescription not set")}if(this.pc.signalingState==="closed")return cb("Already closed");self.pc.createAnswer(function(answer){var sim=[];if(self.enableChromeNativeSimulcast){answer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});if(answer.jingle.contents.length>=2&&answer.jingle.contents[1].name==="video"){var groups=answer.jingle.contents[1].application.sourceGroups||[];var hasSim=false;groups.forEach(function(group){if(group.semantics=="SIM")hasSim=true});if(!hasSim&&answer.jingle.contents[1].application.sources.length){var newssrc=JSON.parse(JSON.stringify(answer.jingle.contents[1].application.sources[0]));newssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].application.sources.push(newssrc);sim.push(answer.jingle.contents[1].application.sources[0].ssrc);sim.push(newssrc.ssrc);groups.push({semantics:"SIM",sources:sim});var rtxssrc=JSON.parse(JSON.stringify(newssrc));rtxssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].application.sources.push(rtxssrc);groups.push({semantics:"FID",sources:[newssrc.ssrc,rtxssrc.ssrc]});answer.jingle.contents[1].application.sourceGroups=groups;answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}var expandedAnswer={type:"answer",sdp:answer.sdp};if(self.assumeSetLocalSuccess){var copy=cloneDeep(expandedAnswer);self.emit("answer",copy);cb(null,copy)}self._candidateBuffer=[];self.pc.setLocalDescription(answer,function(){if(self.config.useJingle){var jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;expandedAnswer.jingle=jingle}if(self.enableChromeNativeSimulcast){if(!expandedAnswer.jingle){expandedAnswer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"})}expandedAnswer.jingle.contents[1].application.sources.forEach(function(source,idx){source.parameters=source.parameters.map(function(parameter){if(parameter.key==="msid"){parameter.value+="-"+Math.floor(idx/2)}return parameter})});expandedAnswer.sdp=SJJ.toSessionSDP(expandedAnswer.jingle,{sid:self.sdpSessionID,role:self._role(),direction:"outgoing"})}expandedAnswer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});if(!self.assumeSetLocalSuccess){var copy=cloneDeep(expandedAnswer);self.emit("answer",copy);cb(null,copy)}},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},constraints)};PeerConnection.prototype._onIce=function(event){var self=this;if(event.candidate){if(this.dontSignalCandidates)return;var ice=event.candidate;var expandedCandidate={candidate:{candidate:ice.candidate,sdpMid:ice.sdpMid,sdpMLineIndex:ice.sdpMLineIndex}};this._checkLocalCandidate(ice.candidate);var cand=SJJ.toCandidateJSON(ice.candidate);var already;var idx;if(this.eliminateDuplicateCandidates&&cand.type==="relay"){already=this._candidateBuffer.filter(function(c){return c.type==="relay"}).map(function(c){return c.foundation+":"+c.component});idx=already.indexOf(cand.foundation+":"+cand.component);if(idx>-1&&cand.priority>>24>=already[idx].priority>>24){return}}if(this.config.bundlePolicy==="max-bundle"){already=this._candidateBuffer.filter(function(c){return cand.type===c.type}).map(function(cand){return cand.address+":"+cand.port});idx=already.indexOf(cand.address+":"+cand.port);if(idx>-1)return}if(this.config.rtcpMuxPolicy==="require"&&cand.component==="2"){return}this._candidateBuffer.push(cand);if(self.config.useJingle){if(!ice.sdpMid){if(self.pc.remoteDescription&&self.pc.remoteDescription.type==="offer"){ice.sdpMid=self.remoteDescription.contents[ice.sdpMLineIndex].name}else{ice.sdpMid=self.localDescription.contents[ice.sdpMLineIndex].name}}if(!self.iceCredentials.local[ice.sdpMid]){var jingle=SJJ.toSessionJSON(self.pc.localDescription.sdp,{role:self._role(),direction:"outgoing"});jingle.contents.forEach(function(content){var transport=content.transport||{};if(transport.ufrag){self.iceCredentials.local[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}})}expandedCandidate.jingle={contents:[{name:ice.sdpMid,creator:self._role(),transport:{transportType:"iceUdp",ufrag:self.iceCredentials.local[ice.sdpMid].ufrag,pwd:self.iceCredentials.local[ice.sdpMid].pwd,candidates:[cand]}}]};if(self.batchIceCandidates>0){if(self.batchedIceCandidates.length===0){window.setTimeout(function(){var contents={};self.batchedIceCandidates.forEach(function(content){content=content.contents[0];if(!contents[content.name])contents[content.name]=content;contents[content.name].transport.candidates.push(content.transport.candidates[0])});var newCand={jingle:{contents:[]}};Object.keys(contents).forEach(function(name){newCand.jingle.contents.push(contents[name])});self.batchedIceCandidates=[];self.emit("ice",newCand)},self.batchIceCandidates)}self.batchedIceCandidates.push(expandedCandidate.jingle);return}}this.emit("ice",expandedCandidate)}else{this.emit("endOfCandidates")}};PeerConnection.prototype._onDataChannel=function(event){var channel=event.channel;this._remoteDataChannels.push(channel);this.emit("addChannel",channel)};PeerConnection.prototype.createDataChannel=function(name,opts){var channel=this.pc.createDataChannel(name,opts);this._localDataChannels.push(channel);return channel};PeerConnection.prototype.getStats=function(){if(typeof arguments[0]==="function"){var cb=arguments[0];this.pc.getStats().then(function(res){cb(null,res)},function(err){cb(err)})}else{return this.pc.getStats.apply(this.pc,arguments)}};module.exports=PeerConnection},{"lodash.clonedeep":223,"sdp-jingle-json":446,util:550,wildemitter:573}],444:[function(require,module,exports){(function(process){module.exports=function(tasks,cb){var results,pending,keys;var isSync=true;if(Array.isArray(tasks)){results=[];pending=tasks.length}else{keys=Object.keys(tasks);results={};pending=keys.length}function done(err){function end(){if(cb)cb(err,results);cb=null}if(isSync)process.nextTick(end);else end()}function each(i,err,result){results[i]=result;if(--pending===0||err){done(err)}}if(!pending){done(null)}else if(keys){keys.forEach(function(key){tasks[key](function(err,result){each(key,err,result)})})}else{tasks.forEach(function(task,i){task(function(err,result){each(i,err,result)})})}isSync=false}}).call(this,require("_process"))},{_process:423}],445:[function(require,module,exports){module.exports=scrollToAnchor;function scrollToAnchor(anchor,options){if(anchor){try{var el=document.querySelector(anchor);if(el)el.scrollIntoView(options)}catch(e){}}}},{}],446:[function(require,module,exports){var toSDP=require("./lib/tosdp");var toJSON=require("./lib/tojson");exports.toIncomingSDPOffer=function(session){return toSDP.toSessionSDP(session,{role:"responder",direction:"incoming"})};exports.toOutgoingSDPOffer=function(session){return toSDP.toSessionSDP(session,{role:"initiator",direction:"outgoing"})};exports.toIncomingSDPAnswer=function(session){return toSDP.toSessionSDP(session,{role:"initiator",direction:"incoming"})};exports.toOutgoingSDPAnswer=function(session){return toSDP.toSessionSDP(session,{role:"responder",direction:"outgoing"})};exports.toIncomingMediaSDPOffer=function(media){return toSDP.toMediaSDP(media,{role:"responder",direction:"incoming"})};exports.toOutgoingMediaSDPOffer=function(media){return toSDP.toMediaSDP(media,{role:"initiator",direction:"outgoing"})};exports.toIncomingMediaSDPAnswer=function(media){return toSDP.toMediaSDP(media,{role:"initiator",direction:"incoming"})};exports.toOutgoingMediaSDPAnswer=function(media){return toSDP.toMediaSDP(media,{role:"responder",direction:"outgoing"})};exports.toCandidateSDP=toSDP.toCandidateSDP;exports.toMediaSDP=toSDP.toMediaSDP;exports.toSessionSDP=toSDP.toSessionSDP;exports.toIncomingJSONOffer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"responder",direction:"incoming",creators:creators})};exports.toOutgoingJSONOffer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"initiator",direction:"outgoing",creators:creators})};exports.toIncomingJSONAnswer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"initiator",direction:"incoming",creators:creators})};exports.toOutgoingJSONAnswer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"responder",direction:"outgoing",creators:creators})};exports.toIncomingMediaJSONOffer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"responder",direction:"incoming",creator:creator})};exports.toOutgoingMediaJSONOffer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"initiator",direction:"outgoing",creator:creator})};exports.toIncomingMediaJSONAnswer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"initiator",direction:"incoming",creator:creator})};exports.toOutgoingMediaJSONAnswer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"responder",direction:"outgoing",creator:creator})};exports.toCandidateJSON=toJSON.toCandidateJSON;exports.toMediaJSON=toJSON.toMediaJSON;exports.toSessionJSON=toJSON.toSessionJSON},{"./lib/tojson":449,"./lib/tosdp":450}],447:[function(require,module,exports){exports.lines=function(sdp){return sdp.split("\r\n").filter(function(line){return line.length>0})};exports.findLine=function(prefix,mediaLines,sessionLines){var prefixLength=prefix.length;for(var i=0;i<mediaLines.length;i++){if(mediaLines[i].substr(0,prefixLength)===prefix){return mediaLines[i]}}if(!sessionLines){return false}for(var j=0;j<sessionLines.length;j++){if(sessionLines[j].substr(0,prefixLength)===prefix){return sessionLines[j]}}return false};exports.findLines=function(prefix,mediaLines,sessionLines){var results=[];var prefixLength=prefix.length;for(var i=0;i<mediaLines.length;i++){if(mediaLines[i].substr(0,prefixLength)===prefix){results.push(mediaLines[i])}}if(results.length||!sessionLines){return results}for(var j=0;j<sessionLines.length;j++){if(sessionLines[j].substr(0,prefixLength)===prefix){results.push(sessionLines[j])}}return results};exports.mline=function(line){var parts=line.substr(2).split(" ");var parsed={media:parts[0],port:parts[1],proto:parts[2],formats:[]};for(var i=3;i<parts.length;i++){if(parts[i]){parsed.formats.push(parts[i])}}return parsed};exports.rtpmap=function(line){var parts=line.substr(9).split(" ");var parsed={id:parts.shift()};parts=parts[0].split("/");parsed.name=parts[0];parsed.clockrate=parts[1];parsed.channels=parts.length==3?parts[2]:"1";return parsed};exports.sctpmap=function(line){var parts=line.substr(10).split(" ");var parsed={number:parts.shift(),protocol:parts.shift(),streams:parts.shift()};return parsed};exports.fmtp=function(line){var kv,key,value;var parts=line.substr(line.indexOf(" ")+1).split(";");var parsed=[];for(var i=0;i<parts.length;i++){kv=parts[i].split("=");key=kv[0].trim();value=kv[1];if(key&&value){parsed.push({key:key,value:value})}else if(key){parsed.push({key:"",value:key})}}return parsed};exports.crypto=function(line){var parts=line.substr(9).split(" ");var parsed={tag:parts[0],cipherSuite:parts[1],keyParams:parts[2],sessionParams:parts.slice(3).join(" ")};return parsed};exports.fingerprint=function(line){var parts=line.substr(14).split(" ");return{hash:parts[0],value:parts[1]}};exports.extmap=function(line){var parts=line.substr(9).split(" ");var parsed={};var idpart=parts.shift();var sp=idpart.indexOf("/");if(sp>=0){parsed.id=idpart.substr(0,sp);parsed.senders=idpart.substr(sp+1)}else{parsed.id=idpart;parsed.senders="sendrecv"}parsed.uri=parts.shift()||"";return parsed};exports.rtcpfb=function(line){var parts=line.substr(10).split(" ");var parsed={};parsed.id=parts.shift();parsed.type=parts.shift();if(parsed.type==="trr-int"){parsed.value=parts.shift()}else{parsed.subtype=parts.shift()||""}parsed.parameters=parts;return parsed};exports.candidate=function(line){var parts;if(line.indexOf("a=candidate:")===0){parts=line.substring(12).split(" ")}else{parts=line.substring(10).split(" ")}var candidate={foundation:parts[0],component:parts[1],protocol:parts[2].toLowerCase(),priority:parts[3],ip:parts[4],port:parts[5],type:parts[7],generation:"0"};for(var i=8;i<parts.length;i+=2){if(parts[i]==="raddr"){candidate.relAddr=parts[i+1]}else if(parts[i]==="rport"){candidate.relPort=parts[i+1]}else if(parts[i]==="generation"){candidate.generation=parts[i+1]}else if(parts[i]==="tcptype"){candidate.tcpType=parts[i+1]}}candidate.network="1";return candidate};exports.sourceGroups=function(lines){var parsed=[];for(var i=0;i<lines.length;i++){var parts=lines[i].substr(13).split(" ");parsed.push({semantics:parts.shift(),sources:parts})}return parsed};exports.sources=function(lines){var parsed=[];var sources={};for(var i=0;i<lines.length;i++){var parts=lines[i].substr(7).split(" ");var ssrc=parts.shift();if(!sources[ssrc]){var source={ssrc:ssrc,parameters:[]};parsed.push(source);sources[ssrc]=source}parts=parts.join(" ").split(":");var attribute=parts.shift();var value=parts.join(":")||null;sources[ssrc].parameters.push({key:attribute,value:value})}return parsed};exports.groups=function(lines){var parsed=[];var parts;for(var i=0;i<lines.length;i++){parts=lines[i].substr(8).split(" ");parsed.push({semantics:parts.shift(),contents:parts})}return parsed};exports.bandwidth=function(line){var parts=line.substr(2).split(":");var parsed={};parsed.type=parts.shift();parsed.bandwidth=parts.shift();return parsed};exports.msid=function(line){var data=line.substr(7);var parts=data.split(" ");return{msid:data,mslabel:parts[0],label:parts[1]}}},{}],448:[function(require,module,exports){module.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],449:[function(require,module,exports){var SENDERS=require("./senders");var parsers=require("./parsers");var idCounter=Math.random();exports._setIdCounter=function(counter){idCounter=counter};exports.toSessionJSON=function(sdp,opts){var i;var creators=opts.creators||[];var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var media=sdp.split("\r\nm=");for(i=1;i<media.length;i++){media[i]="m="+media[i];if(i!==media.length-1){media[i]+="\r\n"}}var session=media.shift()+"\r\n";var sessionLines=parsers.lines(session);var parsed={};var contents=[];for(i=0;i<media.length;i++){contents.push(exports.toMediaJSON(media[i],session,{role:role,direction:direction,creator:creators[i]||"initiator"}))}parsed.contents=contents;var groupLines=parsers.findLines("a=group:",sessionLines);if(groupLines.length){parsed.groups=parsers.groups(groupLines)}return parsed};exports.toMediaJSON=function(media,session,opts){var creator=opts.creator||"initiator";var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var lines=parsers.lines(media);var sessionLines=parsers.lines(session);var mline=parsers.mline(lines[0]);var content={creator:creator,name:mline.media,application:{applicationType:"rtp",media:mline.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};if(mline.media=="application"){content.application={applicationType:"datachannel"};content.transport.sctp=[]}var desc=content.application;var trans=content.transport;var mid=parsers.findLine("a=mid:",lines);if(mid){content.name=mid.substr(6)}if(parsers.findLine("a=sendrecv",lines,sessionLines)){content.senders="both"}else if(parsers.findLine("a=sendonly",lines,sessionLines)){content.senders=SENDERS[role][direction].sendonly}else if(parsers.findLine("a=recvonly",lines,sessionLines)){content.senders=SENDERS[role][direction].recvonly}else if(parsers.findLine("a=inactive",lines,sessionLines)){content.senders="none"}if(desc.applicationType=="rtp"){var bandwidth=parsers.findLine("b=",lines);if(bandwidth){desc.bandwidth=parsers.bandwidth(bandwidth)}var ssrc=parsers.findLine("a=ssrc:",lines);if(ssrc){desc.ssrc=ssrc.substr(7).split(" ")[0]}var rtpmapLines=parsers.findLines("a=rtpmap:",lines);rtpmapLines.forEach(function(line){var payload=parsers.rtpmap(line);payload.parameters=[];payload.feedback=[];var fmtpLines=parsers.findLines("a=fmtp:"+payload.id,lines);fmtpLines.forEach(function(line){payload.parameters=parsers.fmtp(line)});var fbLines=parsers.findLines("a=rtcp-fb:"+payload.id,lines);fbLines.forEach(function(line){payload.feedback.push(parsers.rtcpfb(line))});desc.payloads.push(payload)});var cryptoLines=parsers.findLines("a=crypto:",lines,sessionLines);cryptoLines.forEach(function(line){desc.encryption.push(parsers.crypto(line))});if(parsers.findLine("a=rtcp-mux",lines)){desc.mux=true}var fbLines=parsers.findLines("a=rtcp-fb:*",lines);fbLines.forEach(function(line){desc.feedback.push(parsers.rtcpfb(line))});var extLines=parsers.findLines("a=extmap:",lines);extLines.forEach(function(line){var ext=parsers.extmap(line);ext.senders=SENDERS[role][direction][ext.senders];desc.headerExtensions.push(ext)});var ssrcGroupLines=parsers.findLines("a=ssrc-group:",lines);desc.sourceGroups=parsers.sourceGroups(ssrcGroupLines||[]);var ssrcLines=parsers.findLines("a=ssrc:",lines);var sources=desc.sources=parsers.sources(ssrcLines||[]);var msidLine=parsers.findLine("a=msid:",lines);if(msidLine){var msid=parsers.msid(msidLine);["msid","mslabel","label"].forEach(function(key){for(var i=0;i<sources.length;i++){var found=false;for(var j=0;j<sources[i].parameters.length;j++){if(sources[i].parameters[j].key===key){found=true}}if(!found){sources[i].parameters.push({key:key,value:msid[key]})}}})}if(parsers.findLine("a=x-google-flag:conference",lines,sessionLines)){desc.googConferenceFlag=true}}var fingerprintLines=parsers.findLines("a=fingerprint:",lines,sessionLines);var setup=parsers.findLine("a=setup:",lines,sessionLines);fingerprintLines.forEach(function(line){var fp=parsers.fingerprint(line);if(setup){fp.setup=setup.substr(8)}trans.fingerprints.push(fp)});var ufragLine=parsers.findLine("a=ice-ufrag:",lines,sessionLines);var pwdLine=parsers.findLine("a=ice-pwd:",lines,sessionLines);if(ufragLine&&pwdLine){trans.ufrag=ufragLine.substr(12);trans.pwd=pwdLine.substr(10);trans.candidates=[];var candidateLines=parsers.findLines("a=candidate:",lines,sessionLines);candidateLines.forEach(function(line){trans.candidates.push(exports.toCandidateJSON(line))})}if(desc.applicationType=="datachannel"){var sctpmapLines=parsers.findLines("a=sctpmap:",lines);sctpmapLines.forEach(function(line){var sctp=parsers.sctpmap(line);trans.sctp.push(sctp)})}return content};exports.toCandidateJSON=function(line){var candidate=parsers.candidate(line.split("\r\n")[0]);candidate.id=(idCounter++).toString(36).substr(0,12);return candidate}},{"./parsers":447,"./senders":448}],450:[function(require,module,exports){var SENDERS=require("./senders");exports.toSessionSDP=function(session,opts){var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var sid=opts.sid||session.sid||Date.now();var time=opts.time||Date.now();var sdp=["v=0","o=- "+sid+" "+time+" IN IP4 0.0.0.0","s=-","t=0 0"];var contents=session.contents||[];var hasSources=false;contents.forEach(function(content){if(content.application.sources&&content.application.sources.length){hasSources=true}});if(hasSources){sdp.push("a=msid-semantic: WMS *")}var groups=session.groups||[];groups.forEach(function(group){sdp.push("a=group:"+group.semantics+" "+group.contents.join(" "))});contents.forEach(function(content){sdp.push(exports.toMediaSDP(content,opts))});return sdp.join("\r\n")+"\r\n"};exports.toMediaSDP=function(content,opts){var sdp=[];var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var desc=content.application;var transport=content.transport;var payloads=desc.payloads||[];var fingerprints=transport&&transport.fingerprints||[];var mline=[];if(desc.applicationType=="datachannel"){mline.push("application");mline.push("1");mline.push("DTLS/SCTP");if(transport.sctp){transport.sctp.forEach(function(map){mline.push(map.number)})}}else{mline.push(desc.media);mline.push("1");if(fingerprints.length>0){mline.push("UDP/TLS/RTP/SAVPF")}else if(desc.encryption&&desc.encryption.length>0){mline.push("RTP/SAVPF")}else{mline.push("RTP/AVPF")}payloads.forEach(function(payload){mline.push(payload.id)})}sdp.push("m="+mline.join(" "));sdp.push("c=IN IP4 0.0.0.0");if(desc.bandwidth&&desc.bandwidth.type&&desc.bandwidth.bandwidth){sdp.push("b="+desc.bandwidth.type+":"+desc.bandwidth.bandwidth)}if(desc.applicationType=="rtp"){sdp.push("a=rtcp:1 IN IP4 0.0.0.0")}if(transport){if(transport.ufrag){sdp.push("a=ice-ufrag:"+transport.ufrag)}if(transport.pwd){sdp.push("a=ice-pwd:"+transport.pwd)}var pushedSetup=false;fingerprints.forEach(function(fingerprint){sdp.push("a=fingerprint:"+fingerprint.hash+" "+fingerprint.value);if(fingerprint.setup&&!pushedSetup){sdp.push("a=setup:"+fingerprint.setup)}});if(transport.sctp){transport.sctp.forEach(function(map){sdp.push("a=sctpmap:"+map.number+" "+map.protocol+" "+map.streams)})}}if(desc.applicationType=="rtp"){sdp.push("a="+(SENDERS[role][direction][content.senders]||"sendrecv"))}sdp.push("a=mid:"+content.name);if(desc.sources&&desc.sources.length){(desc.sources[0].parameters||[]).forEach(function(param){if(param.key==="msid"){sdp.push("a=msid:"+param.value)}})}if(desc.mux){sdp.push("a=rtcp-mux")}var encryption=desc.encryption||[];encryption.forEach(function(crypto){sdp.push("a=crypto:"+crypto.tag+" "+crypto.cipherSuite+" "+crypto.keyParams+(crypto.sessionParams?" "+crypto.sessionParams:""))});if(desc.googConferenceFlag){sdp.push("a=x-google-flag:conference")}payloads.forEach(function(payload){var rtpmap="a=rtpmap:"+payload.id+" "+payload.name+"/"+payload.clockrate;if(payload.channels&&payload.channels!="1"){rtpmap+="/"+payload.channels}sdp.push(rtpmap);if(payload.parameters&&payload.parameters.length){var fmtp=["a=fmtp:"+payload.id];var parameters=[];payload.parameters.forEach(function(param){parameters.push((param.key?param.key+"=":"")+param.value)});fmtp.push(parameters.join(";"));sdp.push(fmtp.join(" "))}if(payload.feedback){payload.feedback.forEach(function(fb){if(fb.type==="trr-int"){sdp.push("a=rtcp-fb:"+payload.id+" trr-int "+(fb.value?fb.value:"0"))}else{sdp.push("a=rtcp-fb:"+payload.id+" "+fb.type+(fb.subtype?" "+fb.subtype:""))}})}});if(desc.feedback){desc.feedback.forEach(function(fb){if(fb.type==="trr-int"){sdp.push("a=rtcp-fb:* trr-int "+(fb.value?fb.value:"0"))}else{sdp.push("a=rtcp-fb:* "+fb.type+(fb.subtype?" "+fb.subtype:""))}})}var hdrExts=desc.headerExtensions||[];hdrExts.forEach(function(hdr){sdp.push("a=extmap:"+hdr.id+(hdr.senders?"/"+SENDERS[role][direction][hdr.senders]:"")+" "+hdr.uri)});var ssrcGroups=desc.sourceGroups||[];ssrcGroups.forEach(function(ssrcGroup){sdp.push("a=ssrc-group:"+ssrcGroup.semantics+" "+ssrcGroup.sources.join(" "))});var ssrcs=desc.sources||[];ssrcs.forEach(function(ssrc){for(var i=0;i<ssrc.parameters.length;i++){var param=ssrc.parameters[i];sdp.push("a=ssrc:"+(ssrc.ssrc||desc.ssrc)+" "+param.key+(param.value?":"+param.value:""))}});var candidates=transport.candidates||[];candidates.forEach(function(candidate){sdp.push(exports.toCandidateSDP(candidate))});return sdp.join("\r\n")};exports.toCandidateSDP=function(candidate){var sdp=[];sdp.push(candidate.foundation);sdp.push(candidate.component);sdp.push(candidate.protocol.toUpperCase());sdp.push(candidate.priority);sdp.push(candidate.ip);sdp.push(candidate.port);var type=candidate.type;sdp.push("typ");sdp.push(type);if(type==="srflx"||type==="prflx"||type==="relay"){if(candidate.relAddr&&candidate.relPort){sdp.push("raddr");sdp.push(candidate.relAddr);sdp.push("rport");sdp.push(candidate.relPort)}}if(candidate.tcpType&&candidate.protocol.toUpperCase()=="TCP"){sdp.push("tcptype");sdp.push(candidate.tcpType)}sdp.push("generation");sdp.push(candidate.generation||"0");return"a=candidate:"+sdp.join(" ")}},{"./senders":448}],451:[function(require,module,exports){"use strict";var SDPUtils={};SDPUtils.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};SDPUtils.localCName=SDPUtils.generateIdentifier();SDPUtils.splitLines=function(blob){return blob.trim().split("\n").map(function(line){return line.trim()})};SDPUtils.splitSections=function(blob){var parts=blob.split("\nm=");return parts.map(function(part,index){return(index>0?"m="+part:part).trim()+"\r\n"})};SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter(function(line){return line.indexOf(prefix)===0})};SDPUtils.parseCandidate=function(line){var parts;if(line.indexOf("a=candidate:")===0){parts=line.substring(12).split(" ")}else{parts=line.substring(10).split(" ")}var candidate={foundation:parts[0],component:parseInt(parts[1],10),protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],port:parseInt(parts[5],10),type:parts[7]};for(var i=8;i<parts.length;i+=2){switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1];candidate.usernameFragment=parts[i+1];break;default:candidate[parts[i]]=parts[i+1];break}}return candidate};SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation);sdp.push(candidate.component);sdp.push(candidate.protocol.toUpperCase());sdp.push(candidate.priority);sdp.push(candidate.ip);sdp.push(candidate.port);var type=candidate.type;sdp.push("typ");sdp.push(type);if(type!=="host"&&candidate.relatedAddress&&candidate.relatedPort){sdp.push("raddr");sdp.push(candidate.relatedAddress);sdp.push("rport");sdp.push(candidate.relatedPort)}if(candidate.tcpType&&candidate.protocol.toLowerCase()==="tcp"){sdp.push("tcptype");sdp.push(candidate.tcpType)}if(candidate.ufrag){sdp.push("ufrag");sdp.push(candidate.ufrag)}return"candidate:"+sdp.join(" ")};SDPUtils.parseIceOptions=function(line){return line.substr(14).split(" ")};SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(" ");var parsed={payloadType:parseInt(parts.shift(),10)};parts=parts[0].split("/");parsed.name=parts[0];parsed.clockRate=parseInt(parts[1],10);parsed.numChannels=parts.length===3?parseInt(parts[2],10):1;return parsed};SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;if(codec.preferredPayloadType!==undefined){pt=codec.preferredPayloadType}return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(codec.numChannels!==1?"/"+codec.numChannels:"")+"\r\n"};SDPUtils.parseExtmap=function(line){var parts=line.substr(9).split(" ");return{id:parseInt(parts[0],10),direction:parts[0].indexOf("/")>0?parts[0].split("/")[1]:"sendrecv",uri:parts[1]}};SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&headerExtension.direction!=="sendrecv"?"/"+headerExtension.direction:"")+" "+headerExtension.uri+"\r\n"};SDPUtils.parseFmtp=function(line){var parsed={};var kv;var parts=line.substr(line.indexOf(" ")+1).split(";");for(var j=0;j<parts.length;j++){kv=parts[j].trim().split("=");parsed[kv[0].trim()]=kv[1]}return parsed};SDPUtils.writeFmtp=function(codec){var line="";var pt=codec.payloadType;if(codec.preferredPayloadType!==undefined){pt=codec.preferredPayloadType}if(codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach(function(param){params.push(param+"="+codec.parameters[param])});line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line};SDPUtils.parseRtcpFb=function(line){var parts=line.substr(line.indexOf(" ")+1).split(" ");return{type:parts.shift(),parameter:parts.join(" ")}};SDPUtils.writeRtcpFb=function(codec){var lines="";var pt=codec.payloadType;if(codec.preferredPayloadType!==undefined){pt=codec.preferredPayloadType}if(codec.rtcpFeedback&&codec.rtcpFeedback.length){codec.rtcpFeedback.forEach(function(fb){lines+="a=rtcp-fb:"+pt+" "+fb.type+(fb.parameter&&fb.parameter.length?" "+fb.parameter:"")+"\r\n"})}return lines};SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(" ");var parts={ssrc:parseInt(line.substr(7,sp-7),10)};var colon=line.indexOf(":",sp);if(colon>-1){parts.attribute=line.substr(sp+1,colon-sp-1);parts.value=line.substr(colon+1)}else{parts.attribute=line.substr(sp+1)}return parts};SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid){return mid.substr(6)}};SDPUtils.parseFingerprint=function(line){var parts=line.substr(14).split(" ");return{algorithm:parts[0].toLowerCase(),value:parts[1]}};SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){var lines=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=fingerprint:");return{role:"auto",fingerprints:lines.map(SDPUtils.parseFingerprint)}};SDPUtils.writeDtlsParameters=function(params,setupType){var sdp="a=setup:"+setupType+"\r\n";params.fingerprints.forEach(function(fp){sdp+="a=fingerprint:"+fp.algorithm+" "+fp.value+"\r\n"});return sdp};SDPUtils.getIceParameters=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);lines=lines.concat(SDPUtils.splitLines(sessionpart));var iceParameters={usernameFragment:lines.filter(function(line){return line.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:lines.filter(function(line){return line.indexOf("a=ice-pwd:")===0})[0].substr(10)};return iceParameters};SDPUtils.writeIceParameters=function(params){return"a=ice-ufrag:"+params.usernameFragment+"\r\n"+"a=ice-pwd:"+params.password+"\r\n"};SDPUtils.parseRtpParameters=function(mediaSection){var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var lines=SDPUtils.splitLines(mediaSection);var mline=lines[0].split(" ");for(var i=3;i<mline.length;i++){var pt=mline[i];var rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline);var fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{};codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb);description.codecs.push(codec);switch(codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase());break;default:break}}}SDPUtils.matchPrefix(mediaSection,"a=extmap:").forEach(function(line){description.headerExtensions.push(SDPUtils.parseExtmap(line))});return description};SDPUtils.writeRtpDescription=function(kind,caps){var sdp="";sdp+="m="+kind+" ";sdp+=caps.codecs.length>0?"9":"0";sdp+=" UDP/TLS/RTP/SAVPF ";sdp+=caps.codecs.map(function(codec){if(codec.preferredPayloadType!==undefined){return codec.preferredPayloadType}return codec.payloadType}).join(" ")+"\r\n";sdp+="c=IN IP4 0.0.0.0\r\n";sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n";caps.codecs.forEach(function(codec){sdp+=SDPUtils.writeRtpMap(codec);sdp+=SDPUtils.writeFmtp(codec);sdp+=SDPUtils.writeRtcpFb(codec)});var maxptime=0;caps.codecs.forEach(function(codec){if(codec.maxptime>maxptime){maxptime=codec.maxptime}});if(maxptime>0){sdp+="a=maxptime:"+maxptime+"\r\n"}sdp+="a=rtcp-mux\r\n";caps.headerExtensions.forEach(function(extension){sdp+=SDPUtils.writeExtmap(extension)});return sdp};SDPUtils.parseRtpEncodingParameters=function(mediaSection){var encodingParameters=[];var description=SDPUtils.parseRtpParameters(mediaSection);var hasRed=description.fecMechanisms.indexOf("RED")!==-1;var hasUlpfec=description.fecMechanisms.indexOf("ULPFEC")!==-1;var ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(parts){return parts.attribute==="cname"});var primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc;var secondarySsrc;var flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map(function(line){var parts=line.split(" ");parts.shift();return parts.map(function(part){return parseInt(part,10)})});if(flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc){secondarySsrc=flows[0][1]}description.codecs.forEach(function(codec){if(codec.name.toUpperCase()==="RTX"&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10),rtx:{ssrc:secondarySsrc}};encodingParameters.push(encParam);if(hasRed){encParam=JSON.parse(JSON.stringify(encParam));encParam.fec={ssrc:secondarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"};encodingParameters.push(encParam)}}});if(encodingParameters.length===0&&primarySsrc){encodingParameters.push({ssrc:primarySsrc})}var bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");if(bandwidth.length){if(bandwidth[0].indexOf("b=TIAS:")===0){bandwidth=parseInt(bandwidth[0].substr(7),10)}else if(bandwidth[0].indexOf("b=AS:")===0){bandwidth=parseInt(bandwidth[0].substr(5),10)*1e3*.95-50*40*8}else{bandwidth=undefined}encodingParameters.forEach(function(params){params.maxBitrate=bandwidth})}return encodingParameters};SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={};var cname;var remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(obj){return obj.attribute==="cname"})[0];if(remoteSsrc){rtcpParameters.cname=remoteSsrc.value;rtcpParameters.ssrc=remoteSsrc.ssrc}var rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0;rtcpParameters.compound=rsize.length===0;var mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");rtcpParameters.mux=mux.length>0;return rtcpParameters};SDPUtils.parseMsid=function(mediaSection){var parts;var spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(spec.length===1){parts=spec[0].substr(7).split(" ");return{stream:parts[0],track:parts[1]}}var planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(parts){return parts.attribute==="msid"});if(planB.length>0){parts=planB[0].value.split(" ");return{stream:parts[0],track:parts[1]}}};SDPUtils.generateSessionId=function(){return Math.random().toString().substr(2,21)};SDPUtils.writeSessionBoilerplate=function(sessId,sessVer){var sessionId;var version=sessVer!==undefined?sessVer:2;if(sessId){sessionId=sessId}else{sessionId=SDPUtils.generateSessionId()}return"v=0\r\n"+"o=thisisadapterortc "+sessionId+" "+version+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};SDPUtils.writeMediaSection=function(transceiver,caps,type,stream){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters());sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),type==="offer"?"actpass":"active");sdp+="a=mid:"+transceiver.mid+"\r\n";if(transceiver.direction){sdp+="a="+transceiver.direction+"\r\n"}else if(transceiver.rtpSender&&transceiver.rtpReceiver){sdp+="a=sendrecv\r\n"}else if(transceiver.rtpSender){sdp+="a=sendonly\r\n"}else if(transceiver.rtpReceiver){sdp+="a=recvonly\r\n"}else{sdp+="a=inactive\r\n"}if(transceiver.rtpSender){var msid="msid:"+stream.id+" "+transceiver.rtpSender.track.id+"\r\n";sdp+="a="+msid;sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" "+msid;if(transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" "+msid;sdp+="a=ssrc-group:FID "+transceiver.sendEncodingParameters[0].ssrc+" "+transceiver.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].ssrc+" cname:"+SDPUtils.localCName+"\r\n";if(transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx){sdp+="a=ssrc:"+transceiver.sendEncodingParameters[0].rtx.ssrc+" cname:"+SDPUtils.localCName+"\r\n"}return sdp};SDPUtils.getDirection=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);for(var i=0;i<lines.length;i++){switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substr(2);default:}}if(sessionpart){return SDPUtils.getDirection(sessionpart)}return"sendrecv"};SDPUtils.getKind=function(mediaSection){var lines=SDPUtils.splitLines(mediaSection);var mline=lines[0].split(" ");return mline[0].substr(2)};SDPUtils.isRejected=function(mediaSection){return mediaSection.split(" ",2)[1]==="0"};SDPUtils.parseMLine=function(mediaSection){var lines=SDPUtils.splitLines(mediaSection);var mline=lines[0].split(" ");return{kind:mline[0].substr(2),port:parseInt(mline[1],10),protocol:mline[2],fmt:mline.slice(3).join(" ")}};if(typeof module==="object"){module.exports=SDPUtils}},{}],452:[function(require,module,exports){arguments[4][2][0].apply(exports,arguments)},{dup:2}],453:[function(require,module,exports){(function(chars){"use strict";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],454:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],455:[function(require,module,exports){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}try{if(window.localStorage)debug.enable(localStorage.debug)}catch(e){}},{}],456:[function(require,module,exports){module.exports=require("./lib/")},{"./lib/":457}],457:[function(require,module,exports){arguments[4][158][0].apply(exports,arguments)},{"./socket":458,dup:158,"engine.io-parser":469}],458:[function(require,module,exports){(function(global){var transports=require("./transports");var Emitter=require("component-emitter");var debug=require("debug")("engine.io-client:socket");var index=require("indexof");var parser=require("engine.io-parser");var parseuri=require("parseuri");var parsejson=require("parsejson");var parseqs=require("parseqs");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&"object"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.host=uri.host;opts.secure=uri.protocol=="https"||uri.protocol=="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol;if(opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift();if(pieces.length){opts.port=pieces.pop()}else if(!opts.port){opts.port=this.secure?"443":"80"}}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:"localhost");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if("string"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||"t";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized||null;this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=require("./transport");Socket.transports=require("./transports");Socket.parser=require("engine.io-parser");Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1){transport="websocket"}else if(0==this.transports.length){var self=this;setTimeout(function(){self.emit("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";var transport;try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})};Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",function(msg){if(failed)return;if("pong"==msg.type&&"probe"==msg.data){debug('probe transport "%s" pong',name);self.upgrading=true;self.emit("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name;debug('pausing current transport "%s"',self.transport.name);self.transport.pause(function(){if(failed)return;if("closed"==self.readyState)return;debug("changing transport and sending upgrade packet");cleanup();self.setTransport(transport);transport.send([{type:"upgrade"}]);self.emit("upgrade",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name;self.emit("upgradeError",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);self.removeListener("close",onclose);self.removeListener("upgrading",onupgrade)}transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emit("packet",packet);this.emit("heartbeat");switch(packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data;this.emit("error",err);break;case"message":this.emit("data",packet.data);this.emit("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"==this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if("closed"==self.readyState)return;self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){this.sendPacket("ping")};Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++){if(this.callbackBuffer[i]){this.callbackBuffer[i]()}}this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(this.writeBuffer.length==0){this.emit("drain")}else{this.flush()}};Socket.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};Socket.prototype.write=Socket.prototype.send=function(msg,fn){this.sendPacket("message",msg,fn);return this};Socket.prototype.sendPacket=function(type,data,fn){if("closing"==this.readyState||"closed"==this.readyState){return}var packet={type:type,data:data};this.emit("packetCreate",packet);this.writeBuffer.push(packet);this.callbackBuffer.push(fn);this.flush()};Socket.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;function close(){self.onClose("forced close");debug("socket closing - telling transport to close");self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose);self.removeListener("upgradeError",cleanupAndClose);close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose);self.once("upgradeError",cleanupAndClose)}if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}return this};Socket.prototype.onError=function(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emit("error",err);this.onClose("transport error",err)};Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){self.writeBuffer=[];self.callbackBuffer=[];self.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",reason,desc)}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":459,"./transports":460,"component-emitter":454,debug:466,"engine.io-parser":469,indexof:217,parsejson:251,parseqs:475,parseuri:468}],459:[function(require,module,exports){var parser=require("engine.io-parser");var Emitter=require("component-emitter");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState="";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized}Emitter(Transport.prototype);Transport.timestamps=0;Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type="TransportError";err.description=desc;this.emit("error",err);return this};Transport.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};Transport.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if("open"==this.readyState){this.write(packets)}else{throw new Error("Transport not open")}};Transport.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit("packet",packet)};Transport.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":454,"engine.io-parser":469}],460:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest");var XHR=require("./polling-xhr");var JSONP=require("./polling-jsonp");var websocket=require("./websocket");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if("open"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":461,"./polling-xhr":462,"./websocket":464,xmlhttprequest:465}],461:[function(require,module,exports){(function(global){var Polling=require("./polling");var inherit=require("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g;var rEscapedNewline=/\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener("beforeunload",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement("form");var area=document.createElement("textarea");var id=this.iframeId="eio_iframe_"+this.index;var iframe;form.className="socketio";form.style.position="absolute";form.style.top="-1000px";form.style.left="-1000px";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId;iframe.src="javascript:0"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,"\\\n");this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":463,"component-inherit":40}],462:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest");var Polling=require("./polling");var Emitter=require("component-emitter");var inherit=require("component-inherit");var debug=require("debug")("engine.io-client:polling-xhr");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!=="string"&&data!==undefined;var req=this.request({method:"POST",data:data,isBinary:isBinary});var self=this;req.on("success",fn);req.on("error",function(err){self.onError("xhr post error",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request();var self=this;req.on("data",function(data){self.onData(data)});req.on("error",function(err){self.onError("xhr poll error",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||"GET";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);if(this.supportsBinary){xhr.responseType="arraybuffer"}if("POST"==this.method){try{if(this.isBinary){xhr.setRequestHeader("Content-type","application/octet-stream")}else{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}if("withCredentials"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Request.prototype.onData=function(data){this.emit("data",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit("error",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if("undefined"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(contentType==="application/octet-stream"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{data="ok"}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return"undefined"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent("onunload",unloadHandler)}else if(global.addEventListener){global.addEventListener("beforeunload",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":463,"component-emitter":454,"component-inherit":40,debug:466,xmlhttprequest:465}],463:[function(require,module,exports){var Transport=require("../transport");var parseqs=require("parseqs");var parser=require("engine.io-parser");var inherit=require("component-inherit");var debug=require("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=require("xmlhttprequest");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name="polling";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState="pausing";function pause(){debug("paused");self.readyState="paused";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")};Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){if("opening"==self.readyState){self.onOpen()}if("close"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if("closed"!=this.readyState){this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet");self.write([{type:"close"}])}if("open"==this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit("drain")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"https":"http";var port="";if(false!==this.timestampRequests){query[this.timestampParam]=+new Date+"-"+Transport.timestamps++}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&("https"==schema&&this.port!=443||"http"==schema&&this.port!=80)){port=":"+this.port}if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query}},{"../transport":459,"component-inherit":40,debug:466,"engine.io-parser":469,parseqs:475,xmlhttprequest:465}],464:[function(require,module,exports){var Transport=require("../transport");var parser=require("engine.io-parser");var parseqs=require("parseqs");var inherit=require("component-inherit");var debug=require("debug")("engine.io-client:websocket");var WebSocket=require("ws");module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name="websocket";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;this.ws=new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}this.ws.binaryType="arraybuffer";this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError("websocket error",e)}};if("undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;for(var i=0,l=packets.length;i<l;i++){parser.encodePacket(packets[i],this.supportsBinary,function(data){try{self.ws.send(data)}catch(e){debug("websocket closed before onclose event")}})}function ondrain(){self.writable=true;self.emit("drain")}setTimeout(ondrain,0)};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"wss":"ws";var port="";if(this.port&&("wss"==schema&&this.port!=443||"ws"==schema&&this.port!=80)){port=":"+this.port}if(this.timestampRequests){query[this.timestampParam]=+new Date}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!("__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":459,"component-inherit":40,debug:466,"engine.io-parser":469,parseqs:475,ws:487}],465:[function(require,module,exports){var hasCORS=require("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}},{"has-cors":472}],466:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){localStorage.removeItem("debug")}else{localStorage.debug=namespaces}}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports.enable(load())},{"./debug":467}],467:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:474}],468:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}return uri}},{}],469:[function(require,module,exports){(function(global){var keys=require("./keys");var hasBinary=require("has-binary");var sliceBuffer=require("arraybuffer.slice");var base64encoder=require("base64-arraybuffer");var after=require("after");var utf8=require("utf8");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:"error",data:"parser error"};var Blob=require("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if("function"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if("function"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(""+encoded)};function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data=="string"||data===undefined){if(data.charAt(0)=="b"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType==="blob"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType==="blob"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary=="function"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback("0:")}function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(""))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!="string"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var packet;if(data==""){return callback(err,0,1)}var length="",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"!=chr){length+=chr}else{if(""==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=""}}if(length!=""){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p==="string"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p==="string";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded==="string"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength="";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":470,after:452,"arraybuffer.slice":4,"base64-arraybuffer":453,blob:24,"has-binary":208,utf8:547}],470:[function(require,module,exports){arguments[4][170][0].apply(exports,arguments)},{dup:170}],471:[function(require,module,exports){module.exports=function(){return this}()},{}],472:[function(require,module,exports){var global=require("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=false}},{global:471}],473:[function(require,module,exports){arguments[4][209][0].apply(exports,arguments)},{dup:209}],474:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],475:[function(require,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],476:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri}},{}],477:[function(require,module,exports){module.exports=require("./lib/")},{"./lib/":478}],478:[function(require,module,exports){var url=require("./url");var parser=require("socket.io-parser");var Manager=require("./manager");var debug=require("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri=="object"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var io;if(opts.forceNew||opts["force new connection"]||false===opts.multiplex){debug("ignoring socket cache for %s",source);io=Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=require("./manager");exports.Socket=require("./socket")},{"./manager":479,"./socket":481,"./url":482,debug:455,"socket.io-parser":484}],479:[function(require,module,exports){var url=require("./url");var eio=require("engine.io-client");var Socket=require("./socket");var Emitter=require("component-emitter");var parser=require("socket.io-parser");var on=require("./on");var bind=require("component-bind");var object=require("object-component");var debug=require("debug")("socket.io-client:manager");var indexOf=require("indexof");var Backoff=require("backo2");module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&"object"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState="closed";this.uri=uri;this.connected=[];this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){this.nsps[nsp].id=this.engine.id}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState="opening";this.skipReconnect=false;var openSub=on(socket,"open",function(){self.onopen();fn&&fn()});var errorSub=on(socket,"error",function(data){debug("connect_error");self.cleanup();self.readyState="closed";self.emitAll("connect_error",data);if(fn){var err=new Error("Connection error");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout);openSub.destroy();socket.close();socket.emit("error","timeout");self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug("open");this.cleanup();this.readyState="open";this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata")));this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")));this.subs.push(on(socket,"error",bind(this,"onerror")));this.subs.push(on(socket,"close",bind(this,"onclose")))};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)};Manager.prototype.onerror=function(err){debug("error",err);this.emitAll("error",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on("connect",function(){socket.id=self.engine.id;if(!~indexOf(self.connected,socket)){self.connected.push(socket)}})}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connected,socket);if(~index)this.connected.splice(index,1);if(this.connected.length)return;this.close()};Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i])}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){this.skipReconnect=true;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};Manager.prototype.onclose=function(reason){debug("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug("attempting reconnect");self.emitAll("reconnect_attempt",self.backoff.attempts);self.emitAll("reconnecting",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug("reconnect attempt error");self.reconnecting=false;self.reconnect();self.emitAll("reconnect_error",err.data)}else{debug("reconnect success");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",attempt)}},{"./on":480,"./socket":481,"./url":482,backo2:18,"component-bind":38,"component-emitter":454,debug:455,"engine.io-client":456,indexof:217,"object-component":246,"socket.io-parser":484}],480:[function(require,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],481:[function(require,module,exports){var parser=require("socket.io-parser");var Emitter=require("component-emitter");var toArray=require("to-array");var on=require("./on");var bind=require("component-bind");var debug=require("debug")("socket.io-client:socket");var hasBin=require("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};if(this.io.autoConnect)this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift("message");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};if("function"==typeof args[args.length-1]){debug("emitting packet with ack id %d",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug("transport is open - connecting");if("/"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){debug("calling ack %s with %j",packet.id,packet.data);var fn=this.acks[packet.id];fn.apply(this,packet.data);delete this.acks[packet.id]};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}},{"./on":480,"component-bind":38,"component-emitter":454,debug:455,"has-binary":208,"socket.io-parser":484,"to-array":486}],482:[function(require,module,exports){(function(global){var parseuri=require("parseuri");var debug=require("debug")("socket.io-client:url");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+"//"+loc.host;if("string"==typeof uri){if("/"==uri.charAt(0)){if("/"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.hostname+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!=typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";obj.id=obj.protocol+"://"+obj.host+":"+obj.port;obj.href=obj.protocol+"://"+obj.host+(loc&&loc.port==obj.port?"":":"+obj.port);return obj}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:455,parseuri:476}],483:[function(require,module,exports){(function(global){var isArray=require("isarray");var isBuf=require("./is-buffer");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&"object"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&"object"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":485,isarray:473}],484:[function(require,module,exports){var debug=require("debug")("socket.io-parser");var json=require("json3");var isArray=require("isarray");var Emitter=require("component-emitter");var binary=require("./binary");var isBuf=require("./is-buffer");exports.protocol=4;exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug("encoding packet %j",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str="";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+="-"}if(obj.nsp&&"/"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=",";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=",";str+=json.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",packet)}}else{this.emit("decoded",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf="";while(str.charAt(++i)!="-"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"==str.charAt(i+1)){p.nsp="";while(++i){var c=str.charAt(i);if(","==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp="/"}var next=str.charAt(i+1);if(""!==next&&Number(next)==next){p.id="";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug("decoded %s as %j",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:"parser error"}}},{"./binary":483,"./is-buffer":485,"component-emitter":454,debug:455,isarray:473,json3:221}],485:[function(require,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],486:[function(require,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}],487:[function(require,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],488:[function(require,module,exports){var util=require("util");var webrtcSupport=require("webrtcsupport");var PeerConnection=require("rtcpeerconnection");var WildEmitter=require("wildemitter");var FileTransfer=require("filetransfer");var INBAND_FILETRANSFER_V1="https://simplewebrtc.com/protocol/filetransfer#inband-v1";function isAllTracksEnded(stream){var isAllTracksEnded=true;stream.getTracks().forEach(function(t){isAllTracksEnded=t.readyState==="ended"&&isAllTracksEnded});return isAllTracksEnded}function Peer(options){var self=this;WildEmitter.call(this);this.id=options.id;this.parent=options.parent;this.type=options.type||"video";this.oneway=options.oneway||false;this.sharemyscreen=options.sharemyscreen||false;this.browserPrefix=options.prefix;this.stream=options.stream;this.enableDataChannels=options.enableDataChannels===undefined?this.parent.config.enableDataChannels:options.enableDataChannels;this.receiveMedia=options.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=options.sid||Date.now().toString();this.pc=new PeerConnection(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(event){self.send("endOfCandidates",event)});this.pc.on("offer",function(offer){if(self.parent.config.nick)offer.nick=self.parent.config.nick;self.send("offer",offer)});this.pc.on("answer",function(answer){if(self.parent.config.nick)answer.nick=self.parent.config.nick;self.send("answer",answer)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",this.emit.bind(this,"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(self.pc.iceConnectionState){case"failed":if(self.pc.pc.localDescription.type==="offer"){self.parent.emit("iceFailed",self);self.send("connectivityError")}break}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;if(options.type==="screen"){if(this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen){this.logger.log("adding local screen stream to peer connection");this.pc.addStream(this.parent.localScreens[0]);this.broadcaster=options.broadcaster}}else{this.parent.localStreams.forEach(function(stream){self.pc.addStream(stream)})}this.on("channelOpen",function(channel){if(channel.protocol===INBAND_FILETRANSFER_V1){channel.onmessage=function(event){var metadata=JSON.parse(event.data);var receiver=new FileTransfer.Receiver;receiver.receive(metadata,channel);self.emit("fileTransfer",metadata,receiver);receiver.on("receivedFile",function(file,metadata){receiver.channel.close()})}}});this.on("*",function(){self.parent.emit.apply(self.parent,arguments)})}util.inherits(Peer,WildEmitter);Peer.prototype.handleMessage=function(message){var self=this;this.logger.log("getting",message.type,message);if(message.prefix)this.browserPrefix=message.prefix;if(message.type==="offer"){if(!this.nick)this.nick=message.payload.nick;delete message.payload.nick;this.pc.handleOffer(message.payload,function(err){if(err){return}self.pc.answer(function(err,sessionDescription){})})}else if(message.type==="answer"){if(!this.nick)this.nick=message.payload.nick;delete message.payload.nick;this.pc.handleAnswer(message.payload)}else if(message.type==="candidate"){this.pc.processIce(message.payload)}else if(message.type==="connectivityError"){this.parent.emit("connectivityError",self)}else if(message.type==="mute"){this.parent.emit("mute",{id:message.from,name:message.payload.name})}else if(message.type==="unmute"){this.parent.emit("unmute",{id:message.from,name:message.payload.name})}else if(message.type==="endOfCandidates"){var mLines=this.pc.pc.transceivers||[];mLines.forEach(function(mLine){if(mLine.iceTransport){mLine.iceTransport.addRemoteCandidate({})}})}};Peer.prototype.send=function(messageType,payload){var message={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:messageType,payload:payload,prefix:webrtcSupport.prefix};this.logger.log("sending",messageType,message);this.parent.emit("message",message)};Peer.prototype.sendDirectly=function(channel,messageType,payload){var message={type:messageType,payload:payload};this.logger.log("sending via datachannel",channel,messageType,message);var dc=this.getDataChannel(channel);if(dc.readyState!="open")return false;dc.send(JSON.stringify(message));return true};Peer.prototype._observeDataChannel=function(channel){var self=this;channel.onclose=this.emit.bind(this,"channelClose",channel);channel.onerror=this.emit.bind(this,"channelError",channel);channel.onmessage=function(event){self.emit("channelMessage",self,channel.label,JSON.parse(event.data),channel,event)};channel.onopen=this.emit.bind(this,"channelOpen",channel)};Peer.prototype.getDataChannel=function(name,opts){if(!webrtcSupport.supportDataChannel)return this.emit("error",new Error("createDataChannel not supported"));var channel=this.channels[name];opts||(opts={});if(channel)return channel;channel=this.channels[name]=this.pc.createDataChannel(name,opts);this._observeDataChannel(channel);return channel};Peer.prototype.onIceCandidate=function(candidate){if(this.closed)return;if(candidate){var pcConfig=this.parent.config.peerConnectionConfig;if(webrtcSupport.prefix==="moz"&&pcConfig&&pcConfig.iceTransports&&candidate.candidate&&candidate.candidate.candidate&&candidate.candidate.candidate.indexOf(pcConfig.iceTransports)<0){this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",pcConfig.iceTransports)}else{this.send("candidate",candidate)}}else{this.logger.log("End of candidates.")}};Peer.prototype.start=function(){var self=this;if(this.enableDataChannels){this.getDataChannel("simplewebrtc")}this.pc.offer(this.receiveMedia,function(err,sessionDescription){})};Peer.prototype.icerestart=function(){var constraints=this.receiveMedia;constraints.mandatory.IceRestart=true;this.pc.offer(constraints,function(err,success){})};Peer.prototype.end=function(){if(this.closed)return;this.pc.close();this.handleStreamRemoved()};Peer.prototype.handleRemoteStreamAdded=function(event){var self=this;if(this.stream){this.logger.warn("Already have a remote stream")}else{this.stream=event.stream;this.stream.getTracks().forEach(function(track){track.addEventListener("ended",function(){if(isAllTracksEnded(self.stream)){self.end()}})});this.parent.emit("peerStreamAdded",this)}};Peer.prototype.handleStreamRemoved=function(){var peerIndex=this.parent.peers.indexOf(this);if(peerIndex>-1){this.parent.peers.splice(peerIndex,1);this.closed=true;this.parent.emit("peerStreamRemoved",this)}};Peer.prototype.handleDataChannelAdded=function(channel){this.channels[channel.label]=channel;this._observeDataChannel(channel)};Peer.prototype.sendFile=function(file){var sender=new FileTransfer.Sender;var dc=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:INBAND_FILETRANSFER_V1});dc.onopen=function(){dc.send(JSON.stringify({size:file.size,name:file.name}));sender.send(file,dc)};dc.onclose=function(){console.log("sender received transfer");sender.emit("complete")};return sender};module.exports=Peer},{filetransfer:177,rtcpeerconnection:443,util:550,webrtcsupport:571,wildemitter:573}],489:[function(require,module,exports){var WebRTC=require("./webrtc");var WildEmitter=require("wildemitter");var webrtcSupport=require("webrtcsupport");var attachMediaStream=require("attachmediastream");var mockconsole=require("mockconsole");var SocketIoConnection=require("./socketioconnection");function SimpleWebRTC(opts){var self=this;var options=opts||{};var config=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:false,localVideoEl:"",remoteVideosEl:"",enableDataChannels:true,autoRequestMedia:false,autoRemoveVideos:true,adjustPeerVolume:false,peerVolumeWhenSpeaking:.25,media:{video:true,audio:true},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:true,mirror:true,muted:true}};var item,connection;this.logger=function(){if(opts.debug){return opts.logger||console}else{return opts.logger||mockconsole}}();for(item in options){if(options.hasOwnProperty(item)){this.config[item]=options[item]}}this.capabilities=webrtcSupport;WildEmitter.call(this);if(this.config.connection===null){connection=this.connection=new SocketIoConnection(this.config)}else{connection=this.connection=this.config.connection}connection.on("connect",function(){self.emit("connectionReady",connection.getSessionid());self.sessionReady=true;self.testReadiness()});connection.on("message",function(message){var peers=self.webrtc.getPeers(message.from,message.roomType);var peer;if(message.type==="offer"){if(peers.length){peers.forEach(function(p){if(p.sid==message.sid)peer=p})}if(!peer){peer=self.webrtc.createPeer({id:message.from,sid:message.sid,type:message.roomType,enableDataChannels:self.config.enableDataChannels&&message.roomType!=="screen",sharemyscreen:message.roomType==="screen"&&!message.broadcaster,broadcaster:message.roomType==="screen"&&!message.broadcaster?self.connection.getSessionid():null});self.emit("createdPeer",peer)}peer.handleMessage(message)}else if(peers.length){peers.forEach(function(peer){if(message.sid){if(peer.sid===message.sid){peer.handleMessage(message)}}else{peer.handleMessage(message)}})}});connection.on("remove",function(room){if(room.id!==self.connection.getSessionid()){self.webrtc.removePeers(room.id,room.type)}});opts.logger=this.logger;opts.debug=false;this.webrtc=new WebRTC(opts);["mute","unmute","pauseVideo","resumeVideo","pause","resume","sendToAll","sendDirectlyToAll","getPeers"].forEach(function(method){self[method]=self.webrtc[method].bind(self.webrtc)});this.webrtc.on("*",function(){self.emit.apply(self,arguments)});if(config.debug){this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"))}this.webrtc.on("localStream",function(){self.testReadiness()});this.webrtc.on("message",function(payload){self.connection.emit("message",payload)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));if(this.config.adjustPeerVolume){this.webrtc.on("speaking",this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking));this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1))}connection.on("stunservers",function(args){self.webrtc.config.peerConnectionConfig.iceServers=args;self.emit("stunservers",args)});connection.on("turnservers",function(args){self.webrtc.config.peerConnectionConfig.iceServers=self.webrtc.config.peerConnectionConfig.iceServers.concat(args);self.emit("turnservers",args)});this.webrtc.on("iceFailed",function(peer){});this.webrtc.on("connectivityError",function(peer){});this.webrtc.on("audioOn",function(){self.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){self.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){self.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){self.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(stream){var item,el=document.createElement("video"),container=self.getRemoteVideoContainer();el.oncontextmenu=function(){return false};el.id="localScreen";attachMediaStream(stream,el);if(container){container.appendChild(el)}self.emit("localScreenAdded",el);self.connection.emit("shareScreen");self.webrtc.peers.forEach(function(existingPeer){var peer;if(existingPeer.type==="video"){peer=self.webrtc.createPeer({id:existingPeer.id,type:"screen",sharemyscreen:true,enableDataChannels:false,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:self.connection.getSessionid()});self.emit("createdPeer",peer);peer.start()}})});this.webrtc.on("localScreenStopped",function(stream){if(self.getLocalScreen()){self.stopScreenShare()}});this.webrtc.on("channelMessage",function(peer,label,data){if(data.type=="volume"){self.emit("remoteVolumeChange",peer,data.volume)}});if(this.config.autoRequestMedia)this.startLocalVideo()}SimpleWebRTC.prototype=Object.create(WildEmitter.prototype,{constructor:{value:SimpleWebRTC}});SimpleWebRTC.prototype.leaveRoom=function(){if(this.roomName){this.connection.emit("leave");while(this.webrtc.peers.length){this.webrtc.peers[0].end()}if(this.getLocalScreen()){this.stopScreenShare()}this.emit("leftRoom",this.roomName);this.roomName=undefined}};SimpleWebRTC.prototype.disconnect=function(){this.connection.disconnect();delete this.connection};SimpleWebRTC.prototype.handlePeerStreamAdded=function(peer){var self=this;var container=this.getRemoteVideoContainer();var video=attachMediaStream(peer.stream);peer.videoEl=video;video.id=this.getDomId(peer);if(container)container.appendChild(video);this.emit("videoAdded",video,peer);window.setTimeout(function(){if(!self.webrtc.isAudioEnabled()){peer.send("mute",{name:"audio"})}if(!self.webrtc.isVideoEnabled()){peer.send("mute",{name:"video"})}},250)};SimpleWebRTC.prototype.handlePeerStreamRemoved=function(peer){var container=this.getRemoteVideoContainer();var videoEl=peer.videoEl;if(this.config.autoRemoveVideos&&container&&videoEl){container.removeChild(videoEl)}this.emit("peerRemoved",peer);if(videoEl)this.emit("videoRemoved",videoEl,peer)};SimpleWebRTC.prototype.getDomId=function(peer){return[peer.id,peer.type,peer.broadcaster?"broadcasting":"incoming"].join("_")};SimpleWebRTC.prototype.setVolumeForAll=function(volume){this.webrtc.peers.forEach(function(peer){if(peer.videoEl)peer.videoEl.volume=volume})};SimpleWebRTC.prototype.joinRoom=function(name,cb){var self=this;this.roomName=name;this.connection.emit("join",name,function(err,roomDescription){console.log("join CB",err,roomDescription);if(err){self.emit("error",err)}else{var id,client,type,peer;for(id in roomDescription.clients){client=roomDescription.clients[id];for(type in client){if(client[type]){peer=self.webrtc.createPeer({id:id,type:type,enableDataChannels:self.config.enableDataChannels&&type!=="screen",receiveMedia:{offerToReceiveAudio:type!=="screen"&&self.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:self.config.receiveMedia.offerToReceiveVideo}});self.emit("createdPeer",peer);peer.start()}}}}if(cb)cb(err,roomDescription);self.emit("joinedRoom",name)})};SimpleWebRTC.prototype.getEl=function(idOrEl){if(typeof idOrEl==="string"){return document.getElementById(idOrEl)}else{return idOrEl}};SimpleWebRTC.prototype.startLocalVideo=function(){var self=this;this.webrtc.start(this.config.media,function(err,stream){if(err){self.emit("localMediaError",err)}else{attachMediaStream(stream,self.getLocalVideoContainer(),self.config.localVideo)}})};SimpleWebRTC.prototype.startCustomStream=function(stream){attachMediaStream(stream,this.getLocalVideoContainer(),this.config.localVideo)};SimpleWebRTC.prototype.stopCustomStream=function(stream){stream.getTracks().forEach(function(track){track.stop()})};SimpleWebRTC.prototype.stopLocalVideo=function(){this.webrtc.stop()};SimpleWebRTC.prototype.getLocalVideoContainer=function(){var el=this.getEl(this.config.localVideoEl);if(el&&el.tagName==="VIDEO"){el.oncontextmenu=function(){return false};return el}else if(el){var video=document.createElement("video");video.oncontextmenu=function(){return false};el.appendChild(video);return video}else{return}};SimpleWebRTC.prototype.getRemoteVideoContainer=function(){return this.getEl(this.config.remoteVideosEl)};SimpleWebRTC.prototype.shareScreen=function(cb){this.webrtc.startScreenShare(cb)};SimpleWebRTC.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};SimpleWebRTC.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var videoEl=document.getElementById("localScreen");var container=this.getRemoteVideoContainer();if(this.config.autoRemoveVideos&&container&&videoEl){container.removeChild(videoEl)}if(videoEl){this.emit("videoRemoved",videoEl)}if(this.getLocalScreen()){this.webrtc.stopScreenShare()}this.webrtc.peers.forEach(function(peer){if(peer.broadcaster){peer.end()}})};SimpleWebRTC.prototype.testReadiness=function(){var self=this;if(this.sessionReady){if(!this.config.media.video&&!this.config.media.audio){self.emit("readyToCall",self.connection.getSessionid())}else if(this.webrtc.localStreams.length>0){self.emit("readyToCall",self.connection.getSessionid())}}};SimpleWebRTC.prototype.createRoom=function(name,cb){this.roomName=name;if(arguments.length===2){this.connection.emit("create",name,cb)}else{this.connection.emit("create",name)}};SimpleWebRTC.prototype.sendFile=function(){if(!webrtcSupport.dataChannel){return this.emit("error",new Error("DataChannelNotSupported"))}};module.exports=SimpleWebRTC},{"./socketioconnection":490,"./webrtc":491,attachmediastream:6,mockconsole:226,webrtcsupport:571,wildemitter:573}],490:[function(require,module,exports){var io=require("socket.io-client");function SocketIoConnection(config){this.connection=io.connect(config.url,config.socketio)}SocketIoConnection.prototype.on=function(ev,fn){this.connection.on(ev,fn)};SocketIoConnection.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};SocketIoConnection.prototype.getSessionid=function(){return this.connection.id};SocketIoConnection.prototype.disconnect=function(){return this.connection.disconnect()};module.exports=SocketIoConnection},{"socket.io-client":477}],491:[function(require,module,exports){var util=require("util");var webrtcSupport=require("webrtcsupport");var mockconsole=require("mockconsole");var localMedia=require("localmedia");var Peer=require("./peer");function WebRTC(opts){var self=this;var options=opts||{};var config=this.config={debug:false,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:true};var item;this.logger=function(){if(opts.debug){return opts.logger||console}else{return opts.logger||mockconsole}}();for(item in options){if(options.hasOwnProperty(item)){this.config[item]=options[item]}}if(!webrtcSupport.support){this.logger.error("Your browser doesn't seem to support WebRTC")}this.peers=[];localMedia.call(this,this.config);this.on("speaking",function(){if(!self.hardMuted){self.peers.forEach(function(peer){if(peer.enableDataChannels){var dc=peer.getDataChannel("hark");if(dc.readyState!="open")return;dc.send(JSON.stringify({type:"speaking"}))}})}});this.on("stoppedSpeaking",function(){if(!self.hardMuted){self.peers.forEach(function(peer){if(peer.enableDataChannels){var dc=peer.getDataChannel("hark");if(dc.readyState!="open")return;dc.send(JSON.stringify({type:"stoppedSpeaking"}))}})}});this.on("volumeChange",function(volume,treshold){if(!self.hardMuted){self.peers.forEach(function(peer){if(peer.enableDataChannels){var dc=peer.getDataChannel("hark");if(dc.readyState!="open")return;dc.send(JSON.stringify({type:"volume",volume:volume}))}})}});if(this.config.debug){this.on("*",function(event,val1,val2){var logger;if(self.config.logger===mockconsole){logger=console}else{logger=self.logger}logger.log("event:",event,val1,val2)})}}util.inherits(WebRTC,localMedia);WebRTC.prototype.createPeer=function(opts){var peer;opts.parent=this;peer=new Peer(opts);this.peers.push(peer);return peer};WebRTC.prototype.removePeers=function(id,type){this.getPeers(id,type).forEach(function(peer){peer.end()})};WebRTC.prototype.getPeers=function(sessionId,type){return this.peers.filter(function(peer){return(!sessionId||peer.id===sessionId)&&(!type||peer.type===type)})};WebRTC.prototype.sendToAll=function(message,payload){this.peers.forEach(function(peer){peer.send(message,payload)})};WebRTC.prototype.sendDirectlyToAll=function(channel,message,payload){this.peers.forEach(function(peer){if(peer.enableDataChannels){peer.sendDirectly(channel,message,payload)}})};module.exports=WebRTC},{"./peer":488,localmedia:222,mockconsole:226,util:550,webrtcsupport:571}],492:[function(require,module,exports){var url=require("./url");var parser=require("socket.io-parser");var Manager=require("./manager");var debug=require("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==="object"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts["force new connection"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug("ignoring socket cache for %s",source);io=Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=Manager(source,opts)}io=cache[id]}if(parsed.query&&!opts.query){opts.query=parsed.query}return io.socket(parsed.path,opts)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=require("./manager");exports.Socket=require("./socket")},{"./manager":493,"./socket":495,"./url":496,debug:152,"socket.io-parser":498}],493:[function(require,module,exports){var eio=require("engine.io-client");var Socket=require("./socket");var Emitter=require("component-emitter");var parser=require("socket.io-parser");var on=require("./on");var bind=require("component-bind");var debug=require("debug")("socket.io-client:manager");var indexOf=require("indexof");var Backoff=require("backo2");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&"object"===typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState="closed";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];var _parser=opts.parser||parser;this.encoder=new _parser.Encoder;this.decoder=new _parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.generateId(nsp)}}};Manager.prototype.generateId=function(nsp){return(nsp==="/"?"":nsp+"#")+this.engine.id};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn,opts){debug("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState="opening";this.skipReconnect=false;var openSub=on(socket,"open",function(){self.onopen();fn&&fn()});var errorSub=on(socket,"error",function(data){debug("connect_error");self.cleanup();self.readyState="closed";self.emitAll("connect_error",data);if(fn){var err=new Error("Connection error");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout);openSub.destroy();socket.close();socket.emit("error","timeout");self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug("open");this.cleanup();this.readyState="open";this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata")));this.subs.push(on(socket,"ping",bind(this,"onping")));this.subs.push(on(socket,"pong",bind(this,"onpong")));this.subs.push(on(socket,"error",bind(this,"onerror")));this.subs.push(on(socket,"close",bind(this,"onclose")));this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};Manager.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)};Manager.prototype.onerror=function(err){debug("error",err);this.emitAll("error",err)};Manager.prototype.socket=function(nsp,opts){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp,opts);this.nsps[nsp]=socket;var self=this;socket.on("connecting",onConnecting);socket.on("connect",function(){socket.id=self.generateId(nsp)});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;if(packet.query&&packet.type===0)packet.nsp+="?"+packet.query;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug("cleanup");var subsLength=this.subs.length;for(var i=0;i<subsLength;i++){var sub=this.subs.shift();sub.destroy()}this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug("disconnect");this.skipReconnect=true;this.reconnecting=false;if("opening"===this.readyState){this.cleanup()}this.backoff.reset();this.readyState="closed";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug("attempting reconnect");self.emitAll("reconnect_attempt",self.backoff.attempts);self.emitAll("reconnecting",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug("reconnect attempt error");self.reconnecting=false;self.reconnect();self.emitAll("reconnect_error",err.data)}else{debug("reconnect success");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",attempt)}},{"./on":494,"./socket":495,backo2:18,"component-bind":38,"component-emitter":39,debug:152,"engine.io-client":158,indexof:217,"socket.io-parser":498}],494:[function(require,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],495:[function(require,module,exports){var parser=require("socket.io-parser");var Emitter=require("component-emitter");var toArray=require("to-array");var on=require("./on");var bind=require("component-bind");var debug=require("debug")("socket.io-client:socket");var parseqs=require("parseqs");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp,opts){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(opts&&opts.query){this.query=opts.query}if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"===this.io.readyState)this.onopen();this.emit("connecting");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift("message");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var packet={type:parser.EVENT,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if("function"===typeof args[args.length-1]){debug("emitting packet with ack id %d",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug("transport is open - connecting");if("/"!==this.nsp){if(this.query){var query=typeof this.query==="object"?parseqs.encode(this.query):this.query;debug("sending connect packet with query %s",query);this.packet({type:parser.CONNECT,query:query})}else{this.packet({type:parser.CONNECT})}}};Socket.prototype.onclose=function(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!==this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug("sending ack %j",args);self.packet({type:parser.ACK,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if("function"===typeof ack){debug("calling ack %s with %j",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug("bad ack %s",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{"./on":494,"component-bind":38,"component-emitter":39,debug:152,parseqs:252,"socket.io-parser":498,"to-array":543}],496:[function(require,module,exports){(function(global){var parseuri=require("parseuri");var debug=require("debug")("socket.io-client:url");module.exports=url;function url(uri,loc){var obj=uri;loc=loc||global.location;if(null==uri)uri=loc.protocol+"//"+loc.host;if("string"===typeof uri){if("/"===uri.charAt(0)){if("/"===uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!==typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";var ipv6=obj.host.indexOf(":")!==-1;var host=ipv6?"["+obj.host+"]":obj.host;obj.id=obj.protocol+"://"+host+":"+obj.port;obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port);return obj}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:152,parseuri:253}],497:[function(require,module,exports){(function(global){var isArray=require("isarray");var isBuf=require("./is-buffer");var toString=Object.prototype.toString;var withNativeBlob=typeof global.Blob==="function"||toString.call(global.Blob)==="[object BlobConstructor]";var withNativeFile=typeof global.File==="function"||toString.call(global.File)==="[object FileConstructor]";exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;var pack=packet;pack.data=_deconstructPacket(packetData,buffers);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};function _deconstructPacket(data,buffers){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i],buffers)}return newData}else if(typeof data==="object"&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key],buffers)}return newData}return data}exports.reconstructPacket=function(packet,buffers){packet.data=_reconstructPacket(packet.data,buffers);packet.attachments=undefined;return packet};function _reconstructPacket(data,buffers){if(!data)return data;if(data&&data._placeholder){return buffers[data.num]}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i],buffers)}}else if(typeof data==="object"){for(var key in data){data[key]=_reconstructPacket(data[key],buffers)}}return data}exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(typeof obj==="object"&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":499,isarray:500}],498:[function(require,module,exports){var debug=require("debug")("socket.io-parser");var Emitter=require("component-emitter");var hasBin=require("has-binary2");var binary=require("./binary");var isBuf=require("./is-buffer");exports.protocol=4;exports.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){if((obj.type===exports.EVENT||obj.type===exports.ACK)&&hasBin(obj.data)){obj.type=obj.type===exports.EVENT?exports.BINARY_EVENT:exports.BINARY_ACK}debug("encoding packet %j",obj);if(exports.BINARY_EVENT===obj.type||exports.BINARY_ACK===obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str=""+obj.type;if(exports.BINARY_EVENT===obj.type||exports.BINARY_ACK===obj.type){str+=obj.attachments+"-"}if(obj.nsp&&"/"!==obj.nsp){str+=obj.nsp+","}if(null!=obj.id){str+=obj.id}if(null!=obj.data){str+=JSON.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if(typeof obj==="string"){packet=decodeString(obj);if(exports.BINARY_EVENT===packet.type||exports.BINARY_ACK===packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",packet)}}else{this.emit("decoded",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}};function decodeString(str){var i=0;var p={type:Number(str.charAt(0))};if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT===p.type||exports.BINARY_ACK===p.type){var buf="";while(str.charAt(++i)!=="-"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!=="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"===str.charAt(i+1)){p.nsp="";while(++i){var c=str.charAt(i);if(","===c)break;p.nsp+=c;if(i===str.length)break}}else{p.nsp="/"}var next=str.charAt(i+1);if(""!==next&&Number(next)==next){p.id="";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i===str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){p=tryParse(p,str.substr(i))}debug("decoded %s as %j",str,p);return p}function tryParse(p,str){try{p.data=JSON.parse(str)}catch(e){return error()}return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length===this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(){return{type:exports.ERROR,data:"parser error"}}},{"./binary":497,"./is-buffer":499,"component-emitter":39,debug:152,"has-binary2":210}],499:[function(require,module,exports){arguments[4][485][0].apply(exports,arguments)},{dup:485}],500:[function(require,module,exports){arguments[4][211][0].apply(exports,arguments)},{dup:211}],501:[function(require,module,exports){"use strict";exports.__esModule=true;var _dummy=require("./utils/dummy");var _dummy2=_interopRequireDefault(_dummy);var _fakeContext=require("./utils/fake-context");var _fakeContext2=_interopRequireDefault(_fakeContext);var _iOS=require("./utils/iOS");var _iOS2=_interopRequireDefault(_iOS);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var desiredSampleRate=44100;var Ctx=window.AudioContext||window.webkitAudioContext||_fakeContext2.default;var context=new Ctx;if(!context){context=new _fakeContext2.default}if(_iOS2.default&&context.sampleRate!==desiredSampleRate){(0,_dummy2.default)(context);context.close();context=new Ctx}if(context.state==="suspended"&&typeof context.resume==="function"){window.setTimeout(function(){return context.resume()},1e3)}exports.default=context},{"./utils/dummy":511,"./utils/fake-context":513,"./utils/iOS":516}],502:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Effects=function(){function Effects(context){var _this=this;(0,_classCallCheck3.default)(this,Effects);this.context=context;this._destination=null;this._source=null;this._nodes=[];this._nodes.has=function(node){return _this.has(node)};this._nodes.add=function(node){return _this.add(node)};this._nodes.remove=function(node){return _this.remove(node)};this._nodes.toggle=function(node,force){return _this.toggle(node,force)};this._nodes.removeAll=function(){return _this.removeAll()};Object.keys(Effects.prototype).forEach(function(key){if(!_this._nodes.hasOwnProperty(key)&&typeof Effects.prototype[key]==="function"){_this._nodes[key]=_this[key].bind(_this)}})}Effects.prototype.setSource=function setSource(node){this._source=node;this._updateConnections();return node};Effects.prototype.setDestination=function setDestination(node){this._connectToDestination(node);return node};Effects.prototype.has=function has(node){if(!node){return false}return this._nodes.indexOf(node)>-1};Effects.prototype.add=function add(node){if(!node){return null}if(this.has(node)){return node}if(Array.isArray(node)){var n=void 0;for(var i=0;i<node.length;i++){n=this.add(node[i])}return n}this._nodes.push(node);this._updateConnections();return node};Effects.prototype.remove=function remove(node){if(!node){return null}if(!this.has(node)){return node}var l=this._nodes.length;for(var i=0;i<l;i++){if(node===this._nodes[i]){this._nodes.splice(i,1);break}}node.disconnect();this._updateConnections();return node};Effects.prototype.toggle=function toggle(node,force){force=!!force;var hasNode=this.has(node);if(arguments.length>1&&hasNode===force){return this}if(hasNode){this.remove(node)}else{this.add(node)}return this};Effects.prototype.removeAll=function removeAll(){while(this._nodes.length){var node=this._nodes.pop();node.disconnect()}this._updateConnections();return this};Effects.prototype.destroy=function destroy(){this.removeAll();this.context=null;this._destination=null;if(this._source){this._source.disconnect()}this._source=null};Effects.prototype._connect=function _connect(a,b){a.disconnect();a.connect(b._in||b)};Effects.prototype._connectToDestination=function _connectToDestination(node){var lastNode=this._nodes[this._nodes.length-1]||this._source;if(lastNode){this._connect(lastNode,node)}this._destination=node};Effects.prototype._updateConnections=function _updateConnections(){if(!this._source){return}var node=void 0,prev=void 0;for(var i=0;i<this._nodes.length;i++){node=this._nodes[i];prev=i===0?this._source:this._nodes[i-1];this._connect(prev,node)}if(this._destination){this._connectToDestination(this._destination)}};return Effects}();exports.default=Effects},{"babel-runtime/helpers/classCallCheck":12}],503:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=Group;var _effects=require("./effects");var _effects2=_interopRequireDefault(_effects);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Group(context,destination){var sounds=[];var effects=new _effects2.default(context);var gain=context.createGain();var preMuteVolume=1;var group=null;if(context){effects.setSource(gain);effects.setDestination(destination||context.destination)}function find(soundOrId,callback){var found=void 0;if(!soundOrId&&soundOrId!==0){return found}sounds.some(function(sound){if(sound===soundOrId||sound.id===soundOrId){found=sound;return true}return false});if(found&&callback){return callback(found)}return found}function remove(soundOrId){find(soundOrId,function(sound){return sounds.splice(sounds.indexOf(sound),1)});return group}function add(sound){sound.gain.disconnect();sound.gain.connect(gain);sounds.push(sound);sound.once("destroy",remove);return group}function play(delay,offset){sounds.forEach(function(sound){return sound.play(delay,offset)});return group}function pause(){sounds.forEach(function(sound){if(sound.playing){sound.pause()}});return group}function resume(){sounds.forEach(function(sound){if(sound.paused){sound.play()}});return group}function stop(){sounds.forEach(function(sound){return sound.stop()});return group}function seek(percent){sounds.forEach(function(sound){return sound.seek(percent)});return group}function mute(){preMuteVolume=group.volume;group.volume=0;return group}function unMute(){group.volume=preMuteVolume||1;return group}function setVolume(value){group.volume=value;return group}function fade(volume,duration){if(context){var param=gain.gain;var time=context.currentTime;param.cancelScheduledValues(time);param.setValueAtTime(param.value,time);param.linearRampToValueAtTime(volume,time+duration)}else{sounds.forEach(function(sound){return sound.fade(volume,duration)})}return group}function load(){sounds.forEach(function(sound){return sound.load()})}function unload(){sounds.forEach(function(sound){return sound.unload()})}function destroy(){while(sounds.length){sounds.pop().destroy()}}group={add:add,find:find,remove:remove,play:play,pause:pause,resume:resume,stop:stop,seek:seek,setVolume:setVolume,mute:mute,unMute:unMute,fade:fade,load:load,unload:unload,destroy:destroy,gain:gain,get effects(){return effects._nodes},set effects(value){effects.removeAll().add(value)},get fx(){return this.effects},set fx(value){this.effects=value},get sounds(){return sounds},get volume(){return gain.gain.value},set volume(value){if(isNaN(value)){return}value=Math.min(Math.max(value,0),1);if(context){gain.gain.cancelScheduledValues(context.currentTime);gain.gain.value=value;gain.gain.setValueAtTime(value,context.currentTime)}else{gain.gain.value=value}sounds.forEach(function(sound){if(!sound.context){sound.groupVolume=value}})}};return group}Group.Effects=_effects2.default},{"./effects":502}],504:[function(require,module,exports){"use strict";exports.__esModule=true;var _defineEnumerableProperties2=require("babel-runtime/helpers/defineEnumerableProperties");var _defineEnumerableProperties3=_interopRequireDefault(_defineEnumerableProperties2);var _effects,_effects2,_fx,_fx2,_isTouchLocked,_playInBackground,_playInBackground2,_sounds,_volume,_volume2,_sono,_mutatorMap;require("core-js/fn/object/assign");var _context=require("./context");var _context2=_interopRequireDefault(_context);var _effects3=require("./effects");var _effects4=_interopRequireDefault(_effects3);var _file=require("./utils/file");var _file2=_interopRequireDefault(_file);var _group=require("./group");var _group2=_interopRequireDefault(_group);var _loader=require("./utils/loader");var _loader2=_interopRequireDefault(_loader);var _log2=require("./utils/log");var _log3=_interopRequireDefault(_log2);var _pageVisibility=require("./utils/pageVisibility");var _pageVisibility2=_interopRequireDefault(_pageVisibility);var _sound=require("./sound");var _sound2=_interopRequireDefault(_sound);var _soundGroup=require("./utils/sound-group");var _soundGroup2=_interopRequireDefault(_soundGroup);var _touchLock=require("./utils/touchLock");var _touchLock2=_interopRequireDefault(_touchLock);var _utils=require("./utils/utils");var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VERSION="2.1.4";var bus=new _group2.default(_context2.default,_context2.default.destination);function get(id){return bus.find(id)}function group(sounds){var soundGroup=new _soundGroup2.default(_context2.default,bus.gain);if(sounds){sounds.forEach(function(sound){return soundGroup.add(sound)})}return soundGroup}function add(config){var src=_file2.default.getSupportedFile(config.src||config.url||config.data||config);var sound=new _sound2.default(Object.assign({},config||{},{src:src,context:_context2.default,destination:bus.gain}));sound.isTouchLocked=isTouchLocked;if(config){sound.id=config.id||config.name||"";sound.loop=!!config.loop;sound.volume=config.volume;sound.effects=config.effects||[]}bus.add(sound);return sound}function queue(config,loaderGroup){var sound=add(config).prepare();if(loaderGroup){loaderGroup.add(sound.loader)}return sound}function load(config){var src=config.src||config.url||config.data||config;var sound=void 0,loader=void 0;if(_file2.default.containsURL(src)){sound=queue(config);loader=sound.loader}else if(Array.isArray(src)&&_file2.default.containsURL(src[0].src||src[0].url)){sound=[];loader=new _loader2.default.Group;src.forEach(function(url){return sound.push(queue(url,loader))})}else{var errorMessage="sono.load: No audio file URLs found in config.";if(config.onError){config.onError("[ERROR] "+errorMessage)}else{throw new Error(errorMessage)}return null}if(config.onProgress){loader.on("progress",function(progress){return config.onProgress(progress)})}if(config.onComplete){loader.once("complete",function(){loader.off("progress");config.onComplete(sound)})}loader.once("error",function(err){loader.off("error");if(config.onError){config.onError(err)}else{console.error(err)}});loader.start();return sound}function create(config){if(_file2.default.containsURL(config)){return load(config)}var sound=add(config);sound.data=config.data||config;return sound}function destroy(soundOrId){bus.find(soundOrId,function(sound){return sound.destroy()});return sono}function destroyAll(){bus.destroy();return sono}function mute(){bus.mute();return sono}function unMute(){bus.unMute();return sono}function fade(volume,duration){bus.fade(volume,duration);return sono}function pauseAll(){bus.pause();return sono}function resumeAll(){bus.resume();return sono}function stopAll(){bus.stop();return sono}function play(id,delay,offset){bus.find(id,function(sound){return sound.play(delay,offset)});return sono}function pause(id){bus.find(id,function(sound){return sound.pause()});return sono}function stop(id){bus.find(id,function(sound){return sound.stop()});return sono}var isTouchLocked=(0,_touchLock2.default)(_context2.default,function(){isTouchLocked=false;bus.sounds.forEach(function(sound){return sound.isTouchLocked=false})});var pageHiddenPaused=[];function onHidden(){bus.sounds.forEach(function(sound){if(sound.playing){sound.pause();pageHiddenPaused.push(sound)}})}function onShown(){while(pageHiddenPaused.length){pageHiddenPaused.pop().play()}}var pageVis=(0,_pageVisibility2.default)(onHidden,onShown);function register(name,fn){var attachTo=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_effects4.default.prototype;attachTo[name]=fn;sono[name]=fn;return fn}var sono=(_sono={canPlay:_file2.default.canPlay,context:_context2.default,create:create,createGroup:group,createSound:create,destroyAll:destroyAll,destroy:destroy,effects:bus.effects,extensions:_file2.default.extensions,fade:fade,file:_file2.default,gain:bus.gain,getOfflineContext:_utils2.default.getOfflineContext,get:get,getSound:get,group:group,hasWebAudio:!_context2.default.isFake,isSupported:_file2.default.extensions.length>0,load:load,log:function log(){return(0,_log3.default)(sono)},mute:mute,pause:pause,pauseAll:pauseAll,play:play,register:register,resumeAll:resumeAll,stop:stop,stopAll:stopAll,unMute:unMute,utils:_utils2.default,VERSION:VERSION},_effects="effects",_mutatorMap={},_mutatorMap[_effects]=_mutatorMap[_effects]||{},_mutatorMap[_effects].get=function(){return bus.effects},_effects2="effects",_mutatorMap[_effects2]=_mutatorMap[_effects2]||{},_mutatorMap[_effects2].set=function(value){bus.effects.removeAll().add(value)},_fx="fx",_mutatorMap[_fx]=_mutatorMap[_fx]||{},_mutatorMap[_fx].get=function(){return this.effects},_fx2="fx",_mutatorMap[_fx2]=_mutatorMap[_fx2]||{},_mutatorMap[_fx2].set=function(value){this.effects=value},_isTouchLocked="isTouchLocked",_mutatorMap[_isTouchLocked]=_mutatorMap[_isTouchLocked]||{},_mutatorMap[_isTouchLocked].get=function(){return isTouchLocked},_playInBackground="playInBackground",_mutatorMap[_playInBackground]=_mutatorMap[_playInBackground]||{},_mutatorMap[_playInBackground].get=function(){return!pageVis.enabled},_playInBackground2="playInBackground",_mutatorMap[_playInBackground2]=_mutatorMap[_playInBackground2]||{},_mutatorMap[_playInBackground2].set=function(value){pageVis.enabled=!value;if(!value){onShown()}},_sounds="sounds",_mutatorMap[_sounds]=_mutatorMap[_sounds]||{},_mutatorMap[_sounds].get=function(){return bus.sounds.slice(0)},_volume="volume",_mutatorMap[_volume]=_mutatorMap[_volume]||{},_mutatorMap[_volume].get=function(){return bus.volume},_volume2="volume",_mutatorMap[_volume2]=_mutatorMap[_volume2]||{},_mutatorMap[_volume2].set=function(value){bus.volume=value},_sono.__test={Effects:_effects4.default,Group:_group2.default,Sound:_sound2.default},(0,_defineEnumerableProperties3.default)(_sono,_mutatorMap),_sono);exports.default=sono},{"./context":501,"./effects":502,"./group":503,"./sound":505,"./utils/file":514,"./utils/loader":519,"./utils/log":520,"./utils/pageVisibility":521,"./utils/sound-group":522,"./utils/touchLock":523,"./utils/utils":524,"babel-runtime/helpers/defineEnumerableProperties":14,"core-js/fn/object/assign":42}],505:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _context=require("./context");var _context2=_interopRequireDefault(_context);var _bufferSource=require("./source/buffer-source");var _bufferSource2=_interopRequireDefault(_bufferSource);var _effects=require("./effects");var _effects2=_interopRequireDefault(_effects);var _emitter=require("./utils/emitter");var _emitter2=_interopRequireDefault(_emitter);var _file=require("./utils/file");var _file2=_interopRequireDefault(_file);var _firefox=require("./utils/firefox");var _firefox2=_interopRequireDefault(_firefox);var _utils=require("./utils/utils");var _utils2=_interopRequireDefault(_utils);var _isSafeNumber=require("./utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);var _loader=require("./utils/loader");var _loader2=_interopRequireDefault(_loader);var _audioSource=require("./source/audio-source");var _audioSource2=_interopRequireDefault(_audioSource);var _mediaSource=require("./source/media-source");var _mediaSource2=_interopRequireDefault(_mediaSource);var _microphoneSource=require("./source/microphone-source");var _microphoneSource2=_interopRequireDefault(_microphoneSource);var _oscillatorSource=require("./source/oscillator-source");var _oscillatorSource2=_interopRequireDefault(_oscillatorSource);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Sound=function(_Emitter){(0,_inherits3.default)(Sound,_Emitter);function Sound(config){(0,_classCallCheck3.default)(this,Sound);var _this=(0,_possibleConstructorReturn3.default)(this,_Emitter.call(this));_this.id=config.id||null;_this._context=config.context||_context2.default;_this._destination=config.destination||_this._context.destination;_this._effects=new _effects2.default(_this._context);_this._gain=_this._context.createGain();_this._config=config;_this._data=null;_this._fadeTimeout=null;_this._isTouchLocked=false;_this._loader=null;_this._loop=false;_this._offset=0;_this._playbackRate=1;_this._playWhenReady=null;_this._source=null;_this._wave=null;_this._userData={};_this._effects.setDestination(_this._gain);_this._gain.connect(_this._destination);_this._onEnded=_this._onEnded.bind(_this);_this._onLoad=_this._onLoad.bind(_this);_this._onLoadError=_this._onLoadError.bind(_this);return _this}Sound.prototype.prepare=function prepare(){var newConfig=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var skipLoad=!force&&!this._source&&!!this._config.deferLoad;if(newConfig){var configSrc=_file2.default.getSrc(newConfig);var src=_file2.default.getSupportedFile(configSrc)||this._config.src;this._config=Object.assign(this._config,newConfig,{src:src})}if(this._source&&this._data&&this._data.tagName){this._source.load(this._config.src)}else{this._loader=new _loader2.default(this._config.src,skipLoad);this._loader.audioContext=!!this._config.asMediaElement||this._context.isFake?null:this._context;this._loader.isTouchLocked=this._isTouchLocked;this._loader.once("loaded",this._onLoad);this._loader.once("error",this._onLoadError)}return this};Sound.prototype.load=function load(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.stop();this._source=null;if(!config||_file2.default.containsURL(config)){if(this._loader){this._loader.destroy()}this.prepare(config,true);this._loader.start()}else{this.data=config.data||config}return this};Sound.prototype.play=function play(delay,offset){var _this2=this;if(!this._source||this._isTouchLocked){this._playWhenReady=function(){if(_this2._source){_this2.play(delay,offset)}};if(!!this._config.deferLoad){if(!this._loader){this.prepare(null,true)}this._loader.start(true)}return this}this._playWhenReady=null;this._effects.setSource(this._source.sourceNode);if(this._offset&&typeof offset==="undefined"){offset=this._offset;this._offset=0}this._source.play(delay,offset);if(this._source.hasOwnProperty("volume")){this._source.volume=this._gain.gain.value}if(this._source.hasOwnProperty("loop")){this._source.loop=this._loop}this.emit("play",this);return this};Sound.prototype.pause=function pause(){this._source&&this._source.pause();this.emit("pause",this);return this};Sound.prototype.stop=function stop(delay){this._source&&this._source.stop(delay||0);this.emit("stop",this);return this};Sound.prototype.seek=function seek(value){this.currentTime=value;return this};Sound.prototype.fade=function fade(volume){var duration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!this._source){return this}var param=this._gain.gain;if(this._context&&!this._context.isFake&&!_firefox2.default){var time=this._context.currentTime;param.cancelScheduledValues(time);param.setValueAtTime(param.value,time);param.linearRampToValueAtTime(volume,time+duration)}else{this._fadePolyfill(volume,duration)}this.emit("fade",this,volume);return this};Sound.prototype._fadePolyfill=function _fadePolyfill(toVolume,duration){var _this3=this;var ramp=function ramp(value,step){_this3._fadeTimeout=window.setTimeout(function(){_this3.volume=_this3.volume+(value-_this3.volume)*.2;if(Math.abs(_this3.volume-value)>.05){ramp(value,step);return}_this3.volume=value},step*1e3)};window.clearTimeout(this._fadeTimeout);ramp(toVolume,duration/10);return this};Sound.prototype.unload=function unload(){this._source&&this._source.destroy();this._loader&&this._loader.destroy();this._data=null;this._playWhenReady=null;this._source=null;this._loader=null;this._config.deferLoad=true;this.emit("unload",this)};Sound.prototype.reload=function reload(){return this.load(null,true)};Sound.prototype.destroy=function destroy(){this._source&&this._source.destroy();this._effects&&this._effects.destroy();this._gain&&this._gain.disconnect();if(this._loader){this._loader.off("loaded");this._loader.off("error");this._loader.destroy()}this._gain=null;this._context=null;this._destination=null;this._data=null;this._playWhenReady=null;this._source=null;this._effects=null;this._loader=null;this._config=null;this.emit("destroy",this);this.off()};Sound.prototype.waveform=function waveform(length){var _this4=this;if(!this._wave){this._wave=_utils2.default.waveform()}if(!this._data){this.once("ready",function(){return _this4._wave(_this4._data,length)})}return this._wave(this._data,length)};Sound.prototype._createSource=function _createSource(data){var isAudioBuffer=_file2.default.isAudioBuffer(data);if(isAudioBuffer||_file2.default.isMediaElement(data)){var Fn=isAudioBuffer?_bufferSource2.default:_mediaSource2.default;this._source=new _audioSource2.default(Fn,data,this._context,this._onEnded);this._source.singlePlay=!!this._config.singlePlay;this._source.playbackRate=this._playbackRate;this._source.currentTime=this._offset}else if(_file2.default.isMediaStream(data)){this._source=new _microphoneSource2.default(data,this._context)}else if(_file2.default.isOscillatorType(data&&data.type||data)){this._source=new _oscillatorSource2.default(data.type||data,this._context)}else{throw new Error("Cannot detect data type: "+data)}this._effects.setSource(this._source.sourceNode);this.emit("ready",this);if(this._playWhenReady){this._playWhenReady()}};Sound.prototype._onEnded=function _onEnded(){this.emit("ended",this)};Sound.prototype._onLoad=function _onLoad(data){this._data=data;this.emit("loaded",this);this._createSource(data)};Sound.prototype._onLoadError=function _onLoadError(err){if(this.listenerCount("error")){this.emit("error",this,err);return}console.error("Sound load error",this._loader.url)};(0,_createClass3.default)(Sound,[{key:"context",get:function get(){return this._context}},{key:"currentTime",get:function get(){return this._source?this._source.currentTime:this._offset},set:function set(value){if(this._source){var playing=this._source.playing;this._source.stop();this._source.currentTime=value;if(playing){this.play(0,value)}}else{this._offset=value}}},{key:"data",get:function get(){return this._data},set:function set(value){if(!value){return}this._data=value;this._createSource(value)}},{key:"duration",get:function get(){return this._source?this._source.duration:0}},{key:"effects",get:function get(){return this._effects._nodes},set:function set(value){this._effects.removeAll().add(value)}},{key:"fx",get:function get(){return this.effects},set:function set(value){this.effects=value}},{key:"ended",get:function get(){return!!this._source&&this._source.ended}},{key:"frequency",get:function get(){return this._source?this._source.frequency:0},set:function set(value){if(this._source&&this._source.hasOwnProperty("frequency")){this._source.frequency=value}}},{key:"gain",get:function get(){return this._gain}},{key:"groupVolume",get:function get(){return this._source.groupVolume},set:function set(value){if(this._source&&this._source.hasOwnProperty("groupVolume")){this._source.groupVolume=value}}},{key:"isTouchLocked",set:function set(value){this._isTouchLocked=value;if(this._loader){this._loader.isTouchLocked=value}if(!value&&this._playWhenReady){this._playWhenReady()}}},{key:"loader",get:function get(){return this._loader}},{key:"loop",get:function get(){return this._loop},set:function set(value){this._loop=!!value;if(this._source&&this._source.hasOwnProperty("loop")&&this._source.loop!==this._loop){this._source.loop=this._loop}}},{key:"singlePlay",get:function get(){return this._config.singlePlay},set:function set(value){this._config.singlePlay=value;this._source.singlePlay=value}},{key:"config",get:function get(){return this._config}},{key:"paused",get:function get(){return!!this._source&&this._source.paused}},{key:"playing",get:function get(){return!!this._source&&this._source.playing}},{key:"playbackRate",get:function get(){return this._playbackRate},set:function set(value){this._playbackRate=value;if(this._source){this._source.playbackRate=value}}},{key:"progress",get:function get(){return this._source?this._source.progress||0:0}},{key:"sourceInfo",get:function get(){return this._source&&this._source.info?this._source.info:{}}},{key:"sourceNode",get:function get(){return this._source?this._source.sourceNode:null}},{key:"volume",get:function get(){return this._gain.gain.value},set:function set(value){if(!(0,_isSafeNumber2.default)(value)){return}window.clearTimeout(this._fadeTimeout);value=Math.min(Math.max(value,0),1);var param=this._gain.gain;var time=this._context.currentTime;param.cancelScheduledValues(time);param.value=value;if(!_firefox2.default){param.setValueAtTime(value,time)}if(this._source&&this._source.hasOwnProperty("volume")){this._source.volume=value}}},{key:"userData",get:function get(){return this._userData}}]);return Sound}(_emitter2.default);exports.default=Sound;Sound.__source={BufferSource:_bufferSource2.default,MediaSource:_mediaSource2.default,MicrophoneSource:_microphoneSource2.default,OscillatorSource:_oscillatorSource2.default}},{"./context":501,"./effects":502,"./source/audio-source":506,"./source/buffer-source":507,"./source/media-source":508,"./source/microphone-source":509,"./source/oscillator-source":510,"./utils/emitter":512,"./utils/file":514,"./utils/firefox":515,"./utils/isSafeNumber":518,"./utils/loader":519,"./utils/utils":524,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],506:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=AudioSource;function AudioSource(Type,data,context,onEnded){var sourceNode=context.createGain();var source=create(data);var api={};var pool=[];var clones=[];var numCreated=0;var singlePlay=false;function createSourceNode(){return sourceNode}function disposeSource(src){src.stop();if(!singlePlay){pool.push(src)}}function onSourceEnded(src){if(src!==source&&clones.length){var index=clones.indexOf(src);clones.splice(index,1);disposeSource(src)}onEnded()}function create(buffer){return new Type(buffer,context,onSourceEnded)}function getSource(){if(singlePlay||!source.playing){return source}if(pool.length>0){return pool.pop()}numCreated++;if(data.tagName){return create(data.cloneNode())}return create(data)}function play(delay,offset){var src=getSource();if(sourceNode){src.sourceNode.connect(sourceNode)}if(src!==source){clones.push(src)}src.play(delay,offset)}function stop(){source.stop();while(clones.length){disposeSource(clones.pop())}}function pause(){source.pause();clones.forEach(function(src){return src.pause()})}function load(url){stop();pool.length=0;source.load(url)}function destroy(){source.destroy();while(clones.length){clones.pop().destroy()}while(pool.length){pool.pop().destroy()}sourceNode.disconnect()}Object.defineProperties(api,{play:{value:play},pause:{value:pause},stop:{value:stop},load:{value:load},destroy:{value:destroy},currentTime:{get:function get(){return source.currentTime||0},set:function set(value){source.currentTime=value;clones.forEach(function(src){return src.currentTime=value})}},duration:{get:function get(){return source.duration||0}},ended:{get:function get(){return source.ended&&clones.every(function(src){return src.ended})}},info:{get:function get(){return{pooled:pool.length,active:clones.length+1,created:numCreated+1}}},loop:{get:function get(){return source.loop},set:function set(value){source.loop=!!value;clones.forEach(function(src){return src.loop=!!value})}},paused:{get:function get(){return source.paused}},playbackRate:{get:function get(){return source.playbackRate},set:function set(value){source.playbackRate=value;clones.forEach(function(src){return src.playbackRate=value})}},playing:{get:function get(){return source.playing}},progress:{get:function get(){return source.progress}},singlePlay:{get:function get(){return singlePlay},set:function set(value){singlePlay=value}},sourceNode:{get:function get(){return createSourceNode()}},volume:{get:function get(){return source.volume},set:function set(value){if(source.hasOwnProperty("volume")){source.volume=value;clones.forEach(function(src){return src.volume=value})}}},groupVolume:{get:function get(){return source.groupVolume},set:function set(value){if(!source.hasOwnProperty("groupVolume")){return}source.groupVolume=value;clones.forEach(function(src){return src.groupVolume=value})}}});return Object.freeze(api)}},{}],507:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=BufferSource;function BufferSource(buffer,context,endedCallback){var api={};var ended=false;var loop=false;var paused=false;var cuedAt=0;var playbackRate=1;var playing=false;var sourceNode=null;var startedAt=0;function createSourceNode(){if(!sourceNode&&context){sourceNode=context.createBufferSource();sourceNode.buffer=buffer}return sourceNode}function stop(){if(sourceNode){sourceNode.onended=null;try{sourceNode.disconnect();sourceNode.stop(0)}catch(e){}sourceNode=null}paused=false;cuedAt=0;playing=false;startedAt=0}function pause(){var elapsed=context.currentTime-startedAt;stop();cuedAt=elapsed;playing=false;paused=true}function endedHandler(){stop();ended=true;if(typeof endedCallback==="function"){endedCallback(api)}}function play(){var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(playing){return}delay=delay?context.currentTime+delay:0;if(offset){cuedAt=0}if(cuedAt){offset=cuedAt}while(offset>api.duration){offset=offset%api.duration}createSourceNode();sourceNode.onended=endedHandler;sourceNode.start(delay,offset);sourceNode.loop=loop;sourceNode.playbackRate.value=playbackRate;startedAt=context.currentTime-offset;ended=false;paused=false;cuedAt=0;playing=true}function destroy(){stop();buffer=null;context=null;endedCallback=null;sourceNode=null}Object.defineProperties(api,{play:{value:play},pause:{value:pause},stop:{value:stop},destroy:{value:destroy},currentTime:{get:function get(){if(cuedAt){return cuedAt}if(startedAt){var time=context.currentTime-startedAt;while(time>api.duration){time=time%api.duration}return time}return 0},set:function set(value){cuedAt=value}},duration:{get:function get(){return buffer?buffer.duration:0}},ended:{get:function get(){return ended}},loop:{get:function get(){return loop},set:function set(value){loop=!!value;if(sourceNode){sourceNode.loop=loop}}},paused:{get:function get(){return paused}},playbackRate:{get:function get(){return playbackRate},set:function set(value){playbackRate=value;if(sourceNode){sourceNode.playbackRate.value=playbackRate}}},playing:{get:function get(){return playing}},progress:{get:function get(){return api.duration?api.currentTime/api.duration:0}},sourceNode:{get:function get(){return createSourceNode()}}});return Object.freeze(api)}},{}],508:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=MediaSource;function MediaSource(el,context,onEnded){var api={};var ended=false;var endedCallback=onEnded;var delayTimeout=null;var loop=false;var paused=false;var playbackRate=1;var playing=false;var sourceNode=null;var groupVolume=1;var volume=1;function createSourceNode(){if(!sourceNode&&context){sourceNode=context.createMediaElementSource(el)}return sourceNode}function load(url){el.src=url;el.load();ended=false;paused=false;playing=false}function readyHandler(){el.removeEventListener("canplaythrough",readyHandler);if(playing){el.play()}}function endedHandler(){if(loop){el.currentTime=0;if(el.currentTime>0){el.load()}el.play();return}ended=true;paused=false;playing=false;if(typeof endedCallback==="function"){endedCallback(api)}}function play(delay,offset){clearTimeout(delayTimeout);el.volume=volume*groupVolume;el.playbackRate=playbackRate;if(offset){el.currentTime=offset}if(delay){delayTimeout=setTimeout(play,delay)}else{el.play()}ended=false;paused=false;playing=true;el.removeEventListener("ended",endedHandler);el.addEventListener("ended",endedHandler,false);if(el.readyState<1){el.removeEventListener("canplaythrough",readyHandler);el.addEventListener("canplaythrough",readyHandler,false);el.play()}}function pause(){clearTimeout(delayTimeout);if(!el){return}el.pause();playing=false;paused=true}function stop(){clearTimeout(delayTimeout);if(!el){return}el.pause();try{el.currentTime=0;if(el.currentTime>0){el.load()}}catch(e){}playing=false;paused=false}function destroy(){el.removeEventListener("ended",endedHandler);el.removeEventListener("canplaythrough",readyHandler);stop();el=null;context=null;endedCallback=null;sourceNode=null}Object.defineProperties(api,{play:{value:play},pause:{value:pause},stop:{value:stop},load:{value:load},destroy:{value:destroy},currentTime:{get:function get(){return el?el.currentTime:0},set:function set(value){if(el){el.currentTime=value}}},duration:{get:function get(){return el?el.duration:0}},ended:{get:function get(){return ended}},loop:{get:function get(){return loop},set:function set(value){loop=!!value}},paused:{get:function get(){return paused}},playbackRate:{get:function get(){return playbackRate},set:function set(value){playbackRate=value;if(el){el.playbackRate=playbackRate}}},playing:{get:function get(){return playing}},progress:{get:function get(){return el&&el.duration?el.currentTime/el.duration:0}},sourceNode:{get:function get(){return createSourceNode()}},volume:{get:function get(){return volume},set:function set(value){volume=value;if(el){el.volume=volume*groupVolume}}},groupVolume:{get:function get(){return groupVolume},set:function set(value){groupVolume=value;if(el){el.volume=volume*groupVolume}}}});return Object.freeze(api)}},{}],509:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=MicrophoneSource;function MicrophoneSource(stream,context){var ended=false,paused=false,cuedAt=0,playing=false,sourceNode=null,startedAt=0;function createSourceNode(){if(!sourceNode&&context){sourceNode=context.createMediaStreamSource(stream);if(navigator.mozGetUserMedia){window.mozHack=sourceNode}}return sourceNode}function play(delay){delay=delay?context.currentTime+delay:0;createSourceNode();sourceNode.start(delay);startedAt=context.currentTime-cuedAt;ended=false;playing=true;paused=false;cuedAt=0}function stop(){if(sourceNode){try{sourceNode.stop(0)}catch(e){}sourceNode=null}ended=true;paused=false;cuedAt=0;playing=false;startedAt=0}function pause(){var elapsed=context.currentTime-startedAt;stop();cuedAt=elapsed;playing=false;paused=true}function destroy(){stop();context=null;sourceNode=null;stream=null;window.mozHack=null}var api={play:play,pause:pause,stop:stop,destroy:destroy,duration:0,progress:0};Object.defineProperties(api,{currentTime:{get:function get(){if(cuedAt){return cuedAt}if(startedAt){return context.currentTime-startedAt}return 0},set:function set(value){cuedAt=value}},ended:{get:function get(){return ended}},paused:{get:function get(){return paused}},playing:{get:function get(){return playing}},sourceNode:{get:function get(){return createSourceNode()}}});return Object.freeze(api)}},{}],510:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=OscillatorSource;function OscillatorSource(type,context){var ended=false,paused=false,cuedAt=0,playing=false,sourceNode=null,startedAt=0,frequency=200,api=null;function createSourceNode(){if(!sourceNode&&context){sourceNode=context.createOscillator();sourceNode.type=type;sourceNode.frequency.value=frequency}return sourceNode}function play(delay){delay=delay||0;if(delay){delay=context.currentTime+delay}createSourceNode();sourceNode.start(delay);if(cuedAt){startedAt=context.currentTime-cuedAt}else{startedAt=context.currentTime}ended=false;playing=true;paused=false;cuedAt=0}function stop(){if(sourceNode){try{sourceNode.stop(0)}catch(e){}sourceNode=null}ended=true;paused=false;cuedAt=0;playing=false;startedAt=0}function pause(){var elapsed=context.currentTime-startedAt;stop();cuedAt=elapsed;playing=false;paused=true}function destroy(){stop();context=null;sourceNode=null}api={play:play,pause:pause,stop:stop,destroy:destroy};Object.defineProperties(api,{currentTime:{get:function get(){if(cuedAt){return cuedAt}if(startedAt){return context.currentTime-startedAt}return 0},set:function set(value){cuedAt=value}},duration:{value:0},ended:{get:function get(){return ended}},frequency:{get:function get(){return frequency},set:function set(value){frequency=value;if(sourceNode){sourceNode.frequency.value=value}}},paused:{get:function get(){return paused}},playing:{get:function get(){return playing}},progress:{value:0},sourceNode:{get:function get(){return createSourceNode()}}});return Object.freeze(api)}},{}],511:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=dummy;function dummy(context){var buffer=context.createBuffer(1,1,context.sampleRate);var source=context.createBufferSource();source.buffer=buffer;source.connect(context.destination);source.start(0);source.stop(0);source.disconnect()}},{}],512:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _events=require("events");var _events2=_interopRequireDefault(_events);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EventEmitter=_events2.default.EventEmitter;var Emitter=function(_EventEmitter){(0,_inherits3.default)(Emitter,_EventEmitter);function Emitter(){(0,_classCallCheck3.default)(this,Emitter);return(0,_possibleConstructorReturn3.default)(this,_EventEmitter.call(this))}Emitter.prototype.off=function off(type,listener){if(listener){return this.removeListener(type,listener)}if(type){return this.removeAllListeners(type)}return this.removeAllListeners()};return Emitter}(EventEmitter);exports.default=Emitter},{"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16,events:173}],513:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=FakeContext;function FakeContext(){var startTime=Date.now();function fn(){}function param(){return{value:1,defaultValue:1,linearRampToValueAtTime:fn,setValueAtTime:fn,exponentialRampToValueAtTime:fn,setTargetAtTime:fn,setValueCurveAtTime:fn,cancelScheduledValues:fn}}function fakeNode(){return{connect:fn,disconnect:fn,frequencyBinCount:0,smoothingTimeConstant:0,fftSize:0,minDecibels:0,maxDecibels:0,getByteTimeDomainData:fn,getByteFrequencyData:fn,getFloatTimeDomainData:fn,getFloatFrequencyData:fn,gain:param(),panningModel:0,setPosition:fn,setOrientation:fn,setVelocity:fn,distanceModel:0,refDistance:0,maxDistance:0,rolloffFactor:0,coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,type:0,frequency:param(),Q:param(),detune:param(),delayTime:param(),buffer:0,threshold:param(),knee:param(),ratio:param(),attack:param(),release:param(),reduction:param(),oversample:0,curve:0,sampleRate:1,length:0,duration:0,numberOfChannels:0,getChannelData:function getChannelData(){return[]},copyFromChannel:fn,copyToChannel:fn,dopplerFactor:0,speedOfSound:0,start:fn}}if(!window.Uint8Array){window.Uint8Array=window.Float32Array=Array}return{isFake:true,activeSourceCount:0,createAnalyser:fakeNode,createBuffer:fakeNode,createBufferSource:fakeNode,createMediaElementSource:fakeNode,createMediaStreamSource:fakeNode,createBiquadFilter:fakeNode,createChannelMerger:fakeNode,createChannelSplitter:fakeNode,createDynamicsCompressor:fakeNode,createConvolver:fakeNode,createDelay:fakeNode,createGain:fakeNode,createOscillator:fakeNode,createPanner:fakeNode,createScriptProcessor:fakeNode,createWaveShaper:fakeNode,decodeAudioData:fn,destination:fakeNode,listener:fakeNode(),sampleRate:44100,state:"",get currentTime(){return(Date.now()-startTime)/1e3}}}},{}],514:[function(require,module,exports){"use strict";exports.__esModule=true;var _typeof2=require("babel-runtime/helpers/typeof");var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var extensions=[];var canPlay={};var tests=[{ext:"ogg",type:'audio/ogg; codecs="vorbis"'},{ext:"mp3",type:"audio/mpeg;"},{ext:"opus",type:'audio/ogg; codecs="opus"'},{ext:"wav",type:'audio/wav; codecs="1"'},{ext:"m4a",type:"audio/x-m4a;"},{ext:"m4a",type:"audio/aac;"}];var el=document.createElement("audio");if(el){tests.forEach(function(test){var canPlayType=!!el.canPlayType(test.type);if(canPlayType&&extensions.indexOf(test.ext)===-1){extensions.push(test.ext)}canPlay[test.ext]=canPlayType});el=null}function getFileExtension(url){if(typeof url!=="string"){return""}if(url.slice(0,5)==="data:"){var match=url.match(/data:audio\/(ogg|mp3|opus|wav|m4a)/i);if(match&&match.length>1){return match[1].toLowerCase()}}url=url.split("?")[0];url=url.slice(url.lastIndexOf("/")+1);var a=url.split(".");if(a.length===1||a[0]===""&&a.length===2){return""}return a.pop().toLowerCase()}function getSupportedFile(fileNames){var name=void 0;if(Array.isArray(fileNames)){for(var i=0;i<fileNames.length;i++){name=fileNames[i];var ext=getFileExtension(name);if(extensions.indexOf(ext)>-1){break}}}else if((typeof fileNames==="undefined"?"undefined":(0,_typeof3.default)(fileNames))==="object"){Object.keys(fileNames).some(function(key){name=fileNames[key];var ext=getFileExtension(name);return extensions.indexOf(ext)>-1})}return name||fileNames}function isAudioBuffer(data){return!!(data&&window.AudioBuffer&&data instanceof window.AudioBuffer)}function isArrayBuffer(data){return!!(data&&window.ArrayBuffer&&data instanceof window.ArrayBuffer)}function isMediaElement(data){return!!(data&&window.HTMLMediaElement&&data instanceof window.HTMLMediaElement)}function isMediaStream(data){return!!(data&&typeof data.getAudioTracks==="function"&&data.getAudioTracks().length&&window.MediaStreamTrack&&data.getAudioTracks()[0]instanceof window.MediaStreamTrack)}function isOscillatorType(data){return!!(data&&typeof data==="string"&&(data==="sine"||data==="square"||data==="sawtooth"||data==="triangle"))}function isURL(data){return!!(data&&typeof data==="string"&&(data.indexOf(".")>-1||data.slice(0,5)==="data:"))}function containsURL(config){if(!config||isMediaElement(config)){return false}var src=getSrc(config);return isURL(src)||isArrayBuffer(src)||Array.isArray(src)&&isURL(src[0])}function getSrc(config){return config.src||config.url||config.data||config}exports.default={canPlay:canPlay,containsURL:containsURL,extensions:extensions,getFileExtension:getFileExtension,getSrc:getSrc,getSupportedFile:getSupportedFile,isAudioBuffer:isAudioBuffer,isArrayBuffer:isArrayBuffer,isMediaElement:isMediaElement,isMediaStream:isMediaStream,isOscillatorType:isOscillatorType,isURL:isURL}},{"babel-runtime/helpers/typeof":17}],515:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=navigator&&/Firefox/i.test(navigator.userAgent)},{}],516:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=navigator&&/(iPhone|iPad|iPod)/i.test(navigator.userAgent)},{}],517:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=isDefined;function isDefined(value){return typeof value!=="undefined"}},{}],518:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=isSafeNumber;function isSafeNumber(value){return typeof value==="number"&&!isNaN(value)&&isFinite(value)}},{}],519:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=Loader;var _emitter=require("./emitter");var _emitter2=_interopRequireDefault(_emitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ERROR_STATE=["","ABORTED","NETWORK","DECODE","SRC_NOT_SUPPORTED"];function Loader(url,deferLoad){var emitter=new _emitter2.default;var audioContext=null;var data=null;var isTouchLocked=false;var progress=0;var request=null;var timeout=null;function removeListeners(){emitter.off();if(data&&typeof data.removeEventListener==="function"){data.removeEventListener("load",readyHandler);data.removeEventListener("canplaythrough",readyHandler);data.removeEventListener("error",errorHandler);data.onerror=null}if(request){request.removeEventListener("progress",progressHandler);request.removeEventListener("load",loadHandler);request.removeEventListener("error",errorHandler)}}function dispatchComplete(buffer){emitter.emit("progress",1);emitter.emit("loaded",buffer);emitter.emit("complete",buffer);removeListeners()}function progressHandler(event){if(event.lengthComputable){progress=event.loaded/event.total;emitter.emit("progress",progress)}}function errorHandler(){cancelTimeout();var status="";if(request){status=request.status+" "+request.statusText}else if(data&&data.error){status=ERROR_STATE[data.error.code]}if(emitter.listenerCount("error")){emitter.emit("error",new Error("Load Error: "+status+" "+url))}removeListeners()}function cancelTimeout(){window.clearTimeout(timeout)}function decodeArrayBuffer(arraybuffer){audioContext.decodeAudioData(arraybuffer,function(buffer){data=buffer;request=null;progress=1;dispatchComplete(buffer)},errorHandler)}function loadHandler(){if(request.status>=400){errorHandler();return}decodeArrayBuffer(request.response)}function readyHandler(){cancelTimeout();if(!data){return}if(!data.readyState){errorHandler();return}progress=1;dispatchComplete(data)}function cancel(){cancelTimeout();removeListeners();if(request&&request.readyState!==4){request.abort()}request=null}function destroy(){cancel();request=null;data=null;audioContext=null}function loadArrayBuffer(){if(url instanceof window.ArrayBuffer){decodeArrayBuffer(url);return}request=new XMLHttpRequest;request.open("GET",url,true);request.responseType="arraybuffer";request.addEventListener("progress",progressHandler);request.addEventListener("load",loadHandler);request.addEventListener("error",errorHandler);request.send()}function loadAudioElement(){if(!data||!data.tagName){data=document.createElement("audio")}if(!isTouchLocked){cancelTimeout();timeout=window.setTimeout(readyHandler,3e3);data.addEventListener("canplaythrough",readyHandler,false);data.addEventListener("load",readyHandler,false)}data.addEventListener("error",errorHandler,false);data.preload="auto";data.onerror=errorHandler;data.src=url;data.load();if(isTouchLocked){dispatchComplete(data)}}function start(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!url||deferLoad&&!force){return}if(audioContext){loadArrayBuffer()}else{loadAudioElement()}}function load(newUrl){url=newUrl;start()}var api={on:emitter.on.bind(emitter),once:emitter.once.bind(emitter),off:emitter.off.bind(emitter),load:load,start:start,cancel:cancel,destroy:destroy};Object.defineProperties(api,{data:{get:function get(){return data}},progress:{get:function get(){return progress}},audioContext:{set:function set(value){audioContext=value}},isTouchLocked:{set:function set(value){isTouchLocked=value}},url:{get:function get(){return url}}});return Object.freeze(api)}Loader.Group=function(){var emitter=new _emitter2.default;var queue=[];var numLoaded=0;var numTotal=0;var currentLoader=null;function progressHandler(progress){var loaded=numLoaded+progress;emitter.emit("progress",loaded/numTotal)}function completeHandler(){numLoaded++;removeListeners();emitter.emit("progress",numLoaded/numTotal);next()}function errorHandler(e){removeListeners();if(emitter.listenerCount("error")){emitter.emit("error",e)}next()}function next(){if(queue.length===0){currentLoader=null;emitter.emit("complete");return}currentLoader=queue.pop();currentLoader.on("progress",progressHandler);currentLoader.once("loaded",completeHandler);currentLoader.once("error",errorHandler);currentLoader.start()}function removeListeners(){currentLoader.off("progress",progressHandler);currentLoader.off("loaded",completeHandler);currentLoader.off("error",errorHandler)}function add(loader){queue.push(loader);numTotal++;return loader}function start(){numTotal=queue.length;next()}return Object.freeze({on:emitter.on.bind(emitter),once:emitter.once.bind(emitter),off:emitter.off.bind(emitter),add:add,start:start})}},{"./emitter":512}],520:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=log;function log(api){var title="sono "+api.VERSION,info="Supported:"+api.isSupported+" WebAudioAPI:"+api.hasWebAudio+" TouchLocked:"+api.isTouchLocked+" State:"+(api.context&&api.context.state)+" Extensions:"+api.file.extensions;if(navigator.userAgent.indexOf("Chrome")>-1){var args=["%c ♫ "+title+" ♫ %c "+info+" ","color: #FFFFFF; background: #379F7A","color: #1F1C0D; background: #E0FBAC"];console.log.apply(console,args)}else if(window.console&&window.console.log.call){console.log.call(console,title+" "+info)}}},{}],521:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=pageVisibility;function pageVisibility(onHidden,onShown){var enabled=false;var hidden=null;var visibilityChange=null;if(typeof document.hidden!=="undefined"){hidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.mozHidden!=="undefined"){hidden="mozHidden";visibilityChange="mozvisibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"}function onChange(){if(document[hidden]){onHidden()}else{onShown()}}function enable(value){enabled=value;if(enabled){document.addEventListener(visibilityChange,onChange,false)}else{document.removeEventListener(visibilityChange,onChange)}}if(typeof visibilityChange!=="undefined"){enable(true)}return{get enabled(){return enabled},set enabled(value){enable(value)}}}},{}],522:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=SoundGroup;var _group=require("../group");var _group2=_interopRequireDefault(_group);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SoundGroup(context,destination){var group=new _group2.default(context,destination);var sounds=group.sounds;var playbackRate=1,loop=false,src=void 0;function getSource(){if(!sounds.length){return}src=sounds.slice(0).sort(function(a,b){return b.duration-a.duration})[0]}var add=group.add;group.add=function(sound){add(sound);getSource();return group};var remove=group.rmeove;group.remove=function(soundOrId){remove(soundOrId);getSource();return group};Object.defineProperties(group,{currentTime:{get:function get(){return src?src.currentTime:0},set:function set(value){this.stop();this.play(0,value)}},duration:{get:function get(){return src?src.duration:0}},loop:{get:function get(){return loop},set:function set(value){loop=!!value;sounds.forEach(function(sound){sound.loop=loop})}},paused:{get:function get(){return!!src&&src.paused}},progress:{get:function get(){return src?src.progress:0}},playbackRate:{get:function get(){return playbackRate},set:function set(value){playbackRate=value;sounds.forEach(function(sound){sound.playbackRate=playbackRate})}},playing:{get:function get(){return!!src&&src.playing}}});return group}},{"../group":503}],523:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=touchLock;var _iOS=require("./iOS");var _iOS2=_interopRequireDefault(_iOS);var _dummy=require("./dummy");var _dummy2=_interopRequireDefault(_dummy);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function touchLock(context,callback){var locked=_iOS2.default;function unlock(){if(context&&context.state==="suspended"){context.resume().then(function(){(0,_dummy2.default)(context);unlocked()})}else{unlocked()}}function unlocked(){document.body.removeEventListener("touchstart",unlock);document.body.removeEventListener("touchend",unlock);callback()}function addListeners(){document.body.addEventListener("touchstart",unlock,false);document.body.addEventListener("touchend",unlock,false)}if(locked){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",addListeners)}else{addListeners()}}return locked}},{"./dummy":511,"./iOS":516}],524:[function(require,module,exports){"use strict";exports.__esModule=true;var _context=require("../context");var _context2=_interopRequireDefault(_context);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var offlineCtx=void 0;function getOfflineContext(numOfChannels,length,sampleRate){if(offlineCtx){return offlineCtx}numOfChannels=numOfChannels||2;sampleRate=sampleRate||44100;length=sampleRate||numOfChannels;var OfflineCtx=window.OfflineAudioContext||window.webkitOfflineAudioContext;offlineCtx=OfflineCtx?new OfflineCtx(numOfChannels,length,sampleRate):null;return offlineCtx}function cloneBuffer(buffer){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:buffer.length;if(!_context2.default||_context2.default.isFake){return buffer}var numChannels=buffer.numberOfChannels;var cloned=_context2.default.createBuffer(numChannels,length,buffer.sampleRate);for(var i=0;i<numChannels;i++){cloned.getChannelData(i).set(buffer.getChannelData(i).slice(offset,offset+length))}return cloned}function reverseBuffer(buffer){var numChannels=buffer.numberOfChannels;for(var i=0;i<numChannels;i++){Array.prototype.reverse.call(buffer.getChannelData(i))}return buffer}function ramp(param,fromValue,toValue,duration,linear){if(_context2.default.isFake){return}param.setValueAtTime(fromValue,_context2.default.currentTime);if(linear){param.linearRampToValueAtTime(toValue,_context2.default.currentTime+duration)}else{param.exponentialRampToValueAtTime(toValue,_context2.default.currentTime+duration)}}function getFrequency(value){if(_context2.default.isFake){return 0}var minValue=40;var maxValue=_context2.default.sampleRate/2;var numberOfOctaves=Math.log(maxValue/minValue)/Math.LN2;var multiplier=Math.pow(2,numberOfOctaves*(value-1));return maxValue*multiplier}function timeCode(seconds){var delim=arguments.length>1&&arguments[1]!==undefined?arguments[1]:":";var m=Math.floor(seconds/60);var s=Math.floor(seconds%3600%60);var mn=(m<10?"0"+m:m)+delim;var sc=s<10?"0"+s:s;return mn+sc}exports.default={getOfflineContext:getOfflineContext,cloneBuffer:cloneBuffer,reverseBuffer:reverseBuffer,ramp:ramp,getFrequency:getFrequency,timeCode:timeCode}},{"../context":501}],525:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _context=require("../core/context");var _context2=_interopRequireDefault(_context);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AbstractDirectEffect=function(){function AbstractDirectEffect(node){(0,_classCallCheck3.default)(this,AbstractDirectEffect);this._node=this._in=this._out=node}AbstractDirectEffect.prototype.connect=function connect(node){this._node.connect(node._in||node)};AbstractDirectEffect.prototype.disconnect=function disconnect(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._node.disconnect(args)};AbstractDirectEffect.prototype.update=function update(){throw new Error("update must be overridden")};(0,_createClass3.default)(AbstractDirectEffect,[{key:"context",get:function get(){return _context2.default}},{key:"numberOfInputs",get:function get(){return 1}},{key:"numberOfOutputs",get:function get(){return 1}},{key:"channelCount",get:function get(){return 1}},{key:"channelCountMode",get:function get(){return"max"}},{key:"channelInterpretation",get:function get(){return"speakers"}}]);return AbstractDirectEffect}();exports.default=AbstractDirectEffect},{"../core/context":501,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13}],526:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _context=require("../core/context");var _context2=_interopRequireDefault(_context);var _isSafeNumber=require("../core/utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AbstractEffect=function(){function AbstractEffect(){var node=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var nodeOut=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var enabled=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;(0,_classCallCheck3.default)(this,AbstractEffect);this._node=node;this._nodeOut=nodeOut||node;this._enabled;this._in=this.context.createGain();this._out=this.context.createGain();this._wet=this.context.createGain();this._dry=this.context.createGain();this._in.connect(this._dry);this._wet.connect(this._out);this._dry.connect(this._out);this.enable(enabled)}AbstractEffect.prototype.enable=function enable(b){if(b===this._enabled){return}this._enabled=b;this._in.disconnect();if(b){this._in.connect(this._dry);this._in.connect(this._node);this._nodeOut.connect(this._wet)}else{this._nodeOut.disconnect();this._in.connect(this._out)}};AbstractEffect.prototype.connect=function connect(node){this._out.connect(node._in||node)};AbstractEffect.prototype.disconnect=function disconnect(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._out.disconnect(args)};AbstractEffect.prototype.setSafeParamValue=function setSafeParamValue(param,value){if(!(0,_isSafeNumber2.default)(value)){console.warn(this,"Attempt to set invalid value "+value+" on AudioParam");return}param.value=value};AbstractEffect.prototype.update=function update(){throw new Error("update must be overridden")};(0,_createClass3.default)(AbstractEffect,[{key:"wet",get:function get(){return this._wet.gain.value},set:function set(value){this.setSafeParamValue(this._wet.gain,value)}},{key:"dry",get:function get(){return this._dry.gain.value},set:function set(value){this.setSafeParamValue(this._dry.gain,value)}},{key:"context",get:function get(){return _context2.default}},{key:"numberOfInputs",get:function get(){return 1}},{key:"numberOfOutputs",get:function get(){return 1}},{key:"channelCount",get:function get(){return 1}},{key:"channelCountMode",get:function get(){return"max"}},{key:"channelInterpretation",get:function get(){return"speakers"}}]);return AbstractEffect}();exports.default=AbstractEffect},{"../core/context":501,"../core/utils/isSafeNumber":518,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13}],527:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractDirectEffect=require("./abstract-direct-effect");var _abstractDirectEffect2=_interopRequireDefault(_abstractDirectEffect);var _isSafeNumber=require("../core/utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function noteFromPitch(frequency){var noteNum=12*(Math.log(frequency/440)*Math.LOG2E);return Math.round(noteNum)+69}function frequencyFromNoteNumber(note){return 440*Math.pow(2,(note-69)/12)}function centsOffFromPitch(frequency,note){return Math.floor(1200*Math.log(frequency/frequencyFromNoteNumber(note))*Math.LOG2E)}var Analyser=function(_AbstractDirectEffect){(0,_inherits3.default)(Analyser,_AbstractDirectEffect);function Analyser(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$fftSize=_ref.fftSize,fftSize=_ref$fftSize===undefined?2048:_ref$fftSize,_ref$minDecibels=_ref.minDecibels,minDecibels=_ref$minDecibels===undefined?-100:_ref$minDecibels,_ref$maxDecibels=_ref.maxDecibels,maxDecibels=_ref$maxDecibels===undefined?-30:_ref$maxDecibels,_ref$smoothing=_ref.smoothing,smoothing=_ref$smoothing===undefined?.9:_ref$smoothing,_ref$useFloats=_ref.useFloats,useFloats=_ref$useFloats===undefined?false:_ref$useFloats;(0,_classCallCheck3.default)(this,Analyser);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractDirectEffect.call(this,_sono2.default.context.createAnalyser()));_this._useFloats=!!useFloats;_this._waveform=null;_this._frequencies=null;_this._node.fftSize=fftSize;_this.update({minDecibels:minDecibels,maxDecibels:maxDecibels,smoothing:smoothing});return _this}Analyser.prototype.update=function update(_ref2){var minDecibels=_ref2.minDecibels,maxDecibels=_ref2.maxDecibels,smoothing=_ref2.smoothing;if((0,_isSafeNumber2.default)(smoothing)){this._node.smoothingTimeConstant=smoothing}if((0,_isSafeNumber2.default)(minDecibels)){this._node.minDecibels=minDecibels}if((0,_isSafeNumber2.default)(maxDecibels)){this._node.maxDecibels=maxDecibels}};Analyser.prototype.getWaveform=function getWaveform(){var useFloats=this._useFloats&&this._node.getFloatTimeDomainData;if(!this._waveform){this._waveform=this._createArray(useFloats,this._node.fftSize)}if(useFloats){this._node.getFloatTimeDomainData(this._waveform)}else{this._node.getByteTimeDomainData(this._waveform)}return this._waveform};Analyser.prototype.getFrequencies=function getFrequencies(){var useFloats=this._useFloats&&this._node.getFloatFrequencyData;if(!this._frequencies){this._frequencies=this._createArray(useFloats,this._node.frequencyBinCount)}if(useFloats){this._node.getFloatFrequencyData(this._frequencies)}else{this._node.getByteFrequencyData(this._frequencies)}return this._frequencies};Analyser.prototype.getAmplitude=function getAmplitude(callback){if(!this._amplitudeWorker){this._createAmplitudeAnalyser()}this._amplitudeCallback=callback||this._amplitudeCallback;var f=new Float32Array(this._node.fftSize);f.set(this.getFrequencies(true));this._amplitudeWorker.postMessage({sum:0,length:f.byteLength,numSamples:this._node.fftSize/2,b:f.buffer},[f.buffer])};Analyser.prototype.getPitch=function getPitch(callback){if(!this._pitchWorker){this._createPitchAnalyser()}this._pitchCallback=callback||this._pitchCallback;var f=new Float32Array(this._node.fftSize);f.set(this.getWaveform(true));this._pitchWorker.postMessage({sampleRate:_sono2.default.context.sampleRate,b:f.buffer},[f.buffer])};Analyser.prototype._createArray=function _createArray(useFloats,length){return useFloats?new Float32Array(length):new Uint8Array(length)};Analyser.prototype._createAmplitudeAnalyser=function _createAmplitudeAnalyser(){var _this2=this;var amplitudeBlob=new Blob(["onmessage = function(e) {\n                var data = e.data;\n                var f = new Float32Array(data.b);\n                for (var i = 0; i < f.length; i++) {\n                    data.sum += f[i];\n                }\n                data.sum /= f.length;\n                postMessage(Math.max(1.0 - (data.sum / data.numSamples * -1.0), 0));\n            };"]);var amplitudeBlobURL=URL.createObjectURL(amplitudeBlob);this._amplitudeWorker=new Worker(amplitudeBlobURL);this._amplitudeWorker.onmessage=function(event){if(!_this2._amplitudeCallback){return}_this2._amplitudeCallback(event.data)}};Analyser.prototype._createPitchAnalyser=function _createPitchAnalyser(){var _this3=this;var pitchBlob=new Blob(["onmessage = function(e) {\n                var data = e.data;\n                var sampleRate = data.sampleRate;\n                var buf = new Float32Array(data.b);\n                var SIZE = buf.length;\n                var MAX_SAMPLES = Math.floor(SIZE / 2);\n                var bestOffset = -1;\n                var bestCorrel = 0;\n                var rms = 0;\n                var foundGoodCorrelation = false;\n                var correls = new Array(MAX_SAMPLES);\n                for (var i = 0; i < SIZE; i++) {\n                    var val = buf[i];\n                    rms += val * val;\n                }\n                rms = Math.sqrt(rms / SIZE);\n                if (rms < 0.01) {\n                    postMessage(-1);\n                } else {\n                    var lastCorrelation = 1;\n                    for (var offset = 0; offset < MAX_SAMPLES; offset++) {\n                        var correl = 0;\n                        for (var i = 0; i < MAX_SAMPLES; i++) {\n                            correl += Math.abs(buf[i] - buf[i + offset]);\n                        }\n                        correl = 1 - correl / MAX_SAMPLES;\n                        correls[offset] = correl;\n                        if (correl > 0.9 && correl > lastCorrelation) {\n                            foundGoodCorrelation = true;\n                            if (correl > bestCorrel) {\n                                bestCorrel = correl;\n                                bestOffset = offset;\n                            }\n                        } else if (foundGoodCorrelation) {\n                            var shift = (correls[bestOffset + 1] - correls[bestOffset - 1]) / correls[bestOffset];\n                            postMessage(sampleRate / (bestOffset + 8 * shift));\n                        }\n                        lastCorrelation = correl;\n                    }\n                    if (bestCorrel > 0.01) {\n                        postMessage(sampleRate / bestOffset);\n                    } else {\n                        postMessage(-1);\n                    }\n                }\n            };"]);var pitchBlobURL=URL.createObjectURL(pitchBlob);this._pitchWorker=new Worker(pitchBlobURL);var noteStrings=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var pitchCallbackObject={hertz:0,note:"",noteIndex:0,detuneCents:0,detune:""};this._pitchWorker.onmessage=function(event){if(!_this3._pitchCallback){return}var hz=event.data;if(hz!==-1){var note=noteFromPitch(hz);var detune=centsOffFromPitch(hz,note);pitchCallbackObject.hertz=hz;pitchCallbackObject.noteIndex=note%12;pitchCallbackObject.note=noteStrings[note%12];pitchCallbackObject.detuneCents=detune;if(detune===0){pitchCallbackObject.detune=""}else if(detune<0){pitchCallbackObject.detune="flat"}else{pitchCallbackObject.detune="sharp"}}_this3._pitchCallback(pitchCallbackObject)}};(0,_createClass3.default)(Analyser,[{key:"frequencyBinCount",get:function get(){return this._node.frequencyBinCount}},{key:"maxDecibels",get:function get(){return this._node.maxDecibels},set:function set(value){if((0,_isSafeNumber2.default)(value)){this._node.maxDecibels=value}}},{key:"minDecibels",get:function get(){return this._node.minDecibels},set:function set(value){if((0,_isSafeNumber2.default)(value)){this._node.minDecibels=value}}},{key:"smoothing",get:function get(){return this._node.smoothingTimeConstant},set:function set(value){if((0,_isSafeNumber2.default)(value)){this._node.smoothingTimeConstant=value}}}]);return Analyser}(_abstractDirectEffect2.default);exports.default=_sono2.default.register("analyser",function(opts){return new Analyser(opts)})},{"../core/sono":504,"../core/utils/isSafeNumber":518,"./abstract-direct-effect":525,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],528:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Compressor=function(_AbstractEffect){(0,_inherits3.default)(Compressor,_AbstractEffect);function Compressor(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$attack=_ref.attack,attack=_ref$attack===undefined?.003:_ref$attack,_ref$knee=_ref.knee,knee=_ref$knee===undefined?30:_ref$knee,_ref$ratio=_ref.ratio,ratio=_ref$ratio===undefined?12:_ref$ratio,_ref$release=_ref.release,release=_ref$release===undefined?.25:_ref$release,_ref$threshold=_ref.threshold,threshold=_ref$threshold===undefined?-24:_ref$threshold,_ref$wet=_ref.wet,wet=_ref$wet===undefined?1:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?1:_ref$dry;(0,_classCallCheck3.default)(this,Compressor);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createDynamicsCompressor()));_this.wet=wet;_this.dry=dry;_this.update({threshold:threshold,knee:knee,ratio:ratio,attack:attack,release:release});return _this}Compressor.prototype.update=function update(options){this.setSafeParamValue(this._node.threshold,options.threshold);this.setSafeParamValue(this._node.knee,options.knee);this.setSafeParamValue(this._node.ratio,options.ratio);this.setSafeParamValue(this._node.attack,options.attack);this.setSafeParamValue(this._node.release,options.release)};(0,_createClass3.default)(Compressor,[{key:"threshold",get:function get(){return this._node.threshold.value},set:function set(value){this.setSafeParamValue(this._node.threshold,value)}},{key:"knee",get:function get(){return this._node.knee.value},set:function set(value){this.setSafeParamValue(this._node.knee,value)}},{key:"ratio",get:function get(){return this._node.ratio.value},set:function set(value){this.setSafeParamValue(this._node.ratio,value)}},{key:"attack",get:function get(){return this._node.attack.value},set:function set(value){this.setSafeParamValue(this._node.attack,value)}},{key:"release",get:function get(){return this._node.release.value},set:function set(value){this.setSafeParamValue(this._node.release,value)}}]);return Compressor}(_abstractEffect2.default);exports.default=_sono2.default.register("compressor",function(opts){return new Compressor(opts)})},{"../core/sono":504,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],529:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);var _file=require("../core/utils/file");var _file2=_interopRequireDefault(_file);var _loader=require("../core/utils/loader");var _loader2=_interopRequireDefault(_loader);var _sound=require("../core/sound");var _sound2=_interopRequireDefault(_sound);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Convolver=function(_AbstractEffect){(0,_inherits3.default)(Convolver,_AbstractEffect);function Convolver(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},impulse=_ref.impulse,_ref$wet=_ref.wet,wet=_ref$wet===undefined?1:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?1:_ref$dry;(0,_classCallCheck3.default)(this,Convolver);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createConvolver(),null,false));_this._loader=null;_this.wet=wet;_this.dry=dry;_this.update({impulse:impulse});return _this}Convolver.prototype._load=function _load(src){var _this2=this;if(_sono2.default.context.isFake){return}if(this._loader){this._loader.destroy()}this._loader=new _loader2.default(src);this._loader.audioContext=_sono2.default.context;this._loader.once("complete",function(impulse){return _this2.update({impulse:impulse})});this._loader.once("error",function(error){return console.error(error)});this._loader.start()};Convolver.prototype.update=function update(_ref2){var _this3=this;var impulse=_ref2.impulse;if(!impulse){return this}if(_file2.default.isAudioBuffer(impulse)){this._node.buffer=impulse;this.enable(true);return this}if(impulse instanceof _sound2.default){if(impulse.data){this.update({impulse:impulse.data})}else{impulse.once("ready",function(sound){return _this3.update({impulse:sound.data})})}return this}if(_file2.default.isArrayBuffer(impulse)){this._load(impulse);return this}if(_file2.default.isURL(_file2.default.getSupportedFile(impulse))){this._load(_file2.default.getSupportedFile(impulse))}return this};(0,_createClass3.default)(Convolver,[{key:"impulse",get:function get(){return this._node.buffer},set:function set(impulse){this.update({impulse:impulse})}}]);return Convolver}(_abstractEffect2.default);exports.default=_sono2.default.register("convolver",function(opts){return new Convolver(opts)})},{"../core/sono":504,"../core/sound":505,"../core/utils/file":514,"../core/utils/loader":519,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],530:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _isSafeNumber=require("../core/utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Distortion=function(_AbstractEffect){(0,_inherits3.default)(Distortion,_AbstractEffect);function Distortion(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$level=_ref.level,level=_ref$level===undefined?1:_ref$level,_ref$samples=_ref.samples,samples=_ref$samples===undefined?22050:_ref$samples,_ref$oversample=_ref.oversample,oversample=_ref$oversample===undefined?"none":_ref$oversample,_ref$wet=_ref.wet,wet=_ref$wet===undefined?1:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?0:_ref$dry;(0,_classCallCheck3.default)(this,Distortion);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createWaveShaper(),null,false));_this._node.oversample=oversample||"none";_this._samples=samples||22050;_this._curve=new Float32Array(_this._samples);_this._level;_this._enabled=false;_this.wet=wet;_this.dry=dry;_this.update({level:level});return _this}Distortion.prototype.update=function update(_ref2){var level=_ref2.level;if(level===this._level||!(0,_isSafeNumber2.default)(level)){return}this.enable(level>0);if(!this._enabled){return}var k=level*100;var deg=Math.PI/180;var y=2/this._samples;var x=void 0;for(var i=0;i<this._samples;++i){x=i*y-1;this._curve[i]=(3+k)*x*20*deg/(Math.PI+k*Math.abs(x))}this._level=level;this._node.curve=this._curve};(0,_createClass3.default)(Distortion,[{key:"level",get:function get(){return this._level},set:function set(level){this.update({level:level})}}]);return Distortion}(_abstractEffect2.default);exports.default=_sono2.default.register("distortion",function(opts){return new Distortion(opts)})},{"../core/sono":504,"../core/utils/isSafeNumber":518,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],531:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Echo=function(_AbstractEffect){(0,_inherits3.default)(Echo,_AbstractEffect);function Echo(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$delay=_ref.delay,delay=_ref$delay===undefined?.5:_ref$delay,_ref$feedback=_ref.feedback,feedback=_ref$feedback===undefined?.5:_ref$feedback,_ref$wet=_ref.wet,wet=_ref$wet===undefined?1:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?1:_ref$dry;(0,_classCallCheck3.default)(this,Echo);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createDelay(),_sono2.default.context.createGain()));_this._delay=_this._node;_this._feedback=_this._nodeOut;_this._delay.connect(_this._feedback);_this._feedback.connect(_this._delay);_this.wet=wet;_this.dry=dry;_this.update({delay:delay,feedback:feedback});return _this}Echo.prototype.enable=function enable(value){_AbstractEffect.prototype.enable.call(this,value);if(this._feedback&&value){this._feedback.connect(this._delay)}};Echo.prototype.update=function update(options){this.delay=options.delay;this.feedback=options.feedback};(0,_createClass3.default)(Echo,[{key:"delay",get:function get(){return this._delay.delayTime.value},set:function set(value){this.setSafeParamValue(this._delay.delayTime,value)}},{key:"feedback",get:function get(){return this._feedback.gain.value},set:function set(value){this.setSafeParamValue(this._feedback.gain,value)}}]);return Echo}(_abstractEffect2.default);exports.default=_sono2.default.register("echo",function(opts){return new Echo(opts)})},{"../core/sono":504,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],532:[function(require,module,exports){"use strict";exports.__esModule=true;exports.allpass=exports.notch=exports.peaking=exports.highshelf=exports.lowshelf=exports.bandpass=exports.highpass=exports.lowpass=undefined;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);var _isSafeNumber=require("../core/utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function safeOption(){var value=null;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<args.length;i++){if((0,_isSafeNumber2.default)(args[i])){value=args[i];break}}return value}var minFrequency=40;var maxFrequency=_sono2.default.context.sampleRate/2;function getFrequency(value){var numberOfOctaves=Math.log(maxFrequency/minFrequency)/Math.LN2;var multiplier=Math.pow(2,numberOfOctaves*(value-1));return maxFrequency*multiplier}var Filter=function(_AbstractEffect){(0,_inherits3.default)(Filter,_AbstractEffect);function Filter(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$type=_ref.type,type=_ref$type===undefined?"lowpass":_ref$type,_ref$frequency=_ref.frequency,frequency=_ref$frequency===undefined?1e3:_ref$frequency,_ref$detune=_ref.detune,detune=_ref$detune===undefined?0:_ref$detune,_ref$q=_ref.q,q=_ref$q===undefined?0:_ref$q,_ref$gain=_ref.gain,gain=_ref$gain===undefined?1:_ref$gain,_ref$peak=_ref.peak,peak=_ref$peak===undefined?0:_ref$peak,_ref$boost=_ref.boost,boost=_ref$boost===undefined?0:_ref$boost,_ref$width=_ref.width,width=_ref$width===undefined?100:_ref$width,_ref$sharpness=_ref.sharpness,sharpness=_ref$sharpness===undefined?0:_ref$sharpness,_ref$wet=_ref.wet,wet=_ref$wet===undefined?1:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?0:_ref$dry;(0,_classCallCheck3.default)(this,Filter);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createBiquadFilter()));_this._node.type=type;_this.wet=wet;_this.dry=dry;_this.update({frequency:frequency,gain:gain,detune:detune,q:q,peak:peak,boost:boost,width:width,sharpness:sharpness});return _this}Filter.prototype.update=function update(options){this.setSafeParamValue(this._node.frequency,options.frequency);this.setSafeParamValue(this._node.gain,safeOption(options.boost,options.gain));this.setSafeParamValue(this._node.detune,options.detune);var q=safeOption(options.peak,options.width,options.sharpness,options.q);this.setSafeParamValue(this._node.Q,q)};Filter.prototype.setByPercent=function setByPercent(_ref2){var _ref2$percent=_ref2.percent,percent=_ref2$percent===undefined?.5:_ref2$percent;this.update({frequency:getFrequency(percent)})};(0,_createClass3.default)(Filter,[{key:"type",get:function get(){return this._node.type},set:function set(value){this._node.type=value}},{key:"frequency",get:function get(){return this._node.frequency.value},set:function set(value){this.setSafeParamValue(this._node.frequency,value)}},{key:"q",get:function get(){return this._node.Q.value},set:function set(value){this.setSafeParamValue(this._node.Q,value)}},{key:"Q",get:function get(){return this.q},set:function set(value){this.q=value}},{key:"peak",get:function get(){return this.q},set:function set(value){this.q=value}},{key:"width",get:function get(){return this._node.frequency.value/this._node.Q.value},set:function set(value){if(value<=0){this.q=0;return}this.q=this._node.frequency.value/value}},{key:"sharpness",get:function get(){return this.q},set:function set(value){this.q=value}},{key:"boost",get:function get(){return this._node.gain.value},set:function set(value){this.setSafeParamValue(this._node.gain,value)}},{key:"gain",get:function get(){return this.boost},set:function set(value){this.boost=value}},{key:"detune",get:function get(){return this._node.detune.value},set:function set(value){this.setSafeParamValue(this._node.detune,value)}},{key:"maxFrequency",get:function get(){return _sono2.default.context.sampleRate/2}}]);return Filter}(_abstractEffect2.default);var lowpass=_sono2.default.register("lowpass",function(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref3.frequency,peak=_ref3.peak,q=_ref3.q;return new Filter({type:"lowpass",frequency:frequency,peak:peak,q:q})});var highpass=_sono2.default.register("highpass",function(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref4.frequency,peak=_ref4.peak,q=_ref4.q;return new Filter({type:"highpass",frequency:frequency,peak:peak,q:q})});var lowshelf=_sono2.default.register("lowshelf",function(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref5.frequency,boost=_ref5.boost,gain=_ref5.gain;return new Filter({type:"lowshelf",frequency:frequency,boost:boost,gain:gain,q:0})});var highshelf=_sono2.default.register("highshelf",function(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref6.frequency,boost=_ref6.boost,gain=_ref6.gain;return new Filter({type:"highshelf",frequency:frequency,boost:boost,gain:gain,q:0})});var peaking=_sono2.default.register("peaking",function(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref7.frequency,width=_ref7.width,boost=_ref7.boost,gain=_ref7.gain,q=_ref7.q;return new Filter({type:"peaking",frequency:frequency,width:width,boost:boost,gain:gain,q:q})});var bandpass=_sono2.default.register("bandpass",function(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref8.frequency,width=_ref8.width,q=_ref8.q;return new Filter({type:"bandpass",frequency:frequency,width:width,q:q})});var notch=_sono2.default.register("notch",function(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref9.frequency,width=_ref9.width,gain=_ref9.gain,q=_ref9.q;return new Filter({type:"notch",frequency:frequency,width:width,gain:gain,q:q})});var allpass=_sono2.default.register("allpass",function(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},frequency=_ref10.frequency,sharpness=_ref10.sharpness,q=_ref10.q;return new Filter({type:"allpass",frequency:frequency,sharpness:sharpness,q:q})});exports.default=_sono2.default.register("filter",function(opts){return new Filter(opts)});exports.lowpass=lowpass;exports.highpass=highpass;exports.bandpass=bandpass;exports.lowshelf=lowshelf;exports.highshelf=highshelf;exports.peaking=peaking;exports.notch=notch;exports.allpass=allpass},{"../core/sono":504,"../core/utils/isSafeNumber":518,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],533:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MonoFlanger=function(_AbstractEffect){(0,_inherits3.default)(MonoFlanger,_AbstractEffect);function MonoFlanger(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$delay=_ref.delay,delay=_ref$delay===undefined?.005:_ref$delay,_ref$feedback=_ref.feedback,feedback=_ref$feedback===undefined?.5:_ref$feedback,_ref$frequency=_ref.frequency,frequency=_ref$frequency===undefined?.002:_ref$frequency,_ref$gain=_ref.gain,gain=_ref$gain===undefined?.25:_ref$gain,_ref$wet=_ref.wet,wet=_ref$wet===undefined?1:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?1:_ref$dry;(0,_classCallCheck3.default)(this,MonoFlanger);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createDelay()));_this._delay=_this._node;_this._feedback=_sono2.default.context.createGain();_this._lfo=_sono2.default.context.createOscillator();_this._gain=_sono2.default.context.createGain();_this._lfo.type="sine";_this._delay.connect(_this._feedback);_this._feedback.connect(_this._in);_this._lfo.connect(_this._gain);_this._gain.connect(_this._delay.delayTime);_this._lfo.start(0);_this.wet=wet;_this.dry=dry;_this.update({delay:delay,feedback:feedback,frequency:frequency,gain:gain});return _this}MonoFlanger.prototype.update=function update(options){this.delay=options.delay;this.frequency=options.frequency;this.gain=options.gain;this.feedback=options.feedback};(0,_createClass3.default)(MonoFlanger,[{key:"delay",get:function get(){return this._delay.delayTime.value},set:function set(value){this.setSafeParamValue(this._delay.delayTime,value)}},{key:"frequency",get:function get(){return this._lfo.frequency.value},set:function set(value){this.setSafeParamValue(this._lfo.frequency,value)}},{key:"gain",get:function get(){return this._gain.gain.value},set:function set(value){this.setSafeParamValue(this._gain.gain,value)}},{key:"feedback",get:function get(){return this._feedback.gain.value},set:function set(value){this.setSafeParamValue(this._feedback.gain,value)}}]);return MonoFlanger}(_abstractEffect2.default);_sono2.default.register("monoFlanger",function(opts){return new MonoFlanger(opts)});var StereoFlanger=function(_AbstractEffect2){(0,_inherits3.default)(StereoFlanger,_AbstractEffect2);function StereoFlanger(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$delay=_ref2.delay,delay=_ref2$delay===undefined?.003:_ref2$delay,_ref2$feedback=_ref2.feedback,feedback=_ref2$feedback===undefined?.5:_ref2$feedback,_ref2$frequency=_ref2.frequency,frequency=_ref2$frequency===undefined?.5:_ref2$frequency,_ref2$gain=_ref2.gain,gain=_ref2$gain===undefined?.005:_ref2$gain,_ref2$wet=_ref2.wet,wet=_ref2$wet===undefined?1:_ref2$wet,_ref2$dry=_ref2.dry,dry=_ref2$dry===undefined?1:_ref2$dry;(0,_classCallCheck3.default)(this,StereoFlanger);var _this2=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect2.call(this,_sono2.default.context.createChannelSplitter(2),_sono2.default.context.createChannelMerger(2)));_this2._splitter=_this2._node;_this2._merger=_this2._nodeOut;_this2._feedbackL=_sono2.default.context.createGain();_this2._feedbackR=_sono2.default.context.createGain();_this2._lfo=_sono2.default.context.createOscillator();_this2._lfoGainL=_sono2.default.context.createGain();_this2._lfoGainR=_sono2.default.context.createGain();_this2._delayL=_sono2.default.context.createDelay();_this2._delayR=_sono2.default.context.createDelay();_this2._lfo.type="sine";_this2._splitter.connect(_this2._delayL,0);_this2._splitter.connect(_this2._delayR,1);_this2._delayL.connect(_this2._feedbackL);_this2._delayR.connect(_this2._feedbackR);_this2._feedbackL.connect(_this2._delayR);_this2._feedbackR.connect(_this2._delayL);_this2._delayL.connect(_this2._merger,0,0);_this2._delayR.connect(_this2._merger,0,1);_this2._lfo.connect(_this2._lfoGainL);_this2._lfo.connect(_this2._lfoGainR);_this2._lfoGainL.connect(_this2._delayL.delayTime);_this2._lfoGainR.connect(_this2._delayR.delayTime);_this2._lfo.start(0);_this2.wet=wet;_this2.dry=dry;_this2.update({delay:delay,feedback:feedback,frequency:frequency,gain:gain});return _this2}StereoFlanger.prototype.update=function update(options){this.delay=options.delay;this.frequency=options.frequency;this.gain=options.gain;this.feedback=options.feedback};(0,_createClass3.default)(StereoFlanger,[{key:"delay",get:function get(){return this._delayL.delayTime.value},set:function set(value){this.setSafeParamValue(this._delayL.delayTime,value);this._delayR.delayTime.value=this._delayL.delayTime.value}},{key:"frequency",get:function get(){return this._lfo.frequency.value},set:function set(value){this.setSafeParamValue(this._lfo.frequency,value)}},{key:"gain",get:function get(){return this._lfoGainL.gain.value},set:function set(value){this.setSafeParamValue(this._lfoGainL.gain,value);this._lfoGainR.gain.value=0-this._lfoGainL.gain.value}},{key:"feedback",get:function get(){return this._feedbackL.gain.value},set:function set(value){this.setSafeParamValue(this._feedbackL.gain,value);this._feedbackR.gain.value=this._feedbackL.gain.value}}]);return StereoFlanger}(_abstractEffect2.default);_sono2.default.register("stereoFlanger",function(opts){return new StereoFlanger(opts)});exports.default=_sono2.default.register("flanger",function(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return opts.stereo?new StereoFlanger(opts):new MonoFlanger(opts)})},{"../core/sono":504,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],534:[function(require,module,exports){"use strict";exports.__esModule=true;exports.reverb=exports.phaser=exports.panner=exports.flanger=exports.filter=exports.echo=exports.distortion=exports.convolver=exports.compressor=exports.analyser=undefined;var _analyser=require("./analyser");var _analyser2=_interopRequireDefault(_analyser);var _compressor=require("./compressor");var _compressor2=_interopRequireDefault(_compressor);var _convolver=require("./convolver");var _convolver2=_interopRequireDefault(_convolver);var _distortion=require("./distortion");var _distortion2=_interopRequireDefault(_distortion);var _echo=require("./echo");var _echo2=_interopRequireDefault(_echo);var _filter=require("./filter");var _filter2=_interopRequireDefault(_filter);var _flanger=require("./flanger");var _flanger2=_interopRequireDefault(_flanger);var _panner=require("./panner");var _panner2=_interopRequireDefault(_panner);var _phaser=require("./phaser");var _phaser2=_interopRequireDefault(_phaser);var _reverb=require("./reverb");var _reverb2=_interopRequireDefault(_reverb);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.analyser=_analyser2.default;exports.compressor=_compressor2.default;exports.convolver=_convolver2.default;exports.distortion=_distortion2.default;exports.echo=_echo2.default;exports.filter=_filter2.default;exports.flanger=_flanger2.default;exports.panner=_panner2.default;exports.phaser=_phaser2.default;exports.reverb=_reverb2.default;exports.default={analyser:_analyser2.default,compressor:_compressor2.default,convolver:_convolver2.default,distortion:_distortion2.default,echo:_echo2.default,filter:_filter2.default,flanger:_flanger2.default,panner:_panner2.default,phaser:_phaser2.default,reverb:_reverb2.default}},{"./analyser":527,"./compressor":528,"./convolver":529,"./distortion":530,"./echo":531,"./filter":532,"./flanger":533,"./panner":535,"./phaser":536,"./reverb":537}],535:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractDirectEffect=require("./abstract-direct-effect");var _abstractDirectEffect2=_interopRequireDefault(_abstractDirectEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);var _isSafeNumber=require("../core/utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);var _isDefined=require("../core/utils/isDefined");var _isDefined2=_interopRequireDefault(_isDefined);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var pannerDefaults={panningModel:"HRTF",distanceModel:"linear",refDistance:1,maxDistance:1e3,rolloffFactor:1,coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0};function safeNumber(x){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if((0,_isSafeNumber2.default)(x)){return x}return y}function cross(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;a.x=ay*bz-az*by;a.y=az*bx-ax*bz;a.z=ax*by-ay*bx}function normalize(vec3){if(vec3.x===0&&vec3.y===0&&vec3.z===0){return vec3}var length=Math.sqrt(vec3.x*vec3.x+vec3.y*vec3.y+vec3.z*vec3.z);var invScalar=1/length;vec3.x*=invScalar;vec3.y*=invScalar;vec3.z*=invScalar;return vec3}var vecPool={pool:[],get:function get(x,y,z){var v=this.pool.length?this.pool.pop():{x:0,y:0,z:0};if(typeof x!=="undefined"&&isNaN(x)&&"x"in x&&"y"in x&&"z"in x){v.x=safeNumber(x.x);v.y=safeNumber(x.y);v.z=safeNumber(x.z)}else{v.x=safeNumber(x);v.y=safeNumber(y);v.z=safeNumber(z)}return v},dispose:function dispose(instance){this.pool.push(instance)}};var globalUp=vecPool.get(0,1,0);var angle45=Math.PI/4;var angle90=Math.PI/2;function setNodeOrientation(pannerNode,fw){var up=vecPool.get(fw.x,fw.y,fw.z);cross(up,globalUp);cross(up,fw);normalize(up);normalize(fw);pannerNode.setOrientation(fw.x,fw.y,fw.z,up.x,up.y,up.z);vecPool.dispose(fw);vecPool.dispose(up)}function setNodePosition(nodeOrListener,vec){nodeOrListener.setPosition(vec.x,vec.y,vec.z);vecPool.dispose(vec)}var Panner=function(_AbstractDirectEffect){(0,_inherits3.default)(Panner,_AbstractDirectEffect);function Panner(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},panningModel=_ref.panningModel,distanceModel=_ref.distanceModel,refDistance=_ref.refDistance,maxDistance=_ref.maxDistance,rolloffFactor=_ref.rolloffFactor,coneInnerAngle=_ref.coneInnerAngle,coneOuterAngle=_ref.coneOuterAngle,coneOuterGain=_ref.coneOuterGain;(0,_classCallCheck3.default)(this,Panner);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractDirectEffect.call(this,_sono2.default.context.createPanner()));_this._node.panningModel=panningModel||pannerDefaults.panningModel;_this._node.distanceModel=distanceModel||pannerDefaults.distanceModel;_this._node.refDistance=(0,_isDefined2.default)(refDistance)?refDistance:pannerDefaults.refDistance;_this._node.maxDistance=(0,_isDefined2.default)(maxDistance)?maxDistance:pannerDefaults.maxDistance;_this._node.rolloffFactor=(0,_isDefined2.default)(rolloffFactor)?rolloffFactor:pannerDefaults.rolloffFactor;_this._node.coneInnerAngle=(0,_isDefined2.default)(coneInnerAngle)?coneInnerAngle:pannerDefaults.coneInnerAngle;_this._node.coneOuterAngle=(0,_isDefined2.default)(coneOuterAngle)?coneOuterAngle:pannerDefaults.coneOuterAngle;_this._node.coneOuterGain=(0,_isDefined2.default)(coneOuterGain)?coneOuterGain:pannerDefaults.coneOuterGain;_this._node.setPosition(0,0,0);_this._node.setOrientation(1,0,0);_this.set(0);return _this}Panner.prototype.update=function update(_ref2){var x=_ref2.x,y=_ref2.y,z=_ref2.z;var v=vecPool.get(x,y,z);if((0,_isSafeNumber2.default)(x)&&!(0,_isSafeNumber2.default)(y)&&!(0,_isSafeNumber2.default)(z)){x=v.x;if(x>1){x=1}if(x<-1){x=-1}x=x*angle45;z=x+angle90;if(z>angle90){z=Math.PI-z}v.x=Math.sin(x);v.y=0;v.z=Math.sin(z)}setNodePosition(this._node,v)};Panner.prototype.setPosition=function setPosition(x,y,z){setNodePosition(this._node,vecPool.get(x,y,z))};Panner.prototype.setOrientation=function setOrientation(x,y,z){setNodeOrientation(this._node,vecPool.get(x,y,z))};Panner.prototype.setListenerPosition=function setListenerPosition(x,y,z){setNodePosition(_sono2.default.context.listener,vecPool.get(x,y,z))};Panner.prototype.setListenerOrientation=function setListenerOrientation(x,y,z){setNodeOrientation(_sono2.default.context.listener,vecPool.get(x,y,z))};Panner.prototype.set=function set(x,y,z){return this.update({x:x,y:y,z:z})};(0,_createClass3.default)(Panner,[{key:"defaults",get:function get(){return pannerDefaults},set:function set(value){Object.assign(pannerDefaults,value)}}]);return Panner}(_abstractDirectEffect2.default);var panner=_sono2.default.register("panner",function(opts){return new Panner(opts)});Object.defineProperties(panner,{defaults:{get:function get(){return pannerDefaults},set:function set(value){return Object.assign(pannerDefaults,value)}},setListenerPosition:{value:function value(x,y,z){return setNodePosition(_sono2.default.context.listener,vecPool.get(x,y,z))}},setListenerOrientation:{value:function value(x,y,z){return setNodeOrientation(_sono2.default.context.listener,vecPool.get(x,y,z))}}});exports.default=panner},{"../core/sono":504,"../core/utils/isDefined":517,"../core/utils/isSafeNumber":518,"./abstract-direct-effect":525,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],536:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Phaser=function(_AbstractEffect){(0,_inherits3.default)(Phaser,_AbstractEffect);function Phaser(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$stages=_ref.stages,stages=_ref$stages===undefined?8:_ref$stages,_ref$feedback=_ref.feedback,feedback=_ref$feedback===undefined?.5:_ref$feedback,_ref$frequency=_ref.frequency,frequency=_ref$frequency===undefined?.5:_ref$frequency,_ref$gain=_ref.gain,gain=_ref$gain===undefined?300:_ref$gain,_ref$wet=_ref.wet,wet=_ref$wet===undefined?.8:_ref$wet,_ref$dry=_ref.dry,dry=_ref$dry===undefined?.8:_ref$dry;(0,_classCallCheck3.default)(this,Phaser);stages=stages||8;var filters=[];for(var i=0;i<stages;i++){filters.push(_sono2.default.context.createBiquadFilter())}var first=filters[0];var last=filters[filters.length-1];var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,first,last));_this._stages=stages;_this._feedback=_sono2.default.context.createGain();_this._lfo=_sono2.default.context.createOscillator();_this._lfoGain=_sono2.default.context.createGain();_this._lfo.type="sine";for(var _i=0;_i<filters.length;_i++){var filter=filters[_i];filter.type="allpass";filter.frequency.value=1e3*_i;_this._lfoGain.connect(filter.frequency);if(_i>0){filters[_i-1].connect(filter)}}_this._lfo.connect(_this._lfoGain);_this._lfo.start(0);_this._nodeOut.connect(_this._feedback);_this._feedback.connect(_this._node);_this.wet=wet;_this.dry=dry;_this.update({frequency:frequency,gain:gain,feedback:feedback});return _this}Phaser.prototype.enable=function enable(value){_AbstractEffect.prototype.enable.call(this,value);if(this._feedback){this._feedback.disconnect()}if(value&&this._feedback){this._nodeOut.connect(this._feedback);this._feedback.connect(this._node)}};Phaser.prototype.update=function update(options){this.frequency=options.frequency;this.gain=options.gain;this.feedback=options.feedback};(0,_createClass3.default)(Phaser,[{key:"stages",get:function get(){return this._stages}},{key:"frequency",get:function get(){return this._lfo.frequency.value},set:function set(value){this.setSafeParamValue(this._lfo.frequency,value)}},{key:"gain",get:function get(){return this._lfoGain.gain.value},set:function set(value){this.setSafeParamValue(this._lfoGain.gain,value)}},{key:"feedback",get:function get(){return this._feedback.gain.value},set:function set(value){this.setSafeParamValue(this._feedback.gain,value)}}]);return Phaser}(_abstractEffect2.default);exports.default=_sono2.default.register("phaser",function(opts){return new Phaser(opts)})},{"../core/sono":504,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],537:[function(require,module,exports){"use strict";exports.__esModule=true;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _abstractEffect=require("./abstract-effect");var _abstractEffect2=_interopRequireDefault(_abstractEffect);var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);var _isSafeNumber=require("../core/utils/isSafeNumber");var _isSafeNumber2=_interopRequireDefault(_isSafeNumber);var _isDefined=require("../core/utils/isDefined");var _isDefined2=_interopRequireDefault(_isDefined);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createImpulseResponse(_ref){var time=_ref.time,decay=_ref.decay,reverse=_ref.reverse,buffer=_ref.buffer;var rate=_sono2.default.context.sampleRate;var length=Math.floor(rate*time);var impulseResponse=void 0;if(buffer&&buffer.length===length){impulseResponse=buffer}else{impulseResponse=_sono2.default.context.createBuffer(2,length,rate)}var left=impulseResponse.getChannelData(0);var right=impulseResponse.getChannelData(1);var n=void 0,e=void 0;for(var i=0;i<length;i++){n=reverse?length-i:i;e=Math.pow(1-n/length,decay);left[i]=(Math.random()*2-1)*e;right[i]=(Math.random()*2-1)*e}return impulseResponse}var Reverb=function(_AbstractEffect){(0,_inherits3.default)(Reverb,_AbstractEffect);function Reverb(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$time=_ref2.time,time=_ref2$time===undefined?1:_ref2$time,_ref2$decay=_ref2.decay,decay=_ref2$decay===undefined?5:_ref2$decay,_ref2$reverse=_ref2.reverse,reverse=_ref2$reverse===undefined?false:_ref2$reverse,_ref2$wet=_ref2.wet,wet=_ref2$wet===undefined?1:_ref2$wet,_ref2$dry=_ref2.dry,dry=_ref2$dry===undefined?1:_ref2$dry;(0,_classCallCheck3.default)(this,Reverb);var _this=(0,_possibleConstructorReturn3.default)(this,_AbstractEffect.call(this,_sono2.default.context.createConvolver()));_this._convolver=_this._node;_this._length=0;_this._impulseResponse=null;_this._opts={};_this.wet=wet;_this.dry=dry;_this.update({time:time,decay:decay,reverse:reverse});return _this}Reverb.prototype.update=function update(_ref3){var time=_ref3.time,decay=_ref3.decay,reverse=_ref3.reverse;var changed=false;if(time!==this._opts.time&&(0,_isSafeNumber2.default)(time)){this._opts.time=time;changed=true}if(decay!==this._opts.decay&&(0,_isSafeNumber2.default)(decay)){this._opts.decay=decay;changed=true}if((0,_isDefined2.default)(reverse)&&reverse!==this._reverse){this._opts.reverse=reverse;changed=true}if(!changed){return}this._opts.buffer=time<=0?null:createImpulseResponse(this._opts);this._convolver.buffer=this._opts.buffer};(0,_createClass3.default)(Reverb,[{key:"time",get:function get(){return this._opts.time},set:function set(value){this.update({time:value})}},{key:"decay",get:function get(){return this._opts.decay},set:function set(value){this.update({decay:value})}},{key:"reverse",get:function get(){return this._opts.reverse},set:function set(value){this.update({reverse:value})}}]);return Reverb}(_abstractEffect2.default);exports.default=_sono2.default.register("reverb",function(opts){return new Reverb(opts)})},{"../core/sono":504,"../core/utils/isDefined":517,"../core/utils/isSafeNumber":518,"./abstract-effect":526,"babel-runtime/helpers/classCallCheck":12,"babel-runtime/helpers/createClass":13,"babel-runtime/helpers/inherits":15,"babel-runtime/helpers/possibleConstructorReturn":16}],538:[function(require,module,exports){"use strict";exports.__esModule=true;var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function microphone(connected,denied,error){navigator.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;error=error||function(err){console.error(err)};var isSupported=!!navigator.getUserMedia;var api={};var stream=null;function onConnect(micStream){stream=micStream;connected(stream)}function onError(e){if(denied&&e.name==="PermissionDeniedError"||e==="PERMISSION_DENIED"){denied()}else{error(e.message||e)}}function connect(){if(!isSupported){return api}if(navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia({audio:true}).then(onConnect).catch(onError)}else{navigator.getUserMedia({audio:true},onConnect,onError)}return api}function disconnect(){if(stream.stop){stream.stop()}else{stream.getAudioTracks()[0].stop()}stream=null;return api}return Object.assign(api,{connect:connect,disconnect:disconnect,isSupported:isSupported,get stream(){return stream}})}exports.default=_sono2.default.register("microphone",microphone,_sono2.default.utils)},{"../core/sono":504}],539:[function(require,module,exports){"use strict";exports.__esModule=true;var _sono=require("../core/sono");var _sono2=_interopRequireDefault(_sono);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function recorder(){var passThrough=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var bufferLength=4096;var buffersL=[];var buffersR=[];var startedAt=0;var stoppedAt=0;var script=null;var isRecording=false;var soundOb=null;var input=_sono2.default.context.createGain();var output=_sono2.default.context.createGain();output.gain.value=passThrough?1:0;var node={_in:input,_out:output,connect:function connect(n){output.connect(n._in||n)},disconnect:function disconnect(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}output.disconnect(args)}};function mergeBuffers(buffers,length){var buffer=new Float32Array(length);var offset=0;for(var i=0;i<buffers.length;i++){buffer.set(buffers[i],offset);offset+=buffers[i].length}return buffer}function getBuffer(){if(!buffersL.length){return _sono2.default.context.createBuffer(2,bufferLength,_sono2.default.context.sampleRate)}var recordingLength=buffersL.length*bufferLength;var buffer=_sono2.default.context.createBuffer(2,recordingLength,_sono2.default.context.sampleRate);buffer.getChannelData(0).set(mergeBuffers(buffersL,recordingLength));buffer.getChannelData(1).set(mergeBuffers(buffersR,recordingLength));return buffer}function destroyScriptProcessor(){if(script){script.onaudioprocess=null;input.disconnect();script.disconnect()}}function createScriptProcessor(){destroyScriptProcessor();script=_sono2.default.context.createScriptProcessor(bufferLength,2,2);input.connect(script);script.connect(output);script.connect(_sono2.default.context.destination);script.onaudioprocess=function(event){var inputL=event.inputBuffer.getChannelData(0);var inputR=event.inputBuffer.getChannelData(1);if(passThrough){var outputL=event.outputBuffer.getChannelData(0);var outputR=event.outputBuffer.getChannelData(1);outputL.set(inputL);outputR.set(inputR)}if(isRecording){buffersL.push(new Float32Array(inputL));buffersR.push(new Float32Array(inputR))}}}return{start:function start(sound){if(!sound){return}createScriptProcessor();buffersL.length=0;buffersR.length=0;startedAt=_sono2.default.context.currentTime;stoppedAt=0;soundOb=sound;sound.effects.add(node);isRecording=true},stop:function stop(){soundOb.effects.remove(node);soundOb=null;stoppedAt=_sono2.default.context.currentTime;isRecording=false;destroyScriptProcessor();return getBuffer()},getDuration:function getDuration(){if(!isRecording){return stoppedAt-startedAt}return _sono2.default.context.currentTime-startedAt},get isRecording(){return isRecording}}}exports.default=_sono2.default.register("recorder",recorder,_sono2.default.utils)},{"../core/sono":504}],540:[function(require,module,exports){var fastSafeStringify=require("fast-safe-stringify");var copy=require("copy-text-to-clipboard");function tryStringify(obj){try{return JSON.stringify(obj)}catch(e){}}function stateCopy(obj){var str=tryStringify(obj)||fastSafeStringify(obj);copy(str)}module.exports=stateCopy},{"copy-text-to-clipboard":41,"fast-safe-stringify":174}],541:[function(require,module,exports){"use strict";module.exports=function(str){return encodeURIComponent(str).replace(/[!'()*]/g,function(c){return"%"+c.charCodeAt(0).toString(16).toUpperCase()})}},{}],542:[function(require,module,exports){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function repeat(text,count){return Array(count+1).join(text)}var Tiza=function Tiza(){var currentStyles=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var texts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var styles=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];_classCallCheck(this,Tiza);_initialiseProps.call(this);this._currentStyles=currentStyles;this._texts=texts;this._styles=styles};var _initialiseProps=function _initialiseProps(){var _this=this;this.getCurrentStyles=function(){return _this._currentStyles};this.getTexts=function(){return _this._texts};this.getStyles=function(){return _this._styles};this.style=function(s){return new Tiza([].concat(_toConsumableArray(_this._currentStyles),[s]),_this._texts,_this._styles)};this.color=function(c){return _this.style("color:"+c)};this.bgColor=function(c){return _this.style("background-color:"+c)};this.bold=function(){return _this.style("font-weight:bold")};this.italic=function(){return _this.style("font-style:italic")};this.size=function(n){var s=typeof n==="number"?n+"px":n;return _this.style("font-size:"+s)};this.reset=function(){return new Tiza([],_this._texts,_this._styles)};this.text=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var texts=[].concat(_toConsumableArray(_this._texts));var styles=[].concat(_toConsumableArray(_this._styles));args.forEach(function(arg){if(arg instanceof Tiza){texts.push.apply(texts,_toConsumableArray(arg.getTexts()));styles.push.apply(styles,_toConsumableArray(arg.getStyles()))}else{texts.push(arg);styles.push(_this._currentStyles.join(";"))}});return new Tiza(_this._currentStyles,texts,styles)};this.space=function(){var count=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return _this.text(repeat(" ",count))};this.newline=function(){var count=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return _this.text(repeat("\n",count))};this._output=function(type){return function(){var _console;var ins=_this.text.apply(_this,arguments);(_console=console)[type].apply(_console,[ins.getTexts().map(function(t){return"%c"+t}).join("")].concat(_toConsumableArray(ins._styles)));return new Tiza(ins.getCurrentStyles(),[],[])}};this.log=this._output("log");this.info=this._output("info");this.warn=this._output("warn");this.error=this._output("error")};var index=new Tiza;module.exports=index},{}],543:[function(require,module,exports){arguments[4][486][0].apply(exports,arguments)},{dup:486}],544:[function(require,module,exports){"use strict";var punycode=require("punycode");var util=require("./util");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/");url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=="protocol")result[rkey]=relative[rkey]}if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}},{"./util":545,punycode:425,querystring:429}],545:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return typeof arg==="string"},isObject:function(arg){return typeof arg==="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}},{}],546:[function(require,module,exports){"use strict";exports.__esModule=true;exports.default=objectPool;function objectPool(factoryFn){var pool=[];var numCreated=0;return{getPool:function getPool(){return pool},get:function get(){if(pool.length>0){return pool.pop()}else{numCreated++;return factoryFn()}},dispose:function dispose(instance){pool.push(instance)},fill:function fill(count){while(pool.length<count){numCreated++;pool[pool.length]=factoryFn()}},empty:function empty(){pool=[]},getNumCreated:function getNumCreated(){return numCreated}}}},{}],547:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output="";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343){throw Error("Lone surrogate U+"+codePoint.toString(16).toUpperCase()+" is not a scalar value")}}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol="";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){checkScalarValue(codePoint);symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString="";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error("Invalid byte index")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error("Invalid byte index")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){checkScalarValue(codePoint);return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error("Invalid UTF-8 detected")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],548:[function(require,module,exports){arguments[4][218][0].apply(exports,arguments)},{dup:218}],549:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],550:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":549,_process:423,inherits:548}],551:[function(require,module,exports){var v1=require("./v1");var v4=require("./v4");var uuid=v4;uuid.v1=v1;uuid.v4=v4;module.exports=uuid},{"./v1":554,"./v4":555}],552:[function(require,module,exports){var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(buf,offset){var i=offset||0;var bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}module.exports=bytesToUuid},{}],553:[function(require,module,exports){(function(global){var rng;var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(rnds8);return rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;rnds[i]=r>>>((i&3)<<3)&255}return rnds}}module.exports=rng}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],554:[function(require,module,exports){var rng=require("./lib/rng");var bytesToUuid=require("./lib/bytesToUuid");var _seedBytes=rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;++n){b[i+n]=node[n]}return buf?buf:bytesToUuid(b)}module.exports=v1},{"./lib/bytesToUuid":552,"./lib/rng":553}],555:[function(require,module,exports){var rng=require("./lib/rng");var bytesToUuid=require("./lib/bytesToUuid");function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;++ii){buf[i+ii]=rnds[ii]}}return buf||bytesToUuid(rnds)}module.exports=v4},{"./lib/bytesToUuid":552,"./lib/rng":553}],556:[function(require,module,exports){module.exports=normalize;function normalize(vec){var mag=0;for(var n=0;n<vec.length;n++){mag+=vec[n]*vec[n]}mag=Math.sqrt(mag);if(mag===0){return Array.apply(null,new Array(vec.length)).map(Number.prototype.valueOf,0)}for(var n=0;n<vec.length;n++){vec[n]/=mag}return vec}},{}],557:[function(require,module,exports){var assert=require("assert");module.exports=getAllRoutes;var transform=function(trie,previous){var prev=previous||"/";var routes={};var nodes=trie.nodes;Object.keys(nodes).forEach(function(key){var path=(prev==="/"?prev:prev+"/")+(key==="$$"?":"+trie.name:key);var cb=nodes[key].cb;if(cb!==undefined){routes[path]=cb}if(Object.keys(nodes[key].nodes).length!==0){var obj=transform(nodes[key],path);Object.keys(obj).forEach(function(r){routes[r]=obj[r]})}});return routes};function getAllRoutes(router){assert.equal(typeof router,"function","wayfarer.getAllRoutes: router should be an function");var trie=router._trie;assert.equal(typeof trie,"object","wayfarer.getAllRoutes: trie should be an object");var tree=trie.trie;return transform(tree)}},{assert:5}],558:[function(require,module,exports){var assert=require("assert");var trie=require("./trie");module.exports=Wayfarer;function Wayfarer(dft){if(!(this instanceof Wayfarer))return new Wayfarer(dft);var _default=(dft||"").replace(/^\//,"");var _trie=trie();emit._trie=_trie;emit.emit=emit;emit.on=on;emit._wayfarer=true;return emit;function on(route,cb){assert.equal(typeof route,"string");assert.equal(typeof cb,"function");route=route||"/";cb.route=route;if(cb&&cb._wayfarer&&cb._trie){_trie.mount(route,cb._trie.trie)}else{var node=_trie.create(route);node.cb=cb}return emit}function emit(route){assert.notEqual(route,undefined,"'route' must be defined");var args=new Array(arguments.length);for(var i=1;i<args.length;i++){args[i]=arguments[i]}var node=_trie.match(route);if(node&&node.cb){args[0]=node.params;var cb=node.cb;return cb.apply(cb,args)}var dft=_trie.match(_default);if(dft&&dft.cb){args[0]=dft.params;var dftcb=dft.cb;return dftcb.apply(dftcb,args)}throw new Error("route '"+route+"' did not match")}}},{"./trie":559,assert:5}],559:[function(require,module,exports){var mutate=require("xtend/mutable");var assert=require("assert");var xtend=require("xtend");module.exports=Trie;function Trie(){if(!(this instanceof Trie))return new Trie;this.trie={nodes:{}}}Trie.prototype.create=function(route){assert.equal(typeof route,"string","route should be a string");var routes=route.replace(/^\//,"").split("/");function createNode(index,trie){var thisRoute=routes.hasOwnProperty(index)&&routes[index];if(thisRoute===false)return trie;var node=null;if(/^:|^\*/.test(thisRoute)){if(!trie.nodes.hasOwnProperty("$$")){node={nodes:{}};trie.nodes["$$"]=node}else{node=trie.nodes["$$"]}if(thisRoute[0]==="*"){trie.wildcard=true}trie.name=thisRoute.replace(/^:|^\*/,"")}else if(!trie.nodes.hasOwnProperty(thisRoute)){node={nodes:{}};trie.nodes[thisRoute]=node}else{node=trie.nodes[thisRoute]}return createNode(index+1,node)}return createNode(0,this.trie)};Trie.prototype.match=function(route){assert.equal(typeof route,"string","route should be a string");var routes=route.replace(/^\//,"").split("/");var params={};function search(index,trie){if(trie===undefined)return undefined;var thisRoute=routes[index];if(thisRoute===undefined)return trie;if(trie.nodes.hasOwnProperty(thisRoute)){return search(index+1,trie.nodes[thisRoute])}else if(trie.name){try{params[trie.name]=decodeURIComponent(thisRoute)}catch(e){return search(index,undefined)}return search(index+1,trie.nodes["$$"])}else if(trie.wildcard){try{params["wildcard"]=decodeURIComponent(routes.slice(index).join("/"))}catch(e){return search(index,undefined)}return trie.nodes["$$"]}else{return search(index+1)}}var node=search(0,this.trie);if(!node)return undefined;node=xtend(node);node.params=params;return node};Trie.prototype.mount=function(route,trie){assert.equal(typeof route,"string","route should be a string");assert.equal(typeof trie,"object","trie should be a object");var split=route.replace(/^\//,"").split("/");var node=null;var key=null;if(split.length===1){key=split[0];node=this.create(key)}else{var headArr=split.splice(0,split.length-1);var head=headArr.join("/");key=split[0];node=this.create(head)}mutate(node.nodes,trie.nodes);if(trie.name)node.name=trie.name;if(node.nodes[""]){Object.keys(node.nodes[""]).forEach(function(key){if(key==="nodes")return;node[key]=node.nodes[""][key]});mutate(node.nodes,node.nodes[""].nodes);delete node.nodes[""].nodes}}},{assert:5,xtend:574,"xtend/mutable":575}],560:[function(require,module,exports){(function(global){"use strict";var adapterFactory=require("./adapter_factory.js");module.exports=adapterFactory({window:global.window})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./adapter_factory.js":561}],561:[function(require,module,exports){"use strict";var utils=require("./utils");module.exports=function(dependencies,opts){var window=dependencies&&dependencies.window;var options={shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true};for(var key in opts){if(hasOwnProperty.call(opts,key)){options[key]=opts[key]}}var logging=utils.log;var browserDetails=utils.detectBrowser(window);var adapter={browserDetails:browserDetails,extractVersion:utils.extractVersion,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings};var chromeShim=require("./chrome/chrome_shim")||null;var edgeShim=require("./edge/edge_shim")||null;var firefoxShim=require("./firefox/firefox_shim")||null;var safariShim=require("./safari/safari_shim")||null;var commonShim=require("./common_shim")||null;switch(browserDetails.browser){case"chrome":if(!chromeShim||!chromeShim.shimPeerConnection||!options.shimChrome){logging("Chrome shim is not included in this adapter release.");return adapter}logging("adapter.js shimming chrome.");adapter.browserShim=chromeShim;commonShim.shimCreateObjectURL(window);chromeShim.shimGetUserMedia(window);chromeShim.shimMediaStream(window);chromeShim.shimSourceObject(window);chromeShim.shimPeerConnection(window);chromeShim.shimOnTrack(window);chromeShim.shimAddTrackRemoveTrack(window);chromeShim.shimGetSendersWithDtmf(window);commonShim.shimRTCIceCandidate(window);break;case"firefox":if(!firefoxShim||!firefoxShim.shimPeerConnection||!options.shimFirefox){logging("Firefox shim is not included in this adapter release.");return adapter}logging("adapter.js shimming firefox.");adapter.browserShim=firefoxShim;commonShim.shimCreateObjectURL(window);firefoxShim.shimGetUserMedia(window);firefoxShim.shimSourceObject(window);firefoxShim.shimPeerConnection(window);firefoxShim.shimOnTrack(window);commonShim.shimRTCIceCandidate(window);break;case"edge":if(!edgeShim||!edgeShim.shimPeerConnection||!options.shimEdge){logging("MS edge shim is not included in this adapter release.");return adapter}logging("adapter.js shimming edge.");adapter.browserShim=edgeShim;commonShim.shimCreateObjectURL(window);edgeShim.shimGetUserMedia(window);edgeShim.shimPeerConnection(window);edgeShim.shimReplaceTrack(window);break;case"safari":if(!safariShim||!options.shimSafari){logging("Safari shim is not included in this adapter release.");return adapter}logging("adapter.js shimming safari.");adapter.browserShim=safariShim;commonShim.shimCreateObjectURL(window);safariShim.shimRTCIceServerUrls(window);safariShim.shimCallbacksAPI(window);safariShim.shimLocalStreamsAPI(window);safariShim.shimRemoteStreamsAPI(window);safariShim.shimTrackEventTransceiver(window);safariShim.shimGetUserMedia(window);safariShim.shimCreateOfferLegacy(window);commonShim.shimRTCIceCandidate(window);break;default:logging("Unsupported browser!");break}return adapter}},{"./chrome/chrome_shim":562,"./common_shim":564,"./edge/edge_shim":565,"./firefox/firefox_shim":567,"./safari/safari_shim":569,"./utils":570}],562:[function(require,module,exports){"use strict";var utils=require("../utils.js");var logging=utils.log;var chromeShim={shimMediaStream:function(window){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(window){if(typeof window==="object"&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(f){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=f)}});var origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function(){var pc=this;if(!pc._ontrackpoly){pc._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(te){var receiver;if(window.RTCPeerConnection.prototype.getReceivers){receiver=pc.getReceivers().find(function(r){return r.track&&r.track.id===te.track.id})}else{receiver={track:te.track}}var event=new Event("track");event.track=te.track;event.receiver=receiver;event.transceiver={receiver:receiver};event.streams=[e.stream];pc.dispatchEvent(event)});e.stream.getTracks().forEach(function(track){var receiver;if(window.RTCPeerConnection.prototype.getReceivers){receiver=pc.getReceivers().find(function(r){return r.track&&r.track.id===track.id})}else{receiver={track:track}}var event=new Event("track");event.track=track;event.receiver=receiver;event.transceiver={receiver:receiver};event.streams=[e.stream];pc.dispatchEvent(event)})};pc.addEventListener("addstream",pc._ontrackpoly)}return origSetRemoteDescription.apply(pc,arguments)}}},shimGetSendersWithDtmf:function(window){if(typeof window==="object"&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){var shimSenderWithDtmf=function(pc,track){return{track:track,get dtmf(){if(this._dtmf===undefined){if(track.kind==="audio"){this._dtmf=pc.createDTMFSender(track)}else{this._dtmf=null}}return this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function(track,stream){var pc=this;var sender=origAddTrack.apply(pc,arguments);if(!sender){sender=shimSenderWithDtmf(pc,track);pc._senders.push(sender)}return sender};var origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function(sender){var pc=this;origRemoveTrack.apply(pc,arguments);var idx=pc._senders.indexOf(sender);if(idx!==-1){pc._senders.splice(idx,1)}}}var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var pc=this;pc._senders=pc._senders||[];origAddStream.apply(pc,[stream]);stream.getTracks().forEach(function(track){pc._senders.push(shimSenderWithDtmf(pc,track))})};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var pc=this;pc._senders=pc._senders||[];origRemoveStream.apply(pc,[stream]);stream.getTracks().forEach(function(track){var sender=pc._senders.find(function(s){return s.track===track});if(sender){pc._senders.splice(pc._senders.indexOf(sender),1)}})}}else if(typeof window==="object"&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){var origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function(){var pc=this;var senders=origGetSenders.apply(pc,[]);senders.forEach(function(sender){sender._pc=pc});return senders};Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}},shimSourceObject:function(window){var URL=window&&window.URL;if(typeof window==="object"){if(window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)){Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(stream){var self=this;this._srcObject=stream;if(this.src){URL.revokeObjectURL(this.src)}if(!stream){this.src="";return undefined}this.src=URL.createObjectURL(stream);stream.addEventListener("addtrack",function(){if(self.src){URL.revokeObjectURL(self.src)}self.src=URL.createObjectURL(stream)});stream.addEventListener("removetrack",function(){if(self.src){URL.revokeObjectURL(self.src)}self.src=URL.createObjectURL(stream)})}})}}},shimAddTrackRemoveTrack:function(window){var browserDetails=utils.detectBrowser(window);if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=63){return}var origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function(){var self=this;var nativeStreams=origGetLocalStreams.apply(this);self._reverseStreams=self._reverseStreams||{};return nativeStreams.map(function(stream){return self._reverseStreams[stream.id]})};var origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function(stream){var pc=this;pc._streams=pc._streams||{};pc._reverseStreams=pc._reverseStreams||{};stream.getTracks().forEach(function(track){var alreadyExists=pc.getSenders().find(function(s){return s.track===track});if(alreadyExists){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!pc._reverseStreams[stream.id]){var newStream=new window.MediaStream(stream.getTracks());pc._streams[stream.id]=newStream;pc._reverseStreams[newStream.id]=stream;stream=newStream}origAddStream.apply(pc,[stream])};var origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function(stream){var pc=this;pc._streams=pc._streams||{};pc._reverseStreams=pc._reverseStreams||{};origRemoveStream.apply(pc,[pc._streams[stream.id]||stream]);delete pc._reverseStreams[pc._streams[stream.id]?pc._streams[stream.id].id:stream.id];delete pc._streams[stream.id]};window.RTCPeerConnection.prototype.addTrack=function(track,stream){var pc=this;if(pc.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var streams=[].slice.call(arguments,1);if(streams.length!==1||!streams[0].getTracks().find(function(t){return t===track})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}var alreadyExists=pc.getSenders().find(function(s){return s.track===track});if(alreadyExists){throw new DOMException("Track already exists.","InvalidAccessError")}pc._streams=pc._streams||{};pc._reverseStreams=pc._reverseStreams||{};var oldStream=pc._streams[stream.id];if(oldStream){oldStream.addTrack(track);Promise.resolve().then(function(){pc.dispatchEvent(new Event("negotiationneeded"))})}else{var newStream=new window.MediaStream([track]);pc._streams[stream.id]=newStream;pc._reverseStreams[newStream.id]=stream;pc.addStream(newStream)}return pc.getSenders().find(function(s){return s.track===track})};function replaceInternalStreamId(pc,description){var sdp=description.sdp;Object.keys(pc._reverseStreams||[]).forEach(function(internalId){var externalStream=pc._reverseStreams[internalId];var internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)});return new RTCSessionDescription({type:description.type,sdp:sdp})}function replaceExternalStreamId(pc,description){var sdp=description.sdp;Object.keys(pc._reverseStreams||[]).forEach(function(internalId){var externalStream=pc._reverseStreams[internalId];var internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)});return new RTCSessionDescription({type:description.type,sdp:sdp})}["createOffer","createAnswer"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){var pc=this;var args=arguments;var isLegacyCall=arguments.length&&typeof arguments[0]==="function";if(isLegacyCall){return nativeMethod.apply(pc,[function(description){var desc=replaceInternalStreamId(pc,description);args[0].apply(null,[desc])},function(err){if(args[1]){args[1].apply(null,err)}},arguments[2]])}return nativeMethod.apply(pc,arguments).then(function(description){return replaceInternalStreamId(pc,description)})}});var origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function(){var pc=this;if(!arguments.length||!arguments[0].type){return origSetLocalDescription.apply(pc,arguments)}arguments[0]=replaceExternalStreamId(pc,arguments[0]);return origSetLocalDescription.apply(pc,arguments)};var origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get:function(){var pc=this;var description=origLocalDescription.get.apply(this);if(description.type===""){return description}return replaceInternalStreamId(pc,description)}});window.RTCPeerConnection.prototype.removeTrack=function(sender){var pc=this;if(pc.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!sender._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.","TypeError")}var isLocal=sender._pc===pc;if(!isLocal){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}pc._streams=pc._streams||{};var stream;Object.keys(pc._streams).forEach(function(streamid){var hasTrack=pc._streams[streamid].getTracks().find(function(track){return sender.track===track});if(hasTrack){stream=pc._streams[streamid]}});if(stream){if(stream.getTracks().length===1){pc.removeStream(pc._reverseStreams[stream.id])}else{stream.removeTrack(sender.track)}pc.dispatchEvent(new Event("negotiationneeded"))}}},shimPeerConnection:function(window){var browserDetails=utils.detectBrowser(window);if(!window.RTCPeerConnection){window.RTCPeerConnection=function(pcConfig,pcConstraints){logging("PeerConnection");if(pcConfig&&pcConfig.iceTransportPolicy){pcConfig.iceTransports=pcConfig.iceTransportPolicy}return new window.webkitRTCPeerConnection(pcConfig,pcConstraints)};window.RTCPeerConnection.prototype=window.webkitRTCPeerConnection.prototype;if(window.webkitRTCPeerConnection.generateCertificate){Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return window.webkitRTCPeerConnection.generateCertificate}})}}else{var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){var newIceServers=[];for(var i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];if(!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")){utils.deprecated("RTCIceServer.url","RTCIceServer.urls");server=JSON.parse(JSON.stringify(server));server.urls=server.url;newIceServers.push(server)}else{newIceServers.push(pcConfig.iceServers[i])}}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)};window.RTCPeerConnection.prototype=OrigPeerConnection.prototype;Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return OrigPeerConnection.generateCertificate}})}var origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(selector,successCallback,errorCallback){var self=this;var args=arguments;if(arguments.length>0&&typeof selector==="function"){return origGetStats.apply(this,arguments)}if(origGetStats.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return origGetStats.apply(this,[])}var fixChromeStats_=function(response){var standardReport={};var reports=response.result();reports.forEach(function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[report.type]||report.type};report.names().forEach(function(name){standardStats[name]=report.stat(name)});standardReport[standardStats.id]=standardStats});return standardReport};var makeMapStats=function(stats){return new Map(Object.keys(stats).map(function(key){return[key,stats[key]]}))};if(arguments.length>=2){var successCallbackWrapper_=function(response){args[1](makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,arguments[0]])}return new Promise(function(resolve,reject){origGetStats.apply(self,[function(response){resolve(makeMapStats(fixChromeStats_(response)))},reject])}).then(successCallback,errorCallback)};if(browserDetails.version<51){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){var args=arguments;var self=this;var promise=new Promise(function(resolve,reject){nativeMethod.apply(self,[args[0],resolve,reject])});if(args.length<2){return promise}return promise.then(function(){args[1].apply(null,[])},function(err){if(args.length>=3){args[2].apply(null,[err])}})}})}if(browserDetails.version<52){["createOffer","createAnswer"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){var self=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var opts=arguments.length===1?arguments[0]:undefined;return new Promise(function(resolve,reject){nativeMethod.apply(self,[resolve,reject,opts])})}return nativeMethod.apply(this,arguments)}})}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){arguments[0]=new(method==="addIceCandidate"?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]);return nativeMethod.apply(this,arguments)}});var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return nativeAddIceCandidate.apply(this,arguments)}}};module.exports={shimMediaStream:chromeShim.shimMediaStream,shimOnTrack:chromeShim.shimOnTrack,shimAddTrackRemoveTrack:chromeShim.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:chromeShim.shimGetSendersWithDtmf,shimSourceObject:chromeShim.shimSourceObject,shimPeerConnection:chromeShim.shimPeerConnection,shimGetUserMedia:require("./getusermedia")}},{"../utils.js":570,"./getusermedia":563}],563:[function(require,module,exports){"use strict";var utils=require("../utils.js");var logging=utils.log;module.exports=function(window){var browserDetails=utils.detectBrowser(window);var navigator=window&&window.navigator;var constraintsToChrome_=function(c){if(typeof c!=="object"||c.mandatory||c.optional){return c}var cc={};Object.keys(c).forEach(function(key){if(key==="require"||key==="advanced"||key==="mediaSource"){return}var r=typeof c[key]==="object"?c[key]:{ideal:c[key]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var oldname_=function(prefix,name){if(prefix){return prefix+name.charAt(0).toUpperCase()+name.slice(1)}return name==="deviceId"?"sourceId":name};if(r.ideal!==undefined){cc.optional=cc.optional||[];var oc={};if(typeof r.ideal==="number"){oc[oldname_("min",key)]=r.ideal;cc.optional.push(oc);oc={};oc[oldname_("max",key)]=r.ideal;cc.optional.push(oc)}else{oc[oldname_("",key)]=r.ideal;cc.optional.push(oc)}}if(r.exact!==undefined&&typeof r.exact!=="number"){cc.mandatory=cc.mandatory||{};cc.mandatory[oldname_("",key)]=r.exact}else{["min","max"].forEach(function(mix){if(r[mix]!==undefined){cc.mandatory=cc.mandatory||{};cc.mandatory[oldname_(mix,key)]=r[mix]}})}});if(c.advanced){cc.optional=(cc.optional||[]).concat(c.advanced)}return cc};var shimConstraints_=function(constraints,func){constraints=JSON.parse(JSON.stringify(constraints));if(constraints&&typeof constraints.audio==="object"){var remap=function(obj,a,b){if(a in obj&&!(b in obj)){obj[b]=obj[a];delete obj[a]}};constraints=JSON.parse(JSON.stringify(constraints));remap(constraints.audio,"autoGainControl","googAutoGainControl");remap(constraints.audio,"noiseSuppression","googNoiseSuppression");constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&typeof constraints.video==="object"){var face=constraints.video.facingMode;face=face&&(typeof face==="object"?face:{ideal:face});var getSupportedFacingModeLies=browserDetails.version<66;if(face&&(face.exact==="user"||face.exact==="environment"||face.ideal==="user"||face.ideal==="environment")&&!(navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().facingMode&&!getSupportedFacingModeLies)){delete constraints.video.facingMode;var matches;if(face.exact==="environment"||face.ideal==="environment"){matches=["back","rear"]}else if(face.exact==="user"||face.ideal==="user"){matches=["front"]}if(matches){return navigator.mediaDevices.enumerateDevices().then(function(devices){devices=devices.filter(function(d){return d.kind==="videoinput"});var dev=devices.find(function(d){return matches.some(function(match){return d.label.toLowerCase().indexOf(match)!==-1})});if(!dev&&devices.length&&matches.indexOf("back")!==-1){dev=devices[devices.length-1]}if(dev){constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}}constraints.video=constraintsToChrome_(constraints.video);logging("chrome: "+JSON.stringify(constraints));return func(constraints)})}}constraints.video=constraintsToChrome_(constraints.video)}logging("chrome: "+JSON.stringify(constraints));return func(constraints)};var shimError_=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};var getUserMedia_=function(constraints,onSuccess,onError){shimConstraints_(constraints,function(c){navigator.webkitGetUserMedia(c,onSuccess,function(e){if(onError){onError(shimError_(e))}})})};navigator.getUserMedia=getUserMedia_;var getUserMediaPromise_=function(constraints){return new Promise(function(resolve,reject){navigator.getUserMedia(constraints,resolve,reject)})};if(!navigator.mediaDevices){navigator.mediaDevices={getUserMedia:getUserMediaPromise_,enumerateDevices:function(){return new Promise(function(resolve){var kinds={audio:"audioinput",video:"videoinput"};return window.MediaStreamTrack.getSources(function(devices){resolve(devices.map(function(device){return{label:device.label,kind:kinds[device.kind],deviceId:device.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:true,echoCancellation:true,facingMode:true,frameRate:true,height:true,width:true}}}}if(!navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia=function(constraints){return getUserMediaPromise_(constraints)}}else{var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,function(c){return origGetUserMedia(c).then(function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length){stream.getTracks().forEach(function(track){track.stop()});throw new DOMException("","NotFoundError")}return stream},function(e){return Promise.reject(shimError_(e))})})}}if(typeof navigator.mediaDevices.addEventListener==="undefined"){navigator.mediaDevices.addEventListener=function(){logging("Dummy mediaDevices.addEventListener called.")}}if(typeof navigator.mediaDevices.removeEventListener==="undefined"){navigator.mediaDevices.removeEventListener=function(){logging("Dummy mediaDevices.removeEventListener called.")}}}},{"../utils.js":570}],564:[function(require,module,exports){"use strict";var SDPUtils=require("sdp");var utils=require("./utils");function wrapPeerConnectionEvent(window,eventNameToWrap,wrapper){if(!window.RTCPeerConnection){return}var proto=window.RTCPeerConnection.prototype;var nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap){return nativeAddEventListener.apply(this,arguments)}var wrappedCallback=function(e){cb(wrapper(e))};this._eventMap=this._eventMap||{};this._eventMap[cb]=wrappedCallback;return nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};var nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[cb]){return nativeRemoveEventListener.apply(this,arguments)}var unwrappedCb=this._eventMap[cb];delete this._eventMap[cb];return nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])};Object.defineProperty(proto,"on"+eventNameToWrap,{get:function(){return this["_on"+eventNameToWrap]},set:function(cb){if(this["_on"+eventNameToWrap]){this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]);delete this["_on"+eventNameToWrap]}if(cb){this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)}}})}module.exports={shimRTCIceCandidate:function(window){if(window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype){return}var NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function(args){if(typeof args==="object"&&args.candidate&&args.candidate.indexOf("a=")===0){args=JSON.parse(JSON.stringify(args));args.candidate=args.candidate.substr(2)}var nativeCandidate=new NativeRTCIceCandidate(args);var parsedCandidate=SDPUtils.parseCandidate(args.candidate);var augmentedCandidate=Object.assign(nativeCandidate,parsedCandidate);augmentedCandidate.toJSON=function(){return{candidate:augmentedCandidate.candidate,sdpMid:augmentedCandidate.sdpMid,sdpMLineIndex:augmentedCandidate.sdpMLineIndex,usernameFragment:augmentedCandidate.usernameFragment}};return augmentedCandidate};wrapPeerConnectionEvent(window,"icecandidate",function(e){if(e.candidate){Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"})}return e})},shimCreateObjectURL:function(window){var URL=window&&window.URL;if(!(typeof window==="object"&&window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype&&URL.createObjectURL&&URL.revokeObjectURL)){return undefined}var nativeCreateObjectURL=URL.createObjectURL.bind(URL);var nativeRevokeObjectURL=URL.revokeObjectURL.bind(URL);var streams=new Map,newId=0;URL.createObjectURL=function(stream){if("getTracks"in stream){var url="polyblob:"+ ++newId;streams.set(url,stream);utils.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return url}return nativeCreateObjectURL(stream)};URL.revokeObjectURL=function(url){nativeRevokeObjectURL(url);streams.delete(url)};var dsc=Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,"src");Object.defineProperty(window.HTMLMediaElement.prototype,"src",{get:function(){return dsc.get.apply(this)},set:function(url){this.srcObject=streams.get(url)||null;return dsc.set.apply(this,[url])}});var nativeSetAttribute=window.HTMLMediaElement.prototype.setAttribute;window.HTMLMediaElement.prototype.setAttribute=function(){if(arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"){this.srcObject=streams.get(arguments[1])||null}return nativeSetAttribute.apply(this,arguments)}}}},{"./utils":570,sdp:451}],565:[function(require,module,exports){"use strict";var utils=require("../utils");var shimRTCPeerConnection=require("rtcpeerconnection-shim");module.exports={shimGetUserMedia:require("./getusermedia"),shimPeerConnection:function(window){var browserDetails=utils.detectBrowser(window);if(window.RTCIceGatherer){if(!window.RTCIceCandidate){window.RTCIceCandidate=function(args){return args}}if(!window.RTCSessionDescription){window.RTCSessionDescription=function(args){return args}}if(browserDetails.version<15025){var origMSTEnabled=Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype,"enabled");Object.defineProperty(window.MediaStreamTrack.prototype,"enabled",{set:function(value){origMSTEnabled.set.call(this,value);var ev=new Event("enabled");ev.enabled=value;this.dispatchEvent(ev)}})}}if(window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=new window.RTCDtmfSender(this)}else if(this.track.kind==="video"){this._dtmf=null}}return this._dtmf}})}window.RTCPeerConnection=shimRTCPeerConnection(window,browserDetails.version)},shimReplaceTrack:function(window){if(window.RTCRtpSender&&!("replaceTrack"in window.RTCRtpSender.prototype)){window.RTCRtpSender.prototype.replaceTrack=window.RTCRtpSender.prototype.setTrack}}}},{"../utils":570,"./getusermedia":566,"rtcpeerconnection-shim":442}],566:[function(require,module,exports){"use strict";module.exports=function(window){var navigator=window&&window.navigator;var shimError_=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}};var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).catch(function(e){return Promise.reject(shimError_(e))})}}},{}],567:[function(require,module,exports){"use strict";var utils=require("../utils");var firefoxShim={shimOnTrack:function(window){if(typeof window==="object"&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(f){if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=f);this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(track){var event=new Event("track");event.track=track;event.receiver={track:track};event.transceiver={receiver:event.receiver};event.streams=[e.stream];this.dispatchEvent(event)}.bind(this))}.bind(this))}})}if(typeof window==="object"&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)){Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimSourceObject:function(window){if(typeof window==="object"){if(window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)){Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(stream){this.mozSrcObject=stream}})}}},shimPeerConnection:function(window){var browserDetails=utils.detectBrowser(window);if(typeof window!=="object"||!(window.RTCPeerConnection||window.mozRTCPeerConnection)){return}if(!window.RTCPeerConnection){window.RTCPeerConnection=function(pcConfig,pcConstraints){if(browserDetails.version<38){if(pcConfig&&pcConfig.iceServers){var newIceServers=[];for(var i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];if(server.hasOwnProperty("urls")){for(var j=0;j<server.urls.length;j++){var newServer={url:server.urls[j]};if(server.urls[j].indexOf("turn")===0){newServer.username=server.username;newServer.credential=server.credential}newIceServers.push(newServer)}}else{newIceServers.push(pcConfig.iceServers[i])}}pcConfig.iceServers=newIceServers}}return new window.mozRTCPeerConnection(pcConfig,pcConstraints)};window.RTCPeerConnection.prototype=window.mozRTCPeerConnection.prototype;if(window.mozRTCPeerConnection.generateCertificate){Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return window.mozRTCPeerConnection.generateCertificate}})}window.RTCSessionDescription=window.mozRTCSessionDescription;window.RTCIceCandidate=window.mozRTCIceCandidate}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(method){var nativeMethod=window.RTCPeerConnection.prototype[method];window.RTCPeerConnection.prototype[method]=function(){arguments[0]=new(method==="addIceCandidate"?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]);return nativeMethod.apply(this,arguments)}});var nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;window.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return nativeAddIceCandidate.apply(this,arguments)};var makeMapStats=function(stats){var map=new Map;Object.keys(stats).forEach(function(key){map.set(key,stats[key]);map[key]=stats[key]});return map};var modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function(selector,onSucc,onErr){return nativeGetStats.apply(this,[selector||null]).then(function(stats){if(browserDetails.version<48){stats=makeMapStats(stats)}if(browserDetails.version<53&&!onSucc){try{stats.forEach(function(stat){stat.type=modernStatsTypes[stat.type]||stat.type})}catch(e){if(e.name!=="TypeError"){throw e}stats.forEach(function(stat,i){stats.set(i,Object.assign({},stat,{type:modernStatsTypes[stat.type]||stat.type}))})}}return stats}).then(onSucc,onErr)}}};module.exports={shimOnTrack:firefoxShim.shimOnTrack,shimSourceObject:firefoxShim.shimSourceObject,shimPeerConnection:firefoxShim.shimPeerConnection,shimGetUserMedia:require("./getusermedia")}},{"../utils":570,"./getusermedia":568}],568:[function(require,module,exports){"use strict";var utils=require("../utils");var logging=utils.log;module.exports=function(window){var browserDetails=utils.detectBrowser(window);var navigator=window&&window.navigator;var MediaStreamTrack=window&&window.MediaStreamTrack;var shimError_=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the "+"user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}};var getUserMedia_=function(constraints,onSuccess,onError){var constraintsToFF37_=function(c){if(typeof c!=="object"||c.require){return c}var require=[];Object.keys(c).forEach(function(key){if(key==="require"||key==="advanced"||key==="mediaSource"){return}var r=c[key]=typeof c[key]==="object"?c[key]:{ideal:c[key]};if(r.min!==undefined||r.max!==undefined||r.exact!==undefined){require.push(key)}if(r.exact!==undefined){if(typeof r.exact==="number"){r.min=r.max=r.exact}else{c[key]=r.exact}delete r.exact}if(r.ideal!==undefined){c.advanced=c.advanced||[];var oc={};if(typeof r.ideal==="number"){oc[key]={min:r.ideal,max:r.ideal}}else{oc[key]=r.ideal}c.advanced.push(oc);delete r.ideal;if(!Object.keys(r).length){delete c[key]}}});if(require.length){c.require=require}return c};constraints=JSON.parse(JSON.stringify(constraints));if(browserDetails.version<38){logging("spec: "+JSON.stringify(constraints));if(constraints.audio){constraints.audio=constraintsToFF37_(constraints.audio)}if(constraints.video){constraints.video=constraintsToFF37_(constraints.video)}logging("ff37: "+JSON.stringify(constraints))}return navigator.mozGetUserMedia(constraints,onSuccess,function(e){onError(shimError_(e))})};var getUserMediaPromise_=function(constraints){return new Promise(function(resolve,reject){getUserMedia_(constraints,resolve,reject)})};if(!navigator.mediaDevices){navigator.mediaDevices={getUserMedia:getUserMediaPromise_,addEventListener:function(){},removeEventListener:function(){}}}navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(resolve){var infos=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];resolve(infos)})};if(browserDetails.version<41){var orgEnumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return orgEnumerateDevices().then(undefined,function(e){if(e.name==="NotFoundError"){return[]}throw e})}}if(browserDetails.version<49){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).then(function(stream){if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length){stream.getTracks().forEach(function(track){track.stop()});throw new DOMException("The object can not be found here.","NotFoundError")}return stream},function(e){return Promise.reject(shimError_(e))})}}if(!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){var remap=function(obj,a,b){if(a in obj&&!(b in obj)){obj[b]=obj[a];delete obj[a]}};var nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){if(typeof c==="object"&&typeof c.audio==="object"){c=JSON.parse(JSON.stringify(c));remap(c.audio,"autoGainControl","mozAutoGainControl");remap(c.audio,"noiseSuppression","mozNoiseSuppression")}return nativeGetUserMedia(c)};if(MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){var nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var obj=nativeGetSettings.apply(this,arguments);remap(obj,"mozAutoGainControl","autoGainControl");remap(obj,"mozNoiseSuppression","noiseSuppression");return obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){var nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){if(this.kind==="audio"&&typeof c==="object"){c=JSON.parse(JSON.stringify(c));remap(c,"autoGainControl","mozAutoGainControl");remap(c,"noiseSuppression","mozNoiseSuppression")}return nativeApplyConstraints.apply(this,[c])}}}navigator.getUserMedia=function(constraints,onSuccess,onError){if(browserDetails.version<44){return getUserMedia_(constraints,onSuccess,onError)}utils.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)}}},{"../utils":570}],569:[function(require,module,exports){"use strict";var utils=require("../utils");var safariShim={shimLocalStreamsAPI:function(window){if(typeof window!=="object"||!window.RTCPeerConnection){return}if(!("getLocalStreams"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("getStreamById"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.getStreamById=function(id){var result=null;if(this._localStreams){this._localStreams.forEach(function(stream){if(stream.id===id){result=stream}})}if(this._remoteStreams){this._remoteStreams.forEach(function(stream){if(stream.id===id){result=stream}})}return result}}if(!("addStream"in window.RTCPeerConnection.prototype)){var _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function(stream){if(!this._localStreams){this._localStreams=[]}if(this._localStreams.indexOf(stream)===-1){this._localStreams.push(stream)}var self=this;stream.getTracks().forEach(function(track){_addTrack.call(self,track,stream)})};window.RTCPeerConnection.prototype.addTrack=function(track,stream){if(stream){if(!this._localStreams){this._localStreams=[stream]}else if(this._localStreams.indexOf(stream)===-1){this._localStreams.push(stream)}}_addTrack.call(this,track,stream)}}if(!("removeStream"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.removeStream=function(stream){if(!this._localStreams){this._localStreams=[]}var index=this._localStreams.indexOf(stream);if(index===-1){return}this._localStreams.splice(index,1);var self=this;var tracks=stream.getTracks();this.getSenders().forEach(function(sender){if(tracks.indexOf(sender.track)!==-1){self.removeTrack(sender)}})}}},shimRemoteStreamsAPI:function(window){if(typeof window!=="object"||!window.RTCPeerConnection){return}if(!("getRemoteStreams"in window.RTCPeerConnection.prototype)){window.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(f){if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=f);this.addEventListener("track",this._onaddstreampoly=function(e){var stream=e.streams[0];if(!this._remoteStreams){this._remoteStreams=[]}if(this._remoteStreams.indexOf(stream)>=0){return}this._remoteStreams.push(stream);var event=new Event("addstream");event.stream=e.streams[0];this.dispatchEvent(event)}.bind(this))}})}},shimCallbacksAPI:function(window){if(typeof window!=="object"||!window.RTCPeerConnection){return}var prototype=window.RTCPeerConnection.prototype;var createOffer=prototype.createOffer;var createAnswer=prototype.createAnswer;var setLocalDescription=prototype.setLocalDescription;var setRemoteDescription=prototype.setRemoteDescription;var addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0];var promise=createOffer.apply(this,[options]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.createAnswer=function(successCallback,failureCallback){var options=arguments.length>=2?arguments[2]:arguments[0];var promise=createAnswer.apply(this,[options]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};var withCallback=function(description,successCallback,failureCallback){var promise=setLocalDescription.apply(this,[description]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.setLocalDescription=withCallback;withCallback=function(description,successCallback,failureCallback){var promise=setRemoteDescription.apply(this,[description]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.setRemoteDescription=withCallback;withCallback=function(candidate,successCallback,failureCallback){var promise=addIceCandidate.apply(this,[candidate]);if(!failureCallback){return promise}promise.then(successCallback,failureCallback);return Promise.resolve()};prototype.addIceCandidate=withCallback},shimGetUserMedia:function(window){var navigator=window&&window.navigator;if(!navigator.getUserMedia){if(navigator.webkitGetUserMedia){navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator)}else if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.getUserMedia=function(constraints,cb,errcb){navigator.mediaDevices.getUserMedia(constraints).then(cb,errcb)}.bind(navigator)}}},shimRTCIceServerUrls:function(window){var OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){var newIceServers=[];for(var i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];if(!server.hasOwnProperty("urls")&&server.hasOwnProperty("url")){utils.deprecated("RTCIceServer.url","RTCIceServer.urls");server=JSON.parse(JSON.stringify(server));server.urls=server.url;delete server.url;newIceServers.push(server)}else{newIceServers.push(pcConfig.iceServers[i])}}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)};window.RTCPeerConnection.prototype=OrigPeerConnection.prototype;if("generateCertificate"in window.RTCPeerConnection){Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return OrigPeerConnection.generateCertificate}})}},shimTrackEventTransceiver:function(window){if(typeof window==="object"&&window.RTCPeerConnection&&"receiver"in window.RTCTrackEvent.prototype&&!window.RTCTransceiver){Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimCreateOfferLegacy:function(window){var origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function(offerOptions){var pc=this;if(offerOptions){var audioTransceiver=pc.getTransceivers().find(function(transceiver){return transceiver.sender.track&&transceiver.sender.track.kind==="audio"});if(offerOptions.offerToReceiveAudio===false&&audioTransceiver){if(audioTransceiver.direction==="sendrecv"){audioTransceiver.setDirection("sendonly")}else if(audioTransceiver.direction==="recvonly"){audioTransceiver.setDirection("inactive")}}else if(offerOptions.offerToReceiveAudio===true&&!audioTransceiver){pc.addTransceiver("audio")}var videoTransceiver=pc.getTransceivers().find(function(transceiver){return transceiver.sender.track&&transceiver.sender.track.kind==="video"});if(offerOptions.offerToReceiveVideo===false&&videoTransceiver){if(videoTransceiver.direction==="sendrecv"){videoTransceiver.setDirection("sendonly")}else if(videoTransceiver.direction==="recvonly"){videoTransceiver.setDirection("inactive")}}else if(offerOptions.offerToReceiveVideo===true&&!videoTransceiver){pc.addTransceiver("video")}}return origCreateOffer.apply(pc,arguments)}}};module.exports={shimCallbacksAPI:safariShim.shimCallbacksAPI,shimLocalStreamsAPI:safariShim.shimLocalStreamsAPI,shimRemoteStreamsAPI:safariShim.shimRemoteStreamsAPI,shimGetUserMedia:safariShim.shimGetUserMedia,shimRTCIceServerUrls:safariShim.shimRTCIceServerUrls,shimTrackEventTransceiver:safariShim.shimTrackEventTransceiver,shimCreateOfferLegacy:safariShim.shimCreateOfferLegacy}},{"../utils":570}],570:[function(require,module,exports){"use strict";var logDisabled_=true;var deprecationWarnings_=true;var utils={disableLog:function(bool){if(typeof bool!=="boolean"){return new Error("Argument type: "+typeof bool+". Please use a boolean.")}logDisabled_=bool;return bool?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(bool){if(typeof bool!=="boolean"){return new Error("Argument type: "+typeof bool+". Please use a boolean.")}deprecationWarnings_=!bool;return"adapter.js deprecation warnings "+(bool?"disabled":"enabled")},log:function(){if(typeof window==="object"){if(logDisabled_){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}},deprecated:function(oldMethod,newMethod){if(!deprecationWarnings_){return}console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")},extractVersion:function(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)},detectBrowser:function(window){var navigator=window&&window.navigator;var result={};result.browser=null;result.version=null;if(typeof window==="undefined"||!window.navigator){result.browser="Not a browser.";return result}if(navigator.mozGetUserMedia){result.browser="firefox";result.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1)}else if(navigator.webkitGetUserMedia){if(window.webkitRTCPeerConnection){result.browser="chrome";result.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else{if(navigator.userAgent.match(/Version\/(\d+).(\d+)/)){result.browser="safari";result.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else{result.browser="Unsupported webkit-based browser "+"with GUM support but no WebRTC support.";return result}}}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){result.browser="edge";result.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(navigator.mediaDevices&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)){result.browser="safari";result.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else{result.browser="Not a supported browser.";return result}return result}};module.exports={log:utils.log,deprecated:utils.deprecated,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings,extractVersion:utils.extractVersion,shimCreateObjectURL:utils.shimCreateObjectURL,detectBrowser:utils.detectBrowser.bind(utils)}},{}],571:[function(require,module,exports){var prefix;var version;if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){prefix="moz";version=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia){prefix="webkit";version=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)}var PC=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var IceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate;var SessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription;var MediaStream=window.webkitMediaStream||window.MediaStream;var screenSharing=window.location.protocol==="https:"&&(prefix==="webkit"&&version>=26||prefix==="moz"&&version>=33);var AudioContext=window.AudioContext||window.webkitAudioContext;var videoEl=document.createElement("video");var supportVp8=videoEl&&videoEl.canPlayType&&videoEl.canPlayType('video/webm; codecs="vp8", vorbis')==="probably";var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;module.exports={prefix:prefix,browserVersion:version,support:!!PC&&!!getUserMedia,supportRTCPeerConnection:!!PC,supportVp8:supportVp8,supportGetUserMedia:!!getUserMedia,supportDataChannel:!!(PC&&PC.prototype&&PC.prototype.createDataChannel),supportWebAudio:!!(AudioContext&&AudioContext.prototype.createMediaStreamSource),supportMediaStream:!!(MediaStream&&MediaStream.prototype.removeTrack),supportScreenSharing:!!screenSharing,AudioContext:AudioContext,PeerConnection:PC,SessionDescription:SessionDescription,IceCandidate:IceCandidate,MediaStream:MediaStream,getUserMedia:getUserMedia}},{}],572:[function(require,module,exports){(function(self){"use strict";if(self.fetch){return}var support={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{new Blob;return true}catch(e){return false}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(support.arrayBuffer){var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var isDataView=function(obj){return obj&&DataView.prototype.isPrototypeOf(obj)};var isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1}}function normalizeName(name){if(typeof name!=="string"){name=String(name)}if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(name)){throw new TypeError("Invalid character in header field name")}return name.toLowerCase()}function normalizeValue(value){if(typeof value!=="string"){value=String(value)}return value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===undefined,value:value}}};if(support.iterable){iterator[Symbol.iterator]=function(){return iterator}}return iterator}function Headers(headers){this.map={};if(headers instanceof Headers){headers.forEach(function(value,name){this.append(name,value)},this)}else if(Array.isArray(headers)){headers.forEach(function(header){this.append(header[0],header[1])},this)}else if(headers){Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}}Headers.prototype.append=function(name,value){name=normalizeName(name);value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+","+value:value};Headers.prototype["delete"]=function(name){delete this.map[normalizeName(name)]};Headers.prototype.get=function(name){name=normalizeName(name);return this.has(name)?this.map[name]:null};Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))};Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)};Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map){if(this.map.hasOwnProperty(name)){callback.call(thisArg,this.map[name],name,this)}}};Headers.prototype.keys=function(){var items=[];this.forEach(function(value,name){items.push(name)});return iteratorFor(items)};Headers.prototype.values=function(){var items=[];this.forEach(function(value){items.push(value)});return iteratorFor(items)};Headers.prototype.entries=function(){var items=[];this.forEach(function(value,name){items.push([name,value])});return iteratorFor(items)};if(support.iterable){Headers.prototype[Symbol.iterator]=Headers.prototype.entries}function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError("Already read"))}body.bodyUsed=true}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsArrayBuffer(blob);return promise}function readBlobAsText(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsText(blob);return promise}function readArrayBufferAsText(buf){var view=new Uint8Array(buf);var chars=new Array(view.length);for(var i=0;i<view.length;i++){chars[i]=String.fromCharCode(view[i])}return chars.join("")}function bufferClone(buf){if(buf.slice){return buf.slice(0)}else{var view=new Uint8Array(buf.byteLength);view.set(new Uint8Array(buf));return view.buffer}}function Body(){this.bodyUsed=false;this._initBody=function(body){this._bodyInit=body;if(!body){this._bodyText=""}else if(typeof body==="string"){this._bodyText=body}else if(support.blob&&Blob.prototype.isPrototypeOf(body)){this._bodyBlob=body}else if(support.formData&&FormData.prototype.isPrototypeOf(body)){this._bodyFormData=body}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this._bodyText=body.toString()}else if(support.arrayBuffer&&support.blob&&isDataView(body)){this._bodyArrayBuffer=bufferClone(body.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))){this._bodyArrayBuffer=bufferClone(body)}else{throw new Error("unsupported BodyInit type")}if(!this.headers.get("content-type")){if(typeof body==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(support.blob){this.blob=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return consumed(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(readBlobAsArrayBuffer)}}}this.text=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return readBlobAsText(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(support.formData){this.formData=function(){return this.text().then(decode)}}this.json=function(){return this.text().then(JSON.parse)};return this}var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed){throw new TypeError("Already read")}this.url=input.url;this.credentials=input.credentials;if(!options.headers){this.headers=new Headers(input.headers)}this.method=input.method;this.mode=input.mode;if(!body&&input._bodyInit!=null){body=input._bodyInit;input.bodyUsed=true}}else{this.url=String(input)}this.credentials=options.credentials||this.credentials||"omit";if(options.headers||!this.headers){this.headers=new Headers(options.headers)}this.method=normalizeMethod(options.method||this.method||"GET");this.mode=options.mode||this.mode||null;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&body){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(body)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode(body){var form=new FormData;body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("=");var name=split.shift().replace(/\+/g," ");var value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}});return form}function parseHeaders(rawHeaders){var headers=new Headers;rawHeaders.split(/\r?\n/).forEach(function(line){var parts=line.split(":");var key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}});return headers}Body.call(Request.prototype);function Response(bodyInit,options){if(!options){options={}}this.type="default";this.status="status"in options?options.status:200;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in options?options.statusText:"OK";this.headers=new Headers(options.headers);this.url=options.url||"";this._initBody(bodyInit)}Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})};Response.error=function(){var response=new Response(null,{status:0,statusText:""});response.type="error";return response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1){throw new RangeError("Invalid status code")}return new Response(null,{status:status,headers:{location:url}})};self.Headers=Headers;self.Request=Request;self.Response=Response;self.fetch=function(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);var xhr=new XMLHttpRequest;xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))};xhr.onerror=function(){reject(new TypeError("Network request failed"))};xhr.ontimeout=function(){reject(new TypeError("Network request failed"))};xhr.open(request.method,request.url,true);if(request.credentials==="include"){xhr.withCredentials=true}if("responseType"in xhr&&support.blob){xhr.responseType="blob"}request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)});xhr.send(typeof request._bodyInit==="undefined"?null:request._bodyInit)})};self.fetch.polyfill=true})(typeof self!=="undefined"?self:this)},{}],573:[function(require,module,exports){module.exports=WildEmitter;function WildEmitter(){}WildEmitter.mixin=function(constructor){var prototype=constructor.prototype||constructor;prototype.isWildEmitter=true;prototype.on=function(event,groupName,fn){this.callbacks=this.callbacks||{};var hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];func._groupName=group;(this.callbacks[event]=this.callbacks[event]||[]).push(func);return this};prototype.once=function(event,groupName,fn){var self=this,hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on);func.apply(this,arguments)}this.on(event,group,on);return this};prototype.releaseGroup=function(groupName){this.callbacks=this.callbacks||{};var item,i,len,handlers;for(item in this.callbacks){handlers=this.callbacks[item];for(i=0,len=handlers.length;i<len;i++){if(handlers[i]._groupName===groupName){handlers.splice(i,1);i--;len--}}}return this};prototype.off=function(event,fn){this.callbacks=this.callbacks||{};var callbacks=this.callbacks[event],i;if(!callbacks)return this;if(arguments.length===1){delete this.callbacks[event];return this}i=callbacks.indexOf(fn);callbacks.splice(i,1);if(callbacks.length===0){delete this.callbacks[event]}return this};prototype.emit=function(event){this.callbacks=this.callbacks||{};var args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event),i,len,item,listeners;if(callbacks){listeners=callbacks.slice();for(i=0,len=listeners.length;i<len;++i){if(!listeners[i]){break}listeners[i].apply(this,args)}}if(specialCallbacks){len=specialCallbacks.length;listeners=specialCallbacks.slice();for(i=0,len=listeners.length;i<len;++i){if(!listeners[i]){break}listeners[i].apply(this,[event].concat(args))}}return this};prototype.getWildcardCallbacks=function(eventName){this.callbacks=this.callbacks||{};var item,split,result=[];for(item in this.callbacks){split=item.split("*");if(item==="*"||split.length===2&&eventName.slice(0,split[0].length)===split[0]){result=result.concat(this.callbacks[item])}}return result}};WildEmitter.mixin(WildEmitter)},{}],574:[function(require,module,exports){module.exports=extend;var hasOwnProperty=Object.prototype.hasOwnProperty;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target}},{}],575:[function(require,module,exports){module.exports=extend;var hasOwnProperty=Object.prototype.hasOwnProperty;function extend(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target}},{}],576:[function(require,module,exports){"use strict";var alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded="";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],577:[function(require,module,exports){"use strict";var _templateObject=_taggedTemplateLiteral(['\n    <div\n    class="app"\n    onload=',"\n    >\n      ","\n      ","\n      ","\n    </div>\n  "],['\n    <div\n    class="app"\n    onload=',"\n    >\n      ","\n      ","\n      ","\n    </div>\n  "]);var _Whammy=require("./lib/Whammy");var _Whammy2=_interopRequireDefault(_Whammy);var _common=require("./common");var _webrtcAdapter=require("webrtc-adapter");var _webrtcAdapter2=_interopRequireDefault(_webrtcAdapter);var _model=require("./model");var _model2=_interopRequireDefault(_model);var _lodash=require("lodash");var _simplewebrtc=require("simplewebrtc");var _simplewebrtc2=_interopRequireDefault(_simplewebrtc);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}require("fastclick")(document.body);var html=require("choo/html");var choo=require("choo");var app=choo();if(_common.IS_DEV){app.use(require("choo-devtools")())}app.use(require("./store"));var onload=function onload(el){};var home=require("./views/home");var room=require("./views/room");var ui=require("./views/ui");function mainView(state,emit){return html(_templateObject,onload,home(state,emit),room(state,emit),ui(state,emit,app.emitter))}app.route("/*",mainView);var tree=app.start();document.body.appendChild(tree)},{"./common":584,"./lib/Whammy":603,"./model":606,"./store":608,"./views/home":609,"./views/room":610,"./views/ui":611,choo:37,"choo-devtools":27,"choo/html":36,fastclick:175,lodash:224,simplewebrtc:489,"webrtc-adapter":560}],578:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var isFunction=function isFunction(obj){return typeof obj=="function"||false};var Accelerometer=function Accelerometer(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{multiplier:1,useGravity:false};var state={x:null,y:null,z:null,rotation:null,landscape:false};var listeners=new Map;var firstTime=true;var offset={alpha:0,beta:0,gamma:0};var handleOrientation=function handleOrientation(event){var _window=window,orientation=_window.orientation;firstTime=true;state=_extends({},state,{landscape:orientation===90||orientation===-90});var _state=state,landscape=_state.landscape,rotation=_state.rotation;emit("orientationchange",{landscape:landscape,rotation:rotation})};var handleAcceleration=function handleAcceleration(event){var _state2=state,landscape=_state2.landscape;var useGravity=props.useGravity,multiplier=props.multiplier;var acceleration=useGravity?event.accelerationIncludingGravity:event.acceleration;var rotation=event.rotationRate||null;var x=acceleration.x,y=acceleration.y,z=acceleration.z;state=_extends({},state,{rotation:rotation,x:(landscape?y:x)*multiplier,y:(landscape?x:y)*multiplier,z:z*multiplier});emit("devicemotion",state)};var handleMovment=function handleMovment(e){if(firstTime){offset.alpha=e.alpha;offset.beta=e.beta;offset.gamma=e.gamma;firstTime=false;return}var alpha=e.alpha-offset.alpha;var beta=e.beta-offset.beta;var gamma=e.gamma-offset.gamma;emit("deviceorientation",{alpha:alpha,beta:beta,gamma:gamma,landscape:state.landscape})};var destroy=function destroy(){window.removeEventListener("deviceorientation",handleMovment);window.removeEventListener("devicemotion",handleAcceleration);window.removeEventListener("orientationchange",handleOrientation);listeners.clear()};var on=function on(label,callback){listeners.has(label)||listeners.set(label,[]);listeners.get(label).push(callback)};var off=function off(label,callback){var funcs=listeners.get(label),index=void 0;if(funcs&&funcs.length){index=funcs.reduce(function(i,listener,index){return isFunction(listener)&&listener===callback?i=index:i},-1);if(index>-1){funcs.splice(index,1);listeners.set(label,listeners);return true}}return false};var emit=function emit(label){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var func=listeners.get(label);if(func&&func.length){func.forEach(function(listener){listener.apply(undefined,args)});return true}return false};handleOrientation();window.addEventListener("deviceorientation",handleMovment);window.addEventListener("devicemotion",handleAcceleration);window.addEventListener("orientationchange",handleOrientation);return{state:state,on:on,off:off,destroy:destroy}};exports.default=Accelerometer},{}],579:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _queryString=require("query-string");var _queryString2=_interopRequireDefault(_queryString);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AUTH_SERVICE=function(){var ERROR_TYPES={INCOMPLETE:"INCOMPLETE",MISMATCH:"MISMATCH",STORE_VIDEO_FAILED:"STORE_VIDEO_FAILED"};function auth(url){return new Promise(function(yes,no){var newWindow=window.open(url,null,"height=700,width=600,status=yes,toolbar=no,menubar=no,location=no");var _i=setInterval(function(){if(newWindow){if(newWindow.location){var _url=newWindow.location.href||newWindow.location;var success=_url.indexOf("success")>-1;if(success){clearInterval(_i);var _str=_url.split("success?")[1];var parsedHash=_queryString2.default.parse(_str);newWindow.close();newWindow=null;yes(parsedHash)}}}},200)})}return{auth:auth,ERROR_TYPES:ERROR_TYPES}}();exports.default=AUTH_SERVICE},{"query-string":426}],580:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _templateObject=_taggedTemplateLiteral(['\n    <div class="','">\n      ',"\n    </div>\n    "],['\n    <div class="','">\n      ',"\n    </div>\n    "]);var _lodash=require("lodash");function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Nanocomponent=require("nanocomponent");var html=require("bel");var InnerComponent=function(_Nanocomponent){_inherits(InnerComponent,_Nanocomponent);function InnerComponent(){_classCallCheck(this,InnerComponent);return _possibleConstructorReturn(this,(InnerComponent.__proto__||Object.getPrototypeOf(InnerComponent)).apply(this,arguments))}_createClass(InnerComponent,[{key:"createElement",value:function createElement(text){this.text=text;return this.text}},{key:"update",value:function update(text){this.text=text;return true}}]);return InnerComponent}(Nanocomponent);var Component=function(_Nanocomponent2){_inherits(Component,_Nanocomponent2);function Component(){_classCallCheck(this,Component);var _this2=_possibleConstructorReturn(this,(Component.__proto__||Object.getPrototypeOf(Component)).call(this));_this2._inner=new InnerComponent;return _this2}_createClass(Component,[{key:"createElement",value:function createElement(text){var classes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var cb=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if((0,_lodash.isObject)(classes)){this._cb=classes}else{this._cb=cb}this.classes=classes;this.text=text;return html(_templateObject,(0,_lodash.isObject)(this.classes)?null:this.classes,this._inner.render(this.text))}},{key:"update",value:function update(text){this._inner.render(text);return false}},{key:"load",value:function load(el){if(this._cb.onload){this._cb.onload();this._cb=null}}},{key:"unload",value:function unload(){console.log("Not in dom")}}]);return Component}(Nanocomponent);module.exports=Component},{bel:22,lodash:224,nanocomponent:231}],581:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});window.Detector={};var Detector=window.Detector;var ua=navigator.userAgent||navigator.vendor||window.opera;Detector.isIpad=!!ua.match(/iPad/i);Detector.isIphone=!!ua.match(/iPhone/i);Detector.isIpod=!!ua.match(/iPod/i);Detector.isIOS=Detector.isIpad||Detector.isIphone||Detector.isIpod;Detector.isIOS5=!!ua.match(/OS 5(_\d)+ like Mac OS X/i);Detector.isIOS6=!!ua.match(/OS 6(_\d)+ like Mac OS X/i);Detector.isIOS7=!!ua.match(/OS 7(_\d)+ like Mac OS X/i);Detector.isIOS8=!!ua.match(/OS 8(_\d)+ like Mac OS X/i);Detector.isIOS9=!!ua.match(/OS 9(_\d)+ like Mac OS X/i);Detector.IOSVersion=function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var v=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);console.log(v);return parseInt(v[1],10)}else{return false}}();Detector.isAndroid=!!ua.match(/Android/i);Detector.isAndroidOld=!!(Detector.isAndroid&&parseFloat(ua.slice(ua.indexOf("Android")+8))<4);Detector.isAndroidStock=function(){var regExAppleWebKit=new RegExp(/AppleWebKit\/([\d.]+)/);var resultAppleWebKitRegEx=regExAppleWebKit.exec(ua);var appleWebKitVersion=resultAppleWebKitRegEx===null?null:parseFloat(regExAppleWebKit.exec(ua)[1]);var isAndroidBrowser=Detector.isAndroid&&appleWebKitVersion!==null&&appleWebKitVersion<537;return isAndroidBrowser}();Detector.isTabvar=(Detector.isAndroid||Detector.isIOS)&&/ipad|android 3|sch-i800|playbook|tablet|kindle|gt-p1000|sgh-t849|shw-m180s|a510|a511|a100|dell streak|silk/i.test(ua.toLowerCase());Detector.isMobile=(Detector.isAndroid||Detector.isIOS)&&/iphone|ipod|android|blackberry|opera mini|opera mobi|skyfire|maemo|windows phone|palm|iemobile|symbian|symbianos|fennec/i.test(ua.toLowerCase());Detector.isDesktop=!Detector.isTabvar&&!Detector.isMobile;Detector.device=Detector.isTabvar?"tablet":Detector.isMobile?"mobile":"desktop";Detector.IEVersion=function(){var rv=-1;var re;if(navigator.appName==="Microsoft Internet Explorer"){re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!==null){rv=parseFloat(RegExp.$1)}}else if(navigator.appName==="Netscape"){re=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!==null){rv=parseFloat(RegExp.$1)}}return rv}();Detector.isIE=Detector.IEVersion>-1;Detector.isIE11=Detector.IEVersion===11;Detector.isIE11Down=Detector.IEVersion<=11;Detector.isIE11Up=Detector.IEVersion>=11;Detector.isIE10=Detector.IEVersion===10;Detector.isIE10Down=Detector.IEVersion<=10;Detector.isIE10Up=Detector.IEVersion>=10;Detector.isIE9=Detector.IEVersion===9;Detector.isIE9Down=Detector.IEVersion<=9;Detector.isIE9Up=Detector.IEVersion>=9;Detector.isIE8=Detector.IEVersion===8;Detector.isIE8Down=Detector.IEVersion<=8;Detector.isIE8Up=Detector.IEVersion>=8;Detector.isFirefox=ua.toLowerCase().indexOf("firefox")>-1;Detector.isChrome=function(){var isChromium=window.chrome,vendorName=window.navigator.vendor;return isChromium!==null&&isChromium!==undefined&&vendorName==="Google Inc."}();Detector.isSafari=/^((?!chrome).)*safari/i.test(ua);Detector.hasHistory=!!(history&&history.pushState);Detector.hasMouseMove=Detector.isDesktop;Detector.hasTouch="ontouchstart"in window||"onmsgesturechange"in window;Detector.hasFullscreen=function(){var element=document.body;return!!(element.requestFullScreen||element.webkitRequestFullScreen||element.mozRequestFullScreen||element.msRequestFullscreen)}();Detector.transitionEnd=function(){var el=document.createElement("fakeelement");var transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};var transitionend;for(var t in transitions){if(el.style[t]!==undefined){transitionend=transitions[t];break}}return transitionend}();Detector.visibilityChangeEventName=undefined;Detector.hiddenPropertyName=undefined;if(typeof document.hidden!=="undefined"){Detector.hiddenPropertyName="hidden";Detector.visibilityChangeEventName="visibilitychange"}else if(typeof document.mozHidden!=="undefined"){Detector.hiddenPropertyName="mozHidden";Detector.visibilityChangeEventName="mozvisibilitychange"}else if(typeof document.msHidden!=="undefined"){Detector.hiddenPropertyName="msHidden";Detector.visibilityChangeEventName="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){Detector.hiddenPropertyName="webkitHidden";Detector.visibilityChangeEventName="webkitvisibilitychange"}Detector.pixelRatio=window.devicePixelRatio||1;Detector.isRetina=Detector.pixelRatio>1;Detector.webp=Detector.isChrome&&!Detector.isSafari;Detector.hasCanvas=!!window.CanvasRenderingContext2D;Detector.hasWebgl=function(){try{var canvas=document.createElement("canvas");return!!(!!window.WebGLRenderingContext&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl")))}catch(e){return false}}();exports.default=window.Detector},{}],582:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require("lodash");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EventEmitter=function(){function EventEmitter(){_classCallCheck(this,EventEmitter);this.listeners=new Map}_createClass(EventEmitter,[{key:"on",value:function on(label,callback){this.listeners.has(label)||this.listeners.set(label,[]);this.listeners.get(label).push(callback)}},{key:"off",value:function off(label,callback){var listeners=this.listeners.get(label),index=void 0;if(listeners&&listeners.length){index=listeners.reduce(function(i,listener,index){return(0,_lodash.isFunction)(listener)&&listener===callback?i=index:i},-1);if(index>-1){listeners.splice(index,1);this.listeners.set(label,listeners);return true}}return false}},{key:"emit",value:function emit(label){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var listeners=this.listeners.get(label);if(listeners&&listeners.length){listeners.forEach(function(listener){listener.apply(undefined,args)});return true}return false}}]);return EventEmitter}();exports.default=new EventEmitter},{lodash:224}],583:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.disconnect=exports.connect=undefined;var _proxyObservable=require("proxy-observable");var _proxyObservable2=_interopRequireDefault(_proxyObservable);var _index=require("./index");var _server=require("./server");var _server2=_interopRequireDefault(_server);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var dat=require("dat.gui/build/dat.gui.js");var o=(0,_proxyObservable2.default)({state:null,localPeerId:null,secret:null,tolerance:.5,slope:.08,echo:{feedback:.5,delay:1,dry:.5},reverb:{time:1,decay:5},panner:{value:.5},deviceMotion:{x:0,y:0,z:0},deviceOrien:{alpha:0,beta:0,gamma:0},started:false,connect:false,disconnect:false,startWebcam:function startWebcam(){},stopWebcam:function stopWebcam(){},recording:false,rendering:false,recordStart:function recordStart(){},recordEnd:function recordEnd(){},recordFinalStart:function recordFinalStart(){},recordFinalStop:function recordFinalStop(){},recordProgress:0,instagram:function instagram(){_server2.default.insta().then(function(t){console.log(t)})}});if(_index.IS_DEV){var gui=new dat.GUI;gui.add(o,"tolerance",0,1);gui.add(o,"slope",0,1);gui.add(o,"startWebcam");gui.add(o,"stopWebcam");gui.add(o,"recordStart");gui.add(o,"recordEnd");gui.add(o,"recordFinalStart");gui.add(o,"recordFinalStop");gui.add(o,"instagram")}var connect=exports.connect=function connect(){o.disconnect=false;o.connect=true};var disconnect=exports.disconnect=function disconnect(){o.connect=false;o.disconnect=true;o.recording=false;o.rendering=false};exports.default=o},{"./index":584,"./server":585,"dat.gui/build/dat.gui.js":151,"proxy-observable":424}],584:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createVideoElFromStream=exports.numberDesktops=exports.findPeer=exports.hasPeer=exports.M_DEVICE_ORIEN=exports.M_DEVICE_MOTION=exports.M_SCREEN_SIZE=exports.M_SCREEN_ORIEN=exports.KEY_H=exports.KEY_W=exports.AUDIO_EXP_TYPE=exports.AUDIO_EXP=exports.ALPHA_SENS=exports.RECORD_FRAMES_DELAY=exports.FPS_I=exports.FPS=exports.MAX_RECORD_TIME=exports.HEIGHT=exports.WIDTH=exports.IS_DESKTOP=exports.IS_MOBILE=exports.SERVER_URL=exports.IS_DEV=exports.IS_STAGE=exports.IS_PROD=exports.COLOR_P=exports.videoSettings=exports.logSuccess=exports.logInfo=exports.logError=undefined;var _detector=require("./detector");var _detector2=_interopRequireDefault(_detector);var _niceColorPalettes=require("nice-color-palettes");var _niceColorPalettes2=_interopRequireDefault(_niceColorPalettes);var _tiza=require("tiza");var _tiza2=_interopRequireDefault(_tiza);var _lodash=require("lodash");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var error=_tiza2.default.color("red").text;var info=_tiza2.default.bold().bgColor("yellow").text;var success=_tiza2.default.bold().bgColor("#ABEDD1").text;var logError=exports.logError=function logError(str){return _tiza2.default.log(error(str))};var logInfo=exports.logInfo=function logInfo(str){return _tiza2.default.log(info(str))};var logSuccess=exports.logSuccess=function logSuccess(str){return _tiza2.default.log(success(str))};var videoSettings=exports.videoSettings={width:{max:WIDTH},height:{max:HEIGHT},frameRate:{max:FPS}};var COLOR_P=exports.COLOR_P="stage"==="production";var IS_PROD=exports.IS_PROD="stage"==="production";var IS_STAGE=exports.IS_STAGE="stage"==="stage";var IS_DEV=exports.IS_DEV="stage"==="development";var SERVER_URL=exports.SERVER_URL=IS_DEV?"https://rad.ngrok.io/":"https://rad.wtf/";var IS_MOBILE=exports.IS_MOBILE=!_detector2.default.isDesktop;var IS_DESKTOP=exports.IS_DESKTOP=_detector2.default.isDesktop;var WIDTH=exports.WIDTH=640;var HEIGHT=exports.HEIGHT=480;var MAX_RECORD_TIME=exports.MAX_RECORD_TIME=5e3;var FPS=exports.FPS=18;var FPS_I=exports.FPS_I=1e3/FPS;var RECORD_FRAMES_DELAY=exports.RECORD_FRAMES_DELAY=1500;var ALPHA_SENS=exports.ALPHA_SENS=50;var AUDIO_EXP=exports.AUDIO_EXP=".webm";var AUDIO_EXP_TYPE=exports.AUDIO_EXP_TYPE="webm";var KEY_W=exports.KEY_W=8;var KEY_H=exports.KEY_H=8;var M_SCREEN_ORIEN=exports.M_SCREEN_ORIEN="local:mobile:screenOrientation";var M_SCREEN_SIZE=exports.M_SCREEN_SIZE="local:mobile:screenSize";var M_DEVICE_MOTION=exports.M_DEVICE_MOTION="local:mobile:deviceMotion";var M_DEVICE_ORIEN=exports.M_DEVICE_ORIEN="local:mobile:deviceOrientation";var hasPeer=exports.hasPeer=function hasPeer(values,peer){var _found=false;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=values[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var val=_step.value;if(val.id===peer.id){_found=true;break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return _found};var findPeer=exports.findPeer=function findPeer(values,id){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=values[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var peer=_step2.value;if(peer.id===id)return peer}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return null};var numberDesktops=exports.numberDesktops=function numberDesktops(values){var c=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=values[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var val=_step3.value;if(val.desktop)c++}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return c};var createVideoElFromStream=exports.createVideoElFromStream=function createVideoElFromStream(stream){var v=document.createElement("video");v.width=WIDTH;v.height=HEIGHT;v.srcObject=stream;v.classList.add("canvas");return v}},{"./detector":581,lodash:224,"nice-color-palettes":243,tiza:542}],585:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("whatwg-fetch");var _fetchJsonp=require("fetch-jsonp");var _fetchJsonp2=_interopRequireDefault(_fetchJsonp);var _index=require("./index");var _auth=require("./auth");var _auth2=_interopRequireDefault(_auth);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PATH=_index.IS_DEV?"":"feedback-rtc/";var Server=function(){function upload(blob){var formData=new FormData;formData.append("video",blob);return fetch(""+_index.SERVER_URL+PATH+"upload",{method:"POST",headers:{"Access-Control-Allow-Origin":"*"},body:formData}).then(function(response){return response.json()}).then(function(responseJson){console.log(responseJson);return responseJson})}window.instagramCallback=function(data){return data};var DEFAULT_ENDPOINT="users";var DEFAULT_ORIGIN="https://api.instagram.com";var DEFAULT_SIZE=100;var DEFAULT_VERSION="v1";function insta(){return _auth2.default.auth(_index.SERVER_URL+"login/instagram").then(function(d){return(0,_fetchJsonp2.default)(DEFAULT_ORIGIN+"/"+DEFAULT_VERSION+"/"+DEFAULT_ENDPOINT+"/"+d.id[0]+"/media/recent?access_token="+d.accessToken+"&count="+DEFAULT_SIZE,{jsonpCallbackFunction:"instagramCallback"}).then(function(response){return response.json()})})}function roomId(){return fetch(""+_index.SERVER_URL+PATH+"room",{}).then(function(response){return response.json()})}return{roomId:roomId,upload:upload,insta:insta}}();exports.default=Server},{"./auth":579,"./index":584,"fetch-jsonp":176,"whatwg-fetch":572}],586:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _uuid=require("uuid");var _uuid2=_interopRequireDefault(_uuid);var _sono=require("sono");var _sono2=_interopRequireDefault(_sono);var _socket=require("../socket");var _socket2=_interopRequireDefault(_socket);var _regl=require("./regl");var _regl2=_interopRequireDefault(_regl);var _interaction=require("./interaction");var _interaction2=_interopRequireDefault(_interaction);var _emitter=require("../common/emitter");var _emitter2=_interopRequireDefault(_emitter);var _mediaStreamRecorder=require("./mediaStreamRecorder");var _mediaStreamRecorder2=_interopRequireDefault(_mediaStreamRecorder);var _instagram=require("./instagram");var _instagram2=_interopRequireDefault(_instagram);var _webcam=require("./webcam");var _webcam2=_interopRequireDefault(_webcam);var _pixi=require("./pixi/");var _pixi2=_interopRequireDefault(_pixi);var _record=require("./record");var _record2=_interopRequireDefault(_record);var _soundRecorder=require("./soundRecorder");var _soundRecorder2=_interopRequireDefault(_soundRecorder);var _sound=require("./sound");var _sound2=_interopRequireDefault(_sound);var _gui=require("../common/gui");var _gui2=_interopRequireDefault(_gui);var _server=require("../common/server");var _server2=_interopRequireDefault(_server);var _lodash=require("lodash");var _intrinsicScale=require("intrinsic-scale");var _rafLoop=require("raf-loop");var _rafLoop2=_interopRequireDefault(_rafLoop);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Desktop=function Desktop(webrtc,state,emitter){if(_common.IS_MOBILE)return;var peers=new Set;var peerIds=new Map;var localData={id:null,uuid:webrtc.config.nick.uuid};var keyVideo={isReady:false,el:null};var pairedMobile={el:null,secret:null,id:null,peer:null,engaged:false,isReady:false};var keyColors=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]];var isReady=false;var _timeCounter=0;var videoEl=document.getElementById("localVideo");videoEl.setAttribute("muted",true);if(state.useWebcam){videoEl.addEventListener("loadeddata",function(){(0,_common.logInfo)("local video ready");setVideoToKey(videoEl)})}var remoteVideoEl=document.getElementById("remoteVideos");videoEl.style.display="none";remoteVideoEl.style.display="none";var roomEl=document.body.querySelector(".room");var canvasEl=document.getElementById("c_output");canvasEl.width=_common.WIDTH;canvasEl.height=_common.HEIGHT;var canvasKey=document.createElement("canvas");canvasKey.width=_common.KEY_W;canvasKey.height=_common.KEY_H;if(_common.IS_DEV){canvasKey.classList.add("canvas");document.body.appendChild(canvasKey)}var reset=function reset(){localVideo.isReady=false;isReady=false;pairedMobile.engaged=false;pairedMobile.isReady=false;pairedMobile.id=null;pairedMobile.secret=null;pairedMobile.uuid=null;pairedMobile.peer=null};var keyCtx=canvasKey.getContext("2d");var regl=(0,_regl2.default)(canvasEl);var pixi=(0,_pixi2.default)(state,emitter,document.getElementById("pixi"));var interaction=(0,_interaction2.default)(webrtc,canvasEl);interaction.setOnFileDropped(function(urlBlob){var video=document.createElement("video");video.setAttribute("autoplay","true");video.setAttribute("crossorigin","anonymous");video.setAttribute("muted",true);video.src=urlBlob;setVideoToKey(video)});var webcam=(0,_webcam2.default)(webrtc);var instagram=(0,_instagram2.default)(videoEl);var sound=(0,_sound2.default)();var record=(0,_record2.default)();var send=function send(msg,payload){return webrtc.sendToAll(msg,payload)};var sendChannel=function sendChannel(msg,payload){return webrtc.sendDirectlyToAll(state.room.id,msg,payload)};var tryStarting=function tryStarting(peerValues){console.log(pairedMobile.id,pairedMobile.isReady);if(pairedMobile.id&&!pairedMobile.isReady&&!pairedMobile.engaged){console.log(peerValues.size+" peers");var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=peerValues[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var peer=_step.value;if(pairedMobile.id===peer.id){var _ret=function(){var _onProgress=function _onProgress(){pairedMobile.isReady=true;(0,_common.logSuccess)("localMobile playing!");pairedMobile.peer.videoEl.removeEventListener("progress",_onProgress)};console.log("pairedMobile id "+pairedMobile.id+" === peer id "+peer.id);pairedMobile.peer=peer;if(!pairedMobile.secret){pairedMobile.secret=_uuid2.default.v4();_gui2.default.secret=pairedMobile.secret;send("local:desktop:secret",pairedMobile.secret);(0,_common.logInfo)("Created and sent new secret "+pairedMobile.secret)}if(!pairedMobile.peer.videoEl)return{v:void 0};pairedMobile.engaged=true;(0,_common.logInfo)("pairedMobile videoEl ready");pairedMobile.el=pairedMobile.peer.videoEl;pairedMobile.peer.videoEl.addEventListener("progress",_onProgress);sound.init(peer.stream);(0,_common.logSuccess)("Start!")}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}else{}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}};var isPlayingMedia=function isPlayingMedia(){return keyVideo.isReady||pairedMobile.isReady};var createCanvasStream=function createCanvasStream(){var stream=canvasEl.captureStream(_common.FPS);webrtc.webrtc.localStreams.unshift(stream)};var cancelStream=function cancelStream(stream){stream.getTracks().forEach(function(track){return track.stop()})};var cancelStreamFromPeer=function cancelStreamFromPeer(peer){if(!peer)return;if(!peer.stream)return;cancelStream(peer.stream)};var setVideoToKey=function setVideoToKey(el){keyVideo.el=el;keyVideo.isReady=true};var connectToOtherDesktop=function connectToOtherDesktop(peer){if(!peer)return};var addKeyColor=function addKeyColor(color){keyColors.push(color);keyColors.shift();var id=keyCtx.createImageData(_common.KEY_W,_common.KEY_H);for(var x=0;x<id.width;x++){var k=Math.floor(x/id.width*keyColors.length);for(var y=0;y<id.height;y++){var index=(y*id.width+x)*4;id.data[index]=keyColors[k][0];id.data[index+1]=keyColors[k][1];id.data[index+2]=keyColors[k][2];id.data[index+3]=255}}keyCtx.putImageData(id,0,0)};function addListeners(){webrtc.connection.on("message",function(data){switch(data.type){case"local:desktop:handshake":{var _data$payload=data.payload,secret=_data$payload.secret,id=_data$payload.id,_isPlayingMedia=_data$payload.isPlayingMedia;console.log("Got desktop handshake from  "+data.from+" mobile secret: "+secret);if(!peerIds.get(data.from)){peerIds.set(data.from,{desktop:true,isPlayingMedia:_isPlayingMedia,id:data.from})}var numDesktops=(0,_common.numberDesktops)(peerIds.values());(0,_common.logInfo)("numDesktops "+numDesktops);if(numDesktops>=1&&pairedMobile.id){connectToOtherDesktop((0,_common.findPeer)(peers.values(),data.from))}break}case"local:mobile:hello":{localData.id=data.payload.id;(0,_common.logSuccess)("Your peer id is "+localData.id);sendHandshake();break}case"local:mobile:handshake":{var _data$payload2=data.payload,_secret=_data$payload2.secret,_id=_data$payload2.id;console.log("Got mobile handshake from  "+data.from+" with secret "+_secret);if(!peerIds.get(data.from)){peerIds.set(data.from,{desktop:false,id:data.from})}if(_secret&&pairedMobile.secret){console.log("\t has payload "+_secret+" and local secret "+pairedMobile.secret);if(_secret===pairedMobile.secret){console.log("\t payload secret matches local secret");localData.id=_id;pairedMobile.id=data.from;(0,_common.logSuccess)("localMobile peer id : "+pairedMobile.id);tryStarting(peers.values())}}else if(!pairedMobile.secret&&!_secret){console.log("\t No local secret or no payload secret");pairedMobile.id=data.from;localData.id=_id;tryStarting(peers.values())}else if(_secret&&!pairedMobile.secret){(0,_common.logError)("Not for you! "+data.from);peerIds.get(data.from).stopStream=true;cancelStreamFromPeer((0,_common.findPeer)(peers.values(),data.from))}else if(!_secret&&pairedMobile.secret){(0,_common.logError)("You got a partner!");(0,_common.logSuccess)("localMobile peer id : "+pairedMobile.id)}break}case"local:mobile:secret:set":{var _id2=data.payload.id;(0,_common.logSuccess)("Secret was set on "+data.from+" by "+_id2);tryStarting(peers.values())}break;case"local:mobile:joiningRoom":{if(data.payload.secret===pairedMobile.secret&&pairedMobile.id===data.from){(0,_common.logInfo)("Mobile "+data.from+" is joining "+data.payload.roomId+" so joing too");emitter.emit("webrtc:connect",{roomId:data.payload.roomId})}break}case"local:desktop:addKeyColor":case"local:mobile:addKeyColor":{addKeyColor(data.payload);break}case _common.M_SCREEN_ORIEN:{break}case _common.M_DEVICE_MOTION:{_gui2.default.deviceMotion=data.payload;_gui2.default.echo=_extends({},_gui2.default.echo,{delay:Math.abs(data.payload.z)+.5});break}case _common.M_DEVICE_ORIEN:{_gui2.default.deviceOrien=data.payload;if(data.payload.landscape){_gui2.default.panner={value:data.payload.alpha}}break}case _common.M_SCREEN_SIZE:{break}}});(0,_common.logInfo)("Added Listeners")}var sendHandshake=function sendHandshake(){return send("local:desktop:handshake",{secret:pairedMobile.secret,isPlayingMedia:isPlayingMedia(),uuid:localData.uuid})};webrtc.on("createdPeer",function(peer){console.log("Found peer!");peers.add(peer);sendHandshake();(0,_common.logInfo)("createdPeer: sent localsecret "+pairedMobile.secret)});webrtc.on("leftRoom",function(roomId){reset();peerIds.clear();peers.clear();webrtc.stopLocalVideo()});webrtc.on("peerRemoved",function(peer){peers.delete(peer);if(pairedMobile.id===peer.id){reset()}});webrtc.on("videoRemoved",function(videoEl,peer){});webrtc.on("videoAdded",function(video,peer){video.setAttribute("crossorigin","anonymous");video.setAttribute("muted",true);video.style.display="none";var foundPeer=(0,_common.findPeer)(peerIds.values(),peer.id);console.log(foundPeer);if(foundPeer&&foundPeer.stopStream){console.log(foundPeer);cancelStream(peer.stream)}else if(foundPeer&&!pairedMobile.id&&foundPeer.desktop&&foundPeer.isPlayingMedia){setVideoToKey(peer.videoEl)}else if(pairedMobile.id&&foundPeer.desktop&&foundPeer.isPlayingMedia){console.log(peer);setTimeout(function(){setVideoToKey(peer.videoEl)},2e3)}(0,_common.logInfo)("VideoAdded from "+peer.id);tryStarting(peers.values())});var resizeCanvas=function resizeCanvas(){var w=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_common.WIDTH;var h=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_common.HEIGHT;var _cover=(0,_intrinsicScale.cover)(window.innerWidth,window.innerHeight,w,h),width=_cover.width,height=_cover.height,x=_cover.x,y=_cover.y;var scale=Math.max(width/w,height/h);canvasEl.style.transform="scale3d("+scale+","+scale+",1) translate3d(0, 0, 0)";canvasEl.style.webkitTransform="scale3d("+scale+","+scale+",1) translate3d(0,0, 0)";canvasEl.style.top=y/2+"px";canvasEl.style.left=x/2+"px"};window.addEventListener("resize",function(){return resizeCanvas(_common.WIDTH,_common.HEIGHT)});resizeCanvas(_common.WIDTH,_common.HEIGHT);var recordFinalStart=function recordFinalStart(){sound.recordMasterStart();setTimeout(function(){_gui2.default.recording=true},2e3);emitter.emit("desktop:render:start")};var recordFinalStop=function recordFinalStop(){emitter.emit("desktop:render:stop");_gui2.default.recording=false;_gui2.default.rendering=false;_sono2.default.stopAll();_sono2.default.destroyAll();sound.recordMasterStop(function(blob,duration){record.addAudio(blob,duration);record.start(canvasKey).then(function(video){emitter.emit("desktop:render:completed");_server2.default.upload(video).then(function(uploadResp){console.log(uploadResp);emitter.emit("desktop:render:uploaded")}).catch(function(err){console.log(err)})})})};var engine=(0,_rafLoop2.default)(function(dt){if(_gui2.default.rendering){if(performance.now()-_timeCounter>=_common.FPS_I){if(pairedMobile.isReady&&!keyVideo.isReady){regl.drawSingle({mobile:{source:pairedMobile.el,width:_common.WIDTH,height:_common.HEIGHT}})}else if(pairedMobile.isReady&&keyVideo.isReady){regl.drawKey({mobile:{source:pairedMobile.el,width:_common.WIDTH,height:_common.HEIGHT},keyVideo:{source:keyVideo.el,width:_common.WIDTH,height:_common.HEIGHT},keyColors:{source:canvasKey,format:"rgba",width:_common.KEY_W,height:_common.KEY_H}})}else if(!pairedMobile.isReady&&keyVideo.isReady){regl.drawSingle({mobile:{source:keyVideo.el,width:_common.WIDTH,height:_common.HEIGHT}})}if(_gui2.default.recording){record.addFrame(regl.read())}_timeCounter=performance.now()}}_timeCounter++});_gui2.default.recordFinalStart=recordFinalStart;_gui2.default.recordFinalStop=recordFinalStop;_gui2.default.startWebcam=function(){webcam.start().then(function(stream){setVideoToKey((0,_common.createVideoElFromStream)(stream))}).catch(function(err){})};_gui2.default.stopWebcam=function(){keyVideo.isReady=false;webcam.stop(keyVideo.el)};_gui2.default.instagram=function(){instagram.load(setVideoToKey)};_emitter2.default.on("addKeyColor",function(_ref){var color=_ref.color;return addKeyColor(color)});_emitter2.default.on("changerooms",function(_ref2){var roomId=_ref2.roomId;engine.stop();pairedMobile.isReady=false;if(pairedMobile.peer){(0,_common.logInfo)("sending local:desktop:joinRoom"+roomId);webrtc.sendToAll("local:desktop:joinRoom",{roomId:roomId,secret:pairedMobile.secret})}else{emitter.emit("webrtc:connect",{roomId:roomId})}});_gui2.default.on("disconnect",function(v){if(v){engine.stop();pairedMobile.isReady=false;(0,_common.logInfo)("desktop: Disconnected")}});_gui2.default.on("connect",function(v){if(v){_gui2.default.rendering=true;engine.start();(0,_common.logInfo)("desktop: Connected")}});addListeners();createCanvasStream();return{addListeners:addListeners}};exports.default=Desktop},{"../common":584,"../common/emitter":582,"../common/gui":583,"../common/server":585,"../socket":607,"./instagram":587,"./interaction":588,"./mediaStreamRecorder":589,"./pixi/":591,"./record":593,"./regl":595,"./sound":600,"./soundRecorder":601,"./webcam":602,"intrinsic-scale":219,lodash:224,"raf-loop":430,sono:504,uuid:551}],587:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _common=require("../common");var _lodash=require("lodash");var _server=require("../common/server");var _server2=_interopRequireDefault(_server);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Instagram=function Instagram(videoEl){videoEl.setAttribute("crossorigin","anonymous");videoEl.setAttribute("muted",true);var _playNext=function _playNext(url){videoEl.src=url};var _shuffle=function _shuffle(videos){};function load(cb){_server2.default.insta().then(function(t){var videos=t.data.filter(function(d){return!!d.videos}).map(function(d){return d.videos.standard_resolution.url});videoEl.addEventListener("ended",function(){_playNext((0,_lodash.sample)(videos))});_playNext((0,_lodash.sample)(videos));cb(videoEl)})}return{load:load}};exports.default=Instagram},{"../common":584,"../common/server":585,lodash:224}],588:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _dragDrop=require("drag-drop");var _dragDrop2=_interopRequireDefault(_dragDrop);var _lodash=require("lodash");var _intrinsicScale=require("intrinsic-scale");var _emitter=require("../common/emitter");var _emitter2=_interopRequireDefault(_emitter);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SAMPLE_AMOUNT=8;var getAverageColor=function getAverageColor(data,width,x,y){var colors=[[data[(y*width+x)*4],data[(y*width+x)*4+1],data[(y*width+x)*4+2]],[data[(y*width+(x-1))*4],data[(y*width+(x-1))*4+1],data[(y*width+(x-1))*4+2]],[data[((y-1)*width+x)*4],data[((y-1)*width+x)*4+1],data[((y-1)*width+x)*4+2]],[data[(y*width+(x+1))*4],data[(y*width+(x+1))*4+1],data[(y*width+(x+1))*4+2]],[data[((y+1)*width+x)*4],data[((y+1)*width+x)*4+1],data[((y+1)*width+x)*4+2]],[data[((y+1)*width+(x-1))*4],data[((y+1)*width+(x-1))*4+1],data[((y+1)*width+(x-1))*4+2]],[data[((y-1)*width+(x-1))*4],data[((y-1)*width+(x-1))*4+1],data[((y-1)*width+(x-1))*4+2]],[data[((y+1)*width+(x+1))*4],data[((y+1)*width+(x+1))*4+1],data[((y+1)*width+(x+1))*4+2]],[data[((y-1)*width+(x+1))*4],data[((y-1)*width+(x+1))*4+1],data[((y-1)*width+(x+1))*4+2]]];return[Math.round((0,_lodash.mean)(colors.map(function(v){return v[0]}))),Math.round((0,_lodash.mean)(colors.map(function(v){return v[1]}))),Math.round((0,_lodash.mean)(colors.map(function(v){return v[2]})))]};var DesktopInteraction=function DesktopInteraction(webrtc,sourceEl){var canvasOff=document.createElement("canvas");canvasOff.width=_common.WIDTH;canvasOff.height=_common.HEIGHT;var ctx=canvasOff.getContext("2d");canvasOff.classList.add("canvas","no-interaction");canvasOff.style.display="none";if(_common.IS_DEV){document.body.appendChild(canvasOff)}sourceEl.addEventListener("click",function(e){var _cover=(0,_intrinsicScale.cover)(window.innerWidth,window.innerHeight,_common.WIDTH,_common.HEIGHT),width=_cover.width,height=_cover.height,x=_cover.x,y=_cover.y;width=Math.floor(width);height=Math.floor(height);canvasOff.width=width;canvasOff.height=height;canvasOff.style.top=y/2+"px";canvasOff.style.left=x/2+"px";canvasOff.style.width=width+"px";canvasOff.style.height=height+"px";ctx.drawImage(sourceEl,0,0,_common.WIDTH,_common.HEIGHT,0,0,width,height);var frame=ctx.getImageData(0,0,width,height);var clickX=e.pageX+Math.abs(Math.round(x/2));var clickY=e.pageY+Math.abs(Math.round(y/2));var color=getAverageColor(frame.data,width,clickX,clickY);_emitter2.default.emit("addKeyColor",{color:color,position:{x:e.pageX/window.innerWidth,y:e.pageY/window.innerHeight}})});var _onFileDropped=void 0;var _onFileLoaded=function _onFileLoaded(e){e.target.removeEventListener("load",_onFileLoaded);if(_onFileDropped){_onFileDropped(URL.createObjectURL(new Blob([e.target.result])));e.target=null}};var _onFileError=function _onFileError(e){e.target.removeEventListener("error",_onFileError);e.target=null;console.error("FileReader error"+e)};(0,_dragDrop2.default)(document.body,function(files){console.log("Here are the dropped files",files);files.forEach(function(file){var reader=new FileReader;reader.addEventListener("load",_onFileLoaded);reader.addEventListener("error",_onFileError);reader.readAsArrayBuffer(file)})});function setOnFileDropped(cb){_onFileDropped=cb}window.addEventListener("mousemove",(0,_lodash.throttle)(function(e){return _emitter2.default.emit("mousemove",{x:e.pageX,y:e.pageY})},100));return{setOnFileDropped:setOnFileDropped}};exports.default=DesktopInteraction},{"../common":584,"../common/emitter":582,"drag-drop":156,"intrinsic-scale":219,lodash:224}],589:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Recorder=function Recorder(stream,options){var chunks=[];var count=0;var _cb=void 0;var mediaRecorder=new MediaRecorder(stream,{mimeType:""+options.type});function log(message){console.warn(message)}mediaRecorder.ondataavailable=function(e){chunks.push(e.data)};mediaRecorder.onerror=function(e){log("Error: "+e);console.log("Error: ",e)};mediaRecorder.onstart=function(){log("Started & state = "+mediaRecorder.state)};mediaRecorder.onstop=function(){log("Stopped  & state = "+mediaRecorder.state);var blob=new Blob(chunks,{type:""+options.type});var videoElement=document.createElement("audio");videoElement.src=URL.createObjectURL(blob);document.body.appendChild(videoElement);videoElement.play();chunks=[];_cb(blob)};mediaRecorder.onpause=function(){log("Paused & state = "+mediaRecorder.state)};mediaRecorder.onresume=function(){log("Resumed  & state = "+mediaRecorder.state)};mediaRecorder.onwarning=function(e){log("Warning: "+e)};function stop(cb){_cb=cb;mediaRecorder.stop()}function start(argument){mediaRecorder.start(0)}return{start:start,stop:stop}};exports.default=Recorder},{}],590:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var HEADER_HEIGHT=exports.HEADER_HEIGHT=20},{}],591:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("pixi.js");var _constants=require("./constants");var _peers=require("./peers");var _peers2=_interopRequireDefault(_peers);var _emitter=require("../../common/emitter");var _emitter2=_interopRequireDefault(_emitter);var _gui=require("../../common/gui");var _gui2=_interopRequireDefault(_gui);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Pixi=function Pixi(state,emitter,parentEl){var stage=new PIXI.Container;var renderer=new PIXI.CanvasRenderer({width:window.innerWidth,height:window.innerHeight,transparent:true,autoResize:true});parentEl.classList.add("u-full","no-interaction");parentEl.appendChild(renderer.view);var recordBar=new PIXI.Graphics;stage.addChild(recordBar);window.addEventListener("resize",function(){renderer.resize(window.innerWidth,window.innerHeight)});var updateRecordBar=function updateRecordBar(p){recordBar.clear();recordBar.beginFill(16740363,1);recordBar.drawRect(0,window.innerHeight-60,window.innerWidth*p,60);recordBar.endFill();renderer.render(recordBar)};_emitter2.default.on("mousemove",function(_ref){var y=_ref.y;if(y<_constants.HEADER_HEIGHT){parentEl.classList.remove("no-interaction")}else{parentEl.classList.add("no-interaction")}});_gui2.default.on("recordProgress",function(v){return updateRecordBar(v)});var peerGraphics=(0,_peers2.default)(state,emitter,{stage:stage,renderer:renderer});return{stage:stage,renderer:renderer}};exports.default=Pixi},{"../../common/emitter":582,"../../common/gui":583,"./constants":590,"./peers":592,"pixi.js":387}],592:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _common=require("../../common");var _emitter=require("../../common/emitter");var _emitter2=_interopRequireDefault(_emitter);var _gui=require("../../common/gui");var _gui2=_interopRequireDefault(_gui);var _socket=require("../../socket");var _socket2=_interopRequireDefault(_socket);var _lodash=require("lodash");var _niceColorPalettes=require("nice-color-palettes");var _niceColorPalettes2=_interopRequireDefault(_niceColorPalettes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Peers=function Peers(state,emitter,pixi){var stage=pixi.stage,renderer=pixi.renderer;var gfxC=new PIXI.Container;stage.addChild(gfxC);var _rooms=void 0;var clear=function clear(){while(gfxC.children.length){gfxC.removeChildAt(0)}};var drawRoom=function drawRoom(roomId,i){var c=(0,_lodash.sample)(_niceColorPalettes2.default);var icon=new PIXI.Graphics;icon.interactive=true;icon.userData={roomId:roomId};icon.on("click",function(){clear();console.log("click",icon.userData);_emitter2.default.emit("changerooms",icon.userData)});var fill=(0,_lodash.sample)(c);icon.beginFill(parseInt("0x"+fill.substring(1,fill.length)),1);icon.drawCircle(i*20,20,10);icon.endFill();gfxC.addChild(icon)};_gui2.default.on("started",function(v){_socket2.default.socket.on("rooms:get",function(rooms){clear();_rooms=rooms.filter(function(r){return r!==state.room.id});_rooms.forEach(function(r,i){return drawRoom(r,i)});renderer.render(gfxC)});_socket2.default.socket.emit("rooms:get");(0,_common.logInfo)("\tPeers listening for new rooms")});window.addEventListener("resize",function(){renderer.render(gfxC)});_gui2.default.on("connect",function(v){if(v){_socket2.default.socket.emit("rooms:get")}});return{}};exports.default=Peers},{"../../common":584,"../../common/emitter":582,"../../common/gui":583,"../../socket":607,lodash:224,"nice-color-palettes":243}],593:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _gui=require("../common/gui");var _gui2=_interopRequireDefault(_gui);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Record=function Record(){var recordStop=function recordStop(){};var frames=[];var _audio=void 0,_duration=void 0;var W="ffmpeg-worker-mp4";function addFrame(frame){frames.push(frame)}function addAudio(wav,duration){_audio=wav;_duration=duration.toFixed(1)}function transcode(blob,sound){console.log(sound);console.log("will transcode",blob);return new Promise(function(resolve,reject){var worker=new Worker("ffmpeg-worker-mp4.js");var stderr=void 0,stdout=void 0;worker.onmessage=function(e){var msg=e.data;console.log(msg);switch(msg.type){case"ready":worker.postMessage({type:"run",mounts:[{type:"WORKERFS",opts:{blobs:[{name:"input.webm",data:blob},{name:"sound"+_common.AUDIO_EXP,data:sound}]},mountpoint:"/data"}],TOTAL_MEMORY:536870912,arguments:["-i","/data/input.webm","-i","/data/sound"+_common.AUDIO_EXP,"-map","0:v","-map","1:a","-c:v","libx264","-b:v","500k","-pix_fmt","yuv420p","-f","mp4","-shortest","output.mp4"]});break;case"stdout":stdout+=msg.data+"\n";break;case"stderr":stderr+=msg.data+"\n";break;case"done":worker.terminate();resolve(new Blob([msg.data.MEMFS[0].data],{type:"video/mp4"}));break;case"exit":if(msg.data){worker.terminate();reject(msg.data)}break;default:break}}})}function downloadData(blob,basename){basename=basename||"output";var url=URL.createObjectURL(blob);var a=document.createElement("a");document.body.appendChild(a);a.style.display="none";a.href=url;a.download=basename+"."+blob.type.split("/")[1];a.click();URL.revokeObjectURL(url);document.body.removeChild(a)}function flipVertically(pixels,width,height){var halfHeight=Math.floor(height/2);var bytesPerRow=width*4;var temp=new Uint8Array(width*4);for(var y=0;y<halfHeight;++y){var topOffset=y*bytesPerRow;var bottomOffset=(height-y-1)*bytesPerRow;temp.set(pixels.subarray(topOffset,topOffset+bytesPerRow));pixels.copyWithin(topOffset,bottomOffset,bottomOffset+bytesPerRow);pixels.set(temp,bottomOffset)}}function start(canvasKey){var id=new ImageData(_common.WIDTH,_common.HEIGHT);var keyCtx=canvasKey.getContext("2d");var webms=[];canvasKey.width=_common.WIDTH;canvasKey.height=_common.HEIGHT;var _i=0;while(_i<frames.length){flipVertically(frames[_i],_common.WIDTH,_common.HEIGHT);id.data.set(frames[_i]);keyCtx.putImageData(id,0,0);frames[_i]=null;webms.push(canvasKey.toDataURL("image/webp"));_i++}frames.length=0;var blob=window.Whammy.fromImageArray(webms,Math.floor(_common.FPS/2));console.log("DONE");return transcode(blob,_audio).then(function(video){downloadData(video);return video})}return{addFrame:addFrame,addAudio:addAudio,start:start}};exports.default=Record},{"../common":584,"../common/gui":583}],594:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var FAR_Z=exports.FAR_Z=20},{}],595:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _emitter=require("../../common/emitter");var _emitter2=_interopRequireDefault(_emitter);var _constants=require("./constants");var _regl=require("regl");var _regl2=_interopRequireDefault(_regl);var _glMat=require("gl-mat4");var _glMat2=_interopRequireDefault(_glMat);var _reglGeometryActions=require("./regl-geometry-actions");var _reglGeometryActions2=_interopRequireDefault(_reglGeometryActions);var _reglGeometry=require("./regl-geometry");var _reglGeometry2=_interopRequireDefault(_reglGeometry);var _single=require("./single");var _single2=_interopRequireDefault(_single);var _multi=require("./multi");var _multi2=_interopRequireDefault(_multi);var _gui=require("../../common/gui");var _gui2=_interopRequireDefault(_gui);var _common=require("../../common");var _lodash=require("lodash");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGL=function REGL(canvas,assets){if(!Detector.isDesktop)return;var regl=(0,_regl2.default)({canvas:canvas,attributes:{stencil:true,preserveDrawingBuffer:true}});var singleDraw=(0,_single2.default)(regl);var multiDraw=(0,_multi2.default)(regl);var reglGeometry=(0,_reglGeometry2.default)(regl);var textures={};var filterMask0=regl({stencil:{enable:true,mask:255,func:{cmp:"equal",ref:0,mask:255}}});function destroy(){regl.destroy()}var updateTextures=function updateTextures(assets){var draw=true;(0,_lodash.map)(assets,function(val,k){if(textures[k]){textures[k](val.source)}else{try{textures[k]=regl.texture({format:val.format||"rgb",width:val.width,height:val.height,wrapS:"clamp",wrapT:"clamp",data:val.source})}catch(e){(0,_common.logError)("Bad texture at "+k);draw=false}}});return draw};var EYE=[0,0,2];var setupCamera=regl({context:{projection:function projection(_ref){var viewportWidth=_ref.viewportWidth,viewportHeight=_ref.viewportHeight;return _glMat2.default.perspective([],Math.PI/2.1,viewportWidth/viewportHeight,.001,_constants.FAR_Z)},view:_glMat2.default.lookAt([],EYE,[0,0,0],[0,1,0]),eye:EYE}});function drawKey(assets){if(updateTextures(assets)){setupCamera(function(){regl.clear({color:[0,0,0,1],depth:true,stencil:false});multiDraw({texture:textures.mobile,keyVideo:textures.keyVideo,keyColors:textures.keyColors,slope:_gui2.default.slope,tolerance:_gui2.default.tolerance})})}}_emitter2.default.on("addKeyColor",function(_ref2){var color=_ref2.color,position=_ref2.position;var props={color:color.map(function(v){return v/255}),position:position};var sphere=reglGeometry.create("sphere");_reglGeometryActions2.default.add(sphere,"fly",props)});var _x=0;var _z=0;function drawSingle(assets){if(updateTextures(assets)){_x=_gui2.default.deviceOrien.alpha;setupCamera(function(){regl.clear({color:[0,0,0,1],depth:true,stencil:false});singleDraw({texture:textures.mobile});_reglGeometryActions2.default.update()})}}function read(){return regl.read(new Uint8Array(_common.WIDTH*_common.HEIGHT*4))}return{drawKey:drawKey,drawSingle:drawSingle,read:read}};exports.default=REGL},{"../../common":584,"../../common/emitter":582,"../../common/gui":583,"./constants":594,"./multi":596,"./regl-geometry":598,"./regl-geometry-actions":597,"./single":599,"gl-mat4":189,lodash:224,regl:433}],596:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Multi=function Multi(regl){return regl({vert:"\n  precision lowp float;\n  attribute vec2 position;\n  varying vec2 vUv;\n  void main () {\n    vUv = position;\n    vec2 adjusted = 1.0 - 2.0 * position;\n    vec2 imagePosition = adjusted;\n    gl_Position = vec4(imagePosition, 0, 1);\n  }",frag:"\n\n    #define NOISE_S 6.\n\n  precision lowp float;\n  uniform sampler2D texture;\n  uniform sampler2D keyVideo;\n  uniform sampler2D keyColors;\n  uniform float tolerance;\n  uniform float slope;\n  //uniform float time;\n\n  varying vec2 vUv;\n\n  float chromaKeyAlphaTwoFloat(vec3 color, vec3 keyColor, float tolerance, float slope)\n      {\n        float d = abs(length(abs(keyColor - color)));\n        float edge0 = tolerance * (1.0 - slope);\n        float alpha = smoothstep(edge0, tolerance, d);\n        return 1. - alpha;\n      }\n\n  void main () {\n    vec2 uv = vUv;\n    vec3 color = texture2D(texture, vec2(1.-uv.x, uv.y)).rgb;\n\n    float ff = max(\n\n      max(\n         chromaKeyAlphaTwoFloat(color,texture2D(keyColors, vec2(0., 0.5)).rgb, slope, tolerance),\n         chromaKeyAlphaTwoFloat(color,texture2D(keyColors, vec2(0.23, 0.5)).rgb,slope, tolerance)\n         ),\n\n          max(\n          chromaKeyAlphaTwoFloat(color,texture2D(keyColors, vec2(0.73, 0.5)).rgb,slope, tolerance),\n          chromaKeyAlphaTwoFloat(color,texture2D(keyColors, vec2(1., 0.5)).rgb,slope, tolerance)\n          )\n        );\n\n\n    gl_FragColor = vec4(mix(color, texture2D(keyVideo,uv).rgb, ff),1);\n    //gl_FragColor = vec4(vec3(ff),1);\n    //gl_FragColor = vec4(texture2D(keyColors, vec2(uv.x, uv.y)).rgb,1);\n  }",attributes:{position:[[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]]},count:6,uniforms:{texture:regl.prop("texture"),keyVideo:regl.prop("keyVideo"),keyColors:regl.prop("keyColors"),slope:regl.prop("slope"),tolerance:regl.prop("tolerance")}})};exports.default=Multi},{}],597:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _constants=require("./constants");var _glMat=require("gl-mat4");var _glMat2=_interopRequireDefault(_glMat);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReglGeometryActions=function(){var _ACTIONS={fly:[]};function update(){for(var i=_ACTIONS.fly.length-1;i>=0;i--){var g=_ACTIONS.fly[i];_glMat2.default.translate(g.modelM,g.modelM,[0,0,.08]);g.geo.draw(_extends({},g.props,{model:g.modelM}));if(g.modelM[14]>0){_ACTIONS.fly.splice(i,1);g=null}}}function add(geo,type,props){var modelM=_glMat2.default.create([0,0,0]);console.log(props);_glMat2.default.translate(modelM,modelM,[(props.position.x*2-1)*_constants.FAR_Z/2,props.position.y*-1*2-1*_constants.FAR_Z/2,-_constants.FAR_Z]);_ACTIONS[type].push({geo:geo,props:props,modelM:modelM})}return{update:update,add:add}}();exports.default=ReglGeometryActions},{"./constants":594,"gl-mat4":189}],598:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _glMat=require("gl-mat4");var _glMat2=_interopRequireDefault(_glMat);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var normals=require("angle-normals");var ReglGeometry=function ReglGeometry(regl){var icosphere=require("icosphere")(1);function SphereMesh(){this._normals=normals(icosphere.cells,icosphere.positions)}SphereMesh.prototype.draw=regl({vert:"\n    precision lowp float;\n    uniform mat4 projection, view, model;\n    attribute vec3 position;\n    attribute vec3 normal;\n\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n\n    void main () {\n      vNormal = normal;\n      vPosition = position;\n      gl_Position = projection * view * model * vec4(position, 1);\n    }",frag:"\n    precision lowp float;\n\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    uniform float ambientLightAmount;\n    uniform float diffuseLightAmount;\n\n    uniform vec3 lightDir;\n\n    uniform vec3 color;\n\n\n    void main () {\n      vec3 ambient = ambientLightAmount * color;\n      float cosTheta = dot(vNormal, lightDir);\n      vec3 diffuse = diffuseLightAmount * color * clamp(cosTheta , 0.0, 1.0 );\n      gl_FragColor = vec4((ambient + diffuse), 1.0);\n\n      //gl_FragColor = vec4(0, 1, 0, 1);\n    }",uniforms:{model:regl.prop("model"),view:regl.context("view"),projection:regl.context("projection"),ambientLightAmount:.6,diffuseLightAmount:.3,color:regl.prop("color"),lightDir:[.39,.87,.29]},attributes:{position:icosphere.positions,normal:regl.this("_normals")},elements:icosphere.cells});var _GEO={sphere:SphereMesh};function create(type){return new _GEO[type]}return{create:create}};exports.default=ReglGeometry},{"angle-normals":3,"gl-mat4":189,icosphere:215}],599:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Single=function Single(regl){return regl({vert:"\n  precision lowp float;\n  attribute vec2 position;\n  uniform mat4 projection, view, model;\n  varying vec2 vUv;\n  void main () {\n    vUv = position;\n    vec2 adjusted = 1.0 - 2.0 * position;\n    vec4 pos =  vec4(adjusted,0,1);\n    //gl_Position = vec4(imagePosition, 0, 1);\n    gl_Position =  pos;\n    //gl_Position =  vec4(adjusted,0,1);\n  }",frag:"\n\n      precision lowp float;\n      uniform sampler2D texture;\n      varying vec2 vUv;\n\n      void main () {\n        vec2 uv = vUv;\n        gl_FragColor = vec4(texture2D(texture, uv).rgb,1);\n      }",attributes:{position:[[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]]},count:6,depth:{mask:false,enable:false},uniforms:{view:regl.context("view"),model:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-1,1],projection:regl.context("projection"),texture:regl.prop("texture")}})};exports.default=Single},{}],600:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _msr=require("msr");var _msr2=_interopRequireDefault(_msr);var _sono=require("sono");var _sono2=_interopRequireDefault(_sono);require("sono/utils/recorder");require("sono/utils/microphone");var _effects=require("sono/effects");var _effects2=_interopRequireDefault(_effects);var _gui=require("../common/gui");var _gui2=_interopRequireDefault(_gui);var _soundRecorder=require("./soundRecorder");var _soundRecorder2=_interopRequireDefault(_soundRecorder);var _mediaStreamRecorder=require("./mediaStreamRecorder");var _mediaStreamRecorder2=_interopRequireDefault(_mediaStreamRecorder);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Sound=function Sound(){var _started=false;var mediaRecorder=void 0,mediaRecorder2=void 0;var fileReader=new FileReader;var _sounds=[];var addSound=function addSound(sound,blob){_sounds.push({blob:blob,sound:sound,echo:sound.effects.add(_effects2.default.echo(_gui2.default.echo)),reverb:sound.effects.add(_effects2.default.reverb(_gui2.default.reverb)),panner:sound.effects.add(_effects2.default.panner(_gui2.default.panner))});_gui2.default.on("echo",function(value){_sounds.forEach(function(s){for(var k in value){s.echo[k]=value[k]}})});_gui2.default.on("panner",function(value){_sounds.forEach(function(s){s.panner.set(value.value)})});_gui2.default.on("reverb",function(value){for(var k in value){}});sound.loop=true;sound.play()};function init(stream){if(_started||!stream)return;_started=true;mediaRecorder=new _msr2.default(stream);mediaRecorder.mimeType="audio/"+_common.AUDIO_EXP_TYPE;mediaRecorder.ondataavailable=function(blob){fileReader.onloadend=function(){_sono2.default.load({data:fileReader.result,onComplete:function onComplete(sound){addSound(sound,blob)}})};fileReader.readAsArrayBuffer(blob)}}var _rProgress=void 0;function recordStart(){mediaRecorder.start();clearInterval(_rProgress);var _t=0;_rProgress=setInterval(function(){_t+=10;_gui2.default.recordProgress=_t/_common.MAX_RECORD_TIME;if(_t>=_common.MAX_RECORD_TIME){recordEnd()}},10)}function recordEnd(){if(!_gui2.default.recordProgress)return;mediaRecorder.stop();clearInterval(_rProgress);_gui2.default.recordProgress=0}function recordMasterStart(cb){var stream_dest=_sono2.default.context.createMediaStreamDestination();_sono2.default.gain.connect(stream_dest);mediaRecorder2=new _mediaStreamRecorder2.default(stream_dest.stream,{type:"audio/"+_common.AUDIO_EXP_TYPE+";codecs=opus"});mediaRecorder2.start()}function recordMasterStop(cb){mediaRecorder2.stop(function(blob){cb(blob,2)})}_gui2.default.recordStart=recordStart;_gui2.default.recordEnd=recordEnd;_gui2.default.on("disconnect",function(v){if(!v){if(mediaRecorder){mediaRecorder.stop();mediaRecorder=null}if(mediaRecorder2){mediaRecorder2.stop();mediaRecorder2=null}_started=false;_sounds.forEach(function(obj){obj.blob=null;obj.sound.destroy();obj.echo=null;obj.reverb=null;obj.panner=null});_sounds.length=0}});return{init:init,recordMasterStart:recordMasterStart,recordMasterStop:recordMasterStop,sounds:_sounds,recordStart:recordStart,recordEnd:recordEnd}};exports.default=Sound},{"../common":584,"../common/gui":583,"./mediaStreamRecorder":589,"./soundRecorder":601,msr:228,sono:504,"sono/effects":534,"sono/utils/microphone":538,"sono/utils/recorder":539}],601:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var WORKER_PATH="src/js/desktop/soundRecorderWorker.js";var Recorder=function Recorder(source,cfg){var config=cfg||{};var bufferLen=config.bufferLen||4096;this.context=source.context;if(!this.context.createScriptProcessor){this.node=this.context.createJavaScriptNode(bufferLen,2,2)}else{this.node=this.context.createScriptProcessor(bufferLen,2,2)}var worker=new Worker(config.workerPath||WORKER_PATH);worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var recording=false,currCallback;this.node.onaudioprocess=function(e){if(!recording)return;worker.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]})};this.configure=function(cfg){for(var prop in cfg){if(cfg.hasOwnProperty(prop)){config[prop]=cfg[prop]}}};this.record=function(){recording=true};this.stop=function(){recording=false};this.clear=function(){worker.postMessage({command:"clear"})};this.getBuffers=function(cb){currCallback=cb||config.callback;worker.postMessage({command:"getBuffers"})};this.exportWAV=function(cb,type){currCallback=cb||config.callback;type=type||config.type||"audio/wav";if(!currCallback)throw new Error("Callback not set");worker.postMessage({command:"exportWAV",type:type})};this.exportMonoWAV=function(cb,type){currCallback=cb||config.callback;type=type||config.type||"audio/wav";if(!currCallback)throw new Error("Callback not set");worker.postMessage({command:"exportMonoWAV",type:type})};worker.onmessage=function(e){var blob=e.data;currCallback(blob)};source.connect(this.node);this.node.connect(this.context.destination)};Recorder.setupDownload=function(blob,filename){var url=(window.URL||window.webkitURL).createObjectURL(blob);var link=document.getElementById("save");link.href=url;link.download=filename||"output.wav";link.click()};exports.default=Recorder},{}],602:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _common=require("../common");var Webcam=function Webcam(webrtc){function start(){return new Promise(function(yes,no){webrtc.webrtc.start({video:_extends({},_common.videoSettings),audio:false},function(err,stream){if(err){no(err)}else{yes(stream)}})})}function stop(videoEl){webrtc.webrtc.stop(videoEl.srcObject);videoEl=null}return{start:start,stop:stop}};exports.default=Webcam},{"../common":584}],603:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};window.Whammy=function(){function toWebM(frames,outputAsArray){var info=checkFrames(frames);var CLUSTER_MAX_DURATION=3e4;var EBML=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:doubleToString(info.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:info.width,id:176},{data:info.height,id:186}]}]}]},{id:475249515,data:[]}]}];var segment=EBML[1];var cues=segment.data[2];var frameNumber=0;var clusterTimecode=0;while(frameNumber<frames.length){var cuePoint={id:187,data:[{data:Math.round(clusterTimecode),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};cues.data.push(cuePoint);var clusterFrames=[];var clusterDuration=0;do{clusterFrames.push(frames[frameNumber]);clusterDuration+=frames[frameNumber].duration;frameNumber++}while(frameNumber<frames.length&&clusterDuration<CLUSTER_MAX_DURATION);var clusterCounter=0;var cluster={id:524531317,data:[{data:Math.round(clusterTimecode),id:231}].concat(clusterFrames.map(function(webp){var block=makeSimpleBlock({discardable:0,frame:webp.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(clusterCounter)});clusterCounter+=webp.duration;return{data:block,id:163}}))};segment.data.push(cluster);clusterTimecode+=clusterDuration}var position=0;for(var i=0;i<segment.data.length;i++){if(i>=3){cues.data[i-3].data[1].data[1].data=position}var data=generateEBML([segment.data[i]],outputAsArray);position+=data.size||data.byteLength||data.length;if(i!=2){segment.data[i]=data}}return generateEBML(EBML,outputAsArray)}function checkFrames(frames){var width=frames[0].width,height=frames[0].height,duration=frames[0].duration;for(var i=1;i<frames.length;i++){if(frames[i].width!=width)throw"Frame "+(i+1)+" has a different width";if(frames[i].height!=height)throw"Frame "+(i+1)+" has a different height";if(frames[i].duration<0||frames[i].duration>32767)throw"Frame "+(i+1)+" has a weird duration (must be between 0 and 32767)";duration+=frames[i].duration}return{duration:duration,width:width,height:height}}function numToBuffer(num){var parts=[];while(num>0){parts.push(num&255);num=num>>8}return new Uint8Array(parts.reverse())}function numToFixedBuffer(num,size){var parts=new Uint8Array(size);for(var i=size-1;i>=0;i--){parts[i]=num&255;num=num>>8}return parts}function strToBuffer(str){var arr=new Uint8Array(str.length);for(var i=0;i<str.length;i++){arr[i]=str.charCodeAt(i)}return arr}function bitsToBuffer(bits){var data=[];var pad=bits.length%8?new Array(1+8-bits.length%8).join("0"):"";bits=pad+bits;for(var i=0;i<bits.length;i+=8){data.push(parseInt(bits.substr(i,8),2))}return new Uint8Array(data)}function generateEBML(json,outputAsArray){var ebml=[];for(var i=0;i<json.length;i++){if(!("id"in json[i])){ebml.push(json[i]);continue}var data=json[i].data;if((typeof data==="undefined"?"undefined":_typeof(data))=="object")data=generateEBML(data,outputAsArray);if(typeof data=="number")data="size"in json[i]?numToFixedBuffer(data,json[i].size):bitsToBuffer(data.toString(2));if(typeof data=="string")data=strToBuffer(data);if(data.length){var z=z}var len=data.size||data.byteLength||data.length;var zeroes=0;for(var j=56;j>0;j-=7){if(len>Math.pow(2,j)-2){zeroes=j/7;break}}var size_str=len.toString(2);var base=new Array(8*(zeroes+1)+1).join("0");var pre=new Array(zeroes+1).join("0")+1;var padded=base.substr(0,base.length-size_str.length-pre.length)+size_str;var size=pre+padded;ebml.push(numToBuffer(json[i].id));ebml.push(bitsToBuffer(size));ebml.push(data)}if(outputAsArray){var buffer=toFlatArray(ebml);return new Uint8Array(buffer)}else{return new Blob(ebml,{type:"video/webm"})}}function toFlatArray(arr,outBuffer){if(outBuffer==null){outBuffer=[]}for(var i=0;i<arr.length;i++){if(_typeof(arr[i])=="object"){toFlatArray(arr[i],outBuffer)}else{outBuffer.push(arr[i])}}return outBuffer}function toBinStr_old(bits){var data="";var pad=bits.length%8?new Array(1+8-bits.length%8).join("0"):"";bits=pad+bits;for(var i=0;i<bits.length;i+=8){data+=String.fromCharCode(parseInt(bits.substr(i,8),2))}return data}function generateEBML_old(json){var ebml="";for(var i=0;i<json.length;i++){var data=json[i].data;if((typeof data==="undefined"?"undefined":_typeof(data))=="object")data=generateEBML_old(data);if(typeof data=="number")data=toBinStr_old(data.toString(2));var len=data.length;var zeroes=Math.ceil(Math.ceil(Math.log(len)/Math.log(2))/8);var size_str=len.toString(2);var padded=new Array(zeroes*7+7+1-size_str.length).join("0")+size_str;var size=new Array(zeroes).join("0")+"1"+padded;ebml+=toBinStr_old(json[i].id.toString(2))+toBinStr_old(size)+data}return ebml}function makeSimpleBlock(data){var flags=0;if(data.keyframe)flags|=128;if(data.invisible)flags|=8;if(data.lacing)flags|=data.lacing<<1;if(data.discardable)flags|=1;if(data.trackNum>127){throw"TrackNumber > 127 not supported"}var out=[data.trackNum|128,data.timecode>>8,data.timecode&255,flags].map(function(e){return String.fromCharCode(e)}).join("")+data.frame;return out}function parseWebP(riff){var VP8=riff.RIFF[0].WEBP[0];var frame_start=VP8.indexOf("*");for(var i=0,c=[];i<4;i++){c[i]=VP8.charCodeAt(frame_start+3+i)}var width,horizontal_scale,height,vertical_scale,tmp;tmp=c[1]<<8|c[0];width=tmp&16383;horizontal_scale=tmp>>14;tmp=c[3]<<8|c[2];height=tmp&16383;vertical_scale=tmp>>14;return{width:width,height:height,data:VP8,riff:riff}}function parseRIFF(string){var offset=0;var chunks={};while(offset<string.length){var id=string.substr(offset,4);chunks[id]=chunks[id]||[];if(id=="RIFF"||id=="LIST"){var len=parseInt(string.substr(offset+4,4).split("").map(function(i){var unpadded=i.charCodeAt(0).toString(2);return new Array(8-unpadded.length+1).join("0")+unpadded}).join(""),2);var data=string.substr(offset+4+4,len);offset+=4+4+len;chunks[id].push(parseRIFF(data))}else if(id=="WEBP"){chunks[id].push(string.substr(offset+8));offset=string.length}else{chunks[id].push(string.substr(offset+4));offset=string.length}}return chunks}function doubleToString(num){return[].slice.call(new Uint8Array(new Float64Array([num]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}function WhammyVideo(speed,quality){this.frames=[];this.duration=1e3/speed;this.quality=quality||.8}WhammyVideo.prototype.add=function(frame,duration){if(typeof duration!="undefined"&&this.duration)throw"you can't pass a duration if the fps is set";if(typeof duration=="undefined"&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(frame.canvas){frame=frame.canvas}if(frame.toDataURL){frame=frame.getContext("2d").getImageData(0,0,frame.width,frame.height)}else if(typeof frame!="string"){throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string"}if(typeof frame==="string"&&!/^data:image\/webp;base64,/gi.test(frame)){throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp"}this.frames.push({image:frame,duration:duration||this.duration})};WhammyVideo.prototype.encodeFrames=function(callback){if(this.frames[0].image instanceof ImageData){var frames=this.frames;var tmpCanvas=document.createElement("canvas");var tmpContext=tmpCanvas.getContext("2d");tmpCanvas.width=this.frames[0].image.width;tmpCanvas.height=this.frames[0].image.height;var encodeFrame=function(index){var frame=frames[index];tmpContext.putImageData(frame.image,0,0);frame.image=tmpCanvas.toDataURL("image/webp",this.quality);if(index<frames.length-1){setTimeout(function(){encodeFrame(index+1)},1)}else{callback()}}.bind(this);encodeFrame(0)}else{callback()}};WhammyVideo.prototype.compile=function(outputAsArray,callback){this.encodeFrames(function(){var webm=new toWebM(this.frames.map(function(frame){var webp=parseWebP(parseRIFF(atob(frame.image.slice(23))));webp.duration=frame.duration;return webp}),outputAsArray);callback(webm)}.bind(this))};return{Video:WhammyVideo,fromImageArray:function fromImageArray(images,fps,outputAsArray){return toWebM(images.map(function(image){var webp=parseWebP(parseRIFF(atob(image.slice(23))));webp.duration=1e3/fps;return webp}),outputAsArray)},toWebM:toWebM}}();exports.default=window.Whammy},{}],604:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _gui=require("../common/gui");var _gui2=_interopRequireDefault(_gui);var _interaction=require("./interaction");var _interaction2=_interopRequireDefault(_interaction);var _accelerometer=require("../common/accelerometer");var _accelerometer2=_interopRequireDefault(_accelerometer);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Mobile=function Mobile(webrtc,state,emitter){if(Detector.isDesktop)return;var peers=new Set;var desktopPeer={id:null,peer:null,secret:null};var roomEl=document.body.querySelector(".room");var videoEl=document.getElementById("localVideo");videoEl.style.display="none";var remoteVideoEl=document.getElementById("remoteVideos");remoteVideoEl.style.display="none";var interaction=(0,_interaction2.default)(webrtc);var accelerometer=(0,_accelerometer2.default)();accelerometer.on("devicemotion",function(state){send(_common.M_DEVICE_MOTION,state)});accelerometer.on("deviceorientation",function(state){if(state.landscape){state.alpha=-1*state.alpha/_common.ALPHA_SENS}send(_common.M_DEVICE_ORIEN,state)});accelerometer.on("orientationchange",function(state){});var send=function send(msg,payload){return webrtc.sendToAll(msg,payload)};var sendChannel=function sendChannel(msg,payload){return webrtc.sendDirectlyToAll(state.room.id,msg,payload)};var sendDimentions=function sendDimentions(){send(_common.M_SCREEN_SIZE,{width:window.innerWidth,height:window.innerHeight})};var secretHandshake=function secretHandshake(){console.log("Sent local:mobile:handshake "+desktopPeer.secret+" ");send("local:mobile:handshake",{id:desktopPeer.id,uuid:desktopPeer.uuid,secret:desktopPeer.secret})};function addListeners(){webrtc.on("createdPeer",function(peer){console.log("Found peer!");peers.add(peer);send("local:mobile:hello",{id:peer.id})});webrtc.on("leftRoom",function(roomId){console.log("Left the room")});webrtc.on("peerRemoved",function(peer){console.log(peer.id+" left");peers.delete(peer);if(desktopPeer.id===peer.id){desktopPeer.id=null;desktopPeer.secret=null;desktopPeer.uuid=null;desktopPeer.peer=null}});webrtc.connection.on("message",function(data){switch(data.type){case"local:desktop:handshake":{var _data$payload=data.payload,secret=_data$payload.secret,uuid=_data$payload.uuid;(0,_common.logInfo)("From "+data.from);console.log("Got handhsake from "+data.from+" with secret: "+data.payload);console.log("The current saved secret is: "+desktopPeer.secret);if(secret===desktopPeer.secret){console.log("secret matched desktopPeer.secret");desktopPeer.id=data.from;desktopPeer.uuid=uuid;desktopPeer.peer=(0,_common.findPeer)(peers.values(),data.from);sendDimentions();secretHandshake()}break}case"local:desktop:secret":{if(!desktopPeer.secret){desktopPeer.id=data.from;desktopPeer.secret=data.payload;console.log("Got and saved secret "+data.payload);send("local:mobile:secret:set",{id:desktopPeer.id})}break}case _common.M_SCREEN_SIZE:{console.log(data);break}case"local:desktop:joinRoom":{if(_gui2.default.connect&&data.payload.secret===desktopPeer.secret){console.log("local:desktop:joinRoom "+data.payload.roomId);send("local:mobile:joiningRoom",{secret:desktopPeer.secret,roomId:data.payload.roomId});emitter.emit("webrtc:connect",data.payload)}break}}})}_gui2.default.on("disconnect",function(v){if(v){}});_gui2.default.on("connect",function(v){if(v){}});addListeners();return{}};exports.default=Mobile},{"../common":584,"../common/accelerometer":578,"../common/gui":583,"./interaction":605}],605:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _hammerjs=require("hammerjs");var _hammerjs2=_interopRequireDefault(_hammerjs);var _intrinsicScale=require("intrinsic-scale");var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MobileInteraction=function MobileInteraction(webrtc){var videoEl=document.getElementById("localVideo");var canvasOff=document.createElement("canvas");canvasOff.classList.add("u-full","no-interaction");var ctx=canvasOff.getContext("2d");canvasOff.style.display="none";document.body.appendChild(canvasOff);var hammertime=new _hammerjs2.default(document.body);hammertime.on("tap",function(e){var _contain=(0,_intrinsicScale.contain)(window.innerWidth,window.innerHeight,_common.WIDTH,_common.HEIGHT),width=_contain.width,height=_contain.height,x=_contain.x,y=_contain.y;videoEl.style.display="block";canvasOff.width=width;canvasOff.height=height;ctx.drawImage(videoEl,0,0,width,height);canvasOff.style.display="block";setTimeout(function(){videoEl.style.display="none";canvasOff.style.display="none"},2e3);var frame=ctx.getImageData(0,0,width,height);var color=[frame.data[e.center.x*e.center.y*4],frame.data[e.center.x*e.center.y*4+1],frame.data[e.center.x*e.center.y*4+2]];webrtc.sendToAll("local:mobile:addKeyColor",color)})};exports.default=MobileInteraction},{"../common":584,hammerjs:206,"intrinsic-scale":219}],606:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(state,emitter){emitter.on("peer:found",function(id){state.peerFound=id;emitter.emit("render")});emitter.on("peer:connect:requested",function(id){if(state.peerRequest)return;state.peerRequest=id;emitter.emit("render")});emitter.on("peer:connect:accepted",function(id){if(state.peerConnected)return;state.peerRequest=id;state.peerConnected=id;emitter.emit("render")});emitter.on("set:ctx",function(ctx){state.ctx=ctx});emitter.on("add:image",function(buffer){state.images.push(buffer);emitter.emit("render")});state.peerFound=null;state.peerRequest=null;state.peerConnected=null;state.ctx=null;state.images=[];emitter.emit("render")}},{}],607:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _common=require("./common");var _gui=require("./common/gui");var _gui2=_interopRequireDefault(_gui);var _objectPool=require("usfl/object-pool");var _objectPool2=_interopRequireDefault(_objectPool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function cb(data){return data}var Socket=function(){function Socket(){_classCallCheck(this,Socket);this._cbPool={}}_createClass(Socket,[{key:"on",value:function on(str,cb){this._socket.on(str,cb)}},{key:"emit",value:function emit(event,data,cb){var _this=this;if(cb){this._cbPool[event]=function(data){_this._socket.off(event,_this._cbPool[event]);cb(data)};this._socket.on(event,this._cbPool[event])}this._socket.emit(event,data)}},{key:"createRoom",value:function createRoom(_ref){var roomId=_ref.roomId;if(!roomId)return;this.emit("room:create",{id:this._socket.id,desktop:_common.IS_DESKTOP,roomId:roomId})}},{key:"socket",set:function set(s){var _this2=this;this._socket=s;this._socket.on("connect",function(id){_this2.createRoom({roomId:_gui2.default.state.room.id.length?_gui2.default.state.room.id:null})});this._socket.on("handshake",function(roomId){_this2.emitter.emit("set:roomId",roomId)});this._socket.on("event",function(data){console.log(data)});this._socket.on("disconnect",function(){})},get:function get(){return this._socket}},{key:"emiter",set:function set(e){this._emitter=e},get:function get(){return this._emitter}}]);return Socket}();exports.default=new Socket},{"./common":584,"./common/gui":583,"usfl/object-pool":546}],608:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _queryString=require("query-string");var _queryString2=_interopRequireDefault(_queryString);var _uuid=require("uuid");var _uuid2=_interopRequireDefault(_uuid);var _socket=require("socket.io-client");var _socket2=_interopRequireDefault(_socket);var _simplewebrtc=require("simplewebrtc");var _simplewebrtc2=_interopRequireDefault(_simplewebrtc);var _common=require("./common");var _emitter=require("./common/emitter");var _emitter2=_interopRequireDefault(_emitter);var _gui=require("./common/gui");var _gui2=_interopRequireDefault(_gui);var _server=require("./common/server");var _server2=_interopRequireDefault(_server);var _socket3=require("./socket");var _socket4=_interopRequireDefault(_socket3);var _desktop=require("./desktop");var _desktop2=_interopRequireDefault(_desktop);var _mobile=require("./mobile");var _mobile2=_interopRequireDefault(_mobile);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var WebRTC=function WebRTC(state,emitter){function init(){(0,_common.logSuccess)("First load");var noCamera=_queryString2.default.parse(location.search).noc;var videoSettings={width:{max:_common.WIDTH},height:{max:_common.HEIGHT},frameRate:{max:_common.FPS}};var webrtc=new _simplewebrtc2.default({nick:{desktop:Detector.isDesktop,uuid:_uuid2.default.v4()},autoRemoveVideos:true,autoRequestMedia:true,localVideoEl:"localVideo",remoteVideosEl:"remoteVideos",media:{video:state.useWebcam?Detector.isDesktop?noCamera?false:_extends({},videoSettings):noCamera?false:_extends({},videoSettings,{facingMode:"environment"}):false,audio:!Detector.isDesktop},receiveMedia:{offerToReceiveAudio:Detector.isDesktop,offerToReceiveVideo:Detector.isDesktop},offerToReceiveAudio:Detector.isDesktop,offerToReceiveVideo:Detector.isDesktop},{mirror:false});var desktop=(0,_desktop2.default)(webrtc,state,emitter);var mobile=(0,_mobile2.default)(webrtc,state,emitter);webrtc.on("disconnect",function(evt){console.log("Webrtc:disconnect");_socket4.default.emit("room:leave")});webrtc.on("connectionReady",function(evt){(0,_common.logInfo)("connectionReady");if(_common.IS_PROD){_socket4.default.socket=webrtc.connection.connection}});webrtc.on("readyToCall",function(){});var leaveRoom=function leaveRoom(roomId){_socket4.default.emit("room:leave",{roomId:state.room.id});webrtc.leaveRoom()};var joinRoom=function joinRoom(roomId){emitter.emit("room:change",roomId);_socket4.default.createRoom({roomId:roomId});(0,_gui.connect)();webrtc.joinRoom(roomId)};emitter.on("webrtc:connect",function(_ref){var roomId=_ref.roomId;_socket4.default.emit("rooms:canJoin",{roomId:roomId,desktop:_common.IS_DESKTOP},function(resp){console.log("---------");console.log(resp);console.log("---------");if(resp.canJoin){console.log("Gui.connected",_gui2.default.connect);if(_gui2.default.connect){(0,_gui.disconnect)();leaveRoom(roomId)}(0,_gui.connect)();joinRoom(roomId)}else{(0,_common.logError)("Cannot join room "+roomId)}});if(_gui2.default.started)return;_gui2.default.started=true});emitter.emit("webrtc:connect",{roomId:state.room.id})}emitter.once("view:room:onload",function(){init()})};module.exports=store;function store(state,emitter){state.randomRoomId=_queryString2.default.parse(location.search).room;state.useWebcam=Detector.isMobile?true:false;state.room={created:false,id:"",recording:false};_gui2.default.state=state;emitter.on("DOMContentLoaded",function(){});emitter.on("set:roomId",function(v){state.randomRoomId=v});emitter.on("room:change",function(v){state.room.id=v});emitter.on("state:usewebcam",function(v){state.useWebcam=v});emitter.on("room:create",function(roomId){state.room.id=roomId;if(state.room.created){emitter.emit("webrtc:connect",{roomId:roomId})}else{emitter.emit("render")}state.room.created=true});emitter.on("room:create:input",function(v){state.room.id=v;emitter.emit("render")});_server2.default.roomId().then(function(_ref2){var roomId=_ref2.roomId;state.randomRoomId=state.randomRoomId||roomId;emitter.emit("render")});_socket4.default.emitter=emitter;_socket4.default.socket=(0,_socket2.default)(_common.SERVER_URL);var webrtc=WebRTC(state,emitter)}exports.default=WebRTC},{"./common":584,"./common/emitter":582,"./common/gui":583,"./common/server":585,"./desktop":586,"./mobile":604,"./socket":607,"query-string":426,simplewebrtc:489,"socket.io-client":492,uuid:551}],609:[function(require,module,exports){"use strict";var _templateObject=_taggedTemplateLiteral(['\n    <section>\n    <header class="header">\n      <h1>join room</h1>\n      <input class="new-todo"\n        value=',"\n        autofocus\n        onkeyup=",'\n        placeholder="room name"/>\n        <button class="clear-completed" onclick=',">\n        join ",'\n      </button>\n      <div><span>use webcam</span><input label="use webcam" checked=','  type="checkbox" onchange=',"></div>\n      <h1>join new room ",'</h1>\n       <button class="clear-completed" onclick='," >\n        create\n      </button>\n    </section>\n  "],['\n    <section>\n    <header class="header">\n      <h1>join room</h1>\n      <input class="new-todo"\n        value=',"\n        autofocus\n        onkeyup=",'\n        placeholder="room name"/>\n        <button class="clear-completed" onclick=',">\n        join ",'\n      </button>\n      <div><span>use webcam</span><input label="use webcam" checked=','  type="checkbox" onchange=',"></div>\n      <h1>join new room ",'</h1>\n       <button class="clear-completed" onclick='," >\n        create\n      </button>\n    </section>\n  "]);var _html=require("choo/html");var _html2=_interopRequireDefault(_html);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var bel=require("bel");module.exports=function(state,emit){emit("log:debug","Rendering home view");if(state.room.created)return null;var createRoomInput=function createRoomInput(e){var value=e.target.value;if(!value)return;if(e.keyCode===13){emit("room:create",value)}else{emit("room:create:input",value)}};var joinRoom=function joinRoom(){emit("room:create",state.room.id)};var createRoom=function createRoom(e){emit("room:create",state.randomRoomId)};var changeCheckbox=function changeCheckbox(e){emit("state:usewebcam",e.target.checked)};var tree=bel(_templateObject,state.room.id,createRoomInput,joinRoom,state.room.id,state.useWebcam?"checked":"false",changeCheckbox,state.randomRoomId,createRoom);return tree}},{bel:22,"choo/html":36}],610:[function(require,module,exports){"use strict";var _templateObject=_taggedTemplateLiteral(['<div class="u-canvas-container">\n      <canvas class="canvas" id="c_output"></canvas>\n      </div>'],['<div class="u-canvas-container">\n      <canvas class="canvas" id="c_output"></canvas>\n      </div>']),_templateObject2=_taggedTemplateLiteral(['<div id="pixi" class="u-canvas-container">\n      <canvas class="canvas" ></canvas>\n      </div>'],['<div id="pixi" class="u-canvas-container">\n      <canvas class="canvas" ></canvas>\n      </div>']),_templateObject3=_taggedTemplateLiteral(['\n    <section class="room u-full">\n      <div class="rooms"></div>\n      <video class="u-full video--local" id="localVideo" playsinline autoplay ></video>\n      <div class="u-full videos--remote" id="remoteVideos"></div>\n      ',"\n      ","\n    </section>\n  "],['\n    <section class="room u-full">\n      <div class="rooms"></div>\n      <video class="u-full video--local" id="localVideo" playsinline autoplay ></video>\n      <div class="u-full videos--remote" id="remoteVideos"></div>\n      ',"\n      ","\n    </section>\n  "]);var _html=require("choo/html");var _html2=_interopRequireDefault(_html);var _component=require("../common/component");var _component2=_interopRequireDefault(_component);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}module.exports=function(state,emit){emit("log:debug","Rendering Room");if(!state.room.created)return null;var renderCanvas=function renderCanvas(){return _common.IS_MOBILE?null:(0,_html2.default)(_templateObject)};var renderPixi=function renderPixi(){return _common.IS_MOBILE?null:(0,_html2.default)(_templateObject2)};var tree=new _component2.default;return tree.render((0,_html2.default)(_templateObject3,renderCanvas(),renderPixi()),{onload:function onload(){emit("view:room:onload")}})}},{"../common":584,"../common/component":580,"choo/html":36}],611:[function(require,module,exports){"use strict";var _templateObject=_taggedTemplateLiteral(['\n    <section class="u-full">\n      <h1 class="room--title" >In room ',"</h1>\n    </section>\n  "],['\n    <section class="u-full">\n      <h1 class="room--title" >In room ',"</h1>\n    </section>\n  "]);var _html=require("choo/html");var _html2=_interopRequireDefault(_html);var _component=require("../common/component");var _component2=_interopRequireDefault(_component);var _gui=require("../common/gui");var _gui2=_interopRequireDefault(_gui);var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}module.exports=function(state,emit,emitter){if(!state.room.created)return null;var tree=new _component2.default;var getHTML=function getHTML(room){return(0,_html2.default)(_templateObject,room.id)};_gui2.default.on("disconnect",function(v){tree.rerender()});emitter.on("room:change",function(v){tree.update(getHTML({id:v}));tree.rerender()});return tree.render(getHTML(state.room),"u-full RoomUi",{onload:function onload(){}})}},{"../common":584,"../common/component":580,"../common/gui":583,"choo/html":36}]},{},[1]);
